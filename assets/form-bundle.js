var f5=Object.create;var{getPrototypeOf:S5,defineProperty:Q1,getOwnPropertyNames:x5}=Object;var k5=Object.prototype.hasOwnProperty;var G1=($,J,q)=>{q=$!=null?f5(S5($)):{};let Z=J||!$||!$.__esModule?Q1(q,"default",{value:$,enumerable:!0}):q;for(let X of x5($))if(!k5.call(Z,X))Q1(Z,X,{get:()=>$[X],enumerable:!0});return Z};var v5=($,J)=>()=>(J||$((J={exports:{}}).exports,J),J.exports);var XJ=v5((TG,Z9)=>{Z9.exports=function $(J){if(typeof J==="number"&&isNaN(J))throw new Error("NaN is not allowed");if(typeof J==="number"&&!isFinite(J))throw new Error("Infinity is not allowed");if(J===null||typeof J!=="object")return JSON.stringify(J);if(J.toJSON instanceof Function)return $(J.toJSON());if(Array.isArray(J))return`[${J.reduce((X,Q,G)=>{return`${X}${G===0?"":","}${$(Q===void 0||typeof Q==="symbol"?null:Q)}`},"")}]`;return`{${Object.keys(J).sort().reduce((Z,X)=>{if(J[X]===void 0||typeof J[X]==="symbol")return Z;let Q=Z.length===0?"":",";return`${Z}${Q}${$(X)}:${$(J[X])}`},"")}}`}});class c${runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let J=$.dataset.copyFrom;if(J){let X=($.closest("tr")||document).querySelector(`[data-base-key="${J}"], [data-json-path="${J}"]`);if(X&&X.value!==$.value)$.value=X.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let J=$.dataset.formula;if(!J)return;let q=$.closest("tr"),Z=$.closest("table"),X=(G)=>{let U=0,Y="none";if(q){let z=`[data-base-key="${G}"], [data-json-path="${G}"]`,W=q.querySelector(z);if(W){if(Y="row-input",W.value!=="")U=parseFloat(W.value)}}if(Y==="none"){let z=document.querySelector(`[data-json-path="${G}"]`);if(z){if(Y="static-input",z.value!=="")U=parseFloat(z.value)}}return U},Q=J.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(G,U)=>{let Y=0,z=Z||document,W=z.querySelectorAll(`[data-base-key="${U}"], [data-json-path="${U}"]`);if(W.length===0&&z!==document)W=document.querySelectorAll(`[data-base-key="${U}"], [data-json-path="${U}"]`);return W.forEach((K)=>{let M=parseFloat(K.value);if(!isNaN(M))Y+=M}),Y});Q=Q.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(G)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(G))return G;return String(X(G))});try{let G=new Function("return "+Q)();if(typeof G==="number"&&!isNaN(G))$.value=Number.isInteger(G)?G:G.toFixed(0);else $.value=""}catch(G){console.error("Calc Error:",G),$.value="Err"}}),this.runAutoCopy()}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function x0($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function T8($,J=""){if(!Number.isSafeInteger($)||$<0){let q=J&&`"${J}" `;throw new Error(`${q}expected integer >= 0, got ${$}`)}}function c($,J,q=""){let Z=x0($),X=$?.length,Q=J!==void 0;if(!Z||Q&&X!==J){let G=q&&`"${q}" `,U=Q?` of length ${J}`:"",Y=Z?`length=${X}`:`type=${typeof $}`;throw new Error(G+"expected Uint8Array"+U+", got "+Y)}return $}function k0($){if(typeof $!=="function"||typeof $.create!=="function")throw new Error("Hash must wrapped by utils.createHasher");T8($.outputLen),T8($.blockLen)}function b8($,J=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(J&&$.finished)throw new Error("Hash#digest() has already been called")}function q$($,J){c($,void 0,"digestInto() output");let q=J.outputLen;if($.length<q)throw new Error('"digestInto() output" expected to be of length >='+q)}function Z$($){return new Uint32Array($.buffer,$.byteOffset,Math.floor($.byteLength/4))}function B8(...$){for(let J=0;J<$.length;J++)$[J].fill(0)}function X$($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function I8($,J){return $<<32-J|$>>>J}var _5=(()=>new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68)();function g5($){return $<<24&4278190080|$<<8&16711680|$>>>8&65280|$>>>24&255}function y5($){for(let J=0;J<$.length;J++)$[J]=g5($[J]);return $}var l$=_5?($)=>$:y5,Y1=(()=>typeof Uint8Array.from([]).toHex==="function"&&typeof Uint8Array.fromHex==="function")(),m5=Array.from({length:256},($,J)=>J.toString(16).padStart(2,"0"));function B0($){if(c($),Y1)return $.toHex();let J="";for(let q=0;q<$.length;q++)J+=m5[$[q]];return J}var m8={_0:48,_9:57,A:65,F:70,a:97,f:102};function U1($){if($>=m8._0&&$<=m8._9)return $-m8._0;if($>=m8.A&&$<=m8.F)return $-(m8.A-10);if($>=m8.a&&$<=m8.f)return $-(m8.a-10);return}function v0($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);if(Y1)return Uint8Array.fromHex($);let J=$.length,q=J/2;if(J%2)throw new Error("hex string expected, got unpadded hex of length "+J);let Z=new Uint8Array(q);for(let X=0,Q=0;X<q;X++,Q+=2){let G=U1($.charCodeAt(Q)),U=U1($.charCodeAt(Q+1));if(G===void 0||U===void 0){let Y=$[Q]+$[Q+1];throw new Error('hex string expected, got non-hex character "'+Y+'" at index '+Q)}Z[X]=G*16+U}return Z}function H0(...$){let J=0;for(let Z=0;Z<$.length;Z++){let X=$[Z];c(X),J+=X.length}let q=new Uint8Array(J);for(let Z=0,X=0;Z<$.length;Z++){let Q=$[Z];q.set(Q,X),X+=Q.length}return q}function R0($,J={}){let q=(X,Q)=>$(Q).update(X).digest(),Z=$(void 0);return q.outputLen=Z.outputLen,q.blockLen=Z.blockLen,q.create=(X)=>$(X),Object.assign(q,J),Object.freeze(q)}function Q0($=32){let J=typeof globalThis==="object"?globalThis.crypto:null;if(typeof J?.getRandomValues!=="function")throw new Error("crypto.getRandomValues must be defined");return J.getRandomValues(new Uint8Array($))}var o8=($)=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,$])});function W1($,J,q){return $&J^~$&q}function z1($,J,q){return $&J^$&q^J&q}class Q${blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor($,J,q,Z){this.blockLen=$,this.outputLen=J,this.padOffset=q,this.isLE=Z,this.buffer=new Uint8Array($),this.view=X$(this.buffer)}update($){b8(this),c($);let{view:J,buffer:q,blockLen:Z}=this,X=$.length;for(let Q=0;Q<X;){let G=Math.min(Z-this.pos,X-Q);if(G===Z){let U=X$($);for(;Z<=X-Q;Q+=Z)this.process(U,Q);continue}if(q.set($.subarray(Q,Q+G),this.pos),this.pos+=G,Q+=G,this.pos===Z)this.process(J,0),this.pos=0}return this.length+=$.length,this.roundClean(),this}digestInto($){b8(this),q$($,this),this.finished=!0;let{buffer:J,view:q,blockLen:Z,isLE:X}=this,{pos:Q}=this;if(J[Q++]=128,B8(this.buffer.subarray(Q)),this.padOffset>Z-Q)this.process(q,0),Q=0;for(let W=Q;W<Z;W++)J[W]=0;q.setBigUint64(Z-8,BigInt(this.length*8),X),this.process(q,0);let G=X$($),U=this.outputLen;if(U%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let Y=U/4,z=this.get();if(Y>z.length)throw new Error("_sha2: outputLen bigger than state");for(let W=0;W<Y;W++)G.setUint32(4*W,z[W],X)}digest(){let{buffer:$,outputLen:J}=this;this.digestInto($);let q=$.slice(0,J);return this.destroy(),q}_cloneInto($){$||=new this.constructor,$.set(...this.get());let{blockLen:J,buffer:q,length:Z,finished:X,destroyed:Q,pos:G}=this;if($.destroyed=Q,$.finished=X,$.length=Z,$.pos=G,Z%J)$.buffer.set(q);return $}clone(){return this._cloneInto()}}var h8=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),u8=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),X8=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Q8=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var G$=BigInt(4294967295),K1=BigInt(32);function b5($,J=!1){if(J)return{h:Number($&G$),l:Number($>>K1&G$)};return{h:Number($>>K1&G$)|0,l:Number($&G$)|0}}function U$($,J=!1){let q=$.length,Z=new Uint32Array(q),X=new Uint32Array(q);for(let Q=0;Q<q;Q++){let{h:G,l:U}=b5($[Q],J);[Z[Q],X[Q]]=[G,U]}return[Z,X]}var n$=($,J,q)=>$>>>q,i$=($,J,q)=>$<<32-q|J>>>q,G0=($,J,q)=>$>>>q|J<<32-q,U0=($,J,q)=>$<<32-q|J>>>q,_0=($,J,q)=>$<<64-q|J>>>q-32,g0=($,J,q)=>$>>>q-32|J<<64-q;var D1=($,J,q)=>$<<q|J>>>32-q,M1=($,J,q)=>J<<q|$>>>32-q,V1=($,J,q)=>J<<q-32|$>>>64-q,O1=($,J,q)=>$<<q-32|J>>>64-q;function S8($,J,q,Z){let X=(J>>>0)+(Z>>>0);return{h:$+q+(X/4294967296|0)|0,l:X|0}}var N1=($,J,q)=>($>>>0)+(J>>>0)+(q>>>0),B1=($,J,q,Z)=>J+q+Z+($/4294967296|0)|0,H1=($,J,q,Z)=>($>>>0)+(J>>>0)+(q>>>0)+(Z>>>0),R1=($,J,q,Z,X)=>J+q+Z+X+($/4294967296|0)|0,C1=($,J,q,Z,X)=>($>>>0)+(J>>>0)+(q>>>0)+(Z>>>0)+(X>>>0),w1=($,J,q,Z,X,Q)=>J+q+Z+X+Q+($/4294967296|0)|0;var u5=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),r8=new Uint32Array(64);class o$ extends Q${constructor($){super(64,$,8,!1)}get(){let{A:$,B:J,C:q,D:Z,E:X,F:Q,G,H:U}=this;return[$,J,q,Z,X,Q,G,U]}set($,J,q,Z,X,Q,G,U){this.A=$|0,this.B=J|0,this.C=q|0,this.D=Z|0,this.E=X|0,this.F=Q|0,this.G=G|0,this.H=U|0}process($,J){for(let W=0;W<16;W++,J+=4)r8[W]=$.getUint32(J,!1);for(let W=16;W<64;W++){let K=r8[W-15],M=r8[W-2],O=I8(K,7)^I8(K,18)^K>>>3,H=I8(M,17)^I8(M,19)^M>>>10;r8[W]=H+r8[W-7]+O+r8[W-16]|0}let{A:q,B:Z,C:X,D:Q,E:G,F:U,G:Y,H:z}=this;for(let W=0;W<64;W++){let K=I8(G,6)^I8(G,11)^I8(G,25),M=z+K+W1(G,U,Y)+u5[W]+r8[W]|0,H=(I8(q,2)^I8(q,13)^I8(q,22))+z1(q,Z,X)|0;z=Y,Y=U,U=G,G=Q+M|0,Q=X,X=Z,Z=q,q=M+H|0}q=q+this.A|0,Z=Z+this.B|0,X=X+this.C|0,Q=Q+this.D|0,G=G+this.E|0,U=U+this.F|0,Y=Y+this.G|0,z=z+this.H|0,this.set(q,Z,X,Q,G,U,Y,z)}roundClean(){B8(r8)}destroy(){this.set(0,0,0,0,0,0,0,0),B8(this.buffer)}}class T1 extends o${A=h8[0]|0;B=h8[1]|0;C=h8[2]|0;D=h8[3]|0;E=h8[4]|0;F=h8[5]|0;G=h8[6]|0;H=h8[7]|0;constructor(){super(32)}}class p5 extends o${A=u8[0]|0;B=u8[1]|0;C=u8[2]|0;D=u8[3]|0;E=u8[4]|0;F=u8[5]|0;G=u8[6]|0;H=u8[7]|0;constructor(){super(28)}}var F1=(()=>U$(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(($)=>BigInt($))))(),d5=(()=>F1[0])(),c5=(()=>F1[1])(),s8=new Uint32Array(80),a8=new Uint32Array(80);class y0 extends Q${constructor($){super(128,$,16,!1)}get(){let{Ah:$,Al:J,Bh:q,Bl:Z,Ch:X,Cl:Q,Dh:G,Dl:U,Eh:Y,El:z,Fh:W,Fl:K,Gh:M,Gl:O,Hh:H,Hl:E}=this;return[$,J,q,Z,X,Q,G,U,Y,z,W,K,M,O,H,E]}set($,J,q,Z,X,Q,G,U,Y,z,W,K,M,O,H,E){this.Ah=$|0,this.Al=J|0,this.Bh=q|0,this.Bl=Z|0,this.Ch=X|0,this.Cl=Q|0,this.Dh=G|0,this.Dl=U|0,this.Eh=Y|0,this.El=z|0,this.Fh=W|0,this.Fl=K|0,this.Gh=M|0,this.Gl=O|0,this.Hh=H|0,this.Hl=E|0}process($,J){for(let N=0;N<16;N++,J+=4)s8[N]=$.getUint32(J),a8[N]=$.getUint32(J+=4);for(let N=16;N<80;N++){let w=s8[N-15]|0,f=a8[N-15]|0,v=G0(w,f,1)^G0(w,f,8)^n$(w,f,7),g=U0(w,f,1)^U0(w,f,8)^i$(w,f,7),y=s8[N-2]|0,F=a8[N-2]|0,j=G0(y,F,19)^_0(y,F,61)^n$(y,F,6),S=U0(y,F,19)^g0(y,F,61)^i$(y,F,6),m=H1(g,S,a8[N-7],a8[N-16]),d=R1(m,v,j,s8[N-7],s8[N-16]);s8[N]=d|0,a8[N]=m|0}let{Ah:q,Al:Z,Bh:X,Bl:Q,Ch:G,Cl:U,Dh:Y,Dl:z,Eh:W,El:K,Fh:M,Fl:O,Gh:H,Gl:E,Hh:B,Hl:L}=this;for(let N=0;N<80;N++){let w=G0(W,K,14)^G0(W,K,18)^_0(W,K,41),f=U0(W,K,14)^U0(W,K,18)^g0(W,K,41),v=W&M^~W&H,g=K&O^~K&E,y=C1(L,f,g,c5[N],a8[N]),F=w1(y,B,w,v,d5[N],s8[N]),j=y|0,S=G0(q,Z,28)^_0(q,Z,34)^_0(q,Z,39),m=U0(q,Z,28)^g0(q,Z,34)^g0(q,Z,39),d=q&X^q&G^X&G,D=Z&Q^Z&U^Q&U;B=H|0,L=E|0,H=M|0,E=O|0,M=W|0,O=K|0,{h:W,l:K}=S8(Y|0,z|0,F|0,j|0),Y=G|0,z=U|0,G=X|0,U=Q|0,X=q|0,Q=Z|0;let A=N1(j,m,D);q=B1(A,F,S,d),Z=A|0}({h:q,l:Z}=S8(this.Ah|0,this.Al|0,q|0,Z|0)),{h:X,l:Q}=S8(this.Bh|0,this.Bl|0,X|0,Q|0),{h:G,l:U}=S8(this.Ch|0,this.Cl|0,G|0,U|0),{h:Y,l:z}=S8(this.Dh|0,this.Dl|0,Y|0,z|0),{h:W,l:K}=S8(this.Eh|0,this.El|0,W|0,K|0),{h:M,l:O}=S8(this.Fh|0,this.Fl|0,M|0,O|0),{h:H,l:E}=S8(this.Gh|0,this.Gl|0,H|0,E|0),{h:B,l:L}=S8(this.Hh|0,this.Hl|0,B|0,L|0),this.set(q,Z,X,Q,G,U,Y,z,W,K,M,O,H,E,B,L)}roundClean(){B8(s8,a8)}destroy(){B8(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class j1 extends y0{Ah=Q8[0]|0;Al=Q8[1]|0;Bh=Q8[2]|0;Bl=Q8[3]|0;Ch=Q8[4]|0;Cl=Q8[5]|0;Dh=Q8[6]|0;Dl=Q8[7]|0;Eh=Q8[8]|0;El=Q8[9]|0;Fh=Q8[10]|0;Fl=Q8[11]|0;Gh=Q8[12]|0;Gl=Q8[13]|0;Hh=Q8[14]|0;Hl=Q8[15]|0;constructor(){super(64)}}class l5 extends y0{Ah=X8[0]|0;Al=X8[1]|0;Bh=X8[2]|0;Bl=X8[3]|0;Ch=X8[4]|0;Cl=X8[5]|0;Dh=X8[6]|0;Dl=X8[7]|0;Eh=X8[8]|0;El=X8[9]|0;Fh=X8[10]|0;Fl=X8[11]|0;Gh=X8[12]|0;Gl=X8[13]|0;Hh=X8[14]|0;Hl=X8[15]|0;constructor(){super(48)}}var Y8=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),W8=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class n5 extends y0{Ah=Y8[0]|0;Al=Y8[1]|0;Bh=Y8[2]|0;Bl=Y8[3]|0;Ch=Y8[4]|0;Cl=Y8[5]|0;Dh=Y8[6]|0;Dl=Y8[7]|0;Eh=Y8[8]|0;El=Y8[9]|0;Fh=Y8[10]|0;Fl=Y8[11]|0;Gh=Y8[12]|0;Gl=Y8[13]|0;Hh=Y8[14]|0;Hl=Y8[15]|0;constructor(){super(28)}}class i5 extends y0{Ah=W8[0]|0;Al=W8[1]|0;Bh=W8[2]|0;Bl=W8[3]|0;Ch=W8[4]|0;Cl=W8[5]|0;Dh=W8[6]|0;Dl=W8[7]|0;Eh=W8[8]|0;El=W8[9]|0;Fh=W8[10]|0;Fl=W8[11]|0;Gh=W8[12]|0;Gl=W8[13]|0;Hh=W8[14]|0;Hl=W8[15]|0;constructor(){super(32)}}var H8=R0(()=>new T1,o8(1));var A1=R0(()=>new j1,o8(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var P1=BigInt(0),L1=BigInt(1);function W$($,J=""){if(typeof $!=="boolean"){let q=J&&`"${J}" `;throw new Error(q+"expected boolean, got type="+typeof $)}return $}function o5($){if(typeof $==="bigint"){if(!Y$($))throw new Error("positive bigint expected, got "+$)}else T8($);return $}function I1($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);return $===""?P1:BigInt("0x"+$)}function E1($){return I1(B0($))}function p8($){return I1(B0(Y0(c($)).reverse()))}function r$($,J){T8(J),$=o5($);let q=v0($.toString(16).padStart(J*2,"0"));if(q.length!==J)throw new Error("number too large");return q}function z$($,J){return r$($,J).reverse()}function Y0($){return Uint8Array.from($)}var Y$=($)=>typeof $==="bigint"&&P1<=$;function r5($,J,q){return Y$($)&&Y$(J)&&Y$(q)&&J<=$&&$<q}function C0($,J,q,Z){if(!r5(J,q,Z))throw new Error("expected valid "+$+": "+q+" <= n < "+Z+", got "+J)}var f1=($)=>(L1<<BigInt($))-L1;function W0($,J={},q={}){if(!$||typeof $!=="object")throw new Error("expected valid options object");function Z(Q,G,U){let Y=$[Q];if(U&&Y===void 0)return;let z=typeof Y;if(z!==G||Y===null)throw new Error(`param "${Q}" is invalid: expected ${G}, got ${z}`)}let X=(Q,G)=>Object.entries(Q).forEach(([U,Y])=>Z(U,Y,G));X(J,!1),X(q,!0)}function s$($){let J=new WeakMap;return(q,...Z)=>{let X=J.get(q);if(X!==void 0)return X;let Q=$(q,...Z);return J.set(q,Q),Q}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var M8=BigInt(0),z8=BigInt(1),z0=BigInt(2),k1=BigInt(3),v1=BigInt(4),_1=BigInt(5),s5=BigInt(7),g1=BigInt(8),a5=BigInt(9),y1=BigInt(16);function r($,J){let q=$%J;return q>=M8?q:J+q}function j8($,J,q){let Z=$;while(J-- >M8)Z*=Z,Z%=q;return Z}function S1($,J){if($===M8)throw new Error("invert: expected non-zero number");if(J<=M8)throw new Error("invert: expected positive modulus, got "+J);let q=r($,J),Z=J,X=M8,Q=z8,G=z8,U=M8;while(q!==M8){let z=Z/q,W=Z%q,K=X-G*z,M=Q-U*z;Z=q,q=W,X=G,Q=U,G=K,U=M}if(Z!==z8)throw new Error("invert: does not exist");return r(X,J)}function a$($,J,q){if(!$.eql($.sqr(J),q))throw new Error("Cannot find square root")}function m1($,J){let q=($.ORDER+z8)/v1,Z=$.pow(J,q);return a$($,Z,J),Z}function e5($,J){let q=($.ORDER-_1)/g1,Z=$.mul(J,z0),X=$.pow(Z,q),Q=$.mul(J,X),G=$.mul($.mul(Q,z0),X),U=$.mul(Q,$.sub(G,$.ONE));return a$($,U,J),U}function t5($){let J=D$($),q=b1($),Z=q(J,J.neg(J.ONE)),X=q(J,Z),Q=q(J,J.neg(Z)),G=($+s5)/y1;return(U,Y)=>{let z=U.pow(Y,G),W=U.mul(z,Z),K=U.mul(z,X),M=U.mul(z,Q),O=U.eql(U.sqr(W),Y),H=U.eql(U.sqr(K),Y);z=U.cmov(z,W,O),W=U.cmov(M,K,H);let E=U.eql(U.sqr(W),Y),B=U.cmov(z,W,E);return a$(U,B,Y),B}}function b1($){if($<k1)throw new Error("sqrt is not defined for small field");let J=$-z8,q=0;while(J%z0===M8)J/=z0,q++;let Z=z0,X=D$($);while(x1(X,Z)===1)if(Z++>1000)throw new Error("Cannot find square root: probably non-prime P");if(q===1)return m1;let Q=X.pow(Z,J),G=(J+z8)/z0;return function U(Y,z){if(Y.is0(z))return z;if(x1(Y,z)!==1)throw new Error("Cannot find square root");let W=q,K=Y.mul(Y.ONE,Q),M=Y.pow(z,J),O=Y.pow(z,G);while(!Y.eql(M,Y.ONE)){if(Y.is0(M))return Y.ZERO;let H=1,E=Y.sqr(M);while(!Y.eql(E,Y.ONE))if(H++,E=Y.sqr(E),H===W)throw new Error("Cannot find square root");let B=z8<<BigInt(W-H-1),L=Y.pow(K,B);W=H,K=Y.sqr(L),M=Y.mul(M,K),O=Y.mul(O,L)}return O}}function $Z($){if($%v1===k1)return m1;if($%g1===_1)return e5;if($%y1===a5)return t5($);return b1($)}var h1=($,J)=>(r($,J)&z8)===z8,JZ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function u1($){let J={ORDER:"bigint",BYTES:"number",BITS:"number"},q=JZ.reduce((Z,X)=>{return Z[X]="function",Z},J);return W0($,q),$}function qZ($,J,q){if(q<M8)throw new Error("invalid exponent, negatives unsupported");if(q===M8)return $.ONE;if(q===z8)return J;let Z=$.ONE,X=J;while(q>M8){if(q&z8)Z=$.mul(Z,X);X=$.sqr(X),q>>=z8}return Z}function K$($,J,q=!1){let Z=new Array(J.length).fill(q?$.ZERO:void 0),X=J.reduce((G,U,Y)=>{if($.is0(U))return G;return Z[Y]=G,$.mul(G,U)},$.ONE),Q=$.inv(X);return J.reduceRight((G,U,Y)=>{if($.is0(U))return G;return Z[Y]=$.mul(G,Z[Y]),$.mul(G,U)},Q),Z}function x1($,J){let q=($.ORDER-z8)/z0,Z=$.pow(J,q),X=$.eql(Z,$.ONE),Q=$.eql(Z,$.ZERO),G=$.eql(Z,$.neg($.ONE));if(!X&&!Q&&!G)throw new Error("invalid Legendre symbol result");return X?1:Q?0:-1}function ZZ($,J){if(J!==void 0)T8(J);let q=J!==void 0?J:$.toString(2).length,Z=Math.ceil(q/8);return{nBitLength:q,nByteLength:Z}}class p1{ORDER;BITS;BYTES;isLE;ZERO=M8;ONE=z8;_lengths;_sqrt;_mod;constructor($,J={}){if($<=M8)throw new Error("invalid field: expected ORDER > 0, got "+$);let q=void 0;if(this.isLE=!1,J!=null&&typeof J==="object"){if(typeof J.BITS==="number")q=J.BITS;if(typeof J.sqrt==="function")this.sqrt=J.sqrt;if(typeof J.isLE==="boolean")this.isLE=J.isLE;if(J.allowedLengths)this._lengths=J.allowedLengths?.slice();if(typeof J.modFromBytes==="boolean")this._mod=J.modFromBytes}let{nBitLength:Z,nByteLength:X}=ZZ($,q);if(X>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=$,this.BITS=Z,this.BYTES=X,this._sqrt=void 0,Object.preventExtensions(this)}create($){return r($,this.ORDER)}isValid($){if(typeof $!=="bigint")throw new Error("invalid field element: expected bigint, got "+typeof $);return M8<=$&&$<this.ORDER}is0($){return $===M8}isValidNot0($){return!this.is0($)&&this.isValid($)}isOdd($){return($&z8)===z8}neg($){return r(-$,this.ORDER)}eql($,J){return $===J}sqr($){return r($*$,this.ORDER)}add($,J){return r($+J,this.ORDER)}sub($,J){return r($-J,this.ORDER)}mul($,J){return r($*J,this.ORDER)}pow($,J){return qZ(this,$,J)}div($,J){return r($*S1(J,this.ORDER),this.ORDER)}sqrN($){return $*$}addN($,J){return $+J}subN($,J){return $-J}mulN($,J){return $*J}inv($){return S1($,this.ORDER)}sqrt($){if(!this._sqrt)this._sqrt=$Z(this.ORDER);return this._sqrt(this,$)}toBytes($){return this.isLE?z$($,this.BYTES):r$($,this.BYTES)}fromBytes($,J=!1){c($);let{_lengths:q,BYTES:Z,isLE:X,ORDER:Q,_mod:G}=this;if(q){if(!q.includes($.length)||$.length>Z)throw new Error("Field.fromBytes: expected "+q+" bytes, got "+$.length);let Y=new Uint8Array(Z);Y.set($,X?0:Y.length-$.length),$=Y}if($.length!==Z)throw new Error("Field.fromBytes: expected "+Z+" bytes, got "+$.length);let U=X?p8($):E1($);if(G)U=r(U,Q);if(!J){if(!this.isValid(U))throw new Error("invalid field element: outside of range 0..ORDER")}return U}invertBatch($){return K$(this,$)}cmov($,J,q){return q?J:$}}function D$($,J={}){return new p1($,J)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var M$=BigInt(0),JJ=BigInt(1);function d1($,J){let q=J.negate();return $?q:J}function V$($,J){let q=K$($.Fp,J.map((Z)=>Z.Z));return J.map((Z,X)=>$.fromAffine(Z.toAffine(q[X])))}function i1($,J){if(!Number.isSafeInteger($)||$<=0||$>J)throw new Error("invalid window size, expected [1.."+J+"], got W="+$)}function e$($,J){i1($,J);let q=Math.ceil(J/$)+1,Z=2**($-1),X=2**$,Q=f1($),G=BigInt($);return{windows:q,windowSize:Z,mask:Q,maxNumber:X,shiftBy:G}}function c1($,J,q){let{windowSize:Z,mask:X,maxNumber:Q,shiftBy:G}=q,U=Number($&X),Y=$>>G;if(U>Z)U-=Q,Y+=JJ;let z=J*Z,W=z+Math.abs(U)-1,K=U===0,M=U<0,O=J%2!==0;return{nextN:Y,offset:W,isZero:K,isNeg:M,isNegF:O,offsetF:z}}var t$=new WeakMap,o1=new WeakMap;function $J($){return o1.get($)||1}function l1($){if($!==M$)throw new Error("invalid wNAF")}class qJ{BASE;ZERO;Fn;bits;constructor($,J){this.BASE=$.BASE,this.ZERO=$.ZERO,this.Fn=$.Fn,this.bits=J}_unsafeLadder($,J,q=this.ZERO){let Z=$;while(J>M$){if(J&JJ)q=q.add(Z);Z=Z.double(),J>>=JJ}return q}precomputeWindow($,J){let{windows:q,windowSize:Z}=e$(J,this.bits),X=[],Q=$,G=Q;for(let U=0;U<q;U++){G=Q,X.push(G);for(let Y=1;Y<Z;Y++)G=G.add(Q),X.push(G);Q=G.double()}return X}wNAF($,J,q){if(!this.Fn.isValid(q))throw new Error("invalid scalar");let Z=this.ZERO,X=this.BASE,Q=e$($,this.bits);for(let G=0;G<Q.windows;G++){let{nextN:U,offset:Y,isZero:z,isNeg:W,isNegF:K,offsetF:M}=c1(q,G,Q);if(q=U,z)X=X.add(d1(K,J[M]));else Z=Z.add(d1(W,J[Y]))}return l1(q),{p:Z,f:X}}wNAFUnsafe($,J,q,Z=this.ZERO){let X=e$($,this.bits);for(let Q=0;Q<X.windows;Q++){if(q===M$)break;let{nextN:G,offset:U,isZero:Y,isNeg:z}=c1(q,Q,X);if(q=G,Y)continue;else{let W=J[U];Z=Z.add(z?W.negate():W)}}return l1(q),Z}getPrecomputes($,J,q){let Z=t$.get(J);if(!Z){if(Z=this.precomputeWindow(J,$),$!==1){if(typeof q==="function")Z=q(Z);t$.set(J,Z)}}return Z}cached($,J,q){let Z=$J($);return this.wNAF(Z,this.getPrecomputes(Z,$,q),J)}unsafe($,J,q,Z){let X=$J($);if(X===1)return this._unsafeLadder($,J,Z);return this.wNAFUnsafe(X,this.getPrecomputes(X,$,q),J,Z)}createCache($,J){i1(J,this.bits),o1.set($,J),t$.delete($)}hasCache($){return $J($)!==1}}function n1($,J,q){if(J){if(J.ORDER!==$)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return u1(J),J}else return D$($,{isLE:q})}function r1($,J,q={},Z){if(Z===void 0)Z=$==="edwards";if(!J||typeof J!=="object")throw new Error(`expected valid ${$} CURVE object`);for(let Y of["p","n","h"]){let z=J[Y];if(!(typeof z==="bigint"&&z>M$))throw new Error(`CURVE.${Y} must be positive bigint`)}let X=n1(J.p,q.Fp,Z),Q=n1(J.n,q.Fn,Z),U=["Gx","Gy","a",$==="weierstrass"?"b":"d"];for(let Y of U)if(!X.isValid(J[Y]))throw new Error(`CURVE.${Y} must be valid field element of CURVE.Fp`);return J=Object.freeze(Object.assign({},J)),{CURVE:J,Fp:X,Fn:Q}}function O$($,J){return function q(Z){let X=$(Z);return{secretKey:X,publicKey:J(X)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var e8=BigInt(0),q8=BigInt(1),ZJ=BigInt(2),XZ=BigInt(8);function QZ($,J,q,Z){let X=$.sqr(q),Q=$.sqr(Z),G=$.add($.mul(J.a,X),Q),U=$.add($.ONE,$.mul(J.d,$.mul(X,Q)));return $.eql(G,U)}function s1($,J={}){let q=r1("edwards",$,J,J.FpFnLE),{Fp:Z,Fn:X}=q,Q=q.CURVE,{h:G}=Q;W0(J,{},{uvRatio:"function"});let U=ZJ<<BigInt(X.BYTES*8)-q8,Y=(B)=>Z.create(B),z=J.uvRatio||((B,L)=>{try{return{isValid:!0,value:Z.sqrt(Z.div(B,L))}}catch(N){return{isValid:!1,value:e8}}});if(!QZ(Z,Q,Q.Gx,Q.Gy))throw new Error("bad curve params: generator point");function W(B,L,N=!1){let w=N?q8:e8;return C0("coordinate "+B,L,w,U),L}function K(B){if(!(B instanceof H))throw new Error("EdwardsPoint expected")}let M=s$((B,L)=>{let{X:N,Y:w,Z:f}=B,v=B.is0();if(L==null)L=v?XZ:Z.inv(f);let g=Y(N*L),y=Y(w*L),F=Z.mul(f,L);if(v)return{x:e8,y:q8};if(F!==q8)throw new Error("invZ was invalid");return{x:g,y}}),O=s$((B)=>{let{a:L,d:N}=Q;if(B.is0())throw new Error("bad point: ZERO");let{X:w,Y:f,Z:v,T:g}=B,y=Y(w*w),F=Y(f*f),j=Y(v*v),S=Y(j*j),m=Y(y*L),d=Y(j*Y(m+F)),D=Y(S+Y(N*Y(y*F)));if(d!==D)throw new Error("bad point: equation left != right (1)");let A=Y(w*f),C=Y(v*g);if(A!==C)throw new Error("bad point: equation left != right (2)");return!0});class H{static BASE=new H(Q.Gx,Q.Gy,q8,Y(Q.Gx*Q.Gy));static ZERO=new H(e8,q8,q8,e8);static Fp=Z;static Fn=X;X;Y;Z;T;constructor(B,L,N,w){this.X=W("x",B),this.Y=W("y",L),this.Z=W("z",N,!0),this.T=W("t",w),Object.freeze(this)}static CURVE(){return Q}static fromAffine(B){if(B instanceof H)throw new Error("extended point not allowed");let{x:L,y:N}=B||{};return W("x",L),W("y",N),new H(L,N,q8,Y(L*N))}static fromBytes(B,L=!1){let N=Z.BYTES,{a:w,d:f}=Q;B=Y0(c(B,N,"point")),W$(L,"zip215");let v=Y0(B),g=B[N-1];v[N-1]=g&-129;let y=p8(v),F=L?U:Z.ORDER;C0("point.y",y,e8,F);let j=Y(y*y),S=Y(j-q8),m=Y(f*j-w),{isValid:d,value:D}=z(S,m);if(!d)throw new Error("bad point: invalid y coordinate");let A=(D&q8)===q8,C=(g&128)!==0;if(!L&&D===e8&&C)throw new Error("bad point: x=0 and x_0=1");if(C!==A)D=Y(-D);return H.fromAffine({x:D,y})}static fromHex(B,L=!1){return H.fromBytes(v0(B),L)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(B=8,L=!0){if(E.createCache(this,B),!L)this.multiply(ZJ);return this}assertValidity(){O(this)}equals(B){K(B);let{X:L,Y:N,Z:w}=this,{X:f,Y:v,Z:g}=B,y=Y(L*g),F=Y(f*w),j=Y(N*g),S=Y(v*w);return y===F&&j===S}is0(){return this.equals(H.ZERO)}negate(){return new H(Y(-this.X),this.Y,this.Z,Y(-this.T))}double(){let{a:B}=Q,{X:L,Y:N,Z:w}=this,f=Y(L*L),v=Y(N*N),g=Y(ZJ*Y(w*w)),y=Y(B*f),F=L+N,j=Y(Y(F*F)-f-v),S=y+v,m=S-g,d=y-v,D=Y(j*m),A=Y(S*d),C=Y(j*d),T=Y(m*S);return new H(D,A,T,C)}add(B){K(B);let{a:L,d:N}=Q,{X:w,Y:f,Z:v,T:g}=this,{X:y,Y:F,Z:j,T:S}=B,m=Y(w*y),d=Y(f*F),D=Y(g*N*S),A=Y(v*j),C=Y((w+f)*(y+F)-m-d),T=A-D,I=A+D,x=Y(d-L*m),k=Y(C*T),_=Y(I*x),h=Y(C*x),p=Y(T*I);return new H(k,_,p,h)}subtract(B){return this.add(B.negate())}multiply(B){if(!X.isValidNot0(B))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:L,f:N}=E.cached(this,B,(w)=>V$(H,w));return V$(H,[L,N])[0]}multiplyUnsafe(B,L=H.ZERO){if(!X.isValid(B))throw new Error("invalid scalar: expected 0 <= sc < curve.n");if(B===e8)return H.ZERO;if(this.is0()||B===q8)return this;return E.unsafe(this,B,(N)=>V$(H,N),L)}isSmallOrder(){return this.multiplyUnsafe(G).is0()}isTorsionFree(){return E.unsafe(this,Q.n).is0()}toAffine(B){return M(this,B)}clearCofactor(){if(G===q8)return this;return this.multiplyUnsafe(G)}toBytes(){let{x:B,y:L}=this.toAffine(),N=Z.toBytes(L);return N[N.length-1]|=B&q8?128:0,N}toHex(){return B0(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let E=new qJ(H,X.BITS);return H.BASE.precompute(8),H}function a1($,J,q={}){if(typeof J!=="function")throw new Error('"hash" function param is required');W0(q,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:Z}=q,{BASE:X,Fp:Q,Fn:G}=$,U=q.randomBytes||Q0,Y=q.adjustScalarBytes||((F)=>F),z=q.domain||((F,j,S)=>{if(W$(S,"phflag"),j.length||S)throw new Error("Contexts/pre-hash are not supported");return F});function W(F){return G.create(p8(F))}function K(F){let j=w.secretKey;c(F,w.secretKey,"secretKey");let S=c(J(F),2*j,"hashedSecretKey"),m=Y(S.slice(0,j)),d=S.slice(j,2*j),D=W(m);return{head:m,prefix:d,scalar:D}}function M(F){let{head:j,prefix:S,scalar:m}=K(F),d=X.multiply(m),D=d.toBytes();return{head:j,prefix:S,scalar:m,point:d,pointBytes:D}}function O(F){return M(F).pointBytes}function H(F=Uint8Array.of(),...j){let S=H0(...j);return W(J(z(S,c(F,void 0,"context"),!!Z)))}function E(F,j,S={}){if(F=c(F,void 0,"message"),Z)F=Z(F);let{prefix:m,scalar:d,pointBytes:D}=M(j),A=H(S.context,m,F),C=X.multiply(A).toBytes(),T=H(S.context,C,D,F),I=G.create(A+T*d);if(!G.isValid(I))throw new Error("sign failed: invalid s");let x=H0(C,G.toBytes(I));return c(x,w.signature,"result")}let B={zip215:!0};function L(F,j,S,m=B){let{context:d,zip215:D}=m,A=w.signature;if(F=c(F,A,"signature"),j=c(j,void 0,"message"),S=c(S,w.publicKey,"publicKey"),D!==void 0)W$(D,"zip215");if(Z)j=Z(j);let C=A/2,T=F.subarray(0,C),I=p8(F.subarray(C,A)),x,k,_;try{x=$.fromBytes(S,D),k=$.fromBytes(T,D),_=X.multiplyUnsafe(I)}catch(f8){return!1}if(!D&&x.isSmallOrder())return!1;let h=H(d,k.toBytes(),x.toBytes(),j);return k.add(x.multiplyUnsafe(h)).subtract(_).clearCofactor().is0()}let N=Q.BYTES,w={secretKey:N,publicKey:N,signature:2*N,seed:N};function f(F=U(w.seed)){return c(F,w.seed,"seed")}function v(F){return x0(F)&&F.length===G.BYTES}function g(F,j){try{return!!$.fromBytes(F,j)}catch(S){return!1}}let y={getExtendedPublicKey:M,randomSecretKey:f,isValidSecretKey:v,isValidPublicKey:g,toMontgomery(F){let{y:j}=$.fromBytes(F),S=w.publicKey,m=S===32;if(!m&&S!==57)throw new Error("only defined for 25519 and 448");let d=m?Q.div(q8+j,q8-j):Q.div(j-q8,j+q8);return Q.toBytes(d)},toMontgomerySecret(F){let j=w.secretKey;c(F,j);let S=J(F.subarray(0,j));return Y(S).subarray(0,j)}};return Object.freeze({keygen:O$(f,O),getPublicKey:O,sign:E,verify:L,utils:y,Point:$,lengths:w})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var m0=BigInt(0),w0=BigInt(1),N$=BigInt(2);function GZ($){return W0($,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...$})}function e1($){let J=GZ($),{P:q,type:Z,adjustScalarBytes:X,powPminus2:Q,randomBytes:G}=J,U=Z==="x25519";if(!U&&Z!=="x448")throw new Error("invalid type");let Y=G||Q0,z=U?255:448,W=U?32:56,K=U?BigInt(9):BigInt(5),M=U?BigInt(121665):BigInt(39081),O=U?N$**BigInt(254):N$**BigInt(447),H=U?BigInt(8)*N$**BigInt(251)-w0:BigInt(4)*N$**BigInt(445)-w0,E=O+H+w0,B=(A)=>r(A,q),L=N(K);function N(A){return z$(B(A),W)}function w(A){let C=Y0(c(A,W,"uCoordinate"));if(U)C[31]&=127;return B(p8(C))}function f(A){return p8(X(Y0(c(A,W,"scalar"))))}function v(A,C){let T=S(w(C),f(A));if(T===m0)throw new Error("invalid private or public key received");return N(T)}function g(A){return v(A,L)}let y=g,F=v;function j(A,C,T){let I=B(A*(C-T));return C=B(C-I),T=B(T+I),{x_2:C,x_3:T}}function S(A,C){C0("u",A,m0,q),C0("scalar",C,O,E);let T=C,I=A,x=w0,k=m0,_=A,h=w0,p=m0;for(let y8=BigInt(z-1);y8>=m0;y8--){let n8=T>>y8&w0;p^=n8,{x_2:x,x_3:_}=j(p,x,_),{x_2:k,x_3:h}=j(p,k,h),p=n8;let i8=x+k,N0=B(i8*i8),f0=x-k,S0=B(f0*f0),$1=N0-S0,I5=_+h,E5=_-h,J1=B(E5*i8),q1=B(I5*f0),Z1=J1+q1,X1=J1-q1;_=B(Z1*Z1),h=B(I*B(X1*X1)),x=B(N0*S0),k=B($1*(N0+B(M*$1)))}({x_2:x,x_3:_}=j(p,x,_)),{x_2:k,x_3:h}=j(p,k,h);let f8=Q(k);return B(x*f8)}let m={secretKey:W,publicKey:W,seed:W},d=(A=Y(W))=>{return c(A,m.seed,"seed"),A},D={randomSecretKey:d};return Object.freeze({keygen:O$(d,y),getSharedSecret:F,getPublicKey:y,scalarMult:v,scalarMultBase:g,utils:D,GuBytes:L.slice(),lengths:m})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var UZ=BigInt(1),t1=BigInt(2),YZ=BigInt(3),WZ=BigInt(5),zZ=BigInt(8),B$=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),KZ=(()=>({p:B$,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:zZ,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function J9($){let J=BigInt(10),q=BigInt(20),Z=BigInt(40),X=BigInt(80),Q=B$,U=$*$%Q*$%Q,Y=j8(U,t1,Q)*U%Q,z=j8(Y,UZ,Q)*$%Q,W=j8(z,WZ,Q)*z%Q,K=j8(W,J,Q)*W%Q,M=j8(K,q,Q)*K%Q,O=j8(M,Z,Q)*M%Q,H=j8(O,X,Q)*O%Q,E=j8(H,X,Q)*O%Q,B=j8(E,J,Q)*W%Q;return{pow_p_5_8:j8(B,t1,Q)*$%Q,b2:U}}function q9($){return $[0]&=248,$[31]&=127,$[31]|=64,$}var $9=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function DZ($,J){let q=B$,Z=r(J*J*J,q),X=r(Z*Z*J,q),Q=J9($*X).pow_p_5_8,G=r($*Z*Q,q),U=r(J*G*G,q),Y=G,z=r(G*$9,q),W=U===$,K=U===r(-$,q),M=U===r(-$*$9,q);if(W)G=Y;if(K||M)G=z;if(h1(G,q))G=r(-G,q);return{isValid:W||K,value:G}}var MZ=s1(KZ,{uvRatio:DZ});function VZ($){return a1(MZ,A1,Object.assign({adjustScalarBytes:q9},$))}var t8=VZ({});var b0=(()=>{let $=B$;return e1({P:$,type:"x25519",powPminus2:(J)=>{let{pow_p_5_8:q,b2:Z}=J9(J);return r(j8(q,YZ,$)*Z,$)},adjustScalarBytes:q9})})();var A9=G1(XJ(),1);var QJ;try{QJ=new TextDecoder}catch($){}var b,D0,P=0;var Y9=[],OZ=105,NZ=57342,BZ=57343,X9=57337;var Q9=6,T0={},h0=112810000,d8=16810000;var GJ=Y9,UJ=0,l={},s,C$,w$=0,p0=0,t,A8,a=[],YJ=[],R8,V8,u0,G9={useRecords:!1,mapsAsObjects:!0},d0=!1,W9=2;try{new Function("")}catch($){W9=1/0}class $0{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[J,q]of Object.entries($.keyMap))this.mapKey.set(q,J)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let J=new Map;for(let[q,Z]of Object.entries($))J.set(this._keyMap.hasOwnProperty(q)?this._keyMap[q]:q,Z);return J}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[q,Z]of Object.entries(this._keyMap))this._mapKey.set(Z,q)}let J={};return $.forEach((q,Z)=>J[L8(this._mapKey.has(Z)?this._mapKey.get(Z):Z)]=q),J}mapDecode($,J){let q=this.decode($);if(this._keyMap)switch(q.constructor.name){case"Array":return q.map((Z)=>this.decodeKeys(Z))}return q}decode($,J){if(b)return M9(()=>{return T$(),this?this.decode($,J):$0.prototype.decode.call(G9,$,J)});D0=J>-1?J:$.length,P=0,UJ=0,p0=0,C$=null,GJ=Y9,t=null,b=$;try{V8=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(q){if(b=null,$ instanceof Uint8Array)throw q;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof $0){if(l=this,R8=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return s=this.structures,H$();else if(!s||s.length>0)s=[]}else{if(l=G9,!s||s.length>0)s=[];R8=null}return H$()}decodeMultiple($,J){let q,Z=0;try{let X=$.length;d0=!0;let Q=this?this.decode($,X):VJ.decode($,X);if(J){if(J(Q)===!1)return;while(P<X)if(Z=P,J(H$())===!1)return}else{q=[Q];while(P<X)Z=P,q.push(H$());return q}}catch(X){throw X.lastPosition=Z,X.values=q,X}finally{d0=!1,T$()}}}function H$(){try{let $=n();if(t){if(P>=t.postBundlePosition){let J=new Error("Unexpected bundle position");throw J.incomplete=!0,J}P=t.postBundlePosition,t=null}if(P==D0){if(s=null,b=null,A8)A8=null}else if(P>D0){let J=new Error("Unexpected end of CBOR data");throw J.incomplete=!0,J}else if(!d0)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(T$(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function n(){let $=b[P++],J=$>>5;if($=$&31,$>23)switch($){case 24:$=b[P++];break;case 25:if(J==7)return wZ();$=V8.getUint16(P),P+=2;break;case 26:if(J==7){let q=V8.getFloat32(P);if(l.useFloat32>2){let Z=F$[(b[P]&127)<<1|b[P+1]>>7];return P+=4,(Z*q+(q>0?0.5:-0.5)>>0)/Z}return P+=4,q}$=V8.getUint32(P),P+=4;break;case 27:if(J==7){let q=V8.getFloat64(P);return P+=8,q}if(J>1){if(V8.getUint32(P)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=V8.getUint32(P+4)}else if(l.int64AsNumber)$=V8.getUint32(P)*4294967296,$+=V8.getUint32(P+4);else $=V8.getBigUint64(P);P+=8;break;case 31:switch(J){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let q=[],Z,X=0;while((Z=n())!=T0){if(X>=h0)throw new Error(`Array length exceeds ${h0}`);q[X++]=Z}return J==4?q:J==3?q.join(""):Buffer.concat(q);case 5:let Q;if(l.mapsAsObjects){let G={},U=0;if(l.keyMap)while((Q=n())!=T0){if(U++>=d8)throw new Error(`Property count exceeds ${d8}`);G[L8(l.decodeKey(Q))]=n()}else while((Q=n())!=T0){if(U++>=d8)throw new Error(`Property count exceeds ${d8}`);G[L8(Q)]=n()}return G}else{if(u0)l.mapsAsObjects=!0,u0=!1;let G=new Map;if(l.keyMap){let U=0;while((Q=n())!=T0){if(U++>=d8)throw new Error(`Map size exceeds ${d8}`);G.set(l.decodeKey(Q),n())}}else{let U=0;while((Q=n())!=T0){if(U++>=d8)throw new Error(`Map size exceeds ${d8}`);G.set(Q,n())}}return G}case 7:return T0;default:throw new Error("Invalid major type for indefinite length "+J)}default:throw new Error("Unknown token "+$)}switch(J){case 0:return $;case 1:return~$;case 2:return CZ($);case 3:if(p0>=P)return C$.slice(P-w$,(P+=$)-w$);if(p0==0&&D0<140&&$<32){let X=$<16?z9($):RZ($);if(X!=null)return X}return HZ($);case 4:if($>=h0)throw new Error(`Array length exceeds ${h0}`);let q=new Array($);for(let X=0;X<$;X++)q[X]=n();return q;case 5:if($>=d8)throw new Error(`Map size exceeds ${h0}`);if(l.mapsAsObjects){let X={};if(l.keyMap)for(let Q=0;Q<$;Q++)X[L8(l.decodeKey(n()))]=n();else for(let Q=0;Q<$;Q++)X[L8(n())]=n();return X}else{if(u0)l.mapsAsObjects=!0,u0=!1;let X=new Map;if(l.keyMap)for(let Q=0;Q<$;Q++)X.set(l.decodeKey(n()),n());else for(let Q=0;Q<$;Q++)X.set(n(),n());return X}case 6:if($>=X9){let X=s[$&8191];if(X){if(!X.read)X.read=WJ(X);return X.read()}if($<65536){if($==BZ){let Q=j0(),G=n(),U=n();KJ(G,U);let Y={};if(l.keyMap)for(let z=2;z<Q;z++){let W=l.decodeKey(U[z-2]);Y[L8(W)]=n()}else for(let z=2;z<Q;z++){let W=U[z-2];Y[L8(W)]=n()}return Y}else if($==NZ){let Q=j0(),G=n();for(let U=2;U<Q;U++)KJ(G++,n());return n()}else if($==X9)return PZ();if(l.getShared){if(MJ(),X=s[$&8191],X){if(!X.read)X.read=WJ(X);return X.read()}}}}let Z=a[$];if(Z)if(Z.handlesRead)return Z(n);else return Z(n());else{let X=n();for(let Q=0;Q<YJ.length;Q++){let G=YJ[Q]($,X);if(G!==void 0)return G}return new x8(X,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let X=(R8||K0())[$];if(X!==void 0)return X;throw new Error("Unknown token "+$)}default:if(isNaN($)){let X=new Error("Unexpected end of CBOR data");throw X.incomplete=!0,X}throw new Error("Unknown CBOR token "+$)}}var U9=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function WJ($){if(!$)throw new Error("Structure is required in record definition");function J(){let q=b[P++];if(q=q&31,q>23)switch(q){case 24:q=b[P++];break;case 25:q=V8.getUint16(P),P+=2;break;case 26:q=V8.getUint32(P),P+=4;break;default:throw new Error("Expected array header, but got "+b[P-1])}let Z=this.compiledReader;while(Z){if(Z.propertyCount===q)return Z(n);Z=Z.next}if(this.slowReads++>=W9){let Q=this.length==q?this:this.slice(0,q);if(Z=l.keyMap?new Function("r","return {"+Q.map((G)=>l.decodeKey(G)).map((G)=>U9.test(G)?L8(G)+":r()":"["+JSON.stringify(G)+"]:r()").join(",")+"}"):new Function("r","return {"+Q.map((G)=>U9.test(G)?L8(G)+":r()":"["+JSON.stringify(G)+"]:r()").join(",")+"}"),this.compiledReader)Z.next=this.compiledReader;return Z.propertyCount=q,this.compiledReader=Z,Z(n)}let X={};if(l.keyMap)for(let Q=0;Q<q;Q++)X[L8(l.decodeKey(this[Q]))]=n();else for(let Q=0;Q<q;Q++)X[L8(this[Q])]=n();return X}return $.slowReads=0,J}function L8($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var HZ=zJ;function zJ($){let J;if($<16){if(J=z9($))return J}if($>64&&QJ)return QJ.decode(b.subarray(P,P+=$));let q=P+$,Z=[];J="";while(P<q){let X=b[P++];if((X&128)===0)Z.push(X);else if((X&224)===192){let Q=b[P++]&63;Z.push((X&31)<<6|Q)}else if((X&240)===224){let Q=b[P++]&63,G=b[P++]&63;Z.push((X&31)<<12|Q<<6|G)}else if((X&248)===240){let Q=b[P++]&63,G=b[P++]&63,U=b[P++]&63,Y=(X&7)<<18|Q<<12|G<<6|U;if(Y>65535)Y-=65536,Z.push(Y>>>10&1023|55296),Y=56320|Y&1023;Z.push(Y)}else Z.push(X);if(Z.length>=4096)J+=Z8.apply(String,Z),Z.length=0}if(Z.length>0)J+=Z8.apply(String,Z);return J}var Z8=String.fromCharCode;function RZ($){let J=P,q=new Array($);for(let Z=0;Z<$;Z++){let X=b[P++];if((X&128)>0){P=J;return}q[Z]=X}return Z8.apply(String,q)}function z9($){if($<4)if($<2)if($===0)return"";else{let J=b[P++];if((J&128)>1){P-=1;return}return Z8(J)}else{let J=b[P++],q=b[P++];if((J&128)>0||(q&128)>0){P-=2;return}if($<3)return Z8(J,q);let Z=b[P++];if((Z&128)>0){P-=3;return}return Z8(J,q,Z)}else{let J=b[P++],q=b[P++],Z=b[P++],X=b[P++];if((J&128)>0||(q&128)>0||(Z&128)>0||(X&128)>0){P-=4;return}if($<6)if($===4)return Z8(J,q,Z,X);else{let Q=b[P++];if((Q&128)>0){P-=5;return}return Z8(J,q,Z,X,Q)}else if($<8){let Q=b[P++],G=b[P++];if((Q&128)>0||(G&128)>0){P-=6;return}if($<7)return Z8(J,q,Z,X,Q,G);let U=b[P++];if((U&128)>0){P-=7;return}return Z8(J,q,Z,X,Q,G,U)}else{let Q=b[P++],G=b[P++],U=b[P++],Y=b[P++];if((Q&128)>0||(G&128)>0||(U&128)>0||(Y&128)>0){P-=8;return}if($<10)if($===8)return Z8(J,q,Z,X,Q,G,U,Y);else{let z=b[P++];if((z&128)>0){P-=9;return}return Z8(J,q,Z,X,Q,G,U,Y,z)}else if($<12){let z=b[P++],W=b[P++];if((z&128)>0||(W&128)>0){P-=10;return}if($<11)return Z8(J,q,Z,X,Q,G,U,Y,z,W);let K=b[P++];if((K&128)>0){P-=11;return}return Z8(J,q,Z,X,Q,G,U,Y,z,W,K)}else{let z=b[P++],W=b[P++],K=b[P++],M=b[P++];if((z&128)>0||(W&128)>0||(K&128)>0||(M&128)>0){P-=12;return}if($<14)if($===12)return Z8(J,q,Z,X,Q,G,U,Y,z,W,K,M);else{let O=b[P++];if((O&128)>0){P-=13;return}return Z8(J,q,Z,X,Q,G,U,Y,z,W,K,M,O)}else{let O=b[P++],H=b[P++];if((O&128)>0||(H&128)>0){P-=14;return}if($<15)return Z8(J,q,Z,X,Q,G,U,Y,z,W,K,M,O,H);let E=b[P++];if((E&128)>0){P-=15;return}return Z8(J,q,Z,X,Q,G,U,Y,z,W,K,M,O,H,E)}}}}}function CZ($){return l.copyBuffers?Uint8Array.prototype.slice.call(b,P,P+=$):b.subarray(P,P+=$)}var K9=new Float32Array(1),R$=new Uint8Array(K9.buffer,0,4);function wZ(){let $=b[P++],J=b[P++],q=($&127)>>2;if(q===31){if(J||$&3)return NaN;return $&128?-1/0:1/0}if(q===0){let Z=(($&3)<<8|J)/16777216;return $&128?-Z:Z}return R$[3]=$&128|(q>>1)+56,R$[2]=($&7)<<5|J>>3,R$[1]=J<<5,R$[0]=0,K9[0]}var FG=new Array(4096);class x8{constructor($,J){this.value=$,this.tag=J}}a[0]=($)=>{return new Date($)};a[1]=($)=>{return new Date(Math.round($*1000))};a[2]=($)=>{let J=BigInt(0);for(let q=0,Z=$.byteLength;q<Z;q++)J=BigInt($[q])+(J<<BigInt(8));return J};a[3]=($)=>{return BigInt(-1)-a[2]($)};a[4]=($)=>{return+($[1]+"e"+$[0])};a[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var KJ=($,J)=>{$=$-57344;let q=s[$];if(q&&q.isShared)(s.restoreStructures||(s.restoreStructures=[]))[$]=q;s[$]=J,J.read=WJ(J)};a[OZ]=($)=>{let J=$.length,q=$[1];KJ($[0],q);let Z={};for(let X=2;X<J;X++){let Q=q[X-2];Z[L8(Q)]=$[X]}return Z};a[14]=($)=>{if(t)return t[0].slice(t.position0,t.position0+=$);return new x8($,14)};a[15]=($)=>{if(t)return t[1].slice(t.position1,t.position1+=$);return new x8($,15)};var TZ={Error,RegExp};a[27]=($)=>{return(TZ[$[0]]||Error)($[1],$[2])};var D9=($)=>{if(b[P++]!=132){let q=new Error("Packed values structure must be followed by a 4 element array");if(b.length<P)q.incomplete=!0;throw q}let J=$();if(!J||!J.length){let q=new Error("Packed values structure must be followed by a 4 element array");throw q.incomplete=!0,q}return R8=R8?J.concat(R8.slice(J.length)):J,R8.prefixes=$(),R8.suffixes=$(),$()};D9.handlesRead=!0;a[51]=D9;a[Q9]=($)=>{if(!R8)if(l.getShared)MJ();else return new x8($,Q9);if(typeof $=="number")return R8[16+($>=0?2*$:-2*$-1)];let J=new Error("No support for non-integer packed references yet");if($===void 0)J.incomplete=!0;throw J};a[28]=($)=>{if(!A8)A8=new Map,A8.id=0;let J=A8.id++,q=P,Z=b[P],X;if(Z>>5==4)X=[];else X={};let Q={target:X};A8.set(J,Q);let G=$();if(Q.used){if(Object.getPrototypeOf(X)!==Object.getPrototypeOf(G))P=q,X=G,A8.set(J,{target:X}),G=$();return Object.assign(X,G)}return Q.target=G,G};a[28].handlesRead=!0;a[29]=($)=>{let J=A8.get($);return J.used=!0,J.target};a[258]=($)=>new Set($);(a[259]=($)=>{if(l.mapsAsObjects)l.mapsAsObjects=!1,u0=!0;return $()}).handlesRead=!0;function F0($,J){if(typeof $==="string")return $+J;if($ instanceof Array)return $.concat(J);return Object.assign({},$,J)}function K0(){if(!R8)if(l.getShared)MJ();else throw new Error("No packed values available");return R8}var FZ=1399353956;YJ.push(($,J)=>{if($>=225&&$<=255)return F0(K0().prefixes[$-224],J);if($>=28704&&$<=32767)return F0(K0().prefixes[$-28672],J);if($>=1879052288&&$<=2147483647)return F0(K0().prefixes[$-1879048192],J);if($>=216&&$<=223)return F0(J,K0().suffixes[$-216]);if($>=27647&&$<=28671)return F0(J,K0().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return F0(J,K0().suffixes[$-1811939328]);if($==FZ)return{packedValues:R8,structures:s.slice(0),version:J};if($==55799)return J});var jZ=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,DJ=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],AZ=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<DJ.length;$++)LZ(DJ[$],AZ[$]);function LZ($,J){let q="get"+$.name.slice(0,-5),Z;if(typeof $==="function")Z=$.BYTES_PER_ELEMENT;else $=null;for(let X=0;X<2;X++){if(!X&&Z==1)continue;let Q=Z==2?1:Z==4?2:Z==8?3:0;a[X?J:J-4]=Z==1||X==jZ?(G)=>{if(!$)throw new Error("Could not find typed array for code "+J);if(!l.copyBuffers){if(Z===1||Z===2&&!(G.byteOffset&1)||Z===4&&!(G.byteOffset&3)||Z===8&&!(G.byteOffset&7))return new $(G.buffer,G.byteOffset,G.byteLength>>Q)}return new $(Uint8Array.prototype.slice.call(G,0).buffer)}:(G)=>{if(!$)throw new Error("Could not find typed array for code "+J);let U=new DataView(G.buffer,G.byteOffset,G.byteLength),Y=G.length>>Q,z=new $(Y),W=U[q];for(let K=0;K<Y;K++)z[K]=W.call(U,K<<Q,X);return z}}}function PZ(){let $=j0(),J=P+n();for(let Z=2;Z<$;Z++){let X=j0();P+=X}let q=P;return P=J,t=[zJ(j0()),zJ(j0())],t.position0=0,t.position1=0,t.postBundlePosition=P,P=q,n()}function j0(){let $=b[P++]&31;if($>23)switch($){case 24:$=b[P++];break;case 25:$=V8.getUint16(P),P+=2;break;case 26:$=V8.getUint32(P),P+=4;break}return $}function MJ(){if(l.getShared){let $=M9(()=>{return b=null,l.getShared()})||{},J=$.structures||[];if(l.sharedVersion=$.version,R8=l.sharedValues=$.packedValues,s===!0)l.structures=s=J;else s.splice.apply(s,[0,J.length].concat(J))}}function M9($){let J=D0,q=P,Z=UJ,X=w$,Q=p0,G=C$,U=GJ,Y=A8,z=t,W=new Uint8Array(b.slice(0,D0)),K=s,M=l,O=d0,H=$();return D0=J,P=q,UJ=Z,w$=X,p0=Q,C$=G,GJ=U,A8=Y,t=z,b=W,d0=O,s=K,l=M,V8=new DataView(b.buffer,b.byteOffset,b.byteLength),H}function T$(){b=null,A8=null,s=null}var F$=new Array(147);for(let $=0;$<256;$++)F$[$]=+("1e"+Math.floor(45.15-$*0.30103));var VJ=new $0({useRecords:!1}),j$=VJ.decode,IZ=VJ.decodeMultiple;var A$;try{A$=new TextEncoder}catch($){}var RJ,C9,P$=typeof globalThis==="object"&&globalThis.Buffer,c0=typeof P$!=="undefined",OJ=c0?P$.allocUnsafeSlow:Uint8Array,V9=c0?P$:Uint8Array,O9=256,N9=c0?4294967296:2144337920;var NJ,R,i,V=0,J0,$8=null,EZ=61440,fZ=/[\u0080-\uFFFF]/,F8=Symbol("record-id");class I$ extends $0{constructor($){super($);this.offset=0;let J,q,Z,X,Q,G;$=$||{};let U=V9.prototype.utf8Write?function(D,A,C){return R.utf8Write(D,A,C)}:A$&&A$.encodeInto?function(D,A){return A$.encodeInto(D,R.subarray(A)).written}:!1,Y=this,z=$.structures||$.saveStructures,W=$.maxSharedStructures;if(W==null)W=z?128:0;if(W>8190)throw new Error("Maximum maxSharedStructure is 8190");let K=$.sequential;if(K)W=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let M,O,H=$.sharedValues,E;if(H){E=Object.create(null);for(let D=0,A=H.length;D<A;D++)E[H[D]]=D}let B=[],L=0,N=0;this.mapEncode=function(D,A){if(this._keyMap&&!this._mapped)switch(D.constructor.name){case"Array":D=D.map((C)=>this.encodeKeys(C));break}return this.encode(D,A)},this.encode=function(D,A){if(!R)R=new OJ(8192),i=new DataView(R.buffer,0,8192),V=0;if(J0=R.length-10,J0-V<2048)R=new OJ(R.length),i=new DataView(R.buffer,0,R.length),J0=R.length-10,V=0;else if(A===wJ)V=V+7&2147483640;if(q=V,Y.useSelfDescribedHeader)i.setUint32(V,3654940416),V+=3;if(G=Y.structuredClone?new Map:null,Y.bundleStrings&&typeof D!=="string")$8=[],$8.size=1/0;else $8=null;if(Z=Y.structures,Z){if(Z.uninitialized){let T=Y.getShared()||{};Y.structures=Z=T.structures||[],Y.sharedVersion=T.version;let I=Y.sharedValues=T.packedValues;if(I){E={};for(let x=0,k=I.length;x<k;x++)E[I[x]]=x}}let C=Z.length;if(C>W&&!K)C=W;if(!Z.transitions){Z.transitions=Object.create(null);for(let T=0;T<C;T++){let I=Z[T];if(!I)continue;let x,k=Z.transitions;for(let _=0,h=I.length;_<h;_++){if(k[F8]===void 0)k[F8]=T;let p=I[_];if(x=k[p],!x)x=k[p]=Object.create(null);k=x}k[F8]=T|1048576}}if(!K)Z.nextId=C}if(X)X=!1;if(Q=Z||[],O=E,$.pack){let C=new Map;if(C.values=[],C.encoder=Y,C.maxValues=$.maxPrivatePackedValues||(E?16:1/0),C.objectMap=E||!1,C.samplingPackedValues=M,L$(D,C),C.values.length>0){R[V++]=216,R[V++]=51,v8(4);let T=C.values;w(T),v8(0),v8(0),O=Object.create(E||null);for(let I=0,x=T.length;I<x;I++)O[T[I]]=I}}NJ=A&HJ;try{if(NJ)return;if(w(D),$8)H9(q,w);if(Y.offset=V,G&&G.idsToInsert){if(V+=G.idsToInsert.length*2,V>J0)v(V);Y.offset=V;let C=kZ(R.subarray(q,V),G.idsToInsert);return G=null,C}if(A&wJ)return R.start=q,R.end=V,R;return R.subarray(q,V)}finally{if(Z){if(N<10)N++;if(Z.length>W)Z.length=W;if(L>1e4){if(Z.transitions=null,N=0,L=0,B.length>0)B=[]}else if(B.length>0&&!K){for(let C=0,T=B.length;C<T;C++)B[C][F8]=void 0;B=[]}}if(X&&Y.saveShared){if(Y.structures.length>W)Y.structures=Y.structures.slice(0,W);let C=R.subarray(q,V);if(Y.updateSharedData()===!1)return Y.encode(D);return C}if(A&yZ)V=q}},this.findCommonStringsToPack=()=>{if(M=new Map,!E)E=Object.create(null);return(D)=>{let A=D&&D.threshold||4,C=this.pack?D.maxPrivatePackedValues||16:0;if(!H)H=this.sharedValues=[];for(let[T,I]of M)if(I.count>A)E[T]=C++,H.push(T),X=!0;while(this.saveShared&&this.updateSharedData()===!1);M=null}};let w=(D)=>{if(V>J0)R=v(V);var A=typeof D,C;if(A==="string"){if(O){let k=O[D];if(k>=0){if(k<16)R[V++]=k+224;else if(R[V++]=198,k&1)w(15-k>>1);else w(k-16>>1);return}else if(M&&!$.pack){let _=M.get(D);if(_)_.count++;else M.set(D,{count:1})}}let T=D.length;if($8&&T>=4&&T<1024){if(($8.size+=T)>EZ){let _,h=($8[0]?$8[0].length*3+$8[1].length:0)+10;if(V+h>J0)R=v(V+h);if(R[V++]=217,R[V++]=223,R[V++]=249,R[V++]=$8.position?132:130,R[V++]=26,_=V-q,V+=4,$8.position)H9(q,w);$8=["",""],$8.size=0,$8.position=_}let k=fZ.test(D);$8[k?0:1]+=D,R[V++]=k?206:207,w(T);return}let I;if(T<32)I=1;else if(T<256)I=2;else if(T<65536)I=3;else I=5;let x=T*3;if(V+x>J0)R=v(V+x);if(T<64||!U){let k,_,h,p=V+I;for(k=0;k<T;k++)if(_=D.charCodeAt(k),_<128)R[p++]=_;else if(_<2048)R[p++]=_>>6|192,R[p++]=_&63|128;else if((_&64512)===55296&&((h=D.charCodeAt(k+1))&64512)===56320)_=65536+((_&1023)<<10)+(h&1023),k++,R[p++]=_>>18|240,R[p++]=_>>12&63|128,R[p++]=_>>6&63|128,R[p++]=_&63|128;else R[p++]=_>>12|224,R[p++]=_>>6&63|128,R[p++]=_&63|128;C=p-V-I}else C=U(D,V+I,x);if(C<24)R[V++]=96|C;else if(C<256){if(I<2)R.copyWithin(V+2,V+1,V+1+C);R[V++]=120,R[V++]=C}else if(C<65536){if(I<3)R.copyWithin(V+3,V+2,V+2+C);R[V++]=121,R[V++]=C>>8,R[V++]=C&255}else{if(I<5)R.copyWithin(V+5,V+3,V+3+C);R[V++]=122,i.setUint32(V,C),V+=4}V+=C}else if(A==="number")if(!this.alwaysUseFloat&&D>>>0===D)if(D<24)R[V++]=D;else if(D<256)R[V++]=24,R[V++]=D;else if(D<65536)R[V++]=25,R[V++]=D>>8,R[V++]=D&255;else R[V++]=26,i.setUint32(V,D),V+=4;else if(!this.alwaysUseFloat&&D>>0===D)if(D>=-24)R[V++]=31-D;else if(D>=-256)R[V++]=56,R[V++]=~D;else if(D>=-65536)R[V++]=57,i.setUint16(V,~D),V+=2;else R[V++]=58,i.setUint32(V,~D),V+=4;else{let T;if((T=this.useFloat32)>0&&D<4294967296&&D>=-2147483648){R[V++]=250,i.setFloat32(V,D);let I;if(T<4||(I=D*F$[(R[V]&127)<<1|R[V+1]>>7])>>0===I){V+=4;return}else V--}R[V++]=251,i.setFloat64(V,D),V+=8}else if(A==="object")if(!D)R[V++]=246;else{if(G){let I=G.get(D);if(I){if(R[V++]=216,R[V++]=29,R[V++]=25,!I.references){let x=G.idsToInsert||(G.idsToInsert=[]);I.references=[],x.push(I)}I.references.push(V-q),V+=2;return}else G.set(D,{offset:V-q})}let T=D.constructor;if(T===Object)f(D);else if(T===Array){if(C=D.length,C<24)R[V++]=128|C;else v8(C);for(let I=0;I<C;I++)w(D[I])}else if(T===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)R[V++]=217,R[V++]=1,R[V++]=3;if(C=D.size,C<24)R[V++]=160|C;else if(C<256)R[V++]=184,R[V++]=C;else if(C<65536)R[V++]=185,R[V++]=C>>8,R[V++]=C&255;else R[V++]=186,i.setUint32(V,C),V+=4;if(Y.keyMap)for(let[I,x]of D)w(Y.encodeKey(I)),w(x);else for(let[I,x]of D)w(I),w(x)}else{for(let I=0,x=RJ.length;I<x;I++){let k=C9[I];if(D instanceof k){let _=RJ[I],h=_.tag;if(h==null)h=_.getTag&&_.getTag.call(this,D);if(h<24)R[V++]=192|h;else if(h<256)R[V++]=216,R[V++]=h;else if(h<65536)R[V++]=217,R[V++]=h>>8,R[V++]=h&255;else if(h>-1)R[V++]=218,i.setUint32(V,h),V+=4;_.encode.call(this,D,w,v);return}}if(D[Symbol.iterator]){if(NJ){let I=new Error("Iterable should be serialized as iterator");throw I.iteratorNotHandled=!0,I}R[V++]=159;for(let I of D)w(I);R[V++]=255;return}if(D[Symbol.asyncIterator]||BJ(D)){let I=new Error("Iterable/blob should be serialized as iterator");throw I.iteratorNotHandled=!0,I}if(this.useToJSON&&D.toJSON){let I=D.toJSON();if(I!==D)return w(I)}f(D)}}else if(A==="boolean")R[V++]=D?245:244;else if(A==="bigint"){if(D<BigInt(1)<<BigInt(64)&&D>=0)R[V++]=27,i.setBigUint64(V,D);else if(D>-(BigInt(1)<<BigInt(64))&&D<0)R[V++]=59,i.setBigUint64(V,-D-BigInt(1));else if(this.largeBigIntToFloat)R[V++]=251,i.setFloat64(V,Number(D));else{if(D>=BigInt(0))R[V++]=194;else R[V++]=195,D=BigInt(-1)-D;let T=[];while(D)T.push(Number(D&BigInt(255))),D>>=BigInt(8);CJ(new Uint8Array(T.reverse()),v);return}V+=8}else if(A==="undefined")R[V++]=247;else throw new Error("Unknown type: "+A)},f=this.useRecords===!1?this.variableMapSize?(D)=>{let A=Object.keys(D),C=Object.values(D),T=A.length;if(T<24)R[V++]=160|T;else if(T<256)R[V++]=184,R[V++]=T;else if(T<65536)R[V++]=185,R[V++]=T>>8,R[V++]=T&255;else R[V++]=186,i.setUint32(V,T),V+=4;let I;if(Y.keyMap)for(let x=0;x<T;x++)w(Y.encodeKey(A[x])),w(C[x]);else for(let x=0;x<T;x++)w(A[x]),w(C[x])}:(D)=>{R[V++]=185;let A=V-q;V+=2;let C=0;if(Y.keyMap){for(let T in D)if(typeof D.hasOwnProperty!=="function"||D.hasOwnProperty(T))w(Y.encodeKey(T)),w(D[T]),C++}else for(let T in D)if(typeof D.hasOwnProperty!=="function"||D.hasOwnProperty(T))w(T),w(D[T]),C++;R[A+++q]=C>>8,R[A+q]=C&255}:(D,A)=>{let C,T=Q.transitions||(Q.transitions=Object.create(null)),I=0,x=0,k,_;if(this.keyMap){_=Object.keys(D).map((p)=>this.encodeKey(p)),x=_.length;for(let p=0;p<x;p++){let f8=_[p];if(C=T[f8],!C)C=T[f8]=Object.create(null),I++;T=C}}else for(let p in D)if(typeof D.hasOwnProperty!=="function"||D.hasOwnProperty(p)){if(C=T[p],!C){if(T[F8]&1048576)k=T[F8]&65535;C=T[p]=Object.create(null),I++}T=C,x++}let h=T[F8];if(h!==void 0)h&=65535,R[V++]=217,R[V++]=h>>8|224,R[V++]=h&255;else{if(!_)_=T.__keys__||(T.__keys__=Object.keys(D));if(k===void 0){if(h=Q.nextId++,!h)h=0,Q.nextId=1;if(h>=O9)Q.nextId=(h=W)+1}else h=k;if(Q[h]=_,h<W){R[V++]=217,R[V++]=h>>8|224,R[V++]=h&255,T=Q.transitions;for(let p=0;p<x;p++){if(T[F8]===void 0||T[F8]&1048576)T[F8]=h;T=T[_[p]]}T[F8]=h|1048576,X=!0}else{if(T[F8]=h,i.setUint32(V,3655335680),V+=3,I)L+=N*I;if(B.length>=O9-W)B.shift()[F8]=void 0;if(B.push(T),v8(x+2),w(57344+h),w(_),A)return;for(let p in D)if(typeof D.hasOwnProperty!=="function"||D.hasOwnProperty(p))w(D[p]);return}}if(x<24)R[V++]=128|x;else v8(x);if(A)return;for(let p in D)if(typeof D.hasOwnProperty!=="function"||D.hasOwnProperty(p))w(D[p])},v=(D)=>{let A;if(D>16777216){if(D-q>N9)throw new Error("Encoded buffer would be larger than maximum buffer size");A=Math.min(N9,Math.round(Math.max((D-q)*(D>67108864?1.25:2),4194304)/4096)*4096)}else A=(Math.max(D-q<<2,R.length-1)>>12)+1<<12;let C=new OJ(A);if(i=new DataView(C.buffer,0,A),R.copy)R.copy(C,0,q,D);else C.set(R.slice(q,D));return V-=q,q=0,J0=C.length-10,R=C},g=100,y=1000;this.encodeAsIterable=function(D,A){return m(D,A,F)},this.encodeAsAsyncIterable=function(D,A){return m(D,A,d)};function*F(D,A,C){let T=D.constructor;if(T===Object){let I=Y.useRecords!==!1;if(I)f(D,!0);else B9(Object.keys(D).length,160);for(let x in D){let k=D[x];if(!I)w(x);if(k&&typeof k==="object")if(A[x])yield*F(k,A[x]);else yield*j(k,A,x);else w(k)}}else if(T===Array){let I=D.length;v8(I);for(let x=0;x<I;x++){let k=D[x];if(k&&(typeof k==="object"||V-q>g))if(A.element)yield*F(k,A.element);else yield*j(k,A,"element");else w(k)}}else if(D[Symbol.iterator]&&!D.buffer){R[V++]=159;for(let I of D)if(I&&(typeof I==="object"||V-q>g))if(A.element)yield*F(I,A.element);else yield*j(I,A,"element");else w(I);R[V++]=255}else if(BJ(D))B9(D.size,64),yield R.subarray(q,V),yield D,S();else if(D[Symbol.asyncIterator])R[V++]=159,yield R.subarray(q,V),yield D,S(),R[V++]=255;else w(D);if(C&&V>q)yield R.subarray(q,V);else if(V-q>g)yield R.subarray(q,V),S()}function*j(D,A,C){let T=V-q;try{if(w(D),V-q>g)yield R.subarray(q,V),S()}catch(I){if(I.iteratorNotHandled)A[C]={},V=q+T,yield*F.call(this,D,A[C]);else throw I}}function S(){g=y,Y.encode(null,HJ)}function m(D,A,C){if(A&&A.chunkThreshold)g=y=A.chunkThreshold;else g=100;if(D&&typeof D==="object")return Y.encode(null,HJ),C(D,Y.iterateProperties||(Y.iterateProperties={}),!0);return[Y.encode(D)]}async function*d(D,A){for(let C of F(D,A,!0)){let T=C.constructor;if(T===V9||T===Uint8Array)yield C;else if(BJ(C)){let I=C.stream().getReader(),x;while(!(x=await I.read()).done)yield x.value}else if(C[Symbol.asyncIterator])for await(let I of C)if(S(),I)yield*d(I,A.async||(A.async={}));else yield Y.encode(I);else yield C}}}useBuffer($){R=$,i=new DataView(R.buffer,R.byteOffset,R.byteLength),V=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let J=this.structures.slice(0),q=new TJ(J,this.sharedValues,this.sharedVersion),Z=this.saveShared(q,(X)=>(X&&X.version||0)==$);if(Z===!1)q=this.getShared()||{},this.structures=q.structures||[],this.sharedValues=q.packedValues,this.sharedVersion=q.version,this.structures.nextId=this.structures.length;else J.forEach((X,Q)=>this.structures[Q]=X);return Z}}function B9($,J){if($<24)R[V++]=J|$;else if($<256)R[V++]=J|24,R[V++]=$;else if($<65536)R[V++]=J|25,R[V++]=$>>8,R[V++]=$&255;else R[V++]=J|26,i.setUint32(V,$),V+=4}class TJ{constructor($,J,q){this.structures=$,this.packedValues=J,this.version=q}}function v8($){if($<24)R[V++]=128|$;else if($<256)R[V++]=152,R[V++]=$;else if($<65536)R[V++]=153,R[V++]=$>>8,R[V++]=$&255;else R[V++]=154,i.setUint32(V,$),V+=4}var SZ=typeof Blob==="undefined"?function(){}:Blob;function BJ($){if($ instanceof SZ)return!0;let J=$[Symbol.toStringTag];return J==="Blob"||J==="File"}function L$($,J){switch(typeof $){case"string":if($.length>3){if(J.objectMap[$]>-1||J.values.length>=J.maxValues)return;let Z=J.get($);if(Z){if(++Z.count==2)J.values.push($)}else if(J.set($,{count:1}),J.samplingPackedValues){let X=J.samplingPackedValues.get($);if(X)X.count++;else J.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let Z=0,X=$.length;Z<X;Z++)L$($[Z],J);else{let Z=!J.encoder.useRecords;for(var q in $)if($.hasOwnProperty(q)){if(Z)L$(q,J);L$($[q],J)}}break;case"function":console.log($)}}var xZ=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;C9=[Date,Set,Error,RegExp,x8,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,TJ];RJ=[{tag:1,encode($,J){let q=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&q>=0&&q<4294967296)R[V++]=26,i.setUint32(V,q),V+=4;else R[V++]=251,i.setFloat64(V,q),V+=8}},{tag:258,encode($,J){let q=Array.from($);J(q)}},{tag:27,encode($,J){J([$.name,$.message])}},{tag:27,encode($,J){J(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,J){J($.value)}},{encode($,J,q){CJ($,q)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||c0&&this.tagUint8Array!==!1)return 64}},encode($,J,q){CJ($,q)}},k8(68,1),k8(69,2),k8(70,4),k8(71,8),k8(72,1),k8(77,2),k8(78,4),k8(79,8),k8(85,4),k8(86,8),{encode($,J){let q=$.packedValues||[],Z=$.structures||[];if(q.values.length>0){R[V++]=216,R[V++]=51,v8(4);let X=q.values;J(X),v8(0),v8(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let Q=0,G=X.length;Q<G;Q++)packedObjectMap[X[Q]]=Q}if(Z){i.setUint32(V,3655335424),V+=3;let X=Z.slice(0);X.unshift(57344),X.push(new x8($.version,1399353956)),J(X)}else J(new x8($.version,1399353956))}}];function k8($,J){if(!xZ&&J>1)$-=4;return{tag:$,encode:function q(Z,X){let Q=Z.byteLength,G=Z.byteOffset||0,U=Z.buffer||Z;X(c0?P$.from(U,G,Q):new Uint8Array(U,G,Q))}}}function CJ($,J){let q=$.byteLength;if(q<24)R[V++]=64+q;else if(q<256)R[V++]=88,R[V++]=q;else if(q<65536)R[V++]=89,R[V++]=q>>8,R[V++]=q&255;else R[V++]=90,i.setUint32(V,q),V+=4;if(V+q>=R.length)J(V+q);R.set($.buffer?$:new Uint8Array($),V),V+=q}function kZ($,J){let q,Z=J.length*2,X=$.length-Z;J.sort((Q,G)=>Q.offset>G.offset?1:-1);for(let Q=0;Q<J.length;Q++){let G=J[Q];G.id=Q;for(let U of G.references)$[U++]=Q>>8,$[U]=Q&255}while(q=J.pop()){let Q=q.offset;$.copyWithin(Q+Z,Q,X),Z-=2;let G=Q+Z;$[G++]=216,$[G++]=28,X=Q}return $}function H9($,J){i.setUint32($8.position+$,V-$8.position-$+1);let q=$8;$8=null,J(q[0]),J(q[1])}var FJ=new I$({useRecords:!1}),vZ=FJ.encode,_Z=FJ.encodeAsIterable,gZ=FJ.encodeAsAsyncIterable;var wJ=512,yZ=1024,HJ=2048;var E$=($)=>{let J=new Uint8Array($);return btoa(String.fromCharCode(...J)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},w9=($)=>{let J=atob($.replace(/-/g,"+").replace(/_/g,"/")),q=new Uint8Array(J.length);for(let Z=0;Z<J.length;Z++)q[Z]=J.charCodeAt(Z);return q.buffer};async function T9($){let J=crypto.getRandomValues(new Uint8Array(32)),Z=new TextEncoder().encode($),X=await crypto.subtle.digest("SHA-256",Z),Q=new Uint8Array(X).slice(0,16),G=await navigator.credentials.create({publicKey:{challenge:J,rp:{name:"Sorane Web/A Form"},user:{id:Q,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"required"},timeout:60000,attestation:"none",extensions:{prf:{}}}});if(!G)throw new Error("Credential creation failed");return{id:G.id,rawId:E$(G.rawId),response:G.response}}async function F9($,J){let q=await navigator.credentials.get({publicKey:{challenge:J,allowCredentials:[{id:w9($),type:"public-key"}],userVerification:"required"}});if(!q)throw new Error("Assertion failed");let Z=q.response;return{id:q.id,signature:E$(Z.signature),authenticatorData:E$(Z.authenticatorData),clientDataJSON:E$(Z.clientDataJSON)}}async function A0($,J){let q=crypto.getRandomValues(new Uint8Array(32)),Z=await navigator.credentials.get({publicKey:{challenge:q,allowCredentials:[{id:w9($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:J}}}}});if(!Z)throw new Error("Assertion failed");let Q=Z.getClientExtensionResults()?.prf?.results?.first;if(!Q)throw new Error("PRF extension not available");return new Uint8Array(Q)}function l0($){return Array.from($).map((J)=>J.toString(16).padStart(2,"0")).join("")}function j9($){let J=new Uint8Array($.length/2);for(let q=0;q<J.length;q++)J[q]=parseInt($.substring(q*2,q*2+2),16);return J}class L9{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),J=localStorage.getItem("weba_passkey_pub");if($&&J){this.credentialId=$,this.publicKey=j9(J),this.publicKeyType="p256",this.usePasskey=!0;return}let q=localStorage.getItem("weba_private_key");if(q)this.edPrivateKey=j9(q),this.publicKey=t8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{let $=prompt("Enter a name for this Passkey:","demo-user")||"User";console.log(`Registering Passkey for ${$}...`);let J=await T9($),q=new Uint8Array(J.response.attestationObject),X=j$(q).authData,Q=new DataView(X.buffer,X.byteOffset,X.byteLength),G=53,U=Q.getUint16(G);G+=2,G+=U;let Y=X.slice(G),z=j$(Y),W=z.get(-2),K=z.get(-3);if(!W||!K)throw new Error("Invalid COSE Key: x or y missing");let M=new Uint8Array(65);if(M[0]=4,M.set(W,1),M.set(K,33),this.credentialId=J.rawId,this.publicKey=M,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",l0(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}generateEdKey(){if(this.edPrivateKey=t8.utils.randomSecretKey(),this.publicKey=t8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",l0(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return`did:key:z${l0(this.publicKey)}`}getPublicKey(){return this.publicKey?l0(this.publicKey):""}async sign($,J="authentication"){if(!this.publicKey)await this.register();let q=A9.default($),Z=new TextEncoder().encode(q);if(this.usePasskey&&this.credentialId){let X=await crypto.subtle.digest("SHA-256",Z),Q=await F9(this.credentialId,X);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:J,proofValue:Q.signature,"srn:authenticatorData":Q.authenticatorData,"srn:clientDataJSON":Q.clientDataJSON,"srn:credentialId":Q.id}}}else{if(!this.edPrivateKey)this.generateEdKey();let X=t8.sign(Z,this.edPrivateKey);return{...$,proof:{type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:J,proofValue:l0(X)}}}}async derivePrf($){if(!this.credentialId)return null;try{return await A0(this.credentialId,$)}catch(J){return console.error("PRF derivation failed",J),null}}}var E8=new L9;class jJ{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor($,J){if(k0($),c(J,void 0,"key"),this.iHash=$.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let q=this.blockLen,Z=new Uint8Array(q);Z.set(J.length>q?$.create().update(J).digest():J);for(let X=0;X<Z.length;X++)Z[X]^=54;this.iHash.update(Z),this.oHash=$.create();for(let X=0;X<Z.length;X++)Z[X]^=106;this.oHash.update(Z),B8(Z)}update($){return b8(this),this.iHash.update($),this}digestInto($){b8(this),c($,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto($),this.oHash.update($),this.oHash.digestInto($),this.destroy()}digest(){let $=new Uint8Array(this.oHash.outputLen);return this.digestInto($),$}_cloneInto($){$||=Object.create(Object.getPrototypeOf(this),{});let{oHash:J,iHash:q,finished:Z,destroyed:X,blockLen:Q,outputLen:G}=this;return $=$,$.finished=Z,$.destroyed=X,$.blockLen=Q,$.outputLen=G,$.oHash=J._cloneInto($.oHash),$.iHash=q._cloneInto($.iHash),$}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var f$=($,J,q)=>new jJ($,J).update(q).digest();f$.create=($,J)=>new jJ($,J);function mZ($,J,q){if(k0($),q===void 0)q=new Uint8Array($.outputLen);return f$($,q,J)}var AJ=Uint8Array.of(0),P9=Uint8Array.of();function bZ($,J,q,Z=32){k0($),T8(Z,"length");let X=$.outputLen;if(Z>255*X)throw new Error("Length must be <= 255*HashLen");let Q=Math.ceil(Z/X);if(q===void 0)q=P9;else c(q,void 0,"info");let G=new Uint8Array(Q*X),U=f$.create($,J),Y=U._cloneInto(),z=new Uint8Array(U.outputLen);for(let W=0;W<Q;W++)AJ[0]=W+1,Y.update(W===0?P9:z).update(q).update(AJ).digestInto(z),G.set(z,X*W),U._cloneInto(Y);return U.destroy(),Y.destroy(),B8(z,AJ),G.slice(0,Z)}var C8=($,J,q,Z,X)=>bZ($,mZ($,J,q),Z,X);var f9=G1(XJ(),1),I9="weba_l2_ed25519_sk";function O8($){if(typeof Buffer!=="undefined")return Buffer.from($).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");let J="";return $.forEach((Z)=>{J+=String.fromCharCode(Z)}),btoa(J).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function G8($){let J=$.length%4===0?"":"=".repeat(4-$.length%4),q=$.replace(/-/g,"+").replace(/_/g,"/")+J;if(typeof Buffer!=="undefined")return new Uint8Array(Buffer.from(q,"base64"));let Z=atob(q),X=new Uint8Array(Z.length);for(let Q=0;Q<Z.length;Q+=1)X[Q]=Z.charCodeAt(Q);return X}function S$($){let J=f9.default($);if(J===void 0)throw new Error("Failed to canonicalize JSON");return J}function E9($){let J=new Uint8Array($);return crypto.getRandomValues(J),J}function hZ(){let $=localStorage.getItem(I9);if($)return G8($);let J=t8.utils.randomSecretKey();return localStorage.setItem(I9,O8(J)),J}function uZ($,J,q){let Z={layer1_ref:$,recipient:J,weba_version:q};return new TextEncoder().encode(S$(Z))}function S9($,J){let q=new Uint8Array($.length+J.length);return q.set($,0),q.set(J,$.length),q}function x9($){let J=new TextEncoder().encode("weba-l2/user-x25519"),q=C8(H8,$,void 0,J,32);return{publicKey:b0.getPublicKey(q),privateKey:q}}function k9(){return globalThis.webaPqcKem||null}async function v9($,J,q,Z){let X=await crypto.subtle.importKey("raw",J,"AES-GCM",!1,["encrypt"]),Q=await crypto.subtle.encrypt({name:"AES-GCM",iv:q,additionalData:Z},X,$);return new Uint8Array(Q)}async function _9($){let J=C8(H8,$.prfKey,void 0,void 0,32),q=C8(H8,J,void 0,new TextEncoder().encode("weba-l2/kw"),32),Z=C8(H8,J,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),X=$.aad??new Uint8Array;return v9($.recipientSk,q,Z,X)}async function g9($,J,q,Z){let X=await crypto.subtle.importKey("raw",J,"AES-GCM",!1,["decrypt"]),Q=await crypto.subtle.decrypt({name:"AES-GCM",iv:q,additionalData:Z},X,$);return new Uint8Array(Q)}async function y9($){let J=$.config.weba_version??"0.1",q=$.config.recipient_kid,Z=$.config.layer1_ref,X=$.user_kid??"user#sig-1",Q=hZ(),G=S$($.layer2_plain),U=new TextEncoder().encode(G),Y=t8.sign(U,Q),z={alg:"Ed25519",kid:X,sig:O8(Y),created_at:new Date().toISOString()},W={layer2_plain:$.layer2_plain,layer2_sig:z},K=uZ(Z,q,J),M=new TextEncoder().encode(S$(W)),O=G8($.config.recipient_x25519),H=E9(32),E=b0.getPublicKey(H),B=b0.getSharedSecret(H,O),L=B,N,w="X25519";if($.config.recipient_pqc){let F=$.pqcProvider??k9();if(!F)throw new Error("PQC requested but no provider is available");let j=G8($.config.recipient_pqc),S=F.encapsulate(j);N=S.encapsulation,L=S9(B,S.sharedSecret),w=`X25519+${F.kemId}`}let f=C8(H8,L,K,void 0,32),v=C8(H8,f,void 0,new TextEncoder().encode("weba-l2/key"),32),g=C8(H8,f,void 0,new TextEncoder().encode("weba-l2/iv"),12),y=await v9(M,v,g,K);return{weba_version:J,layer1_ref:Z,layer2:{enc:"HPKE-v1",suite:{kem:w,kdf:"HKDF-SHA256",aead:"AES-256-GCM"},recipient:q,encapsulated:{classical:O8(E),...N?{pqc:O8(N)}:{}},ciphertext:O8(y),aad:O8(K)},meta:{created_at:new Date().toISOString(),nonce:O8(E9(16)),...$.config.campaign_id?{campaign_id:$.config.campaign_id}:{},...$.config.key_policy?{key_policy:$.config.key_policy}:{}}}}function m9(){let $=document.getElementById("weba-l2-config");if(!$||!$.textContent)return null;try{return JSON.parse($.textContent)}catch{return null}}async function x$($,J,q){let Z=G8($.layer2.aad),X={layer1_ref:$.layer1_ref,recipient:$.layer2.recipient,weba_version:$.weba_version},Q=new TextEncoder().encode(S$(X));if(O8(Q)!==$.layer2.aad)throw new Error("AAD mismatch");let G=G8($.layer2.encapsulated.classical),U=b0.getSharedSecret(J,G),Y=U;if($.layer2.encapsulated.pqc){let H=q?.pqcProvider??k9(),E=q?.pqcRecipientSk;if(!H||!E)throw new Error("Missing PQC KEM for envelope");let B=G8($.layer2.encapsulated.pqc),L=H.decapsulate(E,B);Y=S9(U,L)}let z=C8(H8,Y,Z,void 0,32),W=C8(H8,z,void 0,new TextEncoder().encode("weba-l2/key"),32),K=C8(H8,z,void 0,new TextEncoder().encode("weba-l2/iv"),12),M=G8($.layer2.ciphertext),O=await g9(M,W,K,Z);return JSON.parse(new TextDecoder().decode(O))}async function b9($){let J=C8(H8,$.prfKey,void 0,void 0,32),q=C8(H8,J,void 0,new TextEncoder().encode("weba-l2/kw"),32),Z=C8(H8,J,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),X=$.keywrap.aad?G8($.keywrap.aad):new Uint8Array,Q=G8($.keywrap.wrapped_key);return g9(Q,q,Z,X)}function pZ($){$.querySelectorAll("input").forEach((q)=>{if(q.type==="checkbox"||q.type==="radio")q.checked=!1,q.removeAttribute("checked");else q.value="",q.removeAttribute("value")}),$.querySelectorAll("textarea").forEach((q)=>{q.value="",q.textContent=""}),$.querySelectorAll("select").forEach((q)=>{q.selectedIndex=-1,q.querySelectorAll("option").forEach((Z)=>Z.removeAttribute("selected"))}),$.getElementById("json-ld")?.remove(),$.getElementById("data-layer")?.remove();let J=$.getElementById("json-debug");if(J)J.textContent=""}function dZ($,J){let q=JSON.stringify(J,null,2),Z=$.createElement("script");Z.type="application/ld+json",Z.id="weba-user-vc",Z.textContent=q,$.body.appendChild(Z);let X=$.createElement("div");X.className="weba-user-verification no-print",X.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",X.innerHTML=`
    <details>
      <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
        <span></span> 
      </summary>
      <div style="padding: 1rem 0;">
        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
      </div>
    </details>
  `;let Q=X.querySelector("pre");if(Q)Q.textContent=q;$.body.appendChild(X)}function cZ($,J){let q=$.createElement("script");q.id="weba-l2-envelope",q.type="application/json",q.textContent=JSON.stringify(J,null,2),$.body.appendChild(q)}function lZ($,J){let q=new Date,Z=q.getFullYear()+("0"+(q.getMonth()+1)).slice(-2)+("0"+q.getDate()).slice(-2)+"-"+("0"+q.getHours()).slice(-2)+("0"+q.getMinutes()).slice(-2),X=Math.random().toString(36).substring(2,8);return`${$}_${Z}_${J}_${X}.html`}function nZ($,J){let Z=new DOMParser().parseFromString($,"text/html");if(J?.stripPlaintext)pZ(Z);if(J?.embeddedVc)dZ(Z,J.embeddedVc);if(J?.l2Envelope)cZ(Z,J.l2Envelope);return Z.documentElement.outerHTML}function h9($){let J=nZ($.documentHtml,$.options),q=new Blob([J],{type:"text/html"}),Z=URL.createObjectURL(q),X=document.createElement("a");if(X.href=Z,X.download=lZ($.title,$.filenameSuffix),X.click(),$.isFinal)setTimeout(()=>window.location.reload(),1000)}class LJ{formId;constructor(){this.formId="WebA_"+window.location.pathname}updateJsonLd(){let J=window.generatedJsonStructure||{};document.querySelectorAll("[data-json-path]").forEach((X)=>{let Q=X.dataset.jsonPath;if(Q)J[Q]=X.value}),document.querySelectorAll('[type="radio"]:checked').forEach((X)=>{J[X.name]=X.value}),document.querySelectorAll("table.data-table.dynamic").forEach((X)=>{let Q=X.dataset.tableKey;if(Q){let G=[];X.querySelectorAll("tbody tr").forEach((U)=>{let Y={},z=!1;if(U.querySelectorAll("[data-base-key]").forEach((W)=>{if(W.type==="checkbox"){if(Y[W.dataset.baseKey]=W.checked,W.checked)z=!0}else if(Y[W.dataset.baseKey]=W.value,W.value)z=!0}),z)G.push(Y)}),J[Q]=G}});let q=document.getElementById("json-ld");if(q)q.textContent=JSON.stringify(J,null,2);let Z=document.getElementById("json-debug");if(Z)Z.textContent=JSON.stringify(J,null,2);return J}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=this.updateJsonLd(),J=window,q=J.generatedJsonStructure&&J.generatedJsonStructure.name||"Response",Z=window.location.href.split("#")[0],X=this.getL2Config(),Q=document.getElementById("weba-l2-encrypt");if(!!(X?.enabled&&(Q?Q.checked:X.default_enabled))){if(!X?.recipient_kid||!X?.recipient_x25519||!X?.layer1_ref){alert("L2 encryption config is missing required fields.");return}try{let Y=await y9({layer2_plain:$,config:X,user_kid:X.user_kid});this.downloadHtml("submit",!0,{l2Envelope:Y,stripPlaintext:!0})}catch(Y){console.error(Y),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!E8.getPublicKey()){if(!await E8.register()){alert("Key registration failed.");return}}let U={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:E8.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:Z,answers:$}};try{let Y=await E8.sign(U);this.downloadHtml("submitted",!0,{embeddedVc:Y})}catch(Y){console.error(Y),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let J=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((q)=>{let Z=q.dataset.jsonPath;if(J[Z]!==void 0)q.value=J[Z]}),document.querySelectorAll("table.data-table.dynamic").forEach((q)=>{let Z=q.dataset.tableKey,X=J[Z];if(Array.isArray(X)){let Q=q.querySelector("tbody");if(!Q)return;let G=Q.querySelectorAll(".template-row");X.forEach((U,Y)=>{let z;if(Y===0)z=Q.querySelector(".template-row");else{let W=Q.querySelector(".template-row");if(W){z=W.cloneNode(!0),z.classList.remove("template-row");let K=z.querySelector(".remove-row-btn");if(K)K.style.visibility="visible";Q.appendChild(z)}}if(z)z.querySelectorAll("input, select").forEach((W)=>{let K=W.dataset.baseKey;if(K&&U[K]!==void 0)if(W.type==="checkbox")W.checked=!!U[K];else W.value=U[K]})})}})}catch(J){console.error(J)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,J,q){let Z=window,X=Z.generatedJsonStructure&&Z.generatedJsonStructure.name||"web-a-form";h9({documentHtml:document.documentElement.outerHTML,title:X,filenameSuffix:$,isFinal:J,options:q})}saveDraft(){this.bakeValues(),this.downloadHtml("draft",!1)}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class PJ{calc;data;constructor($,J){this.calc=$,this.data=J}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save Progress",clear_btn:"Clear Data",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},J=(navigator.language||"en").startsWith("ja")?"ja":"en",q=$[J]||$.en;document.querySelectorAll("[data-i18n]").forEach((Z)=>{let X=Z.dataset.i18n;if(q[X])Z.textContent=q[X]})}initTables(){document.querySelectorAll(".data-table.dynamic tbody").forEach(($)=>{this.renumberRows($)})}renumberRows($){Array.from($.querySelectorAll("tr")).filter((q)=>{return q.querySelectorAll("td").length>0}).forEach((q,Z)=>{let X=Z+1;q.querySelectorAll(".auto-num").forEach((Q)=>{if(Q.value!=X)Q.value=X.toString(),Q.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let J=$.closest("tr"),q=J.parentElement;if(J.classList.contains("template-row"))J.querySelectorAll("input").forEach((Z)=>{if(Z.type==="checkbox")Z.checked=!1;else Z.value=""});else{if(J.remove(),q)this.renumberRows(q);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,J){let q=document.getElementById("tbl_"+J);if(!q)return;let Z=q.querySelector("tbody");if(!Z)return;let X=Z.querySelector(".template-row");if(!X)return;let Q=X.cloneNode(!0);Q.classList.remove("template-row"),Q.querySelectorAll("input").forEach((U)=>{if(U.type==="checkbox")U.checked=U.hasAttribute("checked");else U.value=U.getAttribute("value")||""});let G=Q.querySelector(".remove-row-btn");if(G)G.style.visibility="visible";Q.querySelectorAll("[data-copy-from]").forEach((U)=>{let Y=U.dataset.copyFrom;if(Y){let z=Q.querySelector(`[data-base-key="${Y}"]`);if(z&&z.value)U.value=z.value}}),Z.appendChild(Q),this.renumberRows(Z),this.calc.recalculate()}switchTab($,J){document.querySelectorAll(".tab-btn").forEach((Z)=>Z.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((Z)=>Z.classList.remove("active")),$.classList.add("active");let q=document.getElementById(J);if(q)q.classList.add("active")}}function u9($){let J=document.getElementById($);if(!J||!J.textContent)return null;try{return JSON.parse(J.textContent)}catch{return null}}function p9(){let $=u9("weba-l2-envelope");if(!$)return;let J=u9("weba-l2-keywrap"),q=document.querySelector(".weba-form-container")||document.body,Z=document.createElement("div");Z.className="weba-l2-unlock",Z.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #cbd5f5;border-radius:10px;background:#f8fafc;";let X=document.createElement("div");X.textContent="Encrypted Submission",X.style.cssText="font-weight:600;color:#334155;margin-bottom:0.5rem;",Z.appendChild(X);let Q=document.createElement("div");Q.textContent="Locked. Unlock with Passkey.",Q.style.cssText="color:#64748b;margin-bottom:0.75rem;",Z.appendChild(Q);let G=document.createElement("button");G.textContent="Unlock (Passkey)",G.style.cssText="padding:0.5rem 1rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;",Z.appendChild(G);let U=document.createElement("pre");U.style.cssText="margin-top:1rem;padding:1rem;background:#0f172a;color:#e2e8f0;border-radius:8px;overflow:auto;font-size:0.85rem;display:none;",Z.appendChild(U);let Y=document.createElement("details");Y.style.cssText="margin-top:0.75rem; display:none;",Y.innerHTML='<summary style="cursor:pointer;color:#64748b;">Show signature</summary><pre style="margin-top:0.5rem;padding:0.75rem;background:#0b1220;color:#cbd5f5;border-radius:6px;overflow:auto;font-size:0.8rem;"></pre>',Z.appendChild(Y);let z=document.createElement("button");z.textContent="Export JSON",z.style.cssText="margin-top:0.75rem;padding:0.45rem 0.9rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;display:none;",z.disabled=!0,Z.appendChild(z),G.addEventListener("click",async()=>{if(!J){Q.textContent="Key wrap package not found.";return}G.disabled=!0,Q.textContent="Waiting for passkey...";try{let W=G8(J.prf_salt),K=await A0(J.credential_id,W),M=await b9({keywrap:J,prfKey:K}),O=await x$($,M);iZ(O.layer2_plain),document.body.classList.add("weba-l2-readonly"),U.textContent=JSON.stringify(O.layer2_plain,null,2),U.style.display="block";let H=Y.querySelector("pre");if(H)H.textContent=JSON.stringify(O.layer2_sig,null,2);Y.style.display="block",z.style.display="inline-block",z.disabled=!1,Q.textContent="Unlocked.",z.onclick=()=>{let E=new Blob([JSON.stringify(O,null,2)],{type:"application/json"}),B=URL.createObjectURL(E),L=document.createElement("a");L.href=B,L.download="weba-l2-decrypted.json",L.click()}}catch(W){console.error(W),Q.textContent="Unlock failed.",G.disabled=!1}}),q.appendChild(Z)}function iZ($){if(!$||typeof $!=="object")return;let J=$;document.querySelectorAll("[data-json-path]").forEach((q)=>{let Z=q.dataset.jsonPath;if(!Z||!(Z in J))return;let X=J[Z];if(q.type==="checkbox")q.checked=Boolean(X);else if(q.type==="radio")q.checked=q.value===String(X);else q.value=X===null||X===void 0?"":String(X)}),document.querySelectorAll('input[type="radio"]').forEach((q)=>{let Z=q.name;if(!Z||!(Z in J))return;let X=J[Z];q.checked=q.value===String(X)}),document.querySelectorAll("table.data-table.dynamic").forEach((q)=>{let Z=q.dataset.tableKey;if(!Z)return;let X=J[Z];if(!Array.isArray(X))return;let Q=q.querySelector("tbody");if(!Q)return;let G=Q.querySelector("tr.template-row");if(!G)return;Array.from(Q.querySelectorAll("tr")).forEach((U)=>{if(!U.classList.contains("template-row"))U.remove()}),X.forEach((U,Y)=>{let z=Y===0?G:G.cloneNode(!0);if(Y>0){z.classList.remove("template-row");let W=z.querySelector(".remove-row-btn");if(W)W.style.visibility="visible";Q.appendChild(z)}if(U&&typeof U==="object")z.querySelectorAll("input, select, textarea").forEach((W)=>{let K=W.dataset.baseKey;if(!K)return;let M=U[K];if(W.type==="checkbox")W.checked=Boolean(M);else W.value=M===null||M===void 0?"":String(M)})})}),document.querySelectorAll("input").forEach((q)=>{if(q.type==="checkbox"||q.type==="radio")q.disabled=!0;else q.readOnly=!0}),document.querySelectorAll("textarea").forEach((q)=>{q.readOnly=!0}),document.querySelectorAll("select").forEach((q)=>{q.disabled=!0}),document.querySelectorAll(".form-toolbar button, .add-row-btn, .remove-row-btn").forEach((q)=>{q.disabled=!0})}function _8($){return document.getElementById($)}function d9(){if(!_8("weba-l2-keywrap-tool"))return;let J=_8("kwp-recipient-sk"),q=_8("kwp-credential-id"),Z=_8("kwp-prf-salt"),X=_8("kwp-aad"),Q=_8("kwp-kid"),G=_8("kwp-status"),U=_8("kwp-output"),Y=_8("kwp-generate-salt"),z=_8("kwp-wrap");if(!J||!q||!Z||!G||!U||!z)return;Y?.addEventListener("click",()=>{let W=new Uint8Array(32);crypto.getRandomValues(W),Z.value=O8(W)}),z.addEventListener("click",async()=>{G.textContent="Waiting for passkey...",z.disabled=!0;try{if(!J.value||!q.value||!Z.value)throw new Error("Missing required fields.");let W=G8(J.value.trim()),K=G8(Z.value.trim()),M=await A0(q.value.trim(),K),O=X?.value?G8(X.value.trim()):void 0,H=await _9({recipientSk:W,prfKey:M,aad:O}),E={alg:"WebAuthn-PRF-AESGCM-v1",kid:Q?.value||"issuer#passkey-1",credential_id:q.value.trim(),prf_salt:O8(K),wrapped_key:O8(H),...O?{aad:O8(O)}:{}};U.textContent=JSON.stringify(E,null,2),G.textContent="Key wrap ready."}catch(W){console.error(W),G.textContent="Key wrap failed."}finally{z.disabled=!1}})}function c9($){if(typeof DOMParser!=="undefined")return new DOMParser().parseFromString($,"text/html");if(typeof document!=="undefined"){let J=document.implementation.createHTMLDocument("");return J.documentElement.innerHTML=$,J}return null}function l9($,J){let q=c9($);if(q)return q.getElementById(J)?.textContent??null;let Z=new RegExp(`<script[^>]*id=["']${J}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),X=$.match(Z);return X?X[1]:null}function oZ($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function rZ($,J){let q=c9($);if(q)return q.querySelector(`script[type="${J}"]`)?.textContent??null;let Z=new RegExp(`<script[^>]*type=["']${oZ(J)}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),X=$.match(Z);return X?X[1]:null}function n9($){let J=l9($,"data-layer");if(J)try{return JSON.parse(J)}catch{return null}let q=rZ($,"application/ld+json");if(q)try{return JSON.parse(q)}catch{return null}return null}function i9($){let J=l9($,"weba-l2-envelope");if(!J)return null;try{return JSON.parse(J)}catch{return null}}function sZ($){let J={},q=(Z,X)=>{if(Z===null||Z===void 0){J[X]=null;return}if(Array.isArray(Z)){Z.forEach((Q,G)=>{q(Q,X?`${X}[${G}]`:`[${G}]`)});return}if(typeof Z==="object"){Object.entries(Z).forEach(([Q,G])=>{let U=X?`${X}.${Q}`:Q;q(G,U)});return}J[X]=Z};if(q($,""),""in J)delete J[""];return J}function r9($){let J={_filename:$.filename},q=new Set(["_filename"]);if($.includeJson)q.add("_json"),J._json=JSON.stringify($.plain);let Z=sZ($.plain||{});for(let X of Object.keys(Z)){if($.omitKey&&$.omitKey(X))continue;q.add(X),J[X]=Z[X]}if($.sig)q.add("_l2_sig"),J._l2_sig=JSON.stringify($.sig);return{row:J,keys:q}}function o9($){if($===null||$===void 0)return"";let J=String($);if(/[",\n]/.test(J))return`"${J.replace(/"/g,'""')}"`;return J}function s9($,J){let q=[];return q.push(J.map(o9).join(",")),$.forEach((Z)=>{let X=J.map((Q)=>o9(Z[Q])).join(",");q.push(X)}),"\uFEFF"+q.join(`
`)}var o={_context:{masterData:{}},setMasterData($){this._context.masterData=$},escapeHtml($){if(!$)return"";return $.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},formatHint($){return this.escapeHtml($).replace(/&lt;br\s*\/?&gt;/gi,"<br>").replace(/\r?\n/g,"<br>")},getStyle($){if(!$)return"";let J="";if($.includes("size:L"))J+="font-size: 1.25em;";if($.includes("size:S"))J+="font-size: 0.8em;";if($.includes("size:XL"))J+="font-size: 1.5em; font-weight: bold;";if($.includes("align:R"))J+="text-align: right;";if($.includes("align:C"))J+="text-align: center;";if($.includes("bold"))J+="font-weight: bold;";return J},getExtraAttrs($){if(!$)return"";let J="",q=$.match(/(?:len|max):(\d+)/);if(q)J+=` maxlength="${q[1]}"`;let Z=$.match(/(?:val|value)="([^"]+)"/);if(Z)J+=` value="${this.escapeHtml(Z[1])}"`;else{let X=$.match(/(?:val|value)=([^\s\)]+)/);if(X)J+=` value="${this.escapeHtml(X[1])}"`}return J},text:function($,J,q){let Z=(q||"").match(/(?:val|value)="([^"]+)"/)||(q||"").match(/(?:val|value)='([^']+)'/)||(q||"").match(/(?:val|value)=([^ ]+)/),X=(q||"").match(/placeholder="([^"]+)"/)||(q||"").match(/placeholder='([^']+)'/),Q=(q||"").match(/hint="([^"]+)"/)||(q||"").match(/hint='([^']+)'/),G=Z?Z[1]:"",U=X?X[1]:"",Y=Q?`<div class="form-hint">${this.formatHint(Q[1])}</div>`:"";return`
        <div class="form-row" style="${this.getStyle(q)}">
            <label class="form-label">${this.escapeHtml(J)}</label>
            <input type="text" class="form-input" data-json-path="${$}" value="${this.escapeHtml(G)}" placeholder="${this.escapeHtml(U)}" style="${this.getStyle(q)}"${this.getExtraAttrs(q)}>
            ${Y}
        </div>`},number:function($,J,q){let Z=(q||"").match(/placeholder="([^"]+)"/)||(q||"").match(/placeholder='([^']+)'/),X=(q||"").match(/hint="([^"]+)"/)||(q||"").match(/hint='([^']+)'/),Q=Z?Z[1]:"",G=X?`<div class="form-row"><div class="form-hint">${this.formatHint(X[1])}</div></div>`:"";return`
        <div class="form-row">
            <label class="form-label">${this.escapeHtml(J)}</label>
            <input type="number" class="form-input" data-json-path="${$}" placeholder="${this.escapeHtml(Q)}" style="${this.getStyle(q)}"${this.getExtraAttrs(q)}>
            ${G}
        </div>`},date:function($,J,q){return`
        <div class="form-row">
            <label class="form-label">${this.escapeHtml(J)}</label>
            <input type="date" class="form-input" data-json-path="${$}" style="${this.getStyle(q)}"${this.getExtraAttrs(q)}>
        </div>`},textarea:function($,J,q){let Z=(q||"").match(/placeholder="([^"]+)"/)||(q||"").match(/placeholder='([^']+)'/),X=(q||"").match(/hint="([^"]+)"/)||(q||"").match(/hint='([^']+)'/),Q=Z?Z[1]:"",G=X?`<div class="form-hint">${this.formatHint(X[1])}</div>`:"",U=(q||"").match(/(?:val|value)="([^"]+)"/)||(q||"").match(/(?:val|value)='([^']+)'/)||(q||"").match(/(?:val|value)=([^ ]+)/),Y=U?U[1]:"";return`
        <div class="form-row vertical" style="${this.getStyle(q)}">
            <label class="form-label">${this.escapeHtml(J)}</label>
            <textarea class="form-input" rows="5" data-json-path="${$}" placeholder="${this.escapeHtml(Q)}" style="${this.getStyle(q)}"${this.getExtraAttrs(q)}>${this.escapeHtml(Y)}</textarea>
            ${G}
        </div>`},radioStart:function($,J,q){return`
        <div class="form-row vertical" style="${this.getStyle(q)}">
            <label class="form-label">${this.escapeHtml(J)}</label>
            <div class="radio-group" style="padding-left: 10px;">`},radioOption:function($,J,q,Z){return`
            <label style="display:block; margin-bottom:5px;">
                <input type="radio" name="${$}" value="${this.escapeHtml(J)}" ${Z?"checked":""}> ${this.escapeHtml(q)}
            </label>`},calc:function($,J,q){let Z=(q||"").match(/formula="([^"]+)"/)||(q||"").match(/formula='([^']+)'/),X=Z?Z[1]:"";return`
        <div class="form-row">
            <label class="form-label">${this.escapeHtml(J)}</label>
            <input type="text" readonly class="form-input" data-json-path="${$}" data-formula="${this.escapeHtml(X)}" style="background:#f9f9f9; ${this.getStyle(q)}"${this.getExtraAttrs(q)}>
        </div>`},search:function($,J,q){let Z=(q||"").match(/src:([^\s)]+)/),X=(q||"").match(/label:(\d+)/),Q=(q||"").match(/value:(\d+)/),G=(q||"").match(/placeholder="([^"]+)"/)||(q||"").match(/placeholder='([^']+)'/),U=(q||"").match(/hint="([^"]+)"/)||(q||"").match(/hint='([^']+)'/),Y=Z?Z[1]:"",z=G?G[1]:"",W=U?`<div class="form-hint">${this.formatHint(U[1])}</div>`:"",K=X?` data-master-label-index="${X[1]}"`:"",M=Q?` data-master-value-index="${Q[1]}"`:"";return`
        <div class="form-row autocomplete-container" style="position:relative; z-index:100;">
            <label class="form-label">${this.escapeHtml(J)}</label>
            <div style="flex:1; position:relative;">
                <input type="text" class="form-input search-input" autocomplete="off" 
                    data-json-path="${$}" 
                    data-master-src="${Y}"${K}${M}
                    placeholder="${this.escapeHtml(z)}" 
                    style="${this.getStyle(q)}"${this.getExtraAttrs(q)}>
                <div class="search-suggestions" style="display:none; position:absolute; top:100%; left:0; width:100%; background:white; border:1px solid #ccc; max-height:200px; overflow-y:auto; box-shadow:0 4px 6px rgba(0,0,0,0.1); border-radius:0 0 4px 4px; z-index:1001;"></div>
            </div>
            ${W}
        </div>`},renderInput($,J,q,Z=!1){let X=(q||"").match(/placeholder="([^"]+)"/)||(q||"").match(/placeholder='([^']+)'/),Q=X?`placeholder="${this.escapeHtml(X[1])}"`:"",G=Z?"form-input template-input":"form-input",U=Z?`data-base-key="${J}"`:`data-json-path="${J}"`;if($==="calc"){let O=(q||"").match(/formula="([^"]+)"/)||(q||"").match(/formula='([^']+)'/),H=O?O[1]:"";return`<input type="text" readonly class="${G}" ${U} data-formula="${this.escapeHtml(H)}" style="background:#f9f9f9; text-align:right; ${this.getStyle(q)}"${this.getExtraAttrs(q)}>`}if($==="datalist"){let O=(q||"").match(/src:([a-zA-Z0-9_\-\u0080-\uFFFF]+)/),H=(q||"").match(/label:(\d+)/),E="",B=O?O[1]:"";if(B&&this._context.masterData&&this._context.masterData[B]){let N=this._context.masterData[B],w=H?parseInt(H[1]||"1")-1:1;N.forEach((f)=>{if(f.length>w)E+=`<option value="${this.escapeHtml(f[w]||"")}"></option>`})}let L="list_"+J+"_"+Math.floor(Math.random()*1e4);return`<input type="text" list="${L}" class="${G}" ${U} ${Q} style="${this.getStyle(q)}"${this.getExtraAttrs(q)}><datalist id="${L}">${E}</datalist>`}if($==="search"){let O=(q||"").match(/src:([a-zA-Z0-9_\-\u0080-\uFFFF]+)/),H=(q||"").match(/label:(\d+)/),E=(q||"").match(/value:(\d+)/),B=O?O[1]:"",L=H?` data-master-label-index="${H[1]}"`:"",N=E?` data-master-value-index="${E[1]}"`:"",w=G+" search-input",f="";if((q||"").includes("suggest:column"))f=' data-suggest-source="column"';let v=(q||"").match(/copy:([^\s)]+)/),g=v?` data-copy-from="${v[1]}"`:"";return`<div style="display:inline-block; position:relative; width: 100%; min-width: 100px;">
                        <input type="text" class="${w}" ${U} autocomplete="off" data-master-src="${B}"${L}${N} ${Q} style="${v?"background-color: #ffffea;":""} ${this.getStyle(q)}"${this.getExtraAttrs(q)}${f}${g}>
                    </div>`}if($==="number"){let O=(q||"").match(/copy:([^\s)]+)/),H=O?` data-copy-from="${O[1]}"`:"";return`<input type="number" class="${G}" ${U} ${Q} style="text-align:right; ${O?"background-color: #ffffea;":""} ${this.getStyle(q)}"${this.getExtraAttrs(q)}${H}>`}if($==="date")return`<input type="date" class="${G}" ${U} style="${this.getStyle(q)}"${this.getExtraAttrs(q)}>`;if($==="checkbox")return`<input type="checkbox" class="${G}" ${U} style="${this.getStyle(q)}"${this.getExtraAttrs(q)}>`;if($==="autonum"||(q||"").includes("autonum"))return`<input type="number" readonly class="${G+" auto-num"}" ${U} data-autonum="true" style="background:transparent; border:none; text-align:center; width:100%; font-weight:bold; cursor:default; ${this.getStyle(q)}"${this.getExtraAttrs(q)}>`;let Y="",z="";if((q||"").includes("suggest:column"))z=" search-input",Y=' data-suggest-source="column"';let W=(q||"").match(/copy:([^\s)]+)/),K=W?` data-copy-from="${W[1]}"`:"";return`<input type="text" class="${G}${z}" ${U} ${Q} style="${W?"background-color: #ffffea;":""} ${this.getStyle(q)}"${this.getExtraAttrs(q)}${Y}${K}>`},tableRow($,J=!1){let q=$.map((Z)=>{let X=Z.trim(),Q=X.match(/^\[(?:([a-z]+):)?([^\]:\(\)]+)(?:\s*\((.*)\)|:([^\]]+))?\]$/);if(Q){let[G,U,Y,z,W]=Q,K=(Y||"").trim(),M=z||W||"";if(K.includes(" ")){let H=K.split(/\s+/);K=H[0],M=H.slice(1).join(" ")+" "+M}return`<td>${this.renderInput(U||"text",K,M,J)}</td>`}else return`<td>${this.escapeHtml(X)}</td>`}).join("");return`<tr ${J?'class="template-row"':""}>${q}</tr>`}};/*! js-yaml 4.1.1 https://github.com/nodeca/js-yaml @license MIT */function Dq($){return typeof $==="undefined"||$===null}function aZ($){return typeof $==="object"&&$!==null}function eZ($){if(Array.isArray($))return $;else if(Dq($))return[];return[$]}function tZ($,J){var q,Z,X,Q;if(J){Q=Object.keys(J);for(q=0,Z=Q.length;q<Z;q+=1)X=Q[q],$[X]=J[X]}return $}function $X($,J){var q="",Z;for(Z=0;Z<J;Z+=1)q+=$;return q}function JX($){return $===0&&Number.NEGATIVE_INFINITY===1/$}var qX=Dq,ZX=aZ,XX=eZ,QX=$X,GX=JX,UX=tZ,J8={isNothing:qX,isObject:ZX,toArray:XX,repeat:QX,isNegativeZero:GX,extend:UX};function Mq($,J){var q="",Z=$.reason||"(unknown reason)";if(!$.mark)return Z;if($.mark.name)q+='in "'+$.mark.name+'" ';if(q+="("+($.mark.line+1)+":"+($.mark.column+1)+")",!J&&$.mark.snippet)q+=`

`+$.mark.snippet;return Z+" "+q}function i0($,J){if(Error.call(this),this.name="YAMLException",this.reason=$,this.mark=J,this.message=Mq(this,!1),Error.captureStackTrace)Error.captureStackTrace(this,this.constructor);else this.stack=new Error().stack||""}i0.prototype=Object.create(Error.prototype);i0.prototype.constructor=i0;i0.prototype.toString=function $(J){return this.name+": "+Mq(this,J)};var N8=i0;function IJ($,J,q,Z,X){var Q="",G="",U=Math.floor(X/2)-1;if(Z-J>U)Q=" ... ",J=Z-U+Q.length;if(q-Z>U)G=" ...",q=Z+U-G.length;return{str:Q+$.slice(J,q).replace(/\t/g,"")+G,pos:Z-J+Q.length}}function EJ($,J){return J8.repeat(" ",J-$.length)+$}function YX($,J){if(J=Object.create(J||null),!$.buffer)return null;if(!J.maxLength)J.maxLength=79;if(typeof J.indent!=="number")J.indent=1;if(typeof J.linesBefore!=="number")J.linesBefore=3;if(typeof J.linesAfter!=="number")J.linesAfter=2;var q=/\r?\n|\r|\0/g,Z=[0],X=[],Q,G=-1;while(Q=q.exec($.buffer))if(X.push(Q.index),Z.push(Q.index+Q[0].length),$.position<=Q.index&&G<0)G=Z.length-2;if(G<0)G=Z.length-1;var U="",Y,z,W=Math.min($.line+J.linesAfter,X.length).toString().length,K=J.maxLength-(J.indent+W+3);for(Y=1;Y<=J.linesBefore;Y++){if(G-Y<0)break;z=IJ($.buffer,Z[G-Y],X[G-Y],$.position-(Z[G]-Z[G-Y]),K),U=J8.repeat(" ",J.indent)+EJ(($.line-Y+1).toString(),W)+" | "+z.str+`
`+U}z=IJ($.buffer,Z[G],X[G],$.position,K),U+=J8.repeat(" ",J.indent)+EJ(($.line+1).toString(),W)+" | "+z.str+`
`,U+=J8.repeat("-",J.indent+W+3+z.pos)+`^
`;for(Y=1;Y<=J.linesAfter;Y++){if(G+Y>=X.length)break;z=IJ($.buffer,Z[G+Y],X[G+Y],$.position-(Z[G]-Z[G+Y]),K),U+=J8.repeat(" ",J.indent)+EJ(($.line+Y+1).toString(),W)+" | "+z.str+`
`}return U.replace(/\n$/,"")}var WX=YX,zX=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],KX=["scalar","sequence","mapping"];function DX($){var J={};if($!==null)Object.keys($).forEach(function(q){$[q].forEach(function(Z){J[String(Z)]=q})});return J}function MX($,J){if(J=J||{},Object.keys(J).forEach(function(q){if(zX.indexOf(q)===-1)throw new N8('Unknown option "'+q+'" is met in definition of "'+$+'" YAML type.')}),this.options=J,this.tag=$,this.kind=J.kind||null,this.resolve=J.resolve||function(){return!0},this.construct=J.construct||function(q){return q},this.instanceOf=J.instanceOf||null,this.predicate=J.predicate||null,this.represent=J.represent||null,this.representName=J.representName||null,this.defaultStyle=J.defaultStyle||null,this.multi=J.multi||!1,this.styleAliases=DX(J.styleAliases||null),KX.indexOf(this.kind)===-1)throw new N8('Unknown kind "'+this.kind+'" is specified for "'+$+'" YAML type.')}var U8=MX;function a9($,J){var q=[];return $[J].forEach(function(Z){var X=q.length;q.forEach(function(Q,G){if(Q.tag===Z.tag&&Q.kind===Z.kind&&Q.multi===Z.multi)X=G}),q[X]=Z}),q}function VX(){var $={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},J,q;function Z(X){if(X.multi)$.multi[X.kind].push(X),$.multi.fallback.push(X);else $[X.kind][X.tag]=$.fallback[X.tag]=X}for(J=0,q=arguments.length;J<q;J+=1)arguments[J].forEach(Z);return $}function SJ($){return this.extend($)}SJ.prototype.extend=function $(J){var q=[],Z=[];if(J instanceof U8)Z.push(J);else if(Array.isArray(J))Z=Z.concat(J);else if(J&&(Array.isArray(J.implicit)||Array.isArray(J.explicit))){if(J.implicit)q=q.concat(J.implicit);if(J.explicit)Z=Z.concat(J.explicit)}else throw new N8("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");q.forEach(function(Q){if(!(Q instanceof U8))throw new N8("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(Q.loadKind&&Q.loadKind!=="scalar")throw new N8("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(Q.multi)throw new N8("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),Z.forEach(function(Q){if(!(Q instanceof U8))throw new N8("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var X=Object.create(SJ.prototype);return X.implicit=(this.implicit||[]).concat(q),X.explicit=(this.explicit||[]).concat(Z),X.compiledImplicit=a9(X,"implicit"),X.compiledExplicit=a9(X,"explicit"),X.compiledTypeMap=VX(X.compiledImplicit,X.compiledExplicit),X};var Vq=SJ,Oq=new U8("tag:yaml.org,2002:str",{kind:"scalar",construct:function($){return $!==null?$:""}}),Nq=new U8("tag:yaml.org,2002:seq",{kind:"sequence",construct:function($){return $!==null?$:[]}}),Bq=new U8("tag:yaml.org,2002:map",{kind:"mapping",construct:function($){return $!==null?$:{}}}),Hq=new Vq({explicit:[Oq,Nq,Bq]});function OX($){if($===null)return!0;var J=$.length;return J===1&&$==="~"||J===4&&($==="null"||$==="Null"||$==="NULL")}function NX(){return null}function BX($){return $===null}var Rq=new U8("tag:yaml.org,2002:null",{kind:"scalar",resolve:OX,construct:NX,predicate:BX,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function HX($){if($===null)return!1;var J=$.length;return J===4&&($==="true"||$==="True"||$==="TRUE")||J===5&&($==="false"||$==="False"||$==="FALSE")}function RX($){return $==="true"||$==="True"||$==="TRUE"}function CX($){return Object.prototype.toString.call($)==="[object Boolean]"}var Cq=new U8("tag:yaml.org,2002:bool",{kind:"scalar",resolve:HX,construct:RX,predicate:CX,represent:{lowercase:function($){return $?"true":"false"},uppercase:function($){return $?"TRUE":"FALSE"},camelcase:function($){return $?"True":"False"}},defaultStyle:"lowercase"});function wX($){return 48<=$&&$<=57||65<=$&&$<=70||97<=$&&$<=102}function TX($){return 48<=$&&$<=55}function FX($){return 48<=$&&$<=57}function jX($){if($===null)return!1;var J=$.length,q=0,Z=!1,X;if(!J)return!1;if(X=$[q],X==="-"||X==="+")X=$[++q];if(X==="0"){if(q+1===J)return!0;if(X=$[++q],X==="b"){q++;for(;q<J;q++){if(X=$[q],X==="_")continue;if(X!=="0"&&X!=="1")return!1;Z=!0}return Z&&X!=="_"}if(X==="x"){q++;for(;q<J;q++){if(X=$[q],X==="_")continue;if(!wX($.charCodeAt(q)))return!1;Z=!0}return Z&&X!=="_"}if(X==="o"){q++;for(;q<J;q++){if(X=$[q],X==="_")continue;if(!TX($.charCodeAt(q)))return!1;Z=!0}return Z&&X!=="_"}}if(X==="_")return!1;for(;q<J;q++){if(X=$[q],X==="_")continue;if(!FX($.charCodeAt(q)))return!1;Z=!0}if(!Z||X==="_")return!1;return!0}function AX($){var J=$,q=1,Z;if(J.indexOf("_")!==-1)J=J.replace(/_/g,"");if(Z=J[0],Z==="-"||Z==="+"){if(Z==="-")q=-1;J=J.slice(1),Z=J[0]}if(J==="0")return 0;if(Z==="0"){if(J[1]==="b")return q*parseInt(J.slice(2),2);if(J[1]==="x")return q*parseInt(J.slice(2),16);if(J[1]==="o")return q*parseInt(J.slice(2),8)}return q*parseInt(J,10)}function LX($){return Object.prototype.toString.call($)==="[object Number]"&&($%1===0&&!J8.isNegativeZero($))}var wq=new U8("tag:yaml.org,2002:int",{kind:"scalar",resolve:jX,construct:AX,predicate:LX,represent:{binary:function($){return $>=0?"0b"+$.toString(2):"-0b"+$.toString(2).slice(1)},octal:function($){return $>=0?"0o"+$.toString(8):"-0o"+$.toString(8).slice(1)},decimal:function($){return $.toString(10)},hexadecimal:function($){return $>=0?"0x"+$.toString(16).toUpperCase():"-0x"+$.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),PX=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function IX($){if($===null)return!1;if(!PX.test($)||$[$.length-1]==="_")return!1;return!0}function EX($){var J,q;if(J=$.replace(/_/g,"").toLowerCase(),q=J[0]==="-"?-1:1,"+-".indexOf(J[0])>=0)J=J.slice(1);if(J===".inf")return q===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;else if(J===".nan")return NaN;return q*parseFloat(J,10)}var fX=/^[-+]?[0-9]+e/;function SX($,J){var q;if(isNaN($))switch(J){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===$)switch(J){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===$)switch(J){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(J8.isNegativeZero($))return"-0.0";return q=$.toString(10),fX.test(q)?q.replace("e",".e"):q}function xX($){return Object.prototype.toString.call($)==="[object Number]"&&($%1!==0||J8.isNegativeZero($))}var Tq=new U8("tag:yaml.org,2002:float",{kind:"scalar",resolve:IX,construct:EX,predicate:xX,represent:SX,defaultStyle:"lowercase"}),Fq=Hq.extend({implicit:[Rq,Cq,wq,Tq]}),jq=Fq,Aq=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Lq=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function kX($){if($===null)return!1;if(Aq.exec($)!==null)return!0;if(Lq.exec($)!==null)return!0;return!1}function vX($){var J,q,Z,X,Q,G,U,Y=0,z=null,W,K,M;if(J=Aq.exec($),J===null)J=Lq.exec($);if(J===null)throw new Error("Date resolve error");if(q=+J[1],Z=+J[2]-1,X=+J[3],!J[4])return new Date(Date.UTC(q,Z,X));if(Q=+J[4],G=+J[5],U=+J[6],J[7]){Y=J[7].slice(0,3);while(Y.length<3)Y+="0";Y=+Y}if(J[9]){if(W=+J[10],K=+(J[11]||0),z=(W*60+K)*60000,J[9]==="-")z=-z}if(M=new Date(Date.UTC(q,Z,X,Q,G,U,Y)),z)M.setTime(M.getTime()-z);return M}function _X($){return $.toISOString()}var Pq=new U8("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:kX,construct:vX,instanceOf:Date,represent:_X});function gX($){return $==="<<"||$===null}var Iq=new U8("tag:yaml.org,2002:merge",{kind:"scalar",resolve:gX}),gJ=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function yX($){if($===null)return!1;var J,q,Z=0,X=$.length,Q=gJ;for(q=0;q<X;q++){if(J=Q.indexOf($.charAt(q)),J>64)continue;if(J<0)return!1;Z+=6}return Z%8===0}function mX($){var J,q,Z=$.replace(/[\r\n=]/g,""),X=Z.length,Q=gJ,G=0,U=[];for(J=0;J<X;J++){if(J%4===0&&J)U.push(G>>16&255),U.push(G>>8&255),U.push(G&255);G=G<<6|Q.indexOf(Z.charAt(J))}if(q=X%4*6,q===0)U.push(G>>16&255),U.push(G>>8&255),U.push(G&255);else if(q===18)U.push(G>>10&255),U.push(G>>2&255);else if(q===12)U.push(G>>4&255);return new Uint8Array(U)}function bX($){var J="",q=0,Z,X,Q=$.length,G=gJ;for(Z=0;Z<Q;Z++){if(Z%3===0&&Z)J+=G[q>>18&63],J+=G[q>>12&63],J+=G[q>>6&63],J+=G[q&63];q=(q<<8)+$[Z]}if(X=Q%3,X===0)J+=G[q>>18&63],J+=G[q>>12&63],J+=G[q>>6&63],J+=G[q&63];else if(X===2)J+=G[q>>10&63],J+=G[q>>4&63],J+=G[q<<2&63],J+=G[64];else if(X===1)J+=G[q>>2&63],J+=G[q<<4&63],J+=G[64],J+=G[64];return J}function hX($){return Object.prototype.toString.call($)==="[object Uint8Array]"}var Eq=new U8("tag:yaml.org,2002:binary",{kind:"scalar",resolve:yX,construct:mX,predicate:hX,represent:bX}),uX=Object.prototype.hasOwnProperty,pX=Object.prototype.toString;function dX($){if($===null)return!0;var J=[],q,Z,X,Q,G,U=$;for(q=0,Z=U.length;q<Z;q+=1){if(X=U[q],G=!1,pX.call(X)!=="[object Object]")return!1;for(Q in X)if(uX.call(X,Q))if(!G)G=!0;else return!1;if(!G)return!1;if(J.indexOf(Q)===-1)J.push(Q);else return!1}return!0}function cX($){return $!==null?$:[]}var fq=new U8("tag:yaml.org,2002:omap",{kind:"sequence",resolve:dX,construct:cX}),lX=Object.prototype.toString;function nX($){if($===null)return!0;var J,q,Z,X,Q,G=$;Q=new Array(G.length);for(J=0,q=G.length;J<q;J+=1){if(Z=G[J],lX.call(Z)!=="[object Object]")return!1;if(X=Object.keys(Z),X.length!==1)return!1;Q[J]=[X[0],Z[X[0]]]}return!0}function iX($){if($===null)return[];var J,q,Z,X,Q,G=$;Q=new Array(G.length);for(J=0,q=G.length;J<q;J+=1)Z=G[J],X=Object.keys(Z),Q[J]=[X[0],Z[X[0]]];return Q}var Sq=new U8("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:nX,construct:iX}),oX=Object.prototype.hasOwnProperty;function rX($){if($===null)return!0;var J,q=$;for(J in q)if(oX.call(q,J)){if(q[J]!==null)return!1}return!0}function sX($){return $!==null?$:{}}var xq=new U8("tag:yaml.org,2002:set",{kind:"mapping",resolve:rX,construct:sX}),yJ=jq.extend({implicit:[Pq,Iq],explicit:[Eq,fq,Sq,xq]}),X0=Object.prototype.hasOwnProperty,k$=1,kq=2,vq=3,v$=4,fJ=1,aX=2,e9=3,eX=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,tX=/[\x85\u2028\u2029]/,$Q=/[,\[\]\{\}]/,_q=/^(?:!|!!|![a-z\-]+!)$/i,gq=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function t9($){return Object.prototype.toString.call($)}function g8($){return $===10||$===13}function M0($){return $===9||$===32}function w8($){return $===9||$===32||$===10||$===13}function P0($){return $===44||$===91||$===93||$===123||$===125}function JQ($){var J;if(48<=$&&$<=57)return $-48;if(J=$|32,97<=J&&J<=102)return J-97+10;return-1}function qQ($){if($===120)return 2;if($===117)return 4;if($===85)return 8;return 0}function ZQ($){if(48<=$&&$<=57)return $-48;return-1}function $q($){return $===48?"\x00":$===97?"\x07":$===98?"\b":$===116?"\t":$===9?"\t":$===110?`
`:$===118?"\v":$===102?"\f":$===114?"\r":$===101?"\x1B":$===32?" ":$===34?'"':$===47?"/":$===92?"\\":$===78?"":$===95?"":$===76?"\u2028":$===80?"\u2029":""}function XQ($){if($<=65535)return String.fromCharCode($);return String.fromCharCode(($-65536>>10)+55296,($-65536&1023)+56320)}function yq($,J,q){if(J==="__proto__")Object.defineProperty($,J,{configurable:!0,enumerable:!0,writable:!0,value:q});else $[J]=q}var mq=new Array(256),bq=new Array(256);for(q0=0;q0<256;q0++)mq[q0]=$q(q0)?1:0,bq[q0]=$q(q0);var q0;function QQ($,J){this.input=$,this.filename=J.filename||null,this.schema=J.schema||yJ,this.onWarning=J.onWarning||null,this.legacy=J.legacy||!1,this.json=J.json||!1,this.listener=J.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=$.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function hq($,J){var q={name:$.filename,buffer:$.input.slice(0,-1),position:$.position,line:$.line,column:$.position-$.lineStart};return q.snippet=WX(q),new N8(J,q)}function u($,J){throw hq($,J)}function _$($,J){if($.onWarning)$.onWarning.call(null,hq($,J))}var Jq={YAML:function $(J,q,Z){var X,Q,G;if(J.version!==null)u(J,"duplication of %YAML directive");if(Z.length!==1)u(J,"YAML directive accepts exactly one argument");if(X=/^([0-9]+)\.([0-9]+)$/.exec(Z[0]),X===null)u(J,"ill-formed argument of the YAML directive");if(Q=parseInt(X[1],10),G=parseInt(X[2],10),Q!==1)u(J,"unacceptable YAML version of the document");if(J.version=Z[0],J.checkLineBreaks=G<2,G!==1&&G!==2)_$(J,"unsupported YAML version of the document")},TAG:function $(J,q,Z){var X,Q;if(Z.length!==2)u(J,"TAG directive accepts exactly two arguments");if(X=Z[0],Q=Z[1],!_q.test(X))u(J,"ill-formed tag handle (first argument) of the TAG directive");if(X0.call(J.tagMap,X))u(J,'there is a previously declared suffix for "'+X+'" tag handle');if(!gq.test(Q))u(J,"ill-formed tag prefix (second argument) of the TAG directive");try{Q=decodeURIComponent(Q)}catch(G){u(J,"tag prefix is malformed: "+Q)}J.tagMap[X]=Q}};function Z0($,J,q,Z){var X,Q,G,U;if(J<q){if(U=$.input.slice(J,q),Z){for(X=0,Q=U.length;X<Q;X+=1)if(G=U.charCodeAt(X),!(G===9||32<=G&&G<=1114111))u($,"expected valid JSON character")}else if(eX.test(U))u($,"the stream contains non-printable characters");$.result+=U}}function qq($,J,q,Z){var X,Q,G,U;if(!J8.isObject(q))u($,"cannot merge mappings; the provided source object is unacceptable");X=Object.keys(q);for(G=0,U=X.length;G<U;G+=1)if(Q=X[G],!X0.call(J,Q))yq(J,Q,q[Q]),Z[Q]=!0}function I0($,J,q,Z,X,Q,G,U,Y){var z,W;if(Array.isArray(X)){X=Array.prototype.slice.call(X);for(z=0,W=X.length;z<W;z+=1){if(Array.isArray(X[z]))u($,"nested arrays are not supported inside keys");if(typeof X==="object"&&t9(X[z])==="[object Object]")X[z]="[object Object]"}}if(typeof X==="object"&&t9(X)==="[object Object]")X="[object Object]";if(X=String(X),J===null)J={};if(Z==="tag:yaml.org,2002:merge")if(Array.isArray(Q))for(z=0,W=Q.length;z<W;z+=1)qq($,J,Q[z],q);else qq($,J,Q,q);else{if(!$.json&&!X0.call(q,X)&&X0.call(J,X))$.line=G||$.line,$.lineStart=U||$.lineStart,$.position=Y||$.position,u($,"duplicated mapping key");yq(J,X,Q),delete q[X]}return J}function mJ($){var J=$.input.charCodeAt($.position);if(J===10)$.position++;else if(J===13){if($.position++,$.input.charCodeAt($.position)===10)$.position++}else u($,"a line break is expected");$.line+=1,$.lineStart=$.position,$.firstTabInLine=-1}function e($,J,q){var Z=0,X=$.input.charCodeAt($.position);while(X!==0){while(M0(X)){if(X===9&&$.firstTabInLine===-1)$.firstTabInLine=$.position;X=$.input.charCodeAt(++$.position)}if(J&&X===35)do X=$.input.charCodeAt(++$.position);while(X!==10&&X!==13&&X!==0);if(g8(X)){mJ($),X=$.input.charCodeAt($.position),Z++,$.lineIndent=0;while(X===32)$.lineIndent++,X=$.input.charCodeAt(++$.position)}else break}if(q!==-1&&Z!==0&&$.lineIndent<q)_$($,"deficient indentation");return Z}function m$($){var J=$.position,q;if(q=$.input.charCodeAt(J),(q===45||q===46)&&q===$.input.charCodeAt(J+1)&&q===$.input.charCodeAt(J+2)){if(J+=3,q=$.input.charCodeAt(J),q===0||w8(q))return!0}return!1}function bJ($,J){if(J===1)$.result+=" ";else if(J>1)$.result+=J8.repeat(`
`,J-1)}function GQ($,J,q){var Z,X,Q,G,U,Y,z,W,K=$.kind,M=$.result,O;if(O=$.input.charCodeAt($.position),w8(O)||P0(O)||O===35||O===38||O===42||O===33||O===124||O===62||O===39||O===34||O===37||O===64||O===96)return!1;if(O===63||O===45){if(X=$.input.charCodeAt($.position+1),w8(X)||q&&P0(X))return!1}$.kind="scalar",$.result="",Q=G=$.position,U=!1;while(O!==0){if(O===58){if(X=$.input.charCodeAt($.position+1),w8(X)||q&&P0(X))break}else if(O===35){if(Z=$.input.charCodeAt($.position-1),w8(Z))break}else if($.position===$.lineStart&&m$($)||q&&P0(O))break;else if(g8(O))if(Y=$.line,z=$.lineStart,W=$.lineIndent,e($,!1,-1),$.lineIndent>=J){U=!0,O=$.input.charCodeAt($.position);continue}else{$.position=G,$.line=Y,$.lineStart=z,$.lineIndent=W;break}if(U)Z0($,Q,G,!1),bJ($,$.line-Y),Q=G=$.position,U=!1;if(!M0(O))G=$.position+1;O=$.input.charCodeAt(++$.position)}if(Z0($,Q,G,!1),$.result)return!0;return $.kind=K,$.result=M,!1}function UQ($,J){var q,Z,X;if(q=$.input.charCodeAt($.position),q!==39)return!1;$.kind="scalar",$.result="",$.position++,Z=X=$.position;while((q=$.input.charCodeAt($.position))!==0)if(q===39)if(Z0($,Z,$.position,!0),q=$.input.charCodeAt(++$.position),q===39)Z=$.position,$.position++,X=$.position;else return!0;else if(g8(q))Z0($,Z,X,!0),bJ($,e($,!1,J)),Z=X=$.position;else if($.position===$.lineStart&&m$($))u($,"unexpected end of the document within a single quoted scalar");else $.position++,X=$.position;u($,"unexpected end of the stream within a single quoted scalar")}function YQ($,J){var q,Z,X,Q,G,U;if(U=$.input.charCodeAt($.position),U!==34)return!1;$.kind="scalar",$.result="",$.position++,q=Z=$.position;while((U=$.input.charCodeAt($.position))!==0)if(U===34)return Z0($,q,$.position,!0),$.position++,!0;else if(U===92){if(Z0($,q,$.position,!0),U=$.input.charCodeAt(++$.position),g8(U))e($,!1,J);else if(U<256&&mq[U])$.result+=bq[U],$.position++;else if((G=qQ(U))>0){X=G,Q=0;for(;X>0;X--)if(U=$.input.charCodeAt(++$.position),(G=JQ(U))>=0)Q=(Q<<4)+G;else u($,"expected hexadecimal character");$.result+=XQ(Q),$.position++}else u($,"unknown escape sequence");q=Z=$.position}else if(g8(U))Z0($,q,Z,!0),bJ($,e($,!1,J)),q=Z=$.position;else if($.position===$.lineStart&&m$($))u($,"unexpected end of the document within a double quoted scalar");else $.position++,Z=$.position;u($,"unexpected end of the stream within a double quoted scalar")}function WQ($,J){var q=!0,Z,X,Q,G=$.tag,U,Y=$.anchor,z,W,K,M,O,H=Object.create(null),E,B,L,N;if(N=$.input.charCodeAt($.position),N===91)W=93,O=!1,U=[];else if(N===123)W=125,O=!0,U={};else return!1;if($.anchor!==null)$.anchorMap[$.anchor]=U;N=$.input.charCodeAt(++$.position);while(N!==0){if(e($,!0,J),N=$.input.charCodeAt($.position),N===W)return $.position++,$.tag=G,$.anchor=Y,$.kind=O?"mapping":"sequence",$.result=U,!0;else if(!q)u($,"missed comma between flow collection entries");else if(N===44)u($,"expected the node content, but found ','");if(B=E=L=null,K=M=!1,N===63){if(z=$.input.charCodeAt($.position+1),w8(z))K=M=!0,$.position++,e($,!0,J)}if(Z=$.line,X=$.lineStart,Q=$.position,E0($,J,k$,!1,!0),B=$.tag,E=$.result,e($,!0,J),N=$.input.charCodeAt($.position),(M||$.line===Z)&&N===58)K=!0,N=$.input.charCodeAt(++$.position),e($,!0,J),E0($,J,k$,!1,!0),L=$.result;if(O)I0($,U,H,B,E,L,Z,X,Q);else if(K)U.push(I0($,null,H,B,E,L,Z,X,Q));else U.push(E);if(e($,!0,J),N=$.input.charCodeAt($.position),N===44)q=!0,N=$.input.charCodeAt(++$.position);else q=!1}u($,"unexpected end of the stream within a flow collection")}function zQ($,J){var q,Z,X=fJ,Q=!1,G=!1,U=J,Y=0,z=!1,W,K;if(K=$.input.charCodeAt($.position),K===124)Z=!1;else if(K===62)Z=!0;else return!1;$.kind="scalar",$.result="";while(K!==0)if(K=$.input.charCodeAt(++$.position),K===43||K===45)if(fJ===X)X=K===43?e9:aX;else u($,"repeat of a chomping mode identifier");else if((W=ZQ(K))>=0)if(W===0)u($,"bad explicit indentation width of a block scalar; it cannot be less than one");else if(!G)U=J+W-1,G=!0;else u($,"repeat of an indentation width identifier");else break;if(M0(K)){do K=$.input.charCodeAt(++$.position);while(M0(K));if(K===35)do K=$.input.charCodeAt(++$.position);while(!g8(K)&&K!==0)}while(K!==0){mJ($),$.lineIndent=0,K=$.input.charCodeAt($.position);while((!G||$.lineIndent<U)&&K===32)$.lineIndent++,K=$.input.charCodeAt(++$.position);if(!G&&$.lineIndent>U)U=$.lineIndent;if(g8(K)){Y++;continue}if($.lineIndent<U){if(X===e9)$.result+=J8.repeat(`
`,Q?1+Y:Y);else if(X===fJ){if(Q)$.result+=`
`}break}if(Z)if(M0(K))z=!0,$.result+=J8.repeat(`
`,Q?1+Y:Y);else if(z)z=!1,$.result+=J8.repeat(`
`,Y+1);else if(Y===0){if(Q)$.result+=" "}else $.result+=J8.repeat(`
`,Y);else $.result+=J8.repeat(`
`,Q?1+Y:Y);Q=!0,G=!0,Y=0,q=$.position;while(!g8(K)&&K!==0)K=$.input.charCodeAt(++$.position);Z0($,q,$.position,!1)}return!0}function Zq($,J){var q,Z=$.tag,X=$.anchor,Q=[],G,U=!1,Y;if($.firstTabInLine!==-1)return!1;if($.anchor!==null)$.anchorMap[$.anchor]=Q;Y=$.input.charCodeAt($.position);while(Y!==0){if($.firstTabInLine!==-1)$.position=$.firstTabInLine,u($,"tab characters must not be used in indentation");if(Y!==45)break;if(G=$.input.charCodeAt($.position+1),!w8(G))break;if(U=!0,$.position++,e($,!0,-1)){if($.lineIndent<=J){Q.push(null),Y=$.input.charCodeAt($.position);continue}}if(q=$.line,E0($,J,vq,!1,!0),Q.push($.result),e($,!0,-1),Y=$.input.charCodeAt($.position),($.line===q||$.lineIndent>J)&&Y!==0)u($,"bad indentation of a sequence entry");else if($.lineIndent<J)break}if(U)return $.tag=Z,$.anchor=X,$.kind="sequence",$.result=Q,!0;return!1}function KQ($,J,q){var Z,X,Q,G,U,Y,z=$.tag,W=$.anchor,K={},M=Object.create(null),O=null,H=null,E=null,B=!1,L=!1,N;if($.firstTabInLine!==-1)return!1;if($.anchor!==null)$.anchorMap[$.anchor]=K;N=$.input.charCodeAt($.position);while(N!==0){if(!B&&$.firstTabInLine!==-1)$.position=$.firstTabInLine,u($,"tab characters must not be used in indentation");if(Z=$.input.charCodeAt($.position+1),Q=$.line,(N===63||N===58)&&w8(Z)){if(N===63){if(B)I0($,K,M,O,H,null,G,U,Y),O=H=E=null;L=!0,B=!0,X=!0}else if(B)B=!1,X=!0;else u($,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line");$.position+=1,N=Z}else{if(G=$.line,U=$.lineStart,Y=$.position,!E0($,q,kq,!1,!0))break;if($.line===Q){N=$.input.charCodeAt($.position);while(M0(N))N=$.input.charCodeAt(++$.position);if(N===58){if(N=$.input.charCodeAt(++$.position),!w8(N))u($,"a whitespace character is expected after the key-value separator within a block mapping");if(B)I0($,K,M,O,H,null,G,U,Y),O=H=E=null;L=!0,B=!1,X=!1,O=$.tag,H=$.result}else if(L)u($,"can not read an implicit mapping pair; a colon is missed");else return $.tag=z,$.anchor=W,!0}else if(L)u($,"can not read a block mapping entry; a multiline key may not be an implicit key");else return $.tag=z,$.anchor=W,!0}if($.line===Q||$.lineIndent>J){if(B)G=$.line,U=$.lineStart,Y=$.position;if(E0($,J,v$,!0,X))if(B)H=$.result;else E=$.result;if(!B)I0($,K,M,O,H,E,G,U,Y),O=H=E=null;e($,!0,-1),N=$.input.charCodeAt($.position)}if(($.line===Q||$.lineIndent>J)&&N!==0)u($,"bad indentation of a mapping entry");else if($.lineIndent<J)break}if(B)I0($,K,M,O,H,null,G,U,Y);if(L)$.tag=z,$.anchor=W,$.kind="mapping",$.result=K;return L}function DQ($){var J,q=!1,Z=!1,X,Q,G;if(G=$.input.charCodeAt($.position),G!==33)return!1;if($.tag!==null)u($,"duplication of a tag property");if(G=$.input.charCodeAt(++$.position),G===60)q=!0,G=$.input.charCodeAt(++$.position);else if(G===33)Z=!0,X="!!",G=$.input.charCodeAt(++$.position);else X="!";if(J=$.position,q){do G=$.input.charCodeAt(++$.position);while(G!==0&&G!==62);if($.position<$.length)Q=$.input.slice(J,$.position),G=$.input.charCodeAt(++$.position);else u($,"unexpected end of the stream within a verbatim tag")}else{while(G!==0&&!w8(G)){if(G===33)if(!Z){if(X=$.input.slice(J-1,$.position+1),!_q.test(X))u($,"named tag handle cannot contain such characters");Z=!0,J=$.position+1}else u($,"tag suffix cannot contain exclamation marks");G=$.input.charCodeAt(++$.position)}if(Q=$.input.slice(J,$.position),$Q.test(Q))u($,"tag suffix cannot contain flow indicator characters")}if(Q&&!gq.test(Q))u($,"tag name cannot contain such characters: "+Q);try{Q=decodeURIComponent(Q)}catch(U){u($,"tag name is malformed: "+Q)}if(q)$.tag=Q;else if(X0.call($.tagMap,X))$.tag=$.tagMap[X]+Q;else if(X==="!")$.tag="!"+Q;else if(X==="!!")$.tag="tag:yaml.org,2002:"+Q;else u($,'undeclared tag handle "'+X+'"');return!0}function MQ($){var J,q;if(q=$.input.charCodeAt($.position),q!==38)return!1;if($.anchor!==null)u($,"duplication of an anchor property");q=$.input.charCodeAt(++$.position),J=$.position;while(q!==0&&!w8(q)&&!P0(q))q=$.input.charCodeAt(++$.position);if($.position===J)u($,"name of an anchor node must contain at least one character");return $.anchor=$.input.slice(J,$.position),!0}function VQ($){var J,q,Z;if(Z=$.input.charCodeAt($.position),Z!==42)return!1;Z=$.input.charCodeAt(++$.position),J=$.position;while(Z!==0&&!w8(Z)&&!P0(Z))Z=$.input.charCodeAt(++$.position);if($.position===J)u($,"name of an alias node must contain at least one character");if(q=$.input.slice(J,$.position),!X0.call($.anchorMap,q))u($,'unidentified alias "'+q+'"');return $.result=$.anchorMap[q],e($,!0,-1),!0}function E0($,J,q,Z,X){var Q,G,U,Y=1,z=!1,W=!1,K,M,O,H,E,B;if($.listener!==null)$.listener("open",$);if($.tag=null,$.anchor=null,$.kind=null,$.result=null,Q=G=U=v$===q||vq===q,Z){if(e($,!0,-1)){if(z=!0,$.lineIndent>J)Y=1;else if($.lineIndent===J)Y=0;else if($.lineIndent<J)Y=-1}}if(Y===1)while(DQ($)||MQ($))if(e($,!0,-1)){if(z=!0,U=Q,$.lineIndent>J)Y=1;else if($.lineIndent===J)Y=0;else if($.lineIndent<J)Y=-1}else U=!1;if(U)U=z||X;if(Y===1||v$===q){if(k$===q||kq===q)E=J;else E=J+1;if(B=$.position-$.lineStart,Y===1)if(U&&(Zq($,B)||KQ($,B,E))||WQ($,E))W=!0;else{if(G&&zQ($,E)||UQ($,E)||YQ($,E))W=!0;else if(VQ($)){if(W=!0,$.tag!==null||$.anchor!==null)u($,"alias node should not have any properties")}else if(GQ($,E,k$===q)){if(W=!0,$.tag===null)$.tag="?"}if($.anchor!==null)$.anchorMap[$.anchor]=$.result}else if(Y===0)W=U&&Zq($,B)}if($.tag===null){if($.anchor!==null)$.anchorMap[$.anchor]=$.result}else if($.tag==="?"){if($.result!==null&&$.kind!=="scalar")u($,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+$.kind+'"');for(K=0,M=$.implicitTypes.length;K<M;K+=1)if(H=$.implicitTypes[K],H.resolve($.result)){if($.result=H.construct($.result),$.tag=H.tag,$.anchor!==null)$.anchorMap[$.anchor]=$.result;break}}else if($.tag!=="!"){if(X0.call($.typeMap[$.kind||"fallback"],$.tag))H=$.typeMap[$.kind||"fallback"][$.tag];else{H=null,O=$.typeMap.multi[$.kind||"fallback"];for(K=0,M=O.length;K<M;K+=1)if($.tag.slice(0,O[K].tag.length)===O[K].tag){H=O[K];break}}if(!H)u($,"unknown tag !<"+$.tag+">");if($.result!==null&&H.kind!==$.kind)u($,"unacceptable node kind for !<"+$.tag+'> tag; it should be "'+H.kind+'", not "'+$.kind+'"');if(!H.resolve($.result,$.tag))u($,"cannot resolve a node with !<"+$.tag+"> explicit tag");else if($.result=H.construct($.result,$.tag),$.anchor!==null)$.anchorMap[$.anchor]=$.result}if($.listener!==null)$.listener("close",$);return $.tag!==null||$.anchor!==null||W}function OQ($){var J=$.position,q,Z,X,Q=!1,G;$.version=null,$.checkLineBreaks=$.legacy,$.tagMap=Object.create(null),$.anchorMap=Object.create(null);while((G=$.input.charCodeAt($.position))!==0){if(e($,!0,-1),G=$.input.charCodeAt($.position),$.lineIndent>0||G!==37)break;Q=!0,G=$.input.charCodeAt(++$.position),q=$.position;while(G!==0&&!w8(G))G=$.input.charCodeAt(++$.position);if(Z=$.input.slice(q,$.position),X=[],Z.length<1)u($,"directive name must not be less than one character in length");while(G!==0){while(M0(G))G=$.input.charCodeAt(++$.position);if(G===35){do G=$.input.charCodeAt(++$.position);while(G!==0&&!g8(G));break}if(g8(G))break;q=$.position;while(G!==0&&!w8(G))G=$.input.charCodeAt(++$.position);X.push($.input.slice(q,$.position))}if(G!==0)mJ($);if(X0.call(Jq,Z))Jq[Z]($,Z,X);else _$($,'unknown document directive "'+Z+'"')}if(e($,!0,-1),$.lineIndent===0&&$.input.charCodeAt($.position)===45&&$.input.charCodeAt($.position+1)===45&&$.input.charCodeAt($.position+2)===45)$.position+=3,e($,!0,-1);else if(Q)u($,"directives end mark is expected");if(E0($,$.lineIndent-1,v$,!1,!0),e($,!0,-1),$.checkLineBreaks&&tX.test($.input.slice(J,$.position)))_$($,"non-ASCII line breaks are interpreted as content");if($.documents.push($.result),$.position===$.lineStart&&m$($)){if($.input.charCodeAt($.position)===46)$.position+=3,e($,!0,-1);return}if($.position<$.length-1)u($,"end of the stream or a document separator is expected");else return}function uq($,J){if($=String($),J=J||{},$.length!==0){if($.charCodeAt($.length-1)!==10&&$.charCodeAt($.length-1)!==13)$+=`
`;if($.charCodeAt(0)===65279)$=$.slice(1)}var q=new QQ($,J),Z=$.indexOf("\x00");if(Z!==-1)q.position=Z,u(q,"null byte is not allowed in input");q.input+="\x00";while(q.input.charCodeAt(q.position)===32)q.lineIndent+=1,q.position+=1;while(q.position<q.length-1)OQ(q);return q.documents}function NQ($,J,q){if(J!==null&&typeof J==="object"&&typeof q==="undefined")q=J,J=null;var Z=uq($,q);if(typeof J!=="function")return Z;for(var X=0,Q=Z.length;X<Q;X+=1)J(Z[X])}function BQ($,J){var q=uq($,J);if(q.length===0)return;else if(q.length===1)return q[0];throw new N8("expected a single document in the stream, but found more")}var HQ=NQ,RQ=BQ,pq={loadAll:HQ,load:RQ},dq=Object.prototype.toString,cq=Object.prototype.hasOwnProperty,hJ=65279,CQ=9,o0=10,wQ=13,TQ=32,FQ=33,jQ=34,xJ=35,AQ=37,LQ=38,PQ=39,IQ=42,lq=44,EQ=45,g$=58,fQ=61,SQ=62,xQ=63,kQ=64,nq=91,iq=93,vQ=96,oq=123,_Q=124,rq=125,K8={};K8[0]="\\0";K8[7]="\\a";K8[8]="\\b";K8[9]="\\t";K8[10]="\\n";K8[11]="\\v";K8[12]="\\f";K8[13]="\\r";K8[27]="\\e";K8[34]="\\\"";K8[92]="\\\\";K8[133]="\\N";K8[160]="\\_";K8[8232]="\\L";K8[8233]="\\P";var gQ=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],yQ=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function mQ($,J){var q,Z,X,Q,G,U,Y;if(J===null)return{};q={},Z=Object.keys(J);for(X=0,Q=Z.length;X<Q;X+=1){if(G=Z[X],U=String(J[G]),G.slice(0,2)==="!!")G="tag:yaml.org,2002:"+G.slice(2);if(Y=$.compiledTypeMap.fallback[G],Y&&cq.call(Y.styleAliases,U))U=Y.styleAliases[U];q[G]=U}return q}function bQ($){var J,q,Z;if(J=$.toString(16).toUpperCase(),$<=255)q="x",Z=2;else if($<=65535)q="u",Z=4;else if($<=4294967295)q="U",Z=8;else throw new N8("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+q+J8.repeat("0",Z-J.length)+J}var hQ=1,r0=2;function uQ($){this.schema=$.schema||yJ,this.indent=Math.max(1,$.indent||2),this.noArrayIndent=$.noArrayIndent||!1,this.skipInvalid=$.skipInvalid||!1,this.flowLevel=J8.isNothing($.flowLevel)?-1:$.flowLevel,this.styleMap=mQ(this.schema,$.styles||null),this.sortKeys=$.sortKeys||!1,this.lineWidth=$.lineWidth||80,this.noRefs=$.noRefs||!1,this.noCompatMode=$.noCompatMode||!1,this.condenseFlow=$.condenseFlow||!1,this.quotingType=$.quotingType==='"'?r0:hQ,this.forceQuotes=$.forceQuotes||!1,this.replacer=typeof $.replacer==="function"?$.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function Xq($,J){var q=J8.repeat(" ",J),Z=0,X=-1,Q="",G,U=$.length;while(Z<U){if(X=$.indexOf(`
`,Z),X===-1)G=$.slice(Z),Z=U;else G=$.slice(Z,X+1),Z=X+1;if(G.length&&G!==`
`)Q+=q;Q+=G}return Q}function kJ($,J){return`
`+J8.repeat(" ",$.indent*J)}function pQ($,J){var q,Z,X;for(q=0,Z=$.implicitTypes.length;q<Z;q+=1)if(X=$.implicitTypes[q],X.resolve(J))return!0;return!1}function y$($){return $===TQ||$===CQ}function s0($){return 32<=$&&$<=126||161<=$&&$<=55295&&$!==8232&&$!==8233||57344<=$&&$<=65533&&$!==hJ||65536<=$&&$<=1114111}function Qq($){return s0($)&&$!==hJ&&$!==wQ&&$!==o0}function Gq($,J,q){var Z=Qq($),X=Z&&!y$($);return(q?Z:Z&&$!==lq&&$!==nq&&$!==iq&&$!==oq&&$!==rq)&&$!==xJ&&!(J===g$&&!X)||Qq(J)&&!y$(J)&&$===xJ||J===g$&&X}function dQ($){return s0($)&&$!==hJ&&!y$($)&&$!==EQ&&$!==xQ&&$!==g$&&$!==lq&&$!==nq&&$!==iq&&$!==oq&&$!==rq&&$!==xJ&&$!==LQ&&$!==IQ&&$!==FQ&&$!==_Q&&$!==fQ&&$!==SQ&&$!==PQ&&$!==jQ&&$!==AQ&&$!==kQ&&$!==vQ}function cQ($){return!y$($)&&$!==g$}function n0($,J){var q=$.charCodeAt(J),Z;if(q>=55296&&q<=56319&&J+1<$.length){if(Z=$.charCodeAt(J+1),Z>=56320&&Z<=57343)return(q-55296)*1024+Z-56320+65536}return q}function sq($){var J=/^\n* /;return J.test($)}var aq=1,vJ=2,eq=3,tq=4,L0=5;function lQ($,J,q,Z,X,Q,G,U){var Y,z=0,W=null,K=!1,M=!1,O=Z!==-1,H=-1,E=dQ(n0($,0))&&cQ(n0($,$.length-1));if(J||G)for(Y=0;Y<$.length;z>=65536?Y+=2:Y++){if(z=n0($,Y),!s0(z))return L0;E=E&&Gq(z,W,U),W=z}else{for(Y=0;Y<$.length;z>=65536?Y+=2:Y++){if(z=n0($,Y),z===o0){if(K=!0,O)M=M||Y-H-1>Z&&$[H+1]!==" ",H=Y}else if(!s0(z))return L0;E=E&&Gq(z,W,U),W=z}M=M||O&&(Y-H-1>Z&&$[H+1]!==" ")}if(!K&&!M){if(E&&!G&&!X($))return aq;return Q===r0?L0:vJ}if(q>9&&sq($))return L0;if(!G)return M?tq:eq;return Q===r0?L0:vJ}function nQ($,J,q,Z,X){$.dump=function(){if(J.length===0)return $.quotingType===r0?'""':"''";if(!$.noCompatMode){if(gQ.indexOf(J)!==-1||yQ.test(J))return $.quotingType===r0?'"'+J+'"':"'"+J+"'"}var Q=$.indent*Math.max(1,q),G=$.lineWidth===-1?-1:Math.max(Math.min($.lineWidth,40),$.lineWidth-Q),U=Z||$.flowLevel>-1&&q>=$.flowLevel;function Y(z){return pQ($,z)}switch(lQ(J,U,$.indent,G,Y,$.quotingType,$.forceQuotes&&!Z,X)){case aq:return J;case vJ:return"'"+J.replace(/'/g,"''")+"'";case eq:return"|"+Uq(J,$.indent)+Yq(Xq(J,Q));case tq:return">"+Uq(J,$.indent)+Yq(Xq(iQ(J,G),Q));case L0:return'"'+oQ(J)+'"';default:throw new N8("impossible error: invalid scalar style")}}()}function Uq($,J){var q=sq($)?String(J):"",Z=$[$.length-1]===`
`,X=Z&&($[$.length-2]===`
`||$===`
`),Q=X?"+":Z?"":"-";return q+Q+`
`}function Yq($){return $[$.length-1]===`
`?$.slice(0,-1):$}function iQ($,J){var q=/(\n+)([^\n]*)/g,Z=function(){var z=$.indexOf(`
`);return z=z!==-1?z:$.length,q.lastIndex=z,Wq($.slice(0,z),J)}(),X=$[0]===`
`||$[0]===" ",Q,G;while(G=q.exec($)){var U=G[1],Y=G[2];Q=Y[0]===" ",Z+=U+(!X&&!Q&&Y!==""?`
`:"")+Wq(Y,J),X=Q}return Z}function Wq($,J){if($===""||$[0]===" ")return $;var q=/ [^ ]/g,Z,X=0,Q,G=0,U=0,Y="";while(Z=q.exec($)){if(U=Z.index,U-X>J)Q=G>X?G:U,Y+=`
`+$.slice(X,Q),X=Q+1;G=U}if(Y+=`
`,$.length-X>J&&G>X)Y+=$.slice(X,G)+`
`+$.slice(G+1);else Y+=$.slice(X);return Y.slice(1)}function oQ($){var J="",q=0,Z;for(var X=0;X<$.length;q>=65536?X+=2:X++)if(q=n0($,X),Z=K8[q],!Z&&s0(q)){if(J+=$[X],q>=65536)J+=$[X+1]}else J+=Z||bQ(q);return J}function rQ($,J,q){var Z="",X=$.tag,Q,G,U;for(Q=0,G=q.length;Q<G;Q+=1){if(U=q[Q],$.replacer)U=$.replacer.call(q,String(Q),U);if(c8($,J,U,!1,!1)||typeof U==="undefined"&&c8($,J,null,!1,!1)){if(Z!=="")Z+=","+(!$.condenseFlow?" ":"");Z+=$.dump}}$.tag=X,$.dump="["+Z+"]"}function zq($,J,q,Z){var X="",Q=$.tag,G,U,Y;for(G=0,U=q.length;G<U;G+=1){if(Y=q[G],$.replacer)Y=$.replacer.call(q,String(G),Y);if(c8($,J+1,Y,!0,!0,!1,!0)||typeof Y==="undefined"&&c8($,J+1,null,!0,!0,!1,!0)){if(!Z||X!=="")X+=kJ($,J);if($.dump&&o0===$.dump.charCodeAt(0))X+="-";else X+="- ";X+=$.dump}}$.tag=Q,$.dump=X||"[]"}function sQ($,J,q){var Z="",X=$.tag,Q=Object.keys(q),G,U,Y,z,W;for(G=0,U=Q.length;G<U;G+=1){if(W="",Z!=="")W+=", ";if($.condenseFlow)W+='"';if(Y=Q[G],z=q[Y],$.replacer)z=$.replacer.call(q,Y,z);if(!c8($,J,Y,!1,!1))continue;if($.dump.length>1024)W+="? ";if(W+=$.dump+($.condenseFlow?'"':"")+":"+($.condenseFlow?"":" "),!c8($,J,z,!1,!1))continue;W+=$.dump,Z+=W}$.tag=X,$.dump="{"+Z+"}"}function aQ($,J,q,Z){var X="",Q=$.tag,G=Object.keys(q),U,Y,z,W,K,M;if($.sortKeys===!0)G.sort();else if(typeof $.sortKeys==="function")G.sort($.sortKeys);else if($.sortKeys)throw new N8("sortKeys must be a boolean or a function");for(U=0,Y=G.length;U<Y;U+=1){if(M="",!Z||X!=="")M+=kJ($,J);if(z=G[U],W=q[z],$.replacer)W=$.replacer.call(q,z,W);if(!c8($,J+1,z,!0,!0,!0))continue;if(K=$.tag!==null&&$.tag!=="?"||$.dump&&$.dump.length>1024,K)if($.dump&&o0===$.dump.charCodeAt(0))M+="?";else M+="? ";if(M+=$.dump,K)M+=kJ($,J);if(!c8($,J+1,W,!0,K))continue;if($.dump&&o0===$.dump.charCodeAt(0))M+=":";else M+=": ";M+=$.dump,X+=M}$.tag=Q,$.dump=X||"{}"}function Kq($,J,q){var Z,X,Q,G,U,Y;X=q?$.explicitTypes:$.implicitTypes;for(Q=0,G=X.length;Q<G;Q+=1)if(U=X[Q],(U.instanceOf||U.predicate)&&(!U.instanceOf||typeof J==="object"&&J instanceof U.instanceOf)&&(!U.predicate||U.predicate(J))){if(q)if(U.multi&&U.representName)$.tag=U.representName(J);else $.tag=U.tag;else $.tag="?";if(U.represent){if(Y=$.styleMap[U.tag]||U.defaultStyle,dq.call(U.represent)==="[object Function]")Z=U.represent(J,Y);else if(cq.call(U.represent,Y))Z=U.represent[Y](J,Y);else throw new N8("!<"+U.tag+'> tag resolver accepts not "'+Y+'" style');$.dump=Z}return!0}return!1}function c8($,J,q,Z,X,Q,G){if($.tag=null,$.dump=q,!Kq($,q,!1))Kq($,q,!0);var U=dq.call($.dump),Y=Z,z;if(Z)Z=$.flowLevel<0||$.flowLevel>J;var W=U==="[object Object]"||U==="[object Array]",K,M;if(W)K=$.duplicates.indexOf(q),M=K!==-1;if($.tag!==null&&$.tag!=="?"||M||$.indent!==2&&J>0)X=!1;if(M&&$.usedDuplicates[K])$.dump="*ref_"+K;else{if(W&&M&&!$.usedDuplicates[K])$.usedDuplicates[K]=!0;if(U==="[object Object]"){if(Z&&Object.keys($.dump).length!==0){if(aQ($,J,$.dump,X),M)$.dump="&ref_"+K+$.dump}else if(sQ($,J,$.dump),M)$.dump="&ref_"+K+" "+$.dump}else if(U==="[object Array]"){if(Z&&$.dump.length!==0){if($.noArrayIndent&&!G&&J>0)zq($,J-1,$.dump,X);else zq($,J,$.dump,X);if(M)$.dump="&ref_"+K+$.dump}else if(rQ($,J,$.dump),M)$.dump="&ref_"+K+" "+$.dump}else if(U==="[object String]"){if($.tag!=="?")nQ($,$.dump,J,Q,Y)}else if(U==="[object Undefined]")return!1;else{if($.skipInvalid)return!1;throw new N8("unacceptable kind of an object to dump "+U)}if($.tag!==null&&$.tag!=="?"){if(z=encodeURI($.tag[0]==="!"?$.tag.slice(1):$.tag).replace(/!/g,"%21"),$.tag[0]==="!")z="!"+z;else if(z.slice(0,18)==="tag:yaml.org,2002:")z="!!"+z.slice(18);else z="!<"+z+">";$.dump=z+" "+$.dump}}return!0}function eQ($,J){var q=[],Z=[],X,Q;_J($,q,Z);for(X=0,Q=Z.length;X<Q;X+=1)J.duplicates.push(q[Z[X]]);J.usedDuplicates=new Array(Q)}function _J($,J,q){var Z,X,Q;if($!==null&&typeof $==="object")if(X=J.indexOf($),X!==-1){if(q.indexOf(X)===-1)q.push(X)}else if(J.push($),Array.isArray($))for(X=0,Q=$.length;X<Q;X+=1)_J($[X],J,q);else{Z=Object.keys($);for(X=0,Q=Z.length;X<Q;X+=1)_J($[Z[X]],J,q)}}function tQ($,J){J=J||{};var q=new uQ(J);if(!q.noRefs)eQ($,q);var Z=$;if(q.replacer)Z=q.replacer.call({"":Z},"",Z);if(c8(q,0,Z,!0,!0))return q.dump+`
`;return""}var $4=tQ,J4={dump:$4};function uJ($,J){return function(){throw new Error("Function yaml."+$+" is removed in js-yaml 4. Use yaml."+J+" instead, which is now safe by default.")}}var q4=U8,Z4=Vq,X4=Hq,Q4=Fq,G4=jq,U4=yJ,Y4=pq.load,W4=pq.loadAll,z4=J4.dump,K4=N8,D4={binary:Eq,float:Tq,map:Bq,null:Rq,pairs:Sq,set:xq,timestamp:Pq,bool:Cq,int:wq,merge:Iq,omap:fq,seq:Nq,str:Oq},M4=uJ("safeLoad","load"),V4=uJ("safeLoadAll","loadAll"),O4=uJ("safeDump","dump"),$5={Type:q4,Schema:Z4,FAILSAFE_SCHEMA:X4,JSON_SCHEMA:Q4,CORE_SCHEMA:G4,DEFAULT_SCHEMA:U4,load:Y4,loadAll:W4,dump:z4,YAMLException:K4,types:D4,safeLoad:M4,safeLoadAll:V4,safeDump:O4};function J5($){let J=$.split(`
`),q="",Z={"@context":"https://schema.org","@type":"CreativeWork"},X=[],Q=(F)=>{let j=F.trim();if(!j)return null;try{return JSON.parse(j)}catch{}try{return $5.load(j)}catch{}return null},G={},U=!1,Y="",z=!1;J.forEach((F)=>{let j=F.trim();if(j==="```agg"){z=!0;return}if(z){if(j==="```")z=!1;return}let S=j.match(/^\[master:([^\]]+)\]$/);if(S){Y=S[1]||"",G[Y]=[],U=!0;return}if(U&&Y){if(j.startsWith("|")){let m=j.split("|").slice(1,-1).map((D)=>D.trim());if(!m.every((D)=>D.match(/^-+$/))&&Y&&G[Y])G[Y].push(m)}else if(j.length>0)U=!1}}),o.setMasterData(G);let W=null,K=null,M=!1,O=!1,H="";Z.fields=[],Z.tables={},Z.masterData=G;let E=[],B=null,L="",N=!1,w=[],f=(F)=>{L+=F},v=(F)=>{return F.replace(/\[(?:([a-z]+):)?([^\]\s:\(\)]+)(?:\s*\((.*?)\))?\]/g,(j,S,m,d)=>{let D=(d||"").match(/placeholder="([^"]+)"/)||(d||"").match(/placeholder='([^']+)'/),A=D?D[1]:m;return Z.fields.push({key:m,label:A,type:S||"text"}),o.renderInput(S||"text",m,d||"")})};if(J.forEach((F)=>{let j=F.trim();if(j==="```agg"){N=!0,w=[];return}if(N){if(j==="```"){N=!1;let D=Q(w.join(`
`));if(D)X.push(D);w=[]}else w.push(F);return}let S=j.match(/^\[master:([^\]]+)\]$/);if(S){H=S[1]||"";return}let m=j.match(/^\[dynamic\s*-?\s*table:([^\]]+)\]$/);if(m){K=m[1]||"",Z.tables[K]=[];return}if(j.startsWith("|")){if(!M){f('<div class="form-row vertical"><div class="table-wrapper">');let C="data-table",T="";if(K)C+=" dynamic",T=`id="tbl_${K}" data-table-key="${K}"`;else if(H)C+=" master",T=`data-master-key="${H}"`;f(`<table class="${C}" ${T}>`),f("<tbody>"),M=!0,O=!!H}let D=j.split("|").slice(1,-1).map((C)=>C.trim());if(D.every((C)=>C.match(/^-+$/)));else if(K)if(!D.some((T)=>T.includes("[")))f(`<tr>${D.map((T)=>`<th>${o.escapeHtml(T)}</th>`).join("")}<th class="row-action-cell"></th></tr>`);else{let T=K;D.forEach((x)=>{let k=x.trim().match(/^\[(?:([a-z]+):)?([^\]:\(\)]+)(?:\s*\((.*)\)|:([^\]]+))?\]$/);if(k){let[_,h,p,f8,y8]=k,n8=p.trim(),i8=f8||y8||"";if(n8.includes(" ")){let S0=n8.split(/\s+/);n8=S0[0],i8=S0.slice(1).join(" ")+" "+i8}let N0=i8.match(/placeholder="([^"]+)"/)||i8.match(/placeholder='([^']+)'/),f0=N0?N0[1]:n8;Z.tables[T].push({key:n8,label:f0,type:h||"text"})}});let I=o.tableRow(D,!0);I=I.replace("</tr>",'<td class="row-action-cell"><button type="button" class="remove-row-btn" onclick="removeTableRow(this)" tabindex="-1"></button></td></tr>'),f(I)}else if(O)f(o.tableRow(D));else f(o.tableRow(D));return}else if(M){if(f("</tbody></table></div>"),K)f(`<button type="button" class="add-row-btn" onclick="addTableRow(this, '${K}')" data-i18n="add_row">+ </button>`),K=null;f("</div>"),M=!1,O=!1,H=""}let d=j.match(/^(#{1,6})\s+(.*)$/);if(d){let D=d[1]?d[1].length:1,A=d[2]||"";if(D===1)f(`<h1>${o.escapeHtml(A)}</h1>`),Z.name=A;else if(D===2){if(B)f("</div>");let C=A.includes("(Config)")||A.includes("(Hidden)")||A.includes("(System)"),T="tab-"+(E.length+1);E.push({id:T,title:A,isSystem:C}),B=T;let I=!C&&E.filter((k)=>!k.isSystem).length===1?" active":"",x=C?' style="display:none !important;"':"";f(`<div id="${T}" class="tab-content${I}" data-tab-title="${o.escapeHtml(A)}"${x}>`)}else f(`<h${D}>${o.escapeHtml(A)}</h${D}>`);W=null}else if(F.startsWith("  - ")||F.startsWith("\t- ")){if(W){let D=j.replace(/^-\s*/,""),A=!1;if(D.startsWith("[x] "))A=!0,D=D.substring(4);f(o.radioOption(W.key,D,D,A))}}else if(j.startsWith("- [")){let D=j.match(/^-\s*\[([a-z]+):([^\]\s:\(\)]+)(?:\s*\((.*)\))?\]\s*(.*)$/);if(D){let[A,C,T,I,x]=D;W=null;let k=(x||"").trim();if(Z.fields.push({key:T,label:k,type:C}),C==="radio")W={key:T,label:k,attrs:I||""},f(o.radioStart(T,k,I));else if(C==="text")f(o.text(T,k,I));else if(C==="number")f(o.number(T,k,I));else if(C==="date")f(o.date(T,k,I));else if(C==="textarea")f(o.textarea(T,k,I));else if(C==="search")f(o.search(T,k,I));else if(C==="calc")f(o.calc(T,k,I));else if(C==="datalist")f(o.renderInput(C,T,I));else if(C&&o[C])f(o[C](T,k,I));else console.warn(`Unknown type: ${C}`,Object.keys(o)),f(`<p style="color:red">Unknown type: ${C}</p>`)}}else if(j.startsWith("---")){if(!B)f("<hr>");W=null}else if(j.startsWith("<")){if(W)f("</div></div>"),W=null;f(v(j))}else if(j.length>0){if(W)f("</div></div>"),W=null;f(`<p>${o.escapeHtml(v(j))}</p>`)}else if(W)f("</div></div>"),W=null}),M){if(f("</tbody></table></div>"),K)f(`<button type="button" class="add-row-btn" onclick="addTableRow(this, '${K}')" data-i18n="add_row">+ </button>`),K=null;f("</div>")}if(W)f("</div></div>");if(B)f("</div>");let g=`
            <div style="flex:1"></div>
            <button class="btn-clear" onclick="window.clearData()" data-i18n="clear_btn">Clear</button>
            <button class="secondary" onclick="window.saveDraft()" data-i18n="work_save_btn">Save Progress</button>
            <button class="primary" onclick="window.signAndDownload()" data-i18n="sign_btn">Submit</button>
    `,y=`<div class="no-print form-toolbar" style="display: flex; gap: 10px; align-items: center; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #eee;">
            ${g}
        </div>`;if(E.length>0){let F='<div class="tabs-nav">',j=0;if(E.forEach((S,m)=>{if(S.isSystem)return;F+=`<button class="tab-btn${j===0?" active":""}" onclick="switchTab(this, '${S.id}')">${o.escapeHtml(S.title)}</button>`,j++}),F+=`<div class="no-print" style="display: flex; gap: 10px; align-items: center; flex-grow: 1;">
            ${g}
        </div>`,F+="</div>",L.includes("</h1>"))q=L.replace("</h1>","</h1>"+F);else q=F+L}else q=L+y;if(X.length===1)Z.aggSpec=X[0];else if(X.length>1)Z.aggSpec=X;return{html:q,jsonStructure:Z}}function q5($,J){let q=J.trim().replace(/^\$\./,"");if(!q)return[];let Z=q.split("."),X=[$];for(let Q of Z){let G=Q.match(/^(.*)\[(\d*)\]$/),U=G?G[1]:Q,Y=G?G[2]:null,z=G&&Y==="",W=G&&Y!==""&&Y!==null?parseInt(Y,10):null,K=[];for(let M of X){if(M===null||M===void 0)continue;let O=U?M[U]:M;if(z){if(Array.isArray(O))K.push(...O);continue}if(W!==null){if(Array.isArray(O)&&O[W]!==void 0)K.push(O[W]);continue}if(O!==void 0)K.push(O)}X=K}return X}function N4($,J,q){if(!J){$.innerHTML="";return}let Z="",X=J.dashboard?.cards||J.metrics?.map((G)=>({id:G.id,label:G.name,op:G.type,path:G.path}))||[];if(X.length>0){let G=X.map((U)=>{let Y=0,z=[];if(q.forEach((W)=>{if(U.path)z.push(...q5(W.plain,U.path))}),U.op==="count")Y=q.length;else if(U.op==="sum")Y=z.reduce((W,K)=>W+(Number(K)||0),0);else if(U.op==="avg")Y=z.length?z.reduce((W,K)=>W+(Number(K)||0),0)/z.length:0;else if(U.op==="boolean_count")Y=z.filter((W)=>!!W).length;if(typeof Y==="number"&&U.format==="currency")Y=new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(Y);else if(typeof Y==="number")Y=Y.toLocaleString();return`
        <div class="metric-card">
          <label>${U.label}</label>
          <div class="value">${Y}</div>
        </div>
      `}).join("");Z+=`<div class="dashboard-grid">${G}</div>`}let Q=J.dashboard?.charts||[];if(Q.length>0){let G=Q.map((U)=>{if(U.type==="bar"){let Y={};q.forEach((M)=>{q5(M.plain,U.source).forEach((H)=>{if(U.filter){if(H[U.filter.path]!==U.filter.value)return}let E=H[U.x];if(E)Y[E]=(Y[E]||0)+1})});let z=Object.entries(Y).sort((M,O)=>O[1]-M[1]),W=Math.max(...Object.values(Y),1),K=z.map(([M,O])=>`
          <div class="chart-bar-row">
            <div class="chart-bar-label">${M}</div>
            <div class="chart-bar-track"><div class="chart-bar-fill" style="width: ${O/W*100}%"></div></div>
            <div class="chart-bar-value">${O}</div>
          </div>
        `).join("");return`
          <div class="chart-card">
            <h4>${U.title}</h4>
            <div class="chart-bars">${K}</div>
          </div>
        `}return""}).join("");Z+=`<div class="chart-grid">${G}</div>`}$.innerHTML=Z}function B4($,J,q){if(J.length===0){$.innerHTML=`<div class="agg-empty-state">
      <div class="icon">\uD83D\uDCC2</div>
      <p>No records found. Please upload HTML files and click "Run Aggregation".</p>
    </div>`;return}let Z=q.map((Q)=>`<th>${Q}</th>`).join(""),X=J.map((Q,G)=>{let U=q.map((Y)=>`<td>${Q[Y]??""}</td>`).join("");return`<tr onclick="window.showRecordDetail(${G})">${U}</tr>`}).join("");$.innerHTML=`
    <div class="agg-section-header">
      <h3>\uD83D\uDCCB Extracted Records</h3>
      <span class="count-badge">${J.length} records</span>
    </div>
    <div class="agg-table-container">
      <table class="agg-table">
        <thead><tr>${Z}</tr></thead>
        <tbody>${X}</tbody>
      </table>
    </div>
  `,window._aggRows=J}var pJ=null,dJ=null;function H4(){let $=document.getElementById("weba-source-markdown");if(!$)return null;return $.textContent||null}function R4(){if(pJ&&dJ)return{html:pJ,structure:dJ};let $=H4();if(!$)return null;let J=J5($);return pJ=J.html,dJ=J.jsonStructure,{html:J.html,structure:J.jsonStructure}}function Z5($,J){if(!J)return;let q=J.trim().replace(/^\$\./,"");if(!q)return;let Z=q.split("."),X=$;for(let Q of Z){if(X===null||X===void 0)return;let G=Q.match(/^(.*)\[(\d+)\]$/);if(G){let U=G[1],Y=parseInt(G[2],10),z=U?X[U]:X;X=Array.isArray(z)?z[Y]:void 0;continue}X=X[Q]}return X}function X5($,J){if($ instanceof HTMLInputElement&&$.type==="checkbox"){$.checked=!!J;return}let q=J===null||J===void 0?"":String(J);$.value=q}function C4($,J){let q=Array.isArray(J?.fields)?J.fields:[],Z=new Set(q.map((U)=>U.key)),X=new Set(Object.keys(J?.tables||{})),Q="",G=!1;for(let U in $){if(U.startsWith("@")||U.startsWith("_")||Z.has(U)||X.has(U))continue;if(!G)Q+='<div class="detail-group-header">Extra Information</div>',G=!0;Q+=`
      <div class="detail-row">
        <div class="detail-key">${U}</div>
        <div class="detail-val-box"><pre class="val-json">${JSON.stringify($[U],null,2)}</pre></div>
      </div>
    `}return Q}function w4($,J){let q=J||{};$.querySelectorAll("input[data-json-path], textarea[data-json-path], select[data-json-path]").forEach((Z)=>{let X=Z.dataset.jsonPath||"",Q=Z5(q,X);X5(Z,Q)}),$.querySelectorAll("input[type='radio']").forEach((Z)=>{let X=Z.name;if(!X)return;let Q=Z5(q,X);if(Q!==void 0)Z.checked=String(Q)===Z.value}),$.querySelectorAll(".data-table.dynamic").forEach((Z)=>{let X=Z.getAttribute("data-table-key")||"";if(!X)return;let Q=Array.isArray(q[X])?q[X]:[],G=Z.querySelector("tbody"),U=G?.querySelector("tr.template-row");if(!G||!U)return;U.style.display="none",Q.forEach((Y,z)=>{let W=U.cloneNode(!0);W.classList.remove("template-row"),W.style.display="",W.querySelectorAll("input, textarea, select").forEach((K)=>{let M=K.dataset.baseKey||K.dataset.jsonPath;if(!M)return;X5(K,Y?.[M])}),W.querySelectorAll(".auto-num").forEach((K)=>{if(!K.value)K.value=String(z+1)}),W.querySelectorAll(".remove-row-btn").forEach((K)=>{K.style.display="none"}),G.appendChild(W)})}),$.querySelectorAll("input, textarea, select").forEach((Z)=>{Z.disabled=!0,Z.classList.add("readonly")}),$.querySelectorAll(".add-row-btn").forEach((Z)=>{Z.style.display="none"})}function T4($){let J=window._aggRows;if(!J||!J[$])return;let q=J[$],Z=document.getElementById("weba-agg-detail");if(!Z)return;let X=q._raw||{},Q="",G=R4(),U="",Y=document.getElementById("weba-structure"),z=[],W=null;if(Y)try{let B=JSON.parse(Y.textContent);z=B.fields||[],W=B}catch{}let K=(B)=>{if(B===null||B===void 0)return'<span class="val-null">N/A</span>';if(typeof B==="boolean")return`<span class="val-bool ${B}">${B?"Yes":"No"}</span>`;if(Array.isArray(B))return`<div class="val-array">${B.map((L)=>`<div class="array-item">${typeof L==="object"?JSON.stringify(L):L}</div>`).join("")}</div>`;if(typeof B==="object")return`<pre class="val-json">${JSON.stringify(B,null,2)}</pre>`;return`<span class="val-text">${B}</span>`};if(G)U=`
      <div class="detail-form-preview" id="weba-agg-form-preview">
        ${G.html}
      </div>
      ${C4(X,G.structure||W||{})}
    `;else if(z.length>0){z.forEach((N)=>{if(N.type==="calc")return;let w=X[N.key];if(w!==void 0)Q+=`
          <div class="detail-row">
            <div class="detail-key">${N.label||N.key}</div>
            <div class="detail-val-box">${K(w)}</div>
          </div>
        `});let B=new Set(z.map((N)=>N.key)),L=!1;for(let N in X){if(N.startsWith("@")||N.startsWith("_")||B.has(N))continue;if(!L)Q+='<div class="detail-group-header">Extra Information</div>',L=!0;Q+=`
        <div class="detail-row">
          <div class="detail-key">${N}</div>
          <div class="detail-val-box">${K(X[N])}</div>
        </div>
      `}}else for(let B in X){if(B.startsWith("@")||B.startsWith("_"))continue;Q+=`
        <div class="detail-row">
          <div class="detail-key">${B}</div>
          <div class="detail-val-box">${K(X[B])}</div>
        </div>
      `}Z.innerHTML=`
    <div class="detail-overlay" id="weba-detail-overlay">
      <div class="detail-modal">
        <div class="detail-modal-header">
          <div class="header-info">
            <span class="file-icon">\uD83D\uDCC4</span>
            <div class="text">
              <h3>Record Details</h3>
              <p>${q._filename||"Standalone Record"}</p>
            </div>
          </div>
          <button class="close-btn" id="weba-detail-close"></button>
        </div>
        <div class="detail-modal-body">
          ${U||`<div class="form-view">${Q}</div>`}
          <details class="raw-data-section">
            <summary>View Raw Source Data (JSON)</summary>
            <pre>${JSON.stringify(X,null,2)}</pre>
            ${q._sig?`<h4>Signature</h4><pre>${JSON.stringify(q._sig,null,2)}</pre>`:""}
          </details>
        </div>
      </div>
    </div>
  `,document.body.style.overflow="hidden";let M=document.getElementById("weba-detail-overlay"),O=document.getElementById("weba-detail-close"),H=()=>{if(Z)Z.innerHTML="";document.body.style.overflow=""};M?.addEventListener("click",(B)=>{if(B.stopPropagation(),B.target===M)H()}),O?.addEventListener("click",(B)=>{B.stopPropagation(),H()});let E=document.getElementById("weba-agg-form-preview");if(E)w4(E,X)}window.showRecordDetail=T4;function F4(){let $=document.getElementById("weba-l2-key");if(!$)return null;try{return JSON.parse($.textContent)}catch{return null}}function j4(){let $=document.getElementById("weba-agg-spec");if(!$)return null;try{return JSON.parse($.textContent)}catch{return null}}async function A4($,J){let q=i9($);if(q){if(!J)return{source:"l2",plain:null};try{let X=null;if(J.recipient_x25519_private)X=G8(J.recipient_x25519_private);if(!X&&J.org_root_key);if(X){let Q=await x$(q,X);return{source:"l2",plain:Q.layer2_plain,sig:Q.layer2_sig}}}catch(X){console.warn("L2 decryption failed",X)}}let Z=n9($);if(Z)return{source:"jsonld",plain:Z.credentialSubject?.answers||Z};return{source:"unknown",plain:null}}function Q5(){let $=document.getElementById("aggregator-root");if(!$)return;$.innerHTML=`
    <div class="agg-layout">
      <aside class="agg-sidebar">
        <div class="agg-brand">
          <div class="brand-logo">Agg</div>
          <h1>Web/A Aggregator</h1>
        </div>

        <div class="agg-config-card">
          <div class="card-header">1. Data Source</div>
          <div class="agg-form-field">
            <label>Upload Submitted Forms</label>
            <div class="btn-grid">
              <button id="weba-agg-file-trigger" class="agg-btn-secondary">\uD83D\uDCC4 Select Files</button>
              <button id="weba-agg-dir-trigger" class="agg-btn-secondary">\uD83D\uDCC1 Select Folder</button>
            </div>
            <input id="weba-agg-files" type="file" accept=".html" multiple style="display:none;" />
            <input id="weba-agg-dirs" type="file" webkitdirectory directory style="display:none;" />
            <p class="field-hint">Select files or an entire folder of HTML forms.</p>
          </div>

          <div class="agg-form-field">
            <label>Decryption Method</label>
            <div id="weba-agg-key-status" class="agg-status-chip">No keys detected</div>
            <div class="btn-group">
              <button id="weba-agg-passkey" class="agg-btn-small outline">\uD83D\uDD11 Use Passkey</button>
            </div>
            <p class="field-hint">Encryption is used for Layer 2 security.</p>
          </div>

          <div class="agg-form-field-row">
            <input id="weba-agg-include-json" type="checkbox" />
            <label for="weba-agg-include-json">Include JSON column in table</label>
          </div>
        </div>

        <div class="agg-actions-card">
          <button id="weba-agg-run" class="agg-btn-primary"> Run Aggregation</button>
          <div class="btn-grid">
            <button id="weba-agg-download" class="agg-btn-secondary" disabled>\uD83D\uDCE5 CSV</button>
            <button id="weba-agg-download-jsonl" class="agg-btn-secondary" disabled>\uD83D\uDCE5 JSONL</button>
          </div>
          <button id="weba-agg-clear" class="agg-btn-text">\uD83D\uDDD1 Clear Data</button>
          <div id="weba-agg-status" class="agg-status-message">Ready.</div>
        </div>
      </aside>

      <main class="agg-main">
        <div id="weba-agg-results" class="agg-results is-hidden">
          <div id="weba-agg-dashboard" class="agg-dashboard"></div>
          <div id="weba-agg-output" class="agg-output"></div>
        </div>
      </main>
    </div>

    <div id="weba-agg-detail"></div>

    <style>
      :root {
        --agg-primary: #2563eb;
        --agg-bg: #f8fafc;
        --agg-card-bg: #ffffff;
        --agg-text: #1e293b;
        --agg-text-dim: #64748b;
        --agg-border: #e2e8f0;
      }

      .agg-layout { display: flex; min-height: 80vh; gap: 24px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; color: var(--agg-text); }
      .agg-sidebar { width: 320px; flex-shrink: 0; display: flex; flex-direction: column; gap: 20px; }
      .agg-main { flex: 1; display: flex; flex-direction: column; gap: 24px; }

      .agg-brand { padding: 12px 0; display: flex; align-items: center; gap: 12px; }
      .brand-logo { background: var(--agg-primary); color: white; width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; }
      .agg-brand h1 { font-size: 1.25rem; font-weight: 700; margin: 0; }

      .agg-config-card, .agg-actions-card { background: var(--agg-card-bg); border: 1px solid var(--agg-border); border-radius: 12px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
      .card-header { font-size: 0.85rem; font-weight: 600; text-transform: uppercase; color: var(--agg-text-dim); margin-bottom: 16px; border-bottom: 1px solid var(--agg-border); padding-bottom: 8px; }

      .agg-form-field { margin-bottom: 16px; }
      .agg-form-field label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 6px; }
      .agg-form-field input[type="file"] { width: 100%; font-size: 0.85rem; }
      .field-hint { font-size: 0.75rem; color: var(--agg-text-dim); margin: 4px 0 0; }

      .agg-form-field-row { display: flex; align-items: center; gap: 8px; margin-top: 12px; }
      .agg-form-field-row label { font-size: 0.85rem; cursor: pointer; }

      .agg-status-chip { background: #f1f5f9; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; color: var(--agg-text-dim); display: inline-block; margin-bottom: 8px; }
      .agg-status-chip.ready { background: #dcfce7; color: #166534; }

      .btn-group { display: flex; gap: 8px; }
      .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
      
      .agg-btn-primary { background: var(--agg-primary); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; margin-bottom: 12px; transition: opacity 0.2s; }
      .agg-btn-primary:active { opacity: 0.8; }
      
      .agg-btn-secondary { background: white; border: 1px solid var(--agg-border); color: var(--agg-text); padding: 8px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; }
      .agg-btn-secondary:disabled { opacity: 0.5; cursor: not-allowed; }
      
      .agg-btn-small { padding: 4px 12px; border-radius: 6px; font-size: 0.8rem; cursor: pointer; }
      .agg-btn-small.outline { background: white; border: 1px solid var(--agg-primary); color: var(--agg-primary); }

      .agg-btn-text { background: none; border: none; color: #ef4444; font-size: 0.85rem; padding: 8px; cursor: pointer; width: 100%; margin-top: 12px; }

      .agg-status-message { font-size: 0.85rem; color: var(--agg-text-dim); text-align: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--agg-border); }

      .agg-results.is-hidden { display: none; }

      /* Dashboard */
      .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 16px; }
      .metric-card { background: white; border: 1px solid var(--agg-border); border-radius: 12px; padding: 16px; display: flex; flex-direction: column; gap: 4px; border-left: 4px solid var(--agg-primary); }
      .metric-card label { font-size: 0.75rem; color: var(--agg-text-dim); font-weight: 600; text-transform: uppercase; }
      .metric-card .value { font-size: 1.5rem; font-weight: 700; color: var(--agg-text); }

      /* Charts */
      .chart-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 20px; margin-top: 24px; }
      .chart-card { background: white; border: 1px solid var(--agg-border); border-radius: 12px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
      .chart-card h4 { margin: 0 0 16px 0; font-size: 0.95rem; font-weight: 700; color: var(--agg-text); border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; }
      .chart-bars { display: flex; flex-direction: column; gap: 12px; }
      .chart-bar-row { display: flex; align-items: center; gap: 12px; font-size: 0.85rem; }
      .chart-bar-label { width: 120px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; font-weight: 500; }
      .chart-bar-track { flex: 1; height: 12px; background: #f1f5f9; border-radius: 6px; overflow: hidden; }
      .chart-bar-fill { height: 100%; background: var(--agg-primary); border-radius: 6px; }
      .chart-bar-value { width: 30px; text-align: right; font-weight: 700; color: var(--agg-text-dim); }

      /* Results Styling */
      .agg-section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
      .count-badge { background: var(--agg-primary); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; }

      .agg-table-container { background: white; border: 1px solid var(--agg-border); border-radius: 12px; overflow: auto; box-shadow: 0 1px 3px rgba(0,0,0,0.05); max-height: 500px; }
      .agg-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; text-align: left; }
      .agg-table th { background: #f8fafc; padding: 12px; border-bottom: 1px solid var(--agg-border); font-weight: 600; color: var(--agg-text-dim); position: sticky; top: 0; }
      .agg-table td { padding: 12px; border-bottom: 1px solid var(--agg-border); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }
      .agg-table tr:hover { background: #f1f5f9; cursor: pointer; }

      .agg-empty-state { text-align: center; padding: 48px; color: var(--agg-text-dim); background: white; border: 2px dashed var(--agg-border); border-radius: 12px; }
      .agg-empty-state .icon { font-size: 2rem; margin-bottom: 12px; }

      /* Detail Modal Overhaul */
      .detail-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.75); backdrop-filter: blur(4px); display: flex; align-items: flex-end; justify-content: center; z-index: 10000; }
      @media (min-width: 768px) { .detail-overlay { align-items: center; } }

      .detail-modal { background: white; width: 100%; max-width: 720px; border-radius: 20px 20px 0 0; display: flex; flex-direction: column; max-height: 94vh; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); animation: slideUp 0.3s ease-out; }
      @media (min-width: 768px) { .detail-modal { border-radius: 16px; max-height: 85vh; } }

      @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

      .detail-modal-header { padding: 16px 24px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
      .header-info { display: flex; gap: 12px; align-items: center; }
      .file-icon { font-size: 1.5rem; }
      .header-info h3 { margin: 0; font-size: 1.1rem; }
      .header-info p { margin: 0; font-size: 0.8rem; color: var(--agg-text-dim); }
      .close-btn { border: none; background: #f1f5f9; width: 32px; height: 32px; border-radius: 50%; font-size: 1rem; cursor: pointer; color: #64748b; }

      .detail-modal-body { padding: 24px; overflow-y: auto; flex: 1; }
      
      .form-view { display: flex; flex-direction: column; gap: 16px; }
      .detail-group-header { font-size: 0.8rem; font-weight: 700; color: var(--agg-primary); text-transform: uppercase; background: #eff6ff; padding: 4px 12px; border-radius: 4px; margin-top: 12px; }
      
      .detail-row { display: grid; grid-template-columns: 140px 1fr; gap: 16px; border-bottom: 1px solid #f1f5f9; padding-bottom: 12px; align-items: flex-start; }
      .detail-key { font-size: 0.85rem; font-weight: 600; color: #64748b; padding-top: 2px; }
      
      .val-null { color: #cbd5e1; font-family: monospace; }
      .val-bool.true { color: #16a34a; font-weight: bold; }
      .val-bool.false { color: #dc2626; font-weight: bold; }
      .val-text { line-height: 1.5; color: #0f172a; }
      .val-json { font-size: 0.8rem; background: #f8fafc; padding: 8px; border-radius: 6px; border: 1px solid #e2e8f0; margin: 0; }
      
      .raw-data-section { margin-top: 32px; border-top: 1px solid #e2e8f0; padding-top: 20px; }
      .raw-data-section summary { font-size: 0.85rem; font-weight: 600; cursor: pointer; color: var(--agg-text-dim); }
      .raw-data-section pre { margin-top: 12px; font-size: 0.75rem; background: #1e293b; color: #e2e8f0; padding: 12px; border-radius: 8px; overflow-x: auto; }

      .detail-form-preview { background: #ffffff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 16px; }
      .detail-form-preview .form-row { margin-bottom: 16px; }
      .detail-form-preview .form-label { font-weight: 600; margin-bottom: 6px; display: block; }
      .detail-form-preview .form-input { width: 100%; padding: 8px 10px; border: 1px solid #cbd5f5; border-radius: 6px; background: #f8fafc; }
      .detail-form-preview .form-input.readonly { color: #0f172a; }
      .detail-form-preview .table-wrapper { overflow-x: auto; }
      .detail-form-preview table { border-collapse: collapse; width: 100%; font-size: 0.9rem; }
      .detail-form-preview th, .detail-form-preview td { border: 1px solid #e2e8f0; padding: 8px; text-align: left; }
      .detail-form-preview .remove-row-btn { display: none; }
      .detail-form-preview .tabs-nav { display: none; }
      .detail-form-preview .tab-content { display: block; }
      .detail-form-preview .form-toolbar { display: none; }
      .detail-form-preview .no-print { display: none; }
    </style>
  `;let J=$.querySelector("#weba-agg-files"),q=$.querySelector("#weba-agg-dirs"),Z=$.querySelector("#weba-agg-file-trigger"),X=$.querySelector("#weba-agg-dir-trigger"),Q=$.querySelector("#weba-agg-status"),G=$.querySelector("#weba-agg-output"),U=$.querySelector("#weba-agg-dashboard"),Y=$.querySelector("#weba-agg-results"),z=$.querySelector("#weba-agg-include-json"),W=$.querySelector("#weba-agg-run"),K=$.querySelector("#weba-agg-download"),M=$.querySelector("#weba-agg-download-jsonl"),O=$.querySelector("#weba-agg-key-status"),H=$.querySelector("#weba-agg-passkey"),E=$.querySelector("#weba-agg-clear"),B="",L="",N=[],w=null,f=F4(),v=j4();if(O)O.textContent=f?.recipient_kid?`Loaded (${f.recipient_kid})`:f?"Loaded":"No keys detected",O.classList.toggle("ready",!!f);if(v?.export?.jsonl===!1&&M)M.disabled=!0;let g=(F)=>{if(!Y)return;Y.classList.toggle("is-hidden",!F)};H?.addEventListener("click",async()=>{try{if(!E8.getPublicKey()){if(!await E8.register())return}alert("Please authenticate with your Passkey to decrypt.");let F=new Uint8Array(32),j=await E8.derivePrf(F);if(!j)throw new Error("PRF not supported or enabled on this key, or authentication failed.");if(w={recipient_x25519_private:O8(x9(j).privateKey)},H.textContent=" Passkey Active",H.disabled=!0,O)O.textContent="Passkey Enabled",O.classList.add("ready");if(J?.files&&J.files.length>0||q?.files&&q.files.length>0)y()}catch(F){console.error(F),alert("Passkey error: "+F.message)}}),Z?.addEventListener("click",()=>J?.click()),X?.addEventListener("click",()=>q?.click()),J?.addEventListener("change",()=>y()),q?.addEventListener("change",()=>y());let y=async()=>{let F=J?.files?Array.from(J.files):[],j=q?.files?Array.from(q.files):[],S=[...F,...j].filter((_)=>_.name.toLowerCase().endsWith(".html")&&!_.name.startsWith("."));if(!(S.length>0)){if(Q)Q.textContent="Select HTML files first.";g(!1);return}if(Q)Q.textContent="Processing...";if(K)K.disabled=!0;if(M)M.disabled=!0;g(!0);let d=$.querySelector(".agg-brand h1");N=[];let D=[],A=new Set(["_filename"]),C=0,T=0,I=w||f;if(d)d.innerHTML='Web/A Aggregator <span style="font-size:0.75rem; background:#10b981; color:white; padding:2px 8px; border-radius:4px; margin-left:8px; vertical-align:middle;">REAL DATA</span>';console.log(`Running aggregation on ${S.length} files...`);for(let _ of S)try{let h=await _.text(),p=await A4(h,I);if(p.source!=="unknown"&&p.plain){N.push({filename:_.name,plain:p.plain,sig:p.sig});let f8=r9({plain:p.plain,filename:_.name,includeJson:!!z?.checked,sig:p.sig,omitKey:(y8)=>y8.startsWith("@")});f8.keys.forEach((y8)=>A.add(y8)),D.push({...f8.row,_raw:p.plain,_sig:p.sig}),C+=1}else console.warn(`Could not extract from ${_.name}`),T+=1}catch(h){console.error(`Error processing ${_.name}`,h),T+=1}let x=Array.from(A).sort((_,h)=>{if(_==="_filename")return-1;if(h==="_filename")return 1;return _.localeCompare(h)});if(B=s9(D,x),K)K.disabled=D.length===0;let k=v?.export?.jsonl!==!1;if(L=N.map((_)=>JSON.stringify({_filename:_.filename,_l2_sig:_.sig??null,..._.plain})).join(`
`),M)M.disabled=N.length===0||!k;if(Q)Q.textContent=`Completed. Processed ${C} entries. Errors: ${T}.`;if(U)N4(U,v,N);if(G)B4(G,D,x)};E?.addEventListener("click",()=>{if(N=[],B="",L="",J)J.value="";if(q)q.value="";if(Q)Q.textContent="Data cleared.";if(K)K.disabled=!0;if(M)M.disabled=!0;if(U)U.innerHTML="";if(G)G.innerHTML="";g(!1),window._aggRows=[]}),W?.addEventListener("click",()=>{y().catch((F)=>{if(Q)Q.textContent="Failed to aggregate.";console.error(F)})}),K?.addEventListener("click",()=>{if(!B)return;let F=new Blob([B],{type:"text/csv;charset=utf-8"}),j=URL.createObjectURL(F),S=document.createElement("a");S.href=j,S.download="weba-aggregated.csv",S.click(),URL.revokeObjectURL(j)}),M?.addEventListener("click",()=>{if(!L)return;let F=new Blob([L],{type:"application/x-jsonlines;charset=utf-8"}),j=URL.createObjectURL(F),S=document.createElement("a");S.href=j,S.download="weba-aggregated.jsonl",S.click(),URL.revokeObjectURL(j)})}function G5(){console.log("Web/A Runtime Booting...");let $=new c$,J=new LJ,q=new PJ($,J),Z=window,X=document.getElementById("weba-structure");if(X?.textContent)try{Z.generatedJsonStructure=JSON.parse(X.textContent)}catch(U){console.warn("Failed to parse weba structure JSON",U)}let Q=m9();if(Q)Z.webaL2Config=Q;Z.saveDraft=()=>J.saveDraft(),Z.submitDocument=()=>J.submitDocument(),Z.signAndDownload=()=>J.signAndDownload(),Z.clearData=()=>J.clearData(),Z.removeTableRow=(U)=>q.removeTableRow(U),Z.addTableRow=(U,Y)=>q.addTableRow(U,Y),Z.switchTab=(U,Y)=>q.switchTab(U,Y),Z.recalculate=()=>$.recalculate(),Z.escapeHtml=(U)=>{if(!U)return"";let Y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return U.toString().replace(/[&<>"']/g,(z)=>Y[z]||z)},J.restoreFromLS(),q.applyI18n(),q.initTables(),$.recalculate(),p9(),d9(),Q5();let G;document.addEventListener("input",(U)=>{let Y=U.target;if(U.isTrusted)Y.dataset.dirty="true";let z=Y.dataset.baseKey||Y.dataset.jsonPath;if(z)(Y.closest("tr")||document).querySelectorAll(`[data-copy-from="${z}"]`).forEach((M)=>{if(!M.dataset.dirty){if(M.value!==Y.value)M.value=Y.value,M.dispatchEvent(new Event("input"))}});$.recalculate(),J.updateJsonLd(),clearTimeout(G),G=setTimeout(()=>J.saveToLS(),1000)}),console.log("Web/A Runtime Ready.")}class cJ{suggestionsVisible=!1;activeSearchInput=null;globalBox=null;constructor(){}init(){console.log("Initializing Search Engine (Bundle)...");let $=window;if($.generatedJsonStructure&&$.generatedJsonStructure.masterData){let J=Object.keys($.generatedJsonStructure.masterData);console.log("Master Data Keys available:",J.join(", "))}this.setupEventDelegation()}normalize($){if(!$)return"";let J=$.toString().toLowerCase();return J=J.replace(/[---]/g,(q)=>{return String.fromCharCode(q.charCodeAt(0)-65248)}),J=J.replace(/[-]/g,(q)=>String.fromCharCode(q.charCodeAt(0)-65248)),J.trim()}clean($){if(!$)return"";let J=this.normalize($);return J=J.replace(/(|||||npo||)/g,""),J=J.replace(/(\(\)|\(\)|\(\))/g,""),J.trim()}toIndex($){let J=parseInt($||"",10);return Number.isFinite(J)?J-1:-1}getGlobalBox(){if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",maxHeight:"200px",overflowY:"auto",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if($.target.classList.contains("search-input"))this.handleSearchInput($.target)}),document.body.addEventListener("click",($)=>{if($.target.classList.contains("suggestion-item"))this.handleSelection($.target)})}handleSearchInput($){this.activeSearchInput=$;let J=window,q=$.dataset.masterSrc,Z=$.dataset.suggestSource;if(!q&&!Z)return;let X=this.toIndex($.dataset.masterLabelIndex),Q=this.toIndex($.dataset.masterValueIndex),G=$.value;if(!G){this.hideSuggestions();return}let U=[],Y=this.normalize(G);if(Z==="column"){let z=$.dataset.baseKey,W=$.closest("table");if(W&&z){let K=new Set;W.querySelectorAll(`[data-base-key="${z}"]`).forEach((M)=>{if(M===$)return;let O=M.value;if(O&&this.normalize(O).includes(Y)){if(!K.has(O))K.add(O),U.push({val:O,row:[O],label:O,score:10})}})}}else if(q){let z=J.generatedJsonStructure.masterData;if(!z||!z[q])return;z[q].forEach((K,M)=>{if(M===0)return;if(K.some((H)=>this.normalize(H||"").includes(Y))){let H=X>=0?K[X]||"":"",E=Q>=0?K[Q]||"":"",B=Q>=0?E:X>=0?H:K[1]||K[0]||"";U.push({val:B,row:K,label:H,score:10,idx:M})}})}this.renderSuggestions($,U,X)}renderSuggestions($,J,q){if(J.length===0){this.hideSuggestions();return}let Z=window,X=J.slice(0,10),Q="";X.forEach((W)=>{let K=Z.escapeHtml(JSON.stringify(W.row)),M=q>=0?W.label||W.row.join(" : "):W.row.join(" : ");Q+=`<div class="suggestion-item" data-val="${Z.escapeHtml(W.val)}" data-row="${K}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${Z.escapeHtml(M)}</div>`});let G=this.getGlobalBox();G.innerHTML=Q;let U=$.getBoundingClientRect(),Y=window.scrollY||document.documentElement.scrollTop,z=window.scrollX||document.documentElement.scrollLeft;G.style.width=Math.max(U.width,200)+"px",G.style.left=U.left+z+"px",G.style.top=U.bottom+Y+"px",G.querySelectorAll(".suggestion-item").forEach((W)=>{W.onmouseenter=()=>W.style.background="#f0f8ff",W.onmouseleave=()=>W.style.background="white"}),G.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;let J=window,q=this.activeSearchInput,Z=$.dataset.val||"",X=$.dataset.row||"[]";try{let Q=JSON.parse(X),G=q.dataset.masterSrc,U=G?J.generatedJsonStructure.masterData[G][0]:[],Y=!1;if(U.length>0&&Q.length>0){let z=q.closest("tr");if(z){let W=Array.from(z.querySelectorAll("input, select, textarea"));U.forEach((K,M)=>{if(!K)return;let O=Q[M];this.fillField(W,K,O,q,()=>{Y=!0})})}}if(!Y)q.value=Z,q.dispatchEvent(new Event("input",{bubbles:!0}))}catch(Q){console.error(Q)}this.hideSuggestions()}fillField($,J,q,Z,X){let Q=this.normalize(J),G=$.find((U)=>{let Y=U.dataset.baseKey||U.dataset.jsonPath,z=this.normalize(U.getAttribute("placeholder")||"");return Y&&this.normalize(Y)===Q||z===Q});if(G){if(G.value=q||"",G.dispatchEvent(new Event("input",{bubbles:!0})),G===Z)X()}}}var L4=BigInt(0),a0=BigInt(1),P4=BigInt(2),I4=BigInt(7),E4=BigInt(256),f4=BigInt(113),W5=[],z5=[],K5=[];for(let $=0,J=a0,q=1,Z=0;$<24;$++){[q,Z]=[Z,(2*q+3*Z)%5],W5.push(2*(5*Z+q)),z5.push(($+1)*($+2)/2%64);let X=L4;for(let Q=0;Q<7;Q++)if(J=(J<<a0^(J>>I4)*f4)%E4,J&P4)X^=a0<<(a0<<BigInt(Q))-a0;K5.push(X)}var D5=U$(K5,!0),S4=D5[0],x4=D5[1],U5=($,J,q)=>q>32?V1($,J,q):D1($,J,q),Y5=($,J,q)=>q>32?O1($,J,q):M1($,J,q);function k4($,J=24){let q=new Uint32Array(10);for(let Z=24-J;Z<24;Z++){for(let G=0;G<10;G++)q[G]=$[G]^$[G+10]^$[G+20]^$[G+30]^$[G+40];for(let G=0;G<10;G+=2){let U=(G+8)%10,Y=(G+2)%10,z=q[Y],W=q[Y+1],K=U5(z,W,1)^q[U],M=Y5(z,W,1)^q[U+1];for(let O=0;O<50;O+=10)$[G+O]^=K,$[G+O+1]^=M}let X=$[2],Q=$[3];for(let G=0;G<24;G++){let U=z5[G],Y=U5(X,Q,U),z=Y5(X,Q,U),W=W5[G];X=$[W],Q=$[W+1],$[W]=Y,$[W+1]=z}for(let G=0;G<50;G+=10){for(let U=0;U<10;U++)q[U]=$[G+U];for(let U=0;U<10;U++)$[G+U]^=~q[(U+2)%10]&q[(U+4)%10]}$[0]^=S4[Z],$[1]^=x4[Z]}B8(q)}class b${state;pos=0;posOut=0;finished=!1;state32;destroyed=!1;blockLen;suffix;outputLen;enableXOF=!1;rounds;constructor($,J,q,Z=!1,X=24){if(this.blockLen=$,this.suffix=J,this.outputLen=q,this.enableXOF=Z,this.rounds=X,T8(q,"outputLen"),!(0<$&&$<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Z$(this.state)}clone(){return this._cloneInto()}keccak(){l$(this.state32),k4(this.state32,this.rounds),l$(this.state32),this.posOut=0,this.pos=0}update($){b8(this),c($);let{blockLen:J,state:q}=this,Z=$.length;for(let X=0;X<Z;){let Q=Math.min(J-this.pos,Z-X);for(let G=0;G<Q;G++)q[this.pos++]^=$[X++];if(this.pos===J)this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:$,suffix:J,pos:q,blockLen:Z}=this;if($[q]^=J,(J&128)!==0&&q===Z-1)this.keccak();$[Z-1]^=128,this.keccak()}writeInto($){b8(this,!1),c($),this.finish();let J=this.state,{blockLen:q}=this;for(let Z=0,X=$.length;Z<X;){if(this.posOut>=q)this.keccak();let Q=Math.min(q-this.posOut,X-Z);$.set(J.subarray(this.posOut,this.posOut+Q),Z),this.posOut+=Q,Z+=Q}return $}xofInto($){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto($)}xof($){return T8($),this.xofInto(new Uint8Array($))}digestInto($){if(q$($,this),this.finished)throw new Error("digest() was already called");return this.writeInto($),this.destroy(),$}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,B8(this.state)}_cloneInto($){let{blockLen:J,suffix:q,outputLen:Z,rounds:X,enableXOF:Q}=this;return $||=new b$(J,q,Z,Q,X),$.state32.set(this.state32),$.pos=this.pos,$.posOut=this.posOut,$.finished=this.finished,$.rounds=X,$.suffix=q,$.outputLen=Z,$.enableXOF=Q,$.destroyed=this.destroyed,$}}var M5=($,J,q,Z={})=>R0(()=>new b$(J,$,q),Z);var V5=M5(6,136,32,o8(8));var O5=M5(6,72,64,o8(10));var N5=($,J,q,Z={})=>R0((X={})=>new b$(J,$,X.dkLen===void 0?q:X.dkLen,!0),Z),B5=N5(31,168,16,o8(11)),h$=N5(31,136,32,o8(12));function lJ($){if(!Number.isSafeInteger($)||$<0||$>4294967295)throw new Error("wrong u32 integer:"+$);return $}function R5($){return lJ($),($&$-1)===0&&$!==0}function nJ($,J){lJ($);let q=0;for(let Z=0;Z<J;Z++,$>>>=1)q=q<<1|$&1;return q}function C5($){return lJ($),31-Math.clz32($)}function H5($){let J=$.length;if(J<2||!R5(J))throw new Error("n must be a power of 2 and greater than 1. Got "+J);let q=C5(J);for(let Z=0;Z<J;Z++){let X=nJ(Z,q);if(Z<X){let Q=$[Z];$[Z]=$[X],$[X]=Q}}return $}var iJ=($,J)=>{let{N:q,roots:Z,dit:X,invertButterflies:Q=!1,skipStages:G=0,brp:U=!0}=J,Y=C5(q);if(!R5(q))throw new Error("FFT: Polynomial size should be power of two");let z=X!==Q;return(W)=>{if(W.length!==q)throw new Error("FFT: wrong Polynomial length");if(X&&U)H5(W);for(let K=0,M=1;K<Y-G;K++){let O=X?K+1+G:Y-K,H=1<<O,E=H>>1,B=q>>O;for(let L=0;L<q;L+=H)for(let N=0,w=M++;N<E;N++){let f=Q?X?q-w:w:N*B,v=L+N,g=L+N+E,y=Z[f],F=W[g],j=W[v];if(z){let S=$.mul(F,y);W[v]=$.add(j,S),W[g]=$.sub(j,S)}else if(Q)W[v]=$.add(F,j),W[g]=$.mul($.sub(F,j),y);else W[v]=$.add(j,F),W[g]=$.mul($.sub(j,F),y)}}if(!X&&U)H5(W);return W}};/*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) */var oJ=Q0;function u$($,J){if($.length!==J.length)return!1;let q=0;for(let Z=0;Z<$.length;Z++)q|=$[Z]^J[Z];return q===0}function w5($){return Uint8Array.from($)}function e0($,...J){let q=(X)=>typeof X==="number"?X:X.bytesLen,Z=J.reduce((X,Q)=>X+q(Q),0);return{bytesLen:Z,encode:(X)=>{let Q=new Uint8Array(Z);for(let G=0,U=0;G<J.length;G++){let Y=J[G],z=q(Y),W=typeof Y==="number"?X[G]:Y.encode(X[G]);if(c(W,z,$),Q.set(W,U),typeof Y!=="number")W.fill(0);U+=z}return Q},decode:(X)=>{c(X,Z,$);let Q=[];for(let G of J){let U=q(G),Y=X.subarray(0,U);Q.push(typeof G==="number"?Y:G.decode(Y)),X=X.subarray(U)}return Q}}}function p$($,J){let q=J*$.bytesLen;return{bytesLen:q,encode:(Z)=>{if(Z.length!==J)throw new Error(`vecCoder.encode: wrong length=${Z.length}. Expected: ${J}`);let X=new Uint8Array(q);for(let Q=0,G=0;Q<Z.length;Q++){let U=$.encode(Z[Q]);X.set(U,G),U.fill(0),G+=U.length}return X},decode:(Z)=>{c(Z,q);let X=[];for(let Q=0;Q<Z.length;Q+=$.bytesLen)X.push($.decode(Z.subarray(Q,Q+$.bytesLen)));return X}}}function P8(...$){for(let J of $)if(Array.isArray(J))for(let q of J)q.fill(0);else J.fill(0)}function rJ($){return(1<<$)-1}var nU=Uint8Array.of();/*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) */var T5=($)=>{let{newPoly:J,N:q,Q:Z,F:X,ROOT_OF_UNITY:Q,brvBits:G,isKyber:U}=$,Y=(N,w=Z)=>{let f=N%w|0;return(f>=0?f|0:w+f|0)|0},z=(N,w=Z)=>{let f=Y(N,w)|0;return(f>w>>1?f-w|0:f)|0};function W(){let N=J(q);for(let w=0;w<q;w++){let f=nJ(w,G),v=BigInt(Q)**BigInt(f)%BigInt(Z);N[w]=Number(v)|0}return N}let K=W(),M={add:(N,w)=>Y((N|0)+(w|0))|0,sub:(N,w)=>Y((N|0)-(w|0))|0,mul:(N,w)=>Y((N|0)*(w|0))|0,inv:(N)=>{throw new Error("not implemented")}},O={N:q,roots:K,invertButterflies:!0,skipStages:U?1:0,brp:!1},H=iJ(M,{dit:!1,...O}),E=iJ(M,{dit:!0,...O});return{mod:Y,smod:z,nttZetas:K,NTT:{encode:(N)=>{return H(N)},decode:(N)=>{E(N);for(let w=0;w<N.length;w++)N[w]=Y(X*N[w]);return N}},bitsCoder:(N,w)=>{let f=rJ(N),v=N*(q/8);return{bytesLen:v,encode:(g)=>{let y=new Uint8Array(v);for(let F=0,j=0,S=0,m=0;F<g.length;F++){j|=(w.encode(g[F])&f)<<S,S+=N;for(;S>=8;S-=8,j>>=8)y[m++]=j&rJ(S)}return y},decode:(g)=>{let y=J(q);for(let F=0,j=0,S=0,m=0;F<g.length;F++){j|=g[F]<<S,S+=8;for(;S>=N;S-=N,j>>=N)y[m++]=w.decode(j&f)}return y}}}}},v4=($)=>(J,q)=>{if(!q)q=$.blockLen;let Z=new Uint8Array(J.length+2);Z.set(J);let X=J.length,Q=new Uint8Array(q),G=$.create({}),U=0,Y=0;return{stats:()=>({calls:U,xofs:Y}),get:(z,W)=>{return Z[X+0]=z,Z[X+1]=W,G.destroy(),G=$.create({}).update(Z),U++,()=>{return Y++,G.xofInto(Q)}},clean:()=>{G.destroy(),P8(Q,Z)}}},F5=v4(B5);/*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) */var D8=256,l8=3329,_4=3303,g4=17,{mod:J$,nttZetas:y4,NTT:V0,bitsCoder:m4}=T5({N:D8,Q:l8,F:_4,ROOT_OF_UNITY:g4,newPoly:($)=>new Uint16Array($),brvBits:7,isKyber:!0}),sJ={512:{N:D8,Q:l8,K:2,ETA1:3,ETA2:2,du:10,dv:4,RBGstrength:128},768:{N:D8,Q:l8,K:3,ETA1:2,ETA2:2,du:10,dv:4,RBGstrength:192},1024:{N:D8,Q:l8,K:4,ETA1:2,ETA2:2,du:11,dv:5,RBGstrength:256}},b4=($)=>{if($>=12)return{encode:(q)=>q,decode:(q)=>q};let J=2**($-1);return{encode:(q)=>((q<<$)+l8/2)/l8,decode:(q)=>q*l8+J>>>$}},t0=($)=>m4($,b4($));function O0($,J){for(let q=0;q<D8;q++)$[q]=J$($[q]+J[q])}function h4($,J){for(let q=0;q<D8;q++)$[q]=J$($[q]-J[q])}function u4($,J,q,Z,X){let Q=J$(J*Z*X+$*q),G=J$($*Z+J*q);return{c0:Q,c1:G}}function d$($,J){for(let q=0;q<D8/2;q++){let Z=y4[64+(q>>1)];if(q&1)Z=-Z;let{c0:X,c1:Q}=u4($[2*q+0],$[2*q+1],J[2*q+0],J[2*q+1],Z);$[2*q+0]=X,$[2*q+1]=Q}return $}function j5($){let J=new Uint16Array(D8);for(let q=0;q<D8;){let Z=$();if(Z.length%3)throw new Error("SampleNTT: unaligned block");for(let X=0;q<D8&&X+3<=Z.length;X+=3){let Q=(Z[X+0]>>0|Z[X+1]<<8)&4095,G=(Z[X+1]>>4|Z[X+2]<<4)&4095;if(Q<l8)J[q++]=Q;if(q<D8&&G<l8)J[q++]=G}}return J}function $$($,J,q,Z){let X=$(Z*D8/4,J,q),Q=new Uint16Array(D8),G=Z$(X),U=0;for(let Y=0,z=0,W=0,K=0;Y<G.length;Y++){let M=G[Y];for(let O=0;O<32;O++)if(W+=M&1,M>>=1,U+=1,U===Z)K=W,W=0;else if(U===2*Z)Q[z++]=J$(K-W),W=0,U=0}if(U)throw new Error(`sampleCBD: leftover bits: ${U}`);return Q}var p4=($)=>{let{K:J,PRF:q,XOF:Z,HASH512:X,ETA1:Q,ETA2:G,du:U,dv:Y}=$,z=t0(1),W=t0(Y),K=t0(U),M=e0("publicKey",p$(t0(12),J),32),O=p$(t0(12),J),H=e0("ciphertext",p$(K,J),W),E=e0("seed",32,32);return{secretCoder:O,lengths:{secretKey:O.bytesLen,publicKey:M.bytesLen,cipherText:H.bytesLen},keygen:(B)=>{c(B,32,"seed");let L=new Uint8Array(33);L.set(B),L[32]=J;let N=X(L),[w,f]=E.decode(N),v=[],g=[];for(let j=0;j<J;j++)v.push(V0.encode($$(q,f,j,Q)));let y=Z(w);for(let j=0;j<J;j++){let S=V0.encode($$(q,f,J+j,Q));for(let m=0;m<J;m++){let d=j5(y.get(m,j));O0(S,d$(d,v[m]))}g.push(S)}y.clean();let F={publicKey:M.encode([g,w]),secretKey:O.encode(v)};return P8(w,f,v,g,L,N),F},encrypt:(B,L,N)=>{let[w,f]=M.decode(B),v=[];for(let m=0;m<J;m++)v.push(V0.encode($$(q,N,m,Q)));let g=Z(f),y=new Uint16Array(D8),F=[];for(let m=0;m<J;m++){let d=$$(q,N,J+m,G),D=new Uint16Array(D8);for(let A=0;A<J;A++){let C=j5(g.get(m,A));O0(D,d$(C,v[A]))}O0(d,V0.decode(D)),F.push(d),O0(y,d$(w[m],v[m])),P8(D)}g.clean();let j=$$(q,N,2*J,G);O0(j,V0.decode(y));let S=z.decode(L);return O0(S,j),P8(w,v,y,j),H.encode([F,S])},decrypt:(B,L)=>{let[N,w]=H.decode(B),f=O.decode(L),v=new Uint16Array(D8);for(let g=0;g<J;g++)O0(v,d$(f[g],V0.encode(N[g])));return h4(w,V0.decode(v)),P8(v,f,N),z.encode(w)}}};function aJ($){let J=p4($),{HASH256:q,HASH512:Z,KDF:X}=$,{secretCoder:Q,lengths:G}=J,U=e0("secretKey",G.secretKey,G.publicKey,32,32),Y=32,z=64;return{info:{type:"ml-kem"},lengths:{...G,seed:64,msg:32,msgRand:32,secretKey:U.bytesLen},keygen:(W=oJ(64))=>{c(W,64,"seed");let{publicKey:K,secretKey:M}=J.keygen(W.subarray(0,32)),O=q(K),H=U.encode([M,K,O,W.subarray(32)]);return P8(M,O),{publicKey:K,secretKey:H}},getPublicKey:(W)=>{let[K,M,O,H]=U.decode(W);return Uint8Array.from(M)},encapsulate:(W,K=oJ(32))=>{c(W,G.publicKey,"publicKey"),c(K,32,"message");let M=W.subarray(0,384*$.K),O=Q.encode(Q.decode(w5(M)));if(!u$(O,M))throw P8(O),new Error("ML-KEM.encapsulate: wrong publicKey modulus");P8(O);let H=Z.create().update(K).update(q(W)).digest(),E=J.encrypt(W,K,H.subarray(32,64));return P8(H.subarray(32)),{cipherText:E,sharedSecret:H.subarray(0,32)}},decapsulate:(W,K)=>{c(K,U.bytesLen,"secretKey"),c(W,G.cipherText,"cipherText");let M=U.bytesLen-96,O=M+32,H=q(K.subarray(M/2,O));if(!u$(H,K.subarray(O,O+32)))throw new Error("invalid secretKey: hash check failed");let[E,B,L,N]=U.decode(K),w=J.decrypt(W,E),f=Z.create().update(w).update(L).digest(),v=f.subarray(0,32),g=J.encrypt(B,w,f.subarray(32,64)),y=u$(W,g),F=X.create({dkLen:32}).update(N).update(W).digest();return P8(w,g,!y?v:F),y?v:F}}}function d4($,J,q){return h$.create({dkLen:$}).update(J).update(new Uint8Array([q])).digest()}var eJ={HASH256:V5,HASH512:O5,KDF:h$,XOF:F5,PRF:d4},ZY=aJ({...eJ,...sJ[512]}),tJ=aJ({...eJ,...sJ[768]}),XY=aJ({...eJ,...sJ[1024]});function A5(){return{kemId:"ML-KEM-768",encapsulate:($)=>{let{cipherText:J,sharedSecret:q}=tJ.encapsulate($);return{sharedSecret:q,encapsulation:J}},decapsulate:($,J)=>{return tJ.decapsulate(J,$)}}}function L5($){globalThis.webaPqcKem=$}L5(A5());var P5=new cJ;window.GlobalSearch=P5;G5();P5.init();
