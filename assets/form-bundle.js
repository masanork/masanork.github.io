var d1=Object.create;var{getPrototypeOf:n1,defineProperty:n$,getOwnPropertyNames:i1}=Object;var o1=Object.prototype.hasOwnProperty;var i$=($,q,Q)=>{Q=$!=null?d1(n1($)):{};let J=q||!$||!$.__esModule?n$(Q,"default",{value:$,enumerable:!0}):Q;for(let G of i1($))if(!o1.call(J,G))n$(J,G,{get:()=>$[G],enumerable:!0});return J};var r1=($,q)=>()=>(q||$((q={exports:{}}).exports,q),q.exports);var O$=r1((sJ,cq)=>{cq.exports=function $(q){if(typeof q==="number"&&isNaN(q))throw new Error("NaN is not allowed");if(typeof q==="number"&&!isFinite(q))throw new Error("Infinity is not allowed");if(q===null||typeof q!=="object")return JSON.stringify(q);if(q.toJSON instanceof Function)return $(q.toJSON());if(Array.isArray(q))return`[${q.reduce((G,U,X)=>{return`${G}${X===0?"":","}${$(U===void 0||typeof U==="symbol"?null:U)}`},"")}]`;return`{${Object.keys(q).sort().reduce((J,G)=>{if(q[G]===void 0||typeof q[G]==="symbol")return J;let U=J.length===0?"":",";return`${J}${U}${$(G)}:${$(q[G])}`},"")}}`}});class s0{runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let q=$.dataset.copyFrom;if(q){let G=($.closest("tr")||document).querySelector(`[data-base-key="${q}"], [data-json-path="${q}"]`);if(G&&G.value!==$.value)$.value=G.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let q=$.dataset.formula;if(!q)return;let Q=$.closest("tr"),J=$.closest("table"),G=(X)=>{let Z=0,Y="none";if(Q){let M=`[data-base-key="${X}"], [data-json-path="${X}"]`,N=Q.querySelector(M);if(N){if(Y="row-input",N.value!=="")Z=parseFloat(N.value)}}if(Y==="none"){let M=document.querySelector(`[data-json-path="${X}"]`);if(M){if(Y="static-input",M.value!=="")Z=parseFloat(M.value)}}return Z},U=q.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(X,Z)=>{let Y=0,M=J||document,N=M.querySelectorAll(`[data-base-key="${Z}"], [data-json-path="${Z}"]`);if(N.length===0&&M!==document)N=document.querySelectorAll(`[data-base-key="${Z}"], [data-json-path="${Z}"]`);return N.forEach((L)=>{let E=parseFloat(L.value);if(!isNaN(E))Y+=E}),Y});U=U.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(X)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(X))return X;return String(G(X))});try{let X=new Function("return "+U)();if(typeof X==="number"&&!isNaN(X))$.value=Number.isInteger(X)?X:X.toFixed(0);else $.value=""}catch(X){console.error("Calc Error:",X),$.value="Err"}}),this.runAutoCopy()}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function z0($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function D8($,q=""){if(!Number.isSafeInteger($)||$<0){let Q=q&&`"${q}" `;throw new Error(`${Q}expected integer >= 0, got ${$}`)}}function d($,q,Q=""){let J=z0($),G=$?.length,U=q!==void 0;if(!J||U&&G!==q){let X=Q&&`"${Q}" `,Z=U?` of length ${q}`:"",Y=J?`length=${G}`:`type=${typeof $}`;throw new Error(X+"expected Uint8Array"+Z+", got "+Y)}return $}function $0($){if(typeof $!=="function"||typeof $.create!=="function")throw new Error("Hash must wrapped by utils.createHasher");D8($.outputLen),D8($.blockLen)}function l8($,q=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(q&&$.finished)throw new Error("Hash#digest() has already been called")}function r$($,q){d($,void 0,"digestInto() output");let Q=q.outputLen;if($.length<Q)throw new Error('"digestInto() output" expected to be of length >='+Q)}function z8(...$){for(let q=0;q<$.length;q++)$[q].fill(0)}function E0($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function E8($,q){return $<<32-q|$>>>q}var s$=(()=>typeof Uint8Array.from([]).toHex==="function"&&typeof Uint8Array.fromHex==="function")(),s1=Array.from({length:256},($,q)=>q.toString(16).padStart(2,"0"));function d8($){if(d($),s$)return $.toHex();let q="";for(let Q=0;Q<$.length;Q++)q+=s1[$[Q]];return q}var A8={_0:48,_9:57,A:65,F:70,a:97,f:102};function o$($){if($>=A8._0&&$<=A8._9)return $-A8._0;if($>=A8.A&&$<=A8.F)return $-(A8.A-10);if($>=A8.a&&$<=A8.f)return $-(A8.a-10);return}function q0($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);if(s$)return Uint8Array.fromHex($);let q=$.length,Q=q/2;if(q%2)throw new Error("hex string expected, got unpadded hex of length "+q);let J=new Uint8Array(Q);for(let G=0,U=0;G<Q;G++,U+=2){let X=o$($.charCodeAt(U)),Z=o$($.charCodeAt(U+1));if(X===void 0||Z===void 0){let Y=$[U]+$[U+1];throw new Error('hex string expected, got non-hex character "'+Y+'" at index '+U)}J[G]=X*16+Z}return J}function Q0(...$){let q=0;for(let J=0;J<$.length;J++){let G=$[J];d(G),q+=G.length}let Q=new Uint8Array(q);for(let J=0,G=0;J<$.length;J++){let U=$[J];Q.set(U,G),G+=U.length}return Q}function a0($,q={}){let Q=(G,U)=>$(U).update(G).digest(),J=$(void 0);return Q.outputLen=J.outputLen,Q.blockLen=J.blockLen,Q.create=(G)=>$(G),Object.assign(Q,q),Object.freeze(Q)}function J0($=32){let q=typeof globalThis==="object"?globalThis.crypto:null;if(typeof q?.getRandomValues!=="function")throw new Error("crypto.getRandomValues must be defined");return q.getRandomValues(new Uint8Array($))}var t0=($)=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,$])});function a$($,q,Q){return $&q^~$&Q}function t$($,q,Q){return $&q^$&Q^q&Q}class D0{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor($,q,Q,J){this.blockLen=$,this.outputLen=q,this.padOffset=Q,this.isLE=J,this.buffer=new Uint8Array($),this.view=E0(this.buffer)}update($){l8(this),d($);let{view:q,buffer:Q,blockLen:J}=this,G=$.length;for(let U=0;U<G;){let X=Math.min(J-this.pos,G-U);if(X===J){let Z=E0($);for(;J<=G-U;U+=J)this.process(Z,U);continue}if(Q.set($.subarray(U,U+X),this.pos),this.pos+=X,U+=X,this.pos===J)this.process(q,0),this.pos=0}return this.length+=$.length,this.roundClean(),this}digestInto($){l8(this),r$($,this),this.finished=!0;let{buffer:q,view:Q,blockLen:J,isLE:G}=this,{pos:U}=this;if(q[U++]=128,z8(this.buffer.subarray(U)),this.padOffset>J-U)this.process(Q,0),U=0;for(let N=U;N<J;N++)q[N]=0;Q.setBigUint64(J-8,BigInt(this.length*8),G),this.process(Q,0);let X=E0($),Z=this.outputLen;if(Z%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let Y=Z/4,M=this.get();if(Y>M.length)throw new Error("_sha2: outputLen bigger than state");for(let N=0;N<Y;N++)X.setUint32(4*N,M[N],G)}digest(){let{buffer:$,outputLen:q}=this;this.digestInto($);let Q=$.slice(0,q);return this.destroy(),Q}_cloneInto($){$||=new this.constructor,$.set(...this.get());let{blockLen:q,buffer:Q,length:J,finished:G,destroyed:U,pos:X}=this;if($.destroyed=U,$.finished=G,$.length=J,$.pos=X,J%q)$.buffer.set(Q);return $}clone(){return this._cloneInto()}}var w8=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),j8=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),q8=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Q8=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var H0=BigInt(4294967295),e$=BigInt(32);function a1($,q=!1){if(q)return{h:Number($&H0),l:Number($>>e$&H0)};return{h:Number($>>e$&H0)|0,l:Number($&H0)|0}}function $q($,q=!1){let Q=$.length,J=new Uint32Array(Q),G=new Uint32Array(Q);for(let U=0;U<Q;U++){let{h:X,l:Z}=a1($[U],q);[J[U],G[U]]=[X,Z]}return[J,G]}var e0=($,q,Q)=>$>>>Q,$$=($,q,Q)=>$<<32-Q|q>>>Q,v8=($,q,Q)=>$>>>Q|q<<32-Q,g8=($,q,Q)=>$<<32-Q|q>>>Q,G0=($,q,Q)=>$<<64-Q|q>>>Q-32,U0=($,q,Q)=>$>>>Q-32|q<<64-Q;function H8($,q,Q,J){let G=(q>>>0)+(J>>>0);return{h:$+Q+(G/4294967296|0)|0,l:G|0}}var qq=($,q,Q)=>($>>>0)+(q>>>0)+(Q>>>0),Qq=($,q,Q,J)=>q+Q+J+($/4294967296|0)|0,Jq=($,q,Q,J)=>($>>>0)+(q>>>0)+(Q>>>0)+(J>>>0),Gq=($,q,Q,J,G)=>q+Q+J+G+($/4294967296|0)|0,Uq=($,q,Q,J,G)=>($>>>0)+(q>>>0)+(Q>>>0)+(J>>>0)+(G>>>0),Xq=($,q,Q,J,G,U)=>q+Q+J+G+U+($/4294967296|0)|0;var e1=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),F8=new Uint32Array(64);class q$ extends D0{constructor($){super(64,$,8,!1)}get(){let{A:$,B:q,C:Q,D:J,E:G,F:U,G:X,H:Z}=this;return[$,q,Q,J,G,U,X,Z]}set($,q,Q,J,G,U,X,Z){this.A=$|0,this.B=q|0,this.C=Q|0,this.D=J|0,this.E=G|0,this.F=U|0,this.G=X|0,this.H=Z|0}process($,q){for(let N=0;N<16;N++,q+=4)F8[N]=$.getUint32(q,!1);for(let N=16;N<64;N++){let L=F8[N-15],E=F8[N-2],I=E8(L,7)^E8(L,18)^L>>>3,w=E8(E,17)^E8(E,19)^E>>>10;F8[N]=w+F8[N-7]+I+F8[N-16]|0}let{A:Q,B:J,C:G,D:U,E:X,F:Z,G:Y,H:M}=this;for(let N=0;N<64;N++){let L=E8(X,6)^E8(X,11)^E8(X,25),E=M+L+a$(X,Z,Y)+e1[N]+F8[N]|0,w=(E8(Q,2)^E8(Q,13)^E8(Q,22))+t$(Q,J,G)|0;M=Y,Y=Z,Z=X,X=U+E|0,U=G,G=J,J=Q,Q=E+w|0}Q=Q+this.A|0,J=J+this.B|0,G=G+this.C|0,U=U+this.D|0,X=X+this.E|0,Z=Z+this.F|0,Y=Y+this.G|0,M=M+this.H|0,this.set(Q,J,G,U,X,Z,Y,M)}roundClean(){z8(F8)}destroy(){this.set(0,0,0,0,0,0,0,0),z8(this.buffer)}}class Yq extends q${A=w8[0]|0;B=w8[1]|0;C=w8[2]|0;D=w8[3]|0;E=w8[4]|0;F=w8[5]|0;G=w8[6]|0;H=w8[7]|0;constructor(){super(32)}}class $Q extends q${A=j8[0]|0;B=j8[1]|0;C=j8[2]|0;D=j8[3]|0;E=j8[4]|0;F=j8[5]|0;G=j8[6]|0;H=j8[7]|0;constructor(){super(28)}}var Zq=(()=>$q(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(($)=>BigInt($))))(),qQ=(()=>Zq[0])(),QQ=(()=>Zq[1])(),P8=new Uint32Array(80),x8=new Uint32Array(80);class X0 extends D0{constructor($){super(128,$,16,!1)}get(){let{Ah:$,Al:q,Bh:Q,Bl:J,Ch:G,Cl:U,Dh:X,Dl:Z,Eh:Y,El:M,Fh:N,Fl:L,Gh:E,Gl:I,Hh:w,Hl:_}=this;return[$,q,Q,J,G,U,X,Z,Y,M,N,L,E,I,w,_]}set($,q,Q,J,G,U,X,Z,Y,M,N,L,E,I,w,_){this.Ah=$|0,this.Al=q|0,this.Bh=Q|0,this.Bl=J|0,this.Ch=G|0,this.Cl=U|0,this.Dh=X|0,this.Dl=Z|0,this.Eh=Y|0,this.El=M|0,this.Fh=N|0,this.Fl=L|0,this.Gh=E|0,this.Gl=I|0,this.Hh=w|0,this.Hl=_|0}process($,q){for(let A=0;A<16;A++,q+=4)P8[A]=$.getUint32(q),x8[A]=$.getUint32(q+=4);for(let A=16;A<80;A++){let D=P8[A-15]|0,k=x8[A-15]|0,y=v8(D,k,1)^v8(D,k,8)^e0(D,k,7),m=g8(D,k,1)^g8(D,k,8)^$$(D,k,7),p=P8[A-2]|0,j=x8[A-2]|0,x=v8(p,j,19)^G0(p,j,61)^e0(p,j,6),F=g8(p,j,19)^U0(p,j,61)^$$(p,j,6),c=Jq(m,F,x8[A-7],x8[A-16]),h=Gq(c,y,x,P8[A-7],P8[A-16]);P8[A]=h|0,x8[A]=c|0}let{Ah:Q,Al:J,Bh:G,Bl:U,Ch:X,Cl:Z,Dh:Y,Dl:M,Eh:N,El:L,Fh:E,Fl:I,Gh:w,Gl:_,Hh:H,Hl:V}=this;for(let A=0;A<80;A++){let D=v8(N,L,14)^v8(N,L,18)^G0(N,L,41),k=g8(N,L,14)^g8(N,L,18)^U0(N,L,41),y=N&E^~N&w,m=L&I^~L&_,p=Uq(V,k,m,QQ[A],x8[A]),j=Xq(p,H,D,y,qQ[A],P8[A]),x=p|0,F=v8(Q,J,28)^G0(Q,J,34)^G0(Q,J,39),c=g8(Q,J,28)^U0(Q,J,34)^U0(Q,J,39),h=Q&G^Q&X^G&X,O=J&U^J&Z^U&Z;H=w|0,V=_|0,w=E|0,_=I|0,E=N|0,I=L|0,{h:N,l:L}=H8(Y|0,M|0,j|0,x|0),Y=X|0,M=Z|0,X=G|0,Z=U|0,G=Q|0,U=J|0;let T=qq(x,c,O);Q=Qq(T,j,F,h),J=T|0}({h:Q,l:J}=H8(this.Ah|0,this.Al|0,Q|0,J|0)),{h:G,l:U}=H8(this.Bh|0,this.Bl|0,G|0,U|0),{h:X,l:Z}=H8(this.Ch|0,this.Cl|0,X|0,Z|0),{h:Y,l:M}=H8(this.Dh|0,this.Dl|0,Y|0,M|0),{h:N,l:L}=H8(this.Eh|0,this.El|0,N|0,L|0),{h:E,l:I}=H8(this.Fh|0,this.Fl|0,E|0,I|0),{h:w,l:_}=H8(this.Gh|0,this.Gl|0,w|0,_|0),{h:H,l:V}=H8(this.Hh|0,this.Hl|0,H|0,V|0),this.set(Q,J,G,U,X,Z,Y,M,N,L,E,I,w,_,H,V)}roundClean(){z8(P8,x8)}destroy(){z8(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Nq extends X0{Ah=Q8[0]|0;Al=Q8[1]|0;Bh=Q8[2]|0;Bl=Q8[3]|0;Ch=Q8[4]|0;Cl=Q8[5]|0;Dh=Q8[6]|0;Dl=Q8[7]|0;Eh=Q8[8]|0;El=Q8[9]|0;Fh=Q8[10]|0;Fl=Q8[11]|0;Gh=Q8[12]|0;Gl=Q8[13]|0;Hh=Q8[14]|0;Hl=Q8[15]|0;constructor(){super(64)}}class JQ extends X0{Ah=q8[0]|0;Al=q8[1]|0;Bh=q8[2]|0;Bl=q8[3]|0;Ch=q8[4]|0;Cl=q8[5]|0;Dh=q8[6]|0;Dl=q8[7]|0;Eh=q8[8]|0;El=q8[9]|0;Fh=q8[10]|0;Fl=q8[11]|0;Gh=q8[12]|0;Gl=q8[13]|0;Hh=q8[14]|0;Hl=q8[15]|0;constructor(){super(48)}}var J8=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),G8=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class GQ extends X0{Ah=J8[0]|0;Al=J8[1]|0;Bh=J8[2]|0;Bl=J8[3]|0;Ch=J8[4]|0;Cl=J8[5]|0;Dh=J8[6]|0;Dl=J8[7]|0;Eh=J8[8]|0;El=J8[9]|0;Fh=J8[10]|0;Fl=J8[11]|0;Gh=J8[12]|0;Gl=J8[13]|0;Hh=J8[14]|0;Hl=J8[15]|0;constructor(){super(28)}}class UQ extends X0{Ah=G8[0]|0;Al=G8[1]|0;Bh=G8[2]|0;Bl=G8[3]|0;Ch=G8[4]|0;Cl=G8[5]|0;Dh=G8[6]|0;Dl=G8[7]|0;Eh=G8[8]|0;El=G8[9]|0;Fh=G8[10]|0;Fl=G8[11]|0;Gh=G8[12]|0;Gl=G8[13]|0;Hh=G8[14]|0;Hl=G8[15]|0;constructor(){super(32)}}var X8=a0(()=>new Yq,t0(1));var Kq=a0(()=>new Nq,t0(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Mq=BigInt(0),Oq=BigInt(1);function R0($,q=""){if(typeof $!=="boolean"){let Q=q&&`"${q}" `;throw new Error(Q+"expected boolean, got type="+typeof $)}return $}function XQ($){if(typeof $==="bigint"){if(!T0($))throw new Error("positive bigint expected, got "+$)}else D8($);return $}function Wq($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);return $===""?Mq:BigInt("0x"+$)}function Lq($){return Wq(d8($))}function V8($){return Wq(d8(m8(d($)).reverse()))}function Q$($,q){D8(q),$=XQ($);let Q=q0($.toString(16).padStart(q*2,"0"));if(Q.length!==q)throw new Error("number too large");return Q}function I0($,q){return Q$($,q).reverse()}function m8($){return Uint8Array.from($)}var T0=($)=>typeof $==="bigint"&&Mq<=$;function YQ($,q,Q){return T0($)&&T0(q)&&T0(Q)&&q<=$&&$<Q}function n8($,q,Q,J){if(!YQ(q,Q,J))throw new Error("expected valid "+$+": "+Q+" <= n < "+J+", got "+q)}var Cq=($)=>(Oq<<BigInt($))-Oq;function b8($,q={},Q={}){if(!$||typeof $!=="object")throw new Error("expected valid options object");function J(U,X,Z){let Y=$[U];if(Z&&Y===void 0)return;let M=typeof Y;if(M!==X||Y===null)throw new Error(`param "${U}" is invalid: expected ${X}, got ${M}`)}let G=(U,X)=>Object.entries(U).forEach(([Z,Y])=>J(Z,Y,X));G(q,!1),G(Q,!0)}function J$($){let q=new WeakMap;return(Q,...J)=>{let G=q.get(Q);if(G!==void 0)return G;let U=$(Q,...J);return q.set(Q,U),U}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Y8=BigInt(0),U8=BigInt(1),h8=BigInt(2),Dq=BigInt(3),Hq=BigInt(4),Tq=BigInt(5),ZQ=BigInt(7),Rq=BigInt(8),NQ=BigInt(9),Iq=BigInt(16);function i($,q){let Q=$%q;return Q>=Y8?Q:q+Q}function W8($,q,Q){let J=$;while(q-- >Y8)J*=J,J%=Q;return J}function zq($,q){if($===Y8)throw new Error("invert: expected non-zero number");if(q<=Y8)throw new Error("invert: expected positive modulus, got "+q);let Q=i($,q),J=q,G=Y8,U=U8,X=U8,Z=Y8;while(Q!==Y8){let M=J/Q,N=J%Q,L=G-X*M,E=U-Z*M;J=Q,Q=N,G=X,U=Z,X=L,Z=E}if(J!==U8)throw new Error("invert: does not exist");return i(G,q)}function G$($,q,Q){if(!$.eql($.sqr(q),Q))throw new Error("Cannot find square root")}function Bq($,q){let Q=($.ORDER+U8)/Hq,J=$.pow(q,Q);return G$($,J,q),J}function KQ($,q){let Q=($.ORDER-Tq)/Rq,J=$.mul(q,h8),G=$.pow(J,Q),U=$.mul(q,G),X=$.mul($.mul(U,h8),G),Z=$.mul(U,$.sub(X,$.ONE));return G$($,Z,q),Z}function OQ($){let q=A0($),Q=Aq($),J=Q(q,q.neg(q.ONE)),G=Q(q,J),U=Q(q,q.neg(J)),X=($+ZQ)/Iq;return(Z,Y)=>{let M=Z.pow(Y,X),N=Z.mul(M,J),L=Z.mul(M,G),E=Z.mul(M,U),I=Z.eql(Z.sqr(N),Y),w=Z.eql(Z.sqr(L),Y);M=Z.cmov(M,N,I),N=Z.cmov(E,L,w);let _=Z.eql(Z.sqr(N),Y),H=Z.cmov(M,N,_);return G$(Z,H,Y),H}}function Aq($){if($<Dq)throw new Error("sqrt is not defined for small field");let q=$-U8,Q=0;while(q%h8===Y8)q/=h8,Q++;let J=h8,G=A0($);while(Eq(G,J)===1)if(J++>1000)throw new Error("Cannot find square root: probably non-prime P");if(Q===1)return Bq;let U=G.pow(J,q),X=(q+U8)/h8;return function Z(Y,M){if(Y.is0(M))return M;if(Eq(Y,M)!==1)throw new Error("Cannot find square root");let N=Q,L=Y.mul(Y.ONE,U),E=Y.pow(M,q),I=Y.pow(M,X);while(!Y.eql(E,Y.ONE)){if(Y.is0(E))return Y.ZERO;let w=1,_=Y.sqr(E);while(!Y.eql(_,Y.ONE))if(w++,_=Y.sqr(_),w===N)throw new Error("Cannot find square root");let H=U8<<BigInt(N-w-1),V=Y.pow(L,H);N=w,L=Y.sqr(V),E=Y.mul(E,L),I=Y.mul(I,V)}return I}}function MQ($){if($%Hq===Dq)return Bq;if($%Rq===Tq)return KQ;if($%Iq===NQ)return OQ($);return Aq($)}var wq=($,q)=>(i($,q)&U8)===U8,WQ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function jq($){let q={ORDER:"bigint",BYTES:"number",BITS:"number"},Q=WQ.reduce((J,G)=>{return J[G]="function",J},q);return b8($,Q),$}function LQ($,q,Q){if(Q<Y8)throw new Error("invalid exponent, negatives unsupported");if(Q===Y8)return $.ONE;if(Q===U8)return q;let J=$.ONE,G=q;while(Q>Y8){if(Q&U8)J=$.mul(J,G);G=$.sqr(G),Q>>=U8}return J}function B0($,q,Q=!1){let J=new Array(q.length).fill(Q?$.ZERO:void 0),G=q.reduce((X,Z,Y)=>{if($.is0(Z))return X;return J[Y]=X,$.mul(X,Z)},$.ONE),U=$.inv(G);return q.reduceRight((X,Z,Y)=>{if($.is0(Z))return X;return J[Y]=$.mul(X,J[Y]),$.mul(X,Z)},U),J}function Eq($,q){let Q=($.ORDER-U8)/h8,J=$.pow(q,Q),G=$.eql(J,$.ONE),U=$.eql(J,$.ZERO),X=$.eql(J,$.neg($.ONE));if(!G&&!U&&!X)throw new Error("invalid Legendre symbol result");return G?1:U?0:-1}function CQ($,q){if(q!==void 0)D8(q);let Q=q!==void 0?q:$.toString(2).length,J=Math.ceil(Q/8);return{nBitLength:Q,nByteLength:J}}class Vq{ORDER;BITS;BYTES;isLE;ZERO=Y8;ONE=U8;_lengths;_sqrt;_mod;constructor($,q={}){if($<=Y8)throw new Error("invalid field: expected ORDER > 0, got "+$);let Q=void 0;if(this.isLE=!1,q!=null&&typeof q==="object"){if(typeof q.BITS==="number")Q=q.BITS;if(typeof q.sqrt==="function")this.sqrt=q.sqrt;if(typeof q.isLE==="boolean")this.isLE=q.isLE;if(q.allowedLengths)this._lengths=q.allowedLengths?.slice();if(typeof q.modFromBytes==="boolean")this._mod=q.modFromBytes}let{nBitLength:J,nByteLength:G}=CQ($,Q);if(G>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=$,this.BITS=J,this.BYTES=G,this._sqrt=void 0,Object.preventExtensions(this)}create($){return i($,this.ORDER)}isValid($){if(typeof $!=="bigint")throw new Error("invalid field element: expected bigint, got "+typeof $);return Y8<=$&&$<this.ORDER}is0($){return $===Y8}isValidNot0($){return!this.is0($)&&this.isValid($)}isOdd($){return($&U8)===U8}neg($){return i(-$,this.ORDER)}eql($,q){return $===q}sqr($){return i($*$,this.ORDER)}add($,q){return i($+q,this.ORDER)}sub($,q){return i($-q,this.ORDER)}mul($,q){return i($*q,this.ORDER)}pow($,q){return LQ(this,$,q)}div($,q){return i($*zq(q,this.ORDER),this.ORDER)}sqrN($){return $*$}addN($,q){return $+q}subN($,q){return $-q}mulN($,q){return $*q}inv($){return zq($,this.ORDER)}sqrt($){if(!this._sqrt)this._sqrt=MQ(this.ORDER);return this._sqrt(this,$)}toBytes($){return this.isLE?I0($,this.BYTES):Q$($,this.BYTES)}fromBytes($,q=!1){d($);let{_lengths:Q,BYTES:J,isLE:G,ORDER:U,_mod:X}=this;if(Q){if(!Q.includes($.length)||$.length>J)throw new Error("Field.fromBytes: expected "+Q+" bytes, got "+$.length);let Y=new Uint8Array(J);Y.set($,G?0:Y.length-$.length),$=Y}if($.length!==J)throw new Error("Field.fromBytes: expected "+J+" bytes, got "+$.length);let Z=G?V8($):Lq($);if(X)Z=i(Z,U);if(!q){if(!this.isValid(Z))throw new Error("invalid field element: outside of range 0..ORDER")}return Z}invertBatch($){return B0(this,$)}cmov($,q,Q){return Q?q:$}}function A0($,q={}){return new Vq($,q)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var w0=BigInt(0),Z$=BigInt(1);function fq($,q){let Q=q.negate();return $?Q:q}function j0($,q){let Q=B0($.Fp,q.map((J)=>J.Z));return q.map((J,G)=>$.fromAffine(J.toAffine(Q[G])))}function kq($,q){if(!Number.isSafeInteger($)||$<=0||$>q)throw new Error("invalid window size, expected [1.."+q+"], got W="+$)}function U$($,q){kq($,q);let Q=Math.ceil(q/$)+1,J=2**($-1),G=2**$,U=Cq($),X=BigInt($);return{windows:Q,windowSize:J,mask:U,maxNumber:G,shiftBy:X}}function Fq($,q,Q){let{windowSize:J,mask:G,maxNumber:U,shiftBy:X}=Q,Z=Number($&G),Y=$>>X;if(Z>J)Z-=U,Y+=Z$;let M=q*J,N=M+Math.abs(Z)-1,L=Z===0,E=Z<0,I=q%2!==0;return{nextN:Y,offset:N,isZero:L,isNeg:E,isNegF:I,offsetF:M}}var X$=new WeakMap,_q=new WeakMap;function Y$($){return _q.get($)||1}function Pq($){if($!==w0)throw new Error("invalid wNAF")}class N${BASE;ZERO;Fn;bits;constructor($,q){this.BASE=$.BASE,this.ZERO=$.ZERO,this.Fn=$.Fn,this.bits=q}_unsafeLadder($,q,Q=this.ZERO){let J=$;while(q>w0){if(q&Z$)Q=Q.add(J);J=J.double(),q>>=Z$}return Q}precomputeWindow($,q){let{windows:Q,windowSize:J}=U$(q,this.bits),G=[],U=$,X=U;for(let Z=0;Z<Q;Z++){X=U,G.push(X);for(let Y=1;Y<J;Y++)X=X.add(U),G.push(X);U=X.double()}return G}wNAF($,q,Q){if(!this.Fn.isValid(Q))throw new Error("invalid scalar");let J=this.ZERO,G=this.BASE,U=U$($,this.bits);for(let X=0;X<U.windows;X++){let{nextN:Z,offset:Y,isZero:M,isNeg:N,isNegF:L,offsetF:E}=Fq(Q,X,U);if(Q=Z,M)G=G.add(fq(L,q[E]));else J=J.add(fq(N,q[Y]))}return Pq(Q),{p:J,f:G}}wNAFUnsafe($,q,Q,J=this.ZERO){let G=U$($,this.bits);for(let U=0;U<G.windows;U++){if(Q===w0)break;let{nextN:X,offset:Z,isZero:Y,isNeg:M}=Fq(Q,U,G);if(Q=X,Y)continue;else{let N=q[Z];J=J.add(M?N.negate():N)}}return Pq(Q),J}getPrecomputes($,q,Q){let J=X$.get(q);if(!J){if(J=this.precomputeWindow(q,$),$!==1){if(typeof Q==="function")J=Q(J);X$.set(q,J)}}return J}cached($,q,Q){let J=Y$($);return this.wNAF(J,this.getPrecomputes(J,$,Q),q)}unsafe($,q,Q,J){let G=Y$($);if(G===1)return this._unsafeLadder($,q,J);return this.wNAFUnsafe(G,this.getPrecomputes(G,$,Q),q,J)}createCache($,q){kq(q,this.bits),_q.set($,q),X$.delete($)}hasCache($){return Y$($)!==1}}function xq($,q,Q){if(q){if(q.ORDER!==$)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return jq(q),q}else return A0($,{isLE:Q})}function Sq($,q,Q={},J){if(J===void 0)J=$==="edwards";if(!q||typeof q!=="object")throw new Error(`expected valid ${$} CURVE object`);for(let Y of["p","n","h"]){let M=q[Y];if(!(typeof M==="bigint"&&M>w0))throw new Error(`CURVE.${Y} must be positive bigint`)}let G=xq(q.p,Q.Fp,J),U=xq(q.n,Q.Fn,J),Z=["Gx","Gy","a",$==="weierstrass"?"b":"d"];for(let Y of Z)if(!G.isValid(q[Y]))throw new Error(`CURVE.${Y} must be valid field element of CURVE.Fp`);return q=Object.freeze(Object.assign({},q)),{CURVE:q,Fp:G,Fn:U}}function V0($,q){return function Q(J){let G=$(J);return{secretKey:G,publicKey:q(G)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var k8=BigInt(0),e=BigInt(1),K$=BigInt(2),zQ=BigInt(8);function EQ($,q,Q,J){let G=$.sqr(Q),U=$.sqr(J),X=$.add($.mul(q.a,G),U),Z=$.add($.ONE,$.mul(q.d,$.mul(G,U)));return $.eql(X,Z)}function yq($,q={}){let Q=Sq("edwards",$,q,q.FpFnLE),{Fp:J,Fn:G}=Q,U=Q.CURVE,{h:X}=U;b8(q,{},{uvRatio:"function"});let Z=K$<<BigInt(G.BYTES*8)-e,Y=(H)=>J.create(H),M=q.uvRatio||((H,V)=>{try{return{isValid:!0,value:J.sqrt(J.div(H,V))}}catch(A){return{isValid:!1,value:k8}}});if(!EQ(J,U,U.Gx,U.Gy))throw new Error("bad curve params: generator point");function N(H,V,A=!1){let D=A?e:k8;return n8("coordinate "+H,V,D,Z),V}function L(H){if(!(H instanceof w))throw new Error("EdwardsPoint expected")}let E=J$((H,V)=>{let{X:A,Y:D,Z:k}=H,y=H.is0();if(V==null)V=y?zQ:J.inv(k);let m=Y(A*V),p=Y(D*V),j=J.mul(k,V);if(y)return{x:k8,y:e};if(j!==e)throw new Error("invZ was invalid");return{x:m,y:p}}),I=J$((H)=>{let{a:V,d:A}=U;if(H.is0())throw new Error("bad point: ZERO");let{X:D,Y:k,Z:y,T:m}=H,p=Y(D*D),j=Y(k*k),x=Y(y*y),F=Y(x*x),c=Y(p*V),h=Y(x*Y(c+j)),O=Y(F+Y(A*Y(p*j)));if(h!==O)throw new Error("bad point: equation left != right (1)");let T=Y(D*k),C=Y(y*m);if(T!==C)throw new Error("bad point: equation left != right (2)");return!0});class w{static BASE=new w(U.Gx,U.Gy,e,Y(U.Gx*U.Gy));static ZERO=new w(k8,e,e,k8);static Fp=J;static Fn=G;X;Y;Z;T;constructor(H,V,A,D){this.X=N("x",H),this.Y=N("y",V),this.Z=N("z",A,!0),this.T=N("t",D),Object.freeze(this)}static CURVE(){return U}static fromAffine(H){if(H instanceof w)throw new Error("extended point not allowed");let{x:V,y:A}=H||{};return N("x",V),N("y",A),new w(V,A,e,Y(V*A))}static fromBytes(H,V=!1){let A=J.BYTES,{a:D,d:k}=U;H=m8(d(H,A,"point")),R0(V,"zip215");let y=m8(H),m=H[A-1];y[A-1]=m&-129;let p=V8(y),j=V?Z:J.ORDER;n8("point.y",p,k8,j);let x=Y(p*p),F=Y(x-e),c=Y(k*x-D),{isValid:h,value:O}=M(F,c);if(!h)throw new Error("bad point: invalid y coordinate");let T=(O&e)===e,C=(m&128)!==0;if(!V&&O===k8&&C)throw new Error("bad point: x=0 and x_0=1");if(C!==T)O=Y(-O);return w.fromAffine({x:O,y:p})}static fromHex(H,V=!1){return w.fromBytes(q0(H),V)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(H=8,V=!0){if(_.createCache(this,H),!V)this.multiply(K$);return this}assertValidity(){I(this)}equals(H){L(H);let{X:V,Y:A,Z:D}=this,{X:k,Y:y,Z:m}=H,p=Y(V*m),j=Y(k*D),x=Y(A*m),F=Y(y*D);return p===j&&x===F}is0(){return this.equals(w.ZERO)}negate(){return new w(Y(-this.X),this.Y,this.Z,Y(-this.T))}double(){let{a:H}=U,{X:V,Y:A,Z:D}=this,k=Y(V*V),y=Y(A*A),m=Y(K$*Y(D*D)),p=Y(H*k),j=V+A,x=Y(Y(j*j)-k-y),F=p+y,c=F-m,h=p-y,O=Y(x*c),T=Y(F*h),C=Y(x*h),R=Y(c*F);return new w(O,T,R,C)}add(H){L(H);let{a:V,d:A}=U,{X:D,Y:k,Z:y,T:m}=this,{X:p,Y:j,Z:x,T:F}=H,c=Y(D*p),h=Y(k*j),O=Y(m*A*F),T=Y(y*x),C=Y((D+k)*(p+j)-c-h),R=T-O,B=T+O,f=Y(h-V*c),S=Y(C*R),v=Y(B*f),g=Y(C*f),b=Y(R*B);return new w(S,v,b,g)}subtract(H){return this.add(H.negate())}multiply(H){if(!G.isValidNot0(H))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:V,f:A}=_.cached(this,H,(D)=>j0(w,D));return j0(w,[V,A])[0]}multiplyUnsafe(H,V=w.ZERO){if(!G.isValid(H))throw new Error("invalid scalar: expected 0 <= sc < curve.n");if(H===k8)return w.ZERO;if(this.is0()||H===e)return this;return _.unsafe(this,H,(A)=>j0(w,A),V)}isSmallOrder(){return this.multiplyUnsafe(X).is0()}isTorsionFree(){return _.unsafe(this,U.n).is0()}toAffine(H){return E(this,H)}clearCofactor(){if(X===e)return this;return this.multiplyUnsafe(X)}toBytes(){let{x:H,y:V}=this.toAffine(),A=J.toBytes(V);return A[A.length-1]|=H&e?128:0,A}toHex(){return d8(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let _=new N$(w,G.BITS);return w.BASE.precompute(8),w}function vq($,q,Q={}){if(typeof q!=="function")throw new Error('"hash" function param is required');b8(Q,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:J}=Q,{BASE:G,Fp:U,Fn:X}=$,Z=Q.randomBytes||J0,Y=Q.adjustScalarBytes||((j)=>j),M=Q.domain||((j,x,F)=>{if(R0(F,"phflag"),x.length||F)throw new Error("Contexts/pre-hash are not supported");return j});function N(j){return X.create(V8(j))}function L(j){let x=D.secretKey;d(j,D.secretKey,"secretKey");let F=d(q(j),2*x,"hashedSecretKey"),c=Y(F.slice(0,x)),h=F.slice(x,2*x),O=N(c);return{head:c,prefix:h,scalar:O}}function E(j){let{head:x,prefix:F,scalar:c}=L(j),h=G.multiply(c),O=h.toBytes();return{head:x,prefix:F,scalar:c,point:h,pointBytes:O}}function I(j){return E(j).pointBytes}function w(j=Uint8Array.of(),...x){let F=Q0(...x);return N(q(M(F,d(j,void 0,"context"),!!J)))}function _(j,x,F={}){if(j=d(j,void 0,"message"),J)j=J(j);let{prefix:c,scalar:h,pointBytes:O}=E(x),T=w(F.context,c,j),C=G.multiply(T).toBytes(),R=w(F.context,C,O,j),B=X.create(T+R*h);if(!X.isValid(B))throw new Error("sign failed: invalid s");let f=Q0(C,X.toBytes(B));return d(f,D.signature,"result")}let H={zip215:!0};function V(j,x,F,c=H){let{context:h,zip215:O}=c,T=D.signature;if(j=d(j,T,"signature"),x=d(x,void 0,"message"),F=d(F,D.publicKey,"publicKey"),O!==void 0)R0(O,"zip215");if(J)x=J(x);let C=T/2,R=j.subarray(0,C),B=V8(j.subarray(C,T)),f,S,v;try{f=$.fromBytes(F,O),S=$.fromBytes(R,O),v=G.multiplyUnsafe(B)}catch(e8){return!1}if(!O&&f.isSmallOrder())return!1;let g=w(h,S.toBytes(),f.toBytes(),x);return S.add(f.multiplyUnsafe(g)).subtract(v).clearCofactor().is0()}let A=U.BYTES,D={secretKey:A,publicKey:A,signature:2*A,seed:A};function k(j=Z(D.seed)){return d(j,D.seed,"seed")}function y(j){return z0(j)&&j.length===X.BYTES}function m(j,x){try{return!!$.fromBytes(j,x)}catch(F){return!1}}let p={getExtendedPublicKey:E,randomSecretKey:k,isValidSecretKey:y,isValidPublicKey:m,toMontgomery(j){let{y:x}=$.fromBytes(j),F=D.publicKey,c=F===32;if(!c&&F!==57)throw new Error("only defined for 25519 and 448");let h=c?U.div(e+x,e-x):U.div(x-e,x+e);return U.toBytes(h)},toMontgomerySecret(j){let x=D.secretKey;d(j,x);let F=q(j.subarray(0,x));return Y(F).subarray(0,x)}};return Object.freeze({keygen:V0(k,I),getPublicKey:I,sign:_,verify:V,utils:p,Point:$,lengths:D})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Y0=BigInt(0),i8=BigInt(1),f0=BigInt(2);function DQ($){return b8($,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...$})}function gq($){let q=DQ($),{P:Q,type:J,adjustScalarBytes:G,powPminus2:U,randomBytes:X}=q,Z=J==="x25519";if(!Z&&J!=="x448")throw new Error("invalid type");let Y=X||J0,M=Z?255:448,N=Z?32:56,L=Z?BigInt(9):BigInt(5),E=Z?BigInt(121665):BigInt(39081),I=Z?f0**BigInt(254):f0**BigInt(447),w=Z?BigInt(8)*f0**BigInt(251)-i8:BigInt(4)*f0**BigInt(445)-i8,_=I+w+i8,H=(T)=>i(T,Q),V=A(L);function A(T){return I0(H(T),N)}function D(T){let C=m8(d(T,N,"uCoordinate"));if(Z)C[31]&=127;return H(V8(C))}function k(T){return V8(G(m8(d(T,N,"scalar"))))}function y(T,C){let R=F(D(C),k(T));if(R===Y0)throw new Error("invalid private or public key received");return A(R)}function m(T){return y(T,V)}let p=m,j=y;function x(T,C,R){let B=H(T*(C-R));return C=H(C-B),R=H(R+B),{x_2:C,x_3:R}}function F(T,C){n8("u",T,Y0,Q),n8("scalar",C,I,_);let R=C,B=T,f=i8,S=Y0,v=T,g=i8,b=Y0;for(let n0=BigInt(M-1);n0>=Y0;n0--){let b$=R>>n0&i8;b^=b$,{x_2:f,x_3:v}=x(b,f,v),{x_2:S,x_3:g}=x(b,S,g),b=b$;let i0=f+S,o0=H(i0*i0),r0=f-S,h$=H(r0*r0),p$=o0-h$,u1=v+g,l1=v-g,c$=H(l1*i0),u$=H(u1*r0),l$=c$+u$,d$=c$-u$;v=H(l$*l$),g=H(B*H(d$*d$)),f=H(o0*h$),S=H(p$*(o0+H(E*p$)))}({x_2:f,x_3:v}=x(b,f,v)),{x_2:S,x_3:g}=x(b,S,g);let e8=U(S);return H(f*e8)}let c={secretKey:N,publicKey:N,seed:N},h=(T=Y(N))=>{return d(T,c.seed,"seed"),T},O={randomSecretKey:h};return Object.freeze({keygen:V0(h,p),getSharedSecret:j,getPublicKey:p,scalarMult:y,scalarMultBase:m,utils:O,GuBytes:V.slice(),lengths:c})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var HQ=BigInt(1),mq=BigInt(2),TQ=BigInt(3),RQ=BigInt(5),IQ=BigInt(8),F0=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),BQ=(()=>({p:F0,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:IQ,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function hq($){let q=BigInt(10),Q=BigInt(20),J=BigInt(40),G=BigInt(80),U=F0,Z=$*$%U*$%U,Y=W8(Z,mq,U)*Z%U,M=W8(Y,HQ,U)*$%U,N=W8(M,RQ,U)*M%U,L=W8(N,q,U)*N%U,E=W8(L,Q,U)*L%U,I=W8(E,J,U)*E%U,w=W8(I,G,U)*I%U,_=W8(w,G,U)*I%U,H=W8(_,q,U)*N%U;return{pow_p_5_8:W8(H,mq,U)*$%U,b2:Z}}function pq($){return $[0]&=248,$[31]&=127,$[31]|=64,$}var bq=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function AQ($,q){let Q=F0,J=i(q*q*q,Q),G=i(J*J*q,Q),U=hq($*G).pow_p_5_8,X=i($*J*U,Q),Z=i(q*X*X,Q),Y=X,M=i(X*bq,Q),N=Z===$,L=Z===i(-$,Q),E=Z===i(-$*bq,Q);if(N)X=Y;if(L||E)X=M;if(wq(X,Q))X=i(-X,Q);return{isValid:N||L,value:X}}var wQ=yq(BQ,{uvRatio:AQ});function jQ($){return vq(wQ,Kq,Object.assign({adjustScalarBytes:pq},$))}var _8=jQ({});var o8=(()=>{let $=F0;return gq({P:$,type:"x25519",powPminus2:(q)=>{let{pow_p_5_8:Q,b2:J}=hq(q);return i(W8(Q,TQ,$)*J,$)},adjustScalarBytes:pq})})();var K1=i$(O$(),1);var M$;try{M$=new TextDecoder}catch($){}var P,c8,z=0;var iq=[],VQ=105,fQ=57342,FQ=57343,uq=57337;var lq=6,r8={},Z0=112810000,f8=16810000;var W$=iq,L$=0,u={},o,k0,_0=0,K0=0,s,L8,r=[],C$=[],O8,Z8,N0,dq={useRecords:!1,mapsAsObjects:!0},O0=!1,oq=2;try{new Function("")}catch($){oq=1/0}class S8{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[q,Q]of Object.entries($.keyMap))this.mapKey.set(Q,q)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let q=new Map;for(let[Q,J]of Object.entries($))q.set(this._keyMap.hasOwnProperty(Q)?this._keyMap[Q]:Q,J);return q}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[Q,J]of Object.entries(this._keyMap))this._mapKey.set(J,Q)}let q={};return $.forEach((Q,J)=>q[C8(this._mapKey.has(J)?this._mapKey.get(J):J)]=Q),q}mapDecode($,q){let Q=this.decode($);if(this._keyMap)switch(Q.constructor.name){case"Array":return Q.map((J)=>this.decodeKeys(J))}return Q}decode($,q){if(P)return tq(()=>{return S0(),this?this.decode($,q):S8.prototype.decode.call(dq,$,q)});c8=q>-1?q:$.length,z=0,L$=0,K0=0,k0=null,W$=iq,s=null,P=$;try{Z8=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(Q){if(P=null,$ instanceof Uint8Array)throw Q;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof S8){if(u=this,O8=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return o=this.structures,P0();else if(!o||o.length>0)o=[]}else{if(u=dq,!o||o.length>0)o=[];O8=null}return P0()}decodeMultiple($,q){let Q,J=0;try{let G=$.length;O0=!0;let U=this?this.decode($,G):R$.decode($,G);if(q){if(q(U)===!1)return;while(z<G)if(J=z,q(P0())===!1)return}else{Q=[U];while(z<G)J=z,Q.push(P0());return Q}}catch(G){throw G.lastPosition=J,G.values=Q,G}finally{O0=!1,S0()}}}function P0(){try{let $=l();if(s){if(z>=s.postBundlePosition){let q=new Error("Unexpected bundle position");throw q.incomplete=!0,q}z=s.postBundlePosition,s=null}if(z==c8){if(o=null,P=null,L8)L8=null}else if(z>c8){let q=new Error("Unexpected end of CBOR data");throw q.incomplete=!0,q}else if(!O0)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(S0(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function l(){let $=P[z++],q=$>>5;if($=$&31,$>23)switch($){case 24:$=P[z++];break;case 25:if(q==7)return _Q();$=Z8.getUint16(z),z+=2;break;case 26:if(q==7){let Q=Z8.getFloat32(z);if(u.useFloat32>2){let J=y0[(P[z]&127)<<1|P[z+1]>>7];return z+=4,(J*Q+(Q>0?0.5:-0.5)>>0)/J}return z+=4,Q}$=Z8.getUint32(z),z+=4;break;case 27:if(q==7){let Q=Z8.getFloat64(z);return z+=8,Q}if(q>1){if(Z8.getUint32(z)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=Z8.getUint32(z+4)}else if(u.int64AsNumber)$=Z8.getUint32(z)*4294967296,$+=Z8.getUint32(z+4);else $=Z8.getBigUint64(z);z+=8;break;case 31:switch(q){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let Q=[],J,G=0;while((J=l())!=r8){if(G>=Z0)throw new Error(`Array length exceeds ${Z0}`);Q[G++]=J}return q==4?Q:q==3?Q.join(""):Buffer.concat(Q);case 5:let U;if(u.mapsAsObjects){let X={},Z=0;if(u.keyMap)while((U=l())!=r8){if(Z++>=f8)throw new Error(`Property count exceeds ${f8}`);X[C8(u.decodeKey(U))]=l()}else while((U=l())!=r8){if(Z++>=f8)throw new Error(`Property count exceeds ${f8}`);X[C8(U)]=l()}return X}else{if(N0)u.mapsAsObjects=!0,N0=!1;let X=new Map;if(u.keyMap){let Z=0;while((U=l())!=r8){if(Z++>=f8)throw new Error(`Map size exceeds ${f8}`);X.set(u.decodeKey(U),l())}}else{let Z=0;while((U=l())!=r8){if(Z++>=f8)throw new Error(`Map size exceeds ${f8}`);X.set(U,l())}}return X}case 7:return r8;default:throw new Error("Invalid major type for indefinite length "+q)}default:throw new Error("Unknown token "+$)}switch(q){case 0:return $;case 1:return~$;case 2:return kQ($);case 3:if(K0>=z)return k0.slice(z-_0,(z+=$)-_0);if(K0==0&&c8<140&&$<32){let G=$<16?rq($):xQ($);if(G!=null)return G}return PQ($);case 4:if($>=Z0)throw new Error(`Array length exceeds ${Z0}`);let Q=new Array($);for(let G=0;G<$;G++)Q[G]=l();return Q;case 5:if($>=f8)throw new Error(`Map size exceeds ${Z0}`);if(u.mapsAsObjects){let G={};if(u.keyMap)for(let U=0;U<$;U++)G[C8(u.decodeKey(l()))]=l();else for(let U=0;U<$;U++)G[C8(l())]=l();return G}else{if(N0)u.mapsAsObjects=!0,N0=!1;let G=new Map;if(u.keyMap)for(let U=0;U<$;U++)G.set(u.decodeKey(l()),l());else for(let U=0;U<$;U++)G.set(l(),l());return G}case 6:if($>=uq){let G=o[$&8191];if(G){if(!G.read)G.read=z$(G);return G.read()}if($<65536){if($==FQ){let U=a8(),X=l(),Z=l();D$(X,Z);let Y={};if(u.keyMap)for(let M=2;M<U;M++){let N=u.decodeKey(Z[M-2]);Y[C8(N)]=l()}else for(let M=2;M<U;M++){let N=Z[M-2];Y[C8(N)]=l()}return Y}else if($==fQ){let U=a8(),X=l();for(let Z=2;Z<U;Z++)D$(X++,l());return l()}else if($==uq)return bQ();if(u.getShared){if(T$(),G=o[$&8191],G){if(!G.read)G.read=z$(G);return G.read()}}}}let J=r[$];if(J)if(J.handlesRead)return J(l);else return J(l());else{let G=l();for(let U=0;U<C$.length;U++){let X=C$[U]($,G);if(X!==void 0)return X}return new T8(G,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let G=(O8||p8())[$];if(G!==void 0)return G;throw new Error("Unknown token "+$)}default:if(isNaN($)){let G=new Error("Unexpected end of CBOR data");throw G.incomplete=!0,G}throw new Error("Unknown CBOR token "+$)}}var nq=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function z$($){if(!$)throw new Error("Structure is required in record definition");function q(){let Q=P[z++];if(Q=Q&31,Q>23)switch(Q){case 24:Q=P[z++];break;case 25:Q=Z8.getUint16(z),z+=2;break;case 26:Q=Z8.getUint32(z),z+=4;break;default:throw new Error("Expected array header, but got "+P[z-1])}let J=this.compiledReader;while(J){if(J.propertyCount===Q)return J(l);J=J.next}if(this.slowReads++>=oq){let U=this.length==Q?this:this.slice(0,Q);if(J=u.keyMap?new Function("r","return {"+U.map((X)=>u.decodeKey(X)).map((X)=>nq.test(X)?C8(X)+":r()":"["+JSON.stringify(X)+"]:r()").join(",")+"}"):new Function("r","return {"+U.map((X)=>nq.test(X)?C8(X)+":r()":"["+JSON.stringify(X)+"]:r()").join(",")+"}"),this.compiledReader)J.next=this.compiledReader;return J.propertyCount=Q,this.compiledReader=J,J(l)}let G={};if(u.keyMap)for(let U=0;U<Q;U++)G[C8(u.decodeKey(this[U]))]=l();else for(let U=0;U<Q;U++)G[C8(this[U])]=l();return G}return $.slowReads=0,q}function C8($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var PQ=E$;function E$($){let q;if($<16){if(q=rq($))return q}if($>64&&M$)return M$.decode(P.subarray(z,z+=$));let Q=z+$,J=[];q="";while(z<Q){let G=P[z++];if((G&128)===0)J.push(G);else if((G&224)===192){let U=P[z++]&63;J.push((G&31)<<6|U)}else if((G&240)===224){let U=P[z++]&63,X=P[z++]&63;J.push((G&31)<<12|U<<6|X)}else if((G&248)===240){let U=P[z++]&63,X=P[z++]&63,Z=P[z++]&63,Y=(G&7)<<18|U<<12|X<<6|Z;if(Y>65535)Y-=65536,J.push(Y>>>10&1023|55296),Y=56320|Y&1023;J.push(Y)}else J.push(G);if(J.length>=4096)q+=$8.apply(String,J),J.length=0}if(J.length>0)q+=$8.apply(String,J);return q}var $8=String.fromCharCode;function xQ($){let q=z,Q=new Array($);for(let J=0;J<$;J++){let G=P[z++];if((G&128)>0){z=q;return}Q[J]=G}return $8.apply(String,Q)}function rq($){if($<4)if($<2)if($===0)return"";else{let q=P[z++];if((q&128)>1){z-=1;return}return $8(q)}else{let q=P[z++],Q=P[z++];if((q&128)>0||(Q&128)>0){z-=2;return}if($<3)return $8(q,Q);let J=P[z++];if((J&128)>0){z-=3;return}return $8(q,Q,J)}else{let q=P[z++],Q=P[z++],J=P[z++],G=P[z++];if((q&128)>0||(Q&128)>0||(J&128)>0||(G&128)>0){z-=4;return}if($<6)if($===4)return $8(q,Q,J,G);else{let U=P[z++];if((U&128)>0){z-=5;return}return $8(q,Q,J,G,U)}else if($<8){let U=P[z++],X=P[z++];if((U&128)>0||(X&128)>0){z-=6;return}if($<7)return $8(q,Q,J,G,U,X);let Z=P[z++];if((Z&128)>0){z-=7;return}return $8(q,Q,J,G,U,X,Z)}else{let U=P[z++],X=P[z++],Z=P[z++],Y=P[z++];if((U&128)>0||(X&128)>0||(Z&128)>0||(Y&128)>0){z-=8;return}if($<10)if($===8)return $8(q,Q,J,G,U,X,Z,Y);else{let M=P[z++];if((M&128)>0){z-=9;return}return $8(q,Q,J,G,U,X,Z,Y,M)}else if($<12){let M=P[z++],N=P[z++];if((M&128)>0||(N&128)>0){z-=10;return}if($<11)return $8(q,Q,J,G,U,X,Z,Y,M,N);let L=P[z++];if((L&128)>0){z-=11;return}return $8(q,Q,J,G,U,X,Z,Y,M,N,L)}else{let M=P[z++],N=P[z++],L=P[z++],E=P[z++];if((M&128)>0||(N&128)>0||(L&128)>0||(E&128)>0){z-=12;return}if($<14)if($===12)return $8(q,Q,J,G,U,X,Z,Y,M,N,L,E);else{let I=P[z++];if((I&128)>0){z-=13;return}return $8(q,Q,J,G,U,X,Z,Y,M,N,L,E,I)}else{let I=P[z++],w=P[z++];if((I&128)>0||(w&128)>0){z-=14;return}if($<15)return $8(q,Q,J,G,U,X,Z,Y,M,N,L,E,I,w);let _=P[z++];if((_&128)>0){z-=15;return}return $8(q,Q,J,G,U,X,Z,Y,M,N,L,E,I,w,_)}}}}}function kQ($){return u.copyBuffers?Uint8Array.prototype.slice.call(P,z,z+=$):P.subarray(z,z+=$)}var sq=new Float32Array(1),x0=new Uint8Array(sq.buffer,0,4);function _Q(){let $=P[z++],q=P[z++],Q=($&127)>>2;if(Q===31){if(q||$&3)return NaN;return $&128?-1/0:1/0}if(Q===0){let J=(($&3)<<8|q)/16777216;return $&128?-J:J}return x0[3]=$&128|(Q>>1)+56,x0[2]=($&7)<<5|q>>3,x0[1]=q<<5,x0[0]=0,sq[0]}var aJ=new Array(4096);class T8{constructor($,q){this.value=$,this.tag=q}}r[0]=($)=>{return new Date($)};r[1]=($)=>{return new Date(Math.round($*1000))};r[2]=($)=>{let q=BigInt(0);for(let Q=0,J=$.byteLength;Q<J;Q++)q=BigInt($[Q])+(q<<BigInt(8));return q};r[3]=($)=>{return BigInt(-1)-r[2]($)};r[4]=($)=>{return+($[1]+"e"+$[0])};r[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var D$=($,q)=>{$=$-57344;let Q=o[$];if(Q&&Q.isShared)(o.restoreStructures||(o.restoreStructures=[]))[$]=Q;o[$]=q,q.read=z$(q)};r[VQ]=($)=>{let q=$.length,Q=$[1];D$($[0],Q);let J={};for(let G=2;G<q;G++){let U=Q[G-2];J[C8(U)]=$[G]}return J};r[14]=($)=>{if(s)return s[0].slice(s.position0,s.position0+=$);return new T8($,14)};r[15]=($)=>{if(s)return s[1].slice(s.position1,s.position1+=$);return new T8($,15)};var SQ={Error,RegExp};r[27]=($)=>{return(SQ[$[0]]||Error)($[1],$[2])};var aq=($)=>{if(P[z++]!=132){let Q=new Error("Packed values structure must be followed by a 4 element array");if(P.length<z)Q.incomplete=!0;throw Q}let q=$();if(!q||!q.length){let Q=new Error("Packed values structure must be followed by a 4 element array");throw Q.incomplete=!0,Q}return O8=O8?q.concat(O8.slice(q.length)):q,O8.prefixes=$(),O8.suffixes=$(),$()};aq.handlesRead=!0;r[51]=aq;r[lq]=($)=>{if(!O8)if(u.getShared)T$();else return new T8($,lq);if(typeof $=="number")return O8[16+($>=0?2*$:-2*$-1)];let q=new Error("No support for non-integer packed references yet");if($===void 0)q.incomplete=!0;throw q};r[28]=($)=>{if(!L8)L8=new Map,L8.id=0;let q=L8.id++,Q=z,J=P[z],G;if(J>>5==4)G=[];else G={};let U={target:G};L8.set(q,U);let X=$();if(U.used){if(Object.getPrototypeOf(G)!==Object.getPrototypeOf(X))z=Q,G=X,L8.set(q,{target:G}),X=$();return Object.assign(G,X)}return U.target=X,X};r[28].handlesRead=!0;r[29]=($)=>{let q=L8.get($);return q.used=!0,q.target};r[258]=($)=>new Set($);(r[259]=($)=>{if(u.mapsAsObjects)u.mapsAsObjects=!1,N0=!0;return $()}).handlesRead=!0;function s8($,q){if(typeof $==="string")return $+q;if($ instanceof Array)return $.concat(q);return Object.assign({},$,q)}function p8(){if(!O8)if(u.getShared)T$();else throw new Error("No packed values available");return O8}var yQ=1399353956;C$.push(($,q)=>{if($>=225&&$<=255)return s8(p8().prefixes[$-224],q);if($>=28704&&$<=32767)return s8(p8().prefixes[$-28672],q);if($>=1879052288&&$<=2147483647)return s8(p8().prefixes[$-1879048192],q);if($>=216&&$<=223)return s8(q,p8().suffixes[$-216]);if($>=27647&&$<=28671)return s8(q,p8().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return s8(q,p8().suffixes[$-1811939328]);if($==yQ)return{packedValues:O8,structures:o.slice(0),version:q};if($==55799)return q});var vQ=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,H$=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],gQ=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<H$.length;$++)mQ(H$[$],gQ[$]);function mQ($,q){let Q="get"+$.name.slice(0,-5),J;if(typeof $==="function")J=$.BYTES_PER_ELEMENT;else $=null;for(let G=0;G<2;G++){if(!G&&J==1)continue;let U=J==2?1:J==4?2:J==8?3:0;r[G?q:q-4]=J==1||G==vQ?(X)=>{if(!$)throw new Error("Could not find typed array for code "+q);if(!u.copyBuffers){if(J===1||J===2&&!(X.byteOffset&1)||J===4&&!(X.byteOffset&3)||J===8&&!(X.byteOffset&7))return new $(X.buffer,X.byteOffset,X.byteLength>>U)}return new $(Uint8Array.prototype.slice.call(X,0).buffer)}:(X)=>{if(!$)throw new Error("Could not find typed array for code "+q);let Z=new DataView(X.buffer,X.byteOffset,X.byteLength),Y=X.length>>U,M=new $(Y),N=Z[Q];for(let L=0;L<Y;L++)M[L]=N.call(Z,L<<U,G);return M}}}function bQ(){let $=a8(),q=z+l();for(let J=2;J<$;J++){let G=a8();z+=G}let Q=z;return z=q,s=[E$(a8()),E$(a8())],s.position0=0,s.position1=0,s.postBundlePosition=z,z=Q,l()}function a8(){let $=P[z++]&31;if($>23)switch($){case 24:$=P[z++];break;case 25:$=Z8.getUint16(z),z+=2;break;case 26:$=Z8.getUint32(z),z+=4;break}return $}function T$(){if(u.getShared){let $=tq(()=>{return P=null,u.getShared()})||{},q=$.structures||[];if(u.sharedVersion=$.version,O8=u.sharedValues=$.packedValues,o===!0)u.structures=o=q;else o.splice.apply(o,[0,q.length].concat(q))}}function tq($){let q=c8,Q=z,J=L$,G=_0,U=K0,X=k0,Z=W$,Y=L8,M=s,N=new Uint8Array(P.slice(0,c8)),L=o,E=u,I=O0,w=$();return c8=q,z=Q,L$=J,_0=G,K0=U,k0=X,W$=Z,L8=Y,s=M,P=N,O0=I,o=L,u=E,Z8=new DataView(P.buffer,P.byteOffset,P.byteLength),w}function S0(){P=null,L8=null,o=null}var y0=new Array(147);for(let $=0;$<256;$++)y0[$]=+("1e"+Math.floor(45.15-$*0.30103));var R$=new S8({useRecords:!1}),v0=R$.decode,hQ=R$.decodeMultiple;var g0;try{g0=new TextEncoder}catch($){}var j$,U1,b0=typeof globalThis==="object"&&globalThis.Buffer,M0=typeof b0!=="undefined",I$=M0?b0.allocUnsafeSlow:Uint8Array,eq=M0?b0:Uint8Array,$1=256,q1=M0?4294967296:2144337920;var B$,W,n,K=0,y8,a=null,pQ=61440,cQ=/[\u0080-\uFFFF]/,M8=Symbol("record-id");class h0 extends S8{constructor($){super($);this.offset=0;let q,Q,J,G,U,X;$=$||{};let Z=eq.prototype.utf8Write?function(O,T,C){return W.utf8Write(O,T,C)}:g0&&g0.encodeInto?function(O,T){return g0.encodeInto(O,W.subarray(T)).written}:!1,Y=this,M=$.structures||$.saveStructures,N=$.maxSharedStructures;if(N==null)N=M?128:0;if(N>8190)throw new Error("Maximum maxSharedStructure is 8190");let L=$.sequential;if(L)N=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let E,I,w=$.sharedValues,_;if(w){_=Object.create(null);for(let O=0,T=w.length;O<T;O++)_[w[O]]=O}let H=[],V=0,A=0;this.mapEncode=function(O,T){if(this._keyMap&&!this._mapped)switch(O.constructor.name){case"Array":O=O.map((C)=>this.encodeKeys(C));break}return this.encode(O,T)},this.encode=function(O,T){if(!W)W=new I$(8192),n=new DataView(W.buffer,0,8192),K=0;if(y8=W.length-10,y8-K<2048)W=new I$(W.length),n=new DataView(W.buffer,0,W.length),y8=W.length-10,K=0;else if(T===f$)K=K+7&2147483640;if(Q=K,Y.useSelfDescribedHeader)n.setUint32(K,3654940416),K+=3;if(X=Y.structuredClone?new Map:null,Y.bundleStrings&&typeof O!=="string")a=[],a.size=1/0;else a=null;if(J=Y.structures,J){if(J.uninitialized){let R=Y.getShared()||{};Y.structures=J=R.structures||[],Y.sharedVersion=R.version;let B=Y.sharedValues=R.packedValues;if(B){_={};for(let f=0,S=B.length;f<S;f++)_[B[f]]=f}}let C=J.length;if(C>N&&!L)C=N;if(!J.transitions){J.transitions=Object.create(null);for(let R=0;R<C;R++){let B=J[R];if(!B)continue;let f,S=J.transitions;for(let v=0,g=B.length;v<g;v++){if(S[M8]===void 0)S[M8]=R;let b=B[v];if(f=S[b],!f)f=S[b]=Object.create(null);S=f}S[M8]=R|1048576}}if(!L)J.nextId=C}if(G)G=!1;if(U=J||[],I=_,$.pack){let C=new Map;if(C.values=[],C.encoder=Y,C.maxValues=$.maxPrivatePackedValues||(_?16:1/0),C.objectMap=_||!1,C.samplingPackedValues=E,m0(O,C),C.values.length>0){W[K++]=216,W[K++]=51,I8(4);let R=C.values;D(R),I8(0),I8(0),I=Object.create(_||null);for(let B=0,f=R.length;B<f;B++)I[R[B]]=B}}B$=T&w$;try{if(B$)return;if(D(O),a)J1(Q,D);if(Y.offset=K,X&&X.idsToInsert){if(K+=X.idsToInsert.length*2,K>y8)y(K);Y.offset=K;let C=dQ(W.subarray(Q,K),X.idsToInsert);return X=null,C}if(T&f$)return W.start=Q,W.end=K,W;return W.subarray(Q,K)}finally{if(J){if(A<10)A++;if(J.length>N)J.length=N;if(V>1e4){if(J.transitions=null,A=0,V=0,H.length>0)H=[]}else if(H.length>0&&!L){for(let C=0,R=H.length;C<R;C++)H[C][M8]=void 0;H=[]}}if(G&&Y.saveShared){if(Y.structures.length>N)Y.structures=Y.structures.slice(0,N);let C=W.subarray(Q,K);if(Y.updateSharedData()===!1)return Y.encode(O);return C}if(T&rQ)K=Q}},this.findCommonStringsToPack=()=>{if(E=new Map,!_)_=Object.create(null);return(O)=>{let T=O&&O.threshold||4,C=this.pack?O.maxPrivatePackedValues||16:0;if(!w)w=this.sharedValues=[];for(let[R,B]of E)if(B.count>T)_[R]=C++,w.push(R),G=!0;while(this.saveShared&&this.updateSharedData()===!1);E=null}};let D=(O)=>{if(K>y8)W=y(K);var T=typeof O,C;if(T==="string"){if(I){let S=I[O];if(S>=0){if(S<16)W[K++]=S+224;else if(W[K++]=198,S&1)D(15-S>>1);else D(S-16>>1);return}else if(E&&!$.pack){let v=E.get(O);if(v)v.count++;else E.set(O,{count:1})}}let R=O.length;if(a&&R>=4&&R<1024){if((a.size+=R)>pQ){let v,g=(a[0]?a[0].length*3+a[1].length:0)+10;if(K+g>y8)W=y(K+g);if(W[K++]=217,W[K++]=223,W[K++]=249,W[K++]=a.position?132:130,W[K++]=26,v=K-Q,K+=4,a.position)J1(Q,D);a=["",""],a.size=0,a.position=v}let S=cQ.test(O);a[S?0:1]+=O,W[K++]=S?206:207,D(R);return}let B;if(R<32)B=1;else if(R<256)B=2;else if(R<65536)B=3;else B=5;let f=R*3;if(K+f>y8)W=y(K+f);if(R<64||!Z){let S,v,g,b=K+B;for(S=0;S<R;S++)if(v=O.charCodeAt(S),v<128)W[b++]=v;else if(v<2048)W[b++]=v>>6|192,W[b++]=v&63|128;else if((v&64512)===55296&&((g=O.charCodeAt(S+1))&64512)===56320)v=65536+((v&1023)<<10)+(g&1023),S++,W[b++]=v>>18|240,W[b++]=v>>12&63|128,W[b++]=v>>6&63|128,W[b++]=v&63|128;else W[b++]=v>>12|224,W[b++]=v>>6&63|128,W[b++]=v&63|128;C=b-K-B}else C=Z(O,K+B,f);if(C<24)W[K++]=96|C;else if(C<256){if(B<2)W.copyWithin(K+2,K+1,K+1+C);W[K++]=120,W[K++]=C}else if(C<65536){if(B<3)W.copyWithin(K+3,K+2,K+2+C);W[K++]=121,W[K++]=C>>8,W[K++]=C&255}else{if(B<5)W.copyWithin(K+5,K+3,K+3+C);W[K++]=122,n.setUint32(K,C),K+=4}K+=C}else if(T==="number")if(!this.alwaysUseFloat&&O>>>0===O)if(O<24)W[K++]=O;else if(O<256)W[K++]=24,W[K++]=O;else if(O<65536)W[K++]=25,W[K++]=O>>8,W[K++]=O&255;else W[K++]=26,n.setUint32(K,O),K+=4;else if(!this.alwaysUseFloat&&O>>0===O)if(O>=-24)W[K++]=31-O;else if(O>=-256)W[K++]=56,W[K++]=~O;else if(O>=-65536)W[K++]=57,n.setUint16(K,~O),K+=2;else W[K++]=58,n.setUint32(K,~O),K+=4;else{let R;if((R=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){W[K++]=250,n.setFloat32(K,O);let B;if(R<4||(B=O*y0[(W[K]&127)<<1|W[K+1]>>7])>>0===B){K+=4;return}else K--}W[K++]=251,n.setFloat64(K,O),K+=8}else if(T==="object")if(!O)W[K++]=246;else{if(X){let B=X.get(O);if(B){if(W[K++]=216,W[K++]=29,W[K++]=25,!B.references){let f=X.idsToInsert||(X.idsToInsert=[]);B.references=[],f.push(B)}B.references.push(K-Q),K+=2;return}else X.set(O,{offset:K-Q})}let R=O.constructor;if(R===Object)k(O);else if(R===Array){if(C=O.length,C<24)W[K++]=128|C;else I8(C);for(let B=0;B<C;B++)D(O[B])}else if(R===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)W[K++]=217,W[K++]=1,W[K++]=3;if(C=O.size,C<24)W[K++]=160|C;else if(C<256)W[K++]=184,W[K++]=C;else if(C<65536)W[K++]=185,W[K++]=C>>8,W[K++]=C&255;else W[K++]=186,n.setUint32(K,C),K+=4;if(Y.keyMap)for(let[B,f]of O)D(Y.encodeKey(B)),D(f);else for(let[B,f]of O)D(B),D(f)}else{for(let B=0,f=j$.length;B<f;B++){let S=U1[B];if(O instanceof S){let v=j$[B],g=v.tag;if(g==null)g=v.getTag&&v.getTag.call(this,O);if(g<24)W[K++]=192|g;else if(g<256)W[K++]=216,W[K++]=g;else if(g<65536)W[K++]=217,W[K++]=g>>8,W[K++]=g&255;else if(g>-1)W[K++]=218,n.setUint32(K,g),K+=4;v.encode.call(this,O,D,y);return}}if(O[Symbol.iterator]){if(B$){let B=new Error("Iterable should be serialized as iterator");throw B.iteratorNotHandled=!0,B}W[K++]=159;for(let B of O)D(B);W[K++]=255;return}if(O[Symbol.asyncIterator]||A$(O)){let B=new Error("Iterable/blob should be serialized as iterator");throw B.iteratorNotHandled=!0,B}if(this.useToJSON&&O.toJSON){let B=O.toJSON();if(B!==O)return D(B)}k(O)}}else if(T==="boolean")W[K++]=O?245:244;else if(T==="bigint"){if(O<BigInt(1)<<BigInt(64)&&O>=0)W[K++]=27,n.setBigUint64(K,O);else if(O>-(BigInt(1)<<BigInt(64))&&O<0)W[K++]=59,n.setBigUint64(K,-O-BigInt(1));else if(this.largeBigIntToFloat)W[K++]=251,n.setFloat64(K,Number(O));else{if(O>=BigInt(0))W[K++]=194;else W[K++]=195,O=BigInt(-1)-O;let R=[];while(O)R.push(Number(O&BigInt(255))),O>>=BigInt(8);V$(new Uint8Array(R.reverse()),y);return}K+=8}else if(T==="undefined")W[K++]=247;else throw new Error("Unknown type: "+T)},k=this.useRecords===!1?this.variableMapSize?(O)=>{let T=Object.keys(O),C=Object.values(O),R=T.length;if(R<24)W[K++]=160|R;else if(R<256)W[K++]=184,W[K++]=R;else if(R<65536)W[K++]=185,W[K++]=R>>8,W[K++]=R&255;else W[K++]=186,n.setUint32(K,R),K+=4;let B;if(Y.keyMap)for(let f=0;f<R;f++)D(Y.encodeKey(T[f])),D(C[f]);else for(let f=0;f<R;f++)D(T[f]),D(C[f])}:(O)=>{W[K++]=185;let T=K-Q;K+=2;let C=0;if(Y.keyMap){for(let R in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(R))D(Y.encodeKey(R)),D(O[R]),C++}else for(let R in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(R))D(R),D(O[R]),C++;W[T+++Q]=C>>8,W[T+Q]=C&255}:(O,T)=>{let C,R=U.transitions||(U.transitions=Object.create(null)),B=0,f=0,S,v;if(this.keyMap){v=Object.keys(O).map((b)=>this.encodeKey(b)),f=v.length;for(let b=0;b<f;b++){let e8=v[b];if(C=R[e8],!C)C=R[e8]=Object.create(null),B++;R=C}}else for(let b in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(b)){if(C=R[b],!C){if(R[M8]&1048576)S=R[M8]&65535;C=R[b]=Object.create(null),B++}R=C,f++}let g=R[M8];if(g!==void 0)g&=65535,W[K++]=217,W[K++]=g>>8|224,W[K++]=g&255;else{if(!v)v=R.__keys__||(R.__keys__=Object.keys(O));if(S===void 0){if(g=U.nextId++,!g)g=0,U.nextId=1;if(g>=$1)U.nextId=(g=N)+1}else g=S;if(U[g]=v,g<N){W[K++]=217,W[K++]=g>>8|224,W[K++]=g&255,R=U.transitions;for(let b=0;b<f;b++){if(R[M8]===void 0||R[M8]&1048576)R[M8]=g;R=R[v[b]]}R[M8]=g|1048576,G=!0}else{if(R[M8]=g,n.setUint32(K,3655335680),K+=3,B)V+=A*B;if(H.length>=$1-N)H.shift()[M8]=void 0;if(H.push(R),I8(f+2),D(57344+g),D(v),T)return;for(let b in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(b))D(O[b]);return}}if(f<24)W[K++]=128|f;else I8(f);if(T)return;for(let b in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(b))D(O[b])},y=(O)=>{let T;if(O>16777216){if(O-Q>q1)throw new Error("Encoded buffer would be larger than maximum buffer size");T=Math.min(q1,Math.round(Math.max((O-Q)*(O>67108864?1.25:2),4194304)/4096)*4096)}else T=(Math.max(O-Q<<2,W.length-1)>>12)+1<<12;let C=new I$(T);if(n=new DataView(C.buffer,0,T),W.copy)W.copy(C,0,Q,O);else C.set(W.slice(Q,O));return K-=Q,Q=0,y8=C.length-10,W=C},m=100,p=1000;this.encodeAsIterable=function(O,T){return c(O,T,j)},this.encodeAsAsyncIterable=function(O,T){return c(O,T,h)};function*j(O,T,C){let R=O.constructor;if(R===Object){let B=Y.useRecords!==!1;if(B)k(O,!0);else Q1(Object.keys(O).length,160);for(let f in O){let S=O[f];if(!B)D(f);if(S&&typeof S==="object")if(T[f])yield*j(S,T[f]);else yield*x(S,T,f);else D(S)}}else if(R===Array){let B=O.length;I8(B);for(let f=0;f<B;f++){let S=O[f];if(S&&(typeof S==="object"||K-Q>m))if(T.element)yield*j(S,T.element);else yield*x(S,T,"element");else D(S)}}else if(O[Symbol.iterator]&&!O.buffer){W[K++]=159;for(let B of O)if(B&&(typeof B==="object"||K-Q>m))if(T.element)yield*j(B,T.element);else yield*x(B,T,"element");else D(B);W[K++]=255}else if(A$(O))Q1(O.size,64),yield W.subarray(Q,K),yield O,F();else if(O[Symbol.asyncIterator])W[K++]=159,yield W.subarray(Q,K),yield O,F(),W[K++]=255;else D(O);if(C&&K>Q)yield W.subarray(Q,K);else if(K-Q>m)yield W.subarray(Q,K),F()}function*x(O,T,C){let R=K-Q;try{if(D(O),K-Q>m)yield W.subarray(Q,K),F()}catch(B){if(B.iteratorNotHandled)T[C]={},K=Q+R,yield*j.call(this,O,T[C]);else throw B}}function F(){m=p,Y.encode(null,w$)}function c(O,T,C){if(T&&T.chunkThreshold)m=p=T.chunkThreshold;else m=100;if(O&&typeof O==="object")return Y.encode(null,w$),C(O,Y.iterateProperties||(Y.iterateProperties={}),!0);return[Y.encode(O)]}async function*h(O,T){for(let C of j(O,T,!0)){let R=C.constructor;if(R===eq||R===Uint8Array)yield C;else if(A$(C)){let B=C.stream().getReader(),f;while(!(f=await B.read()).done)yield f.value}else if(C[Symbol.asyncIterator])for await(let B of C)if(F(),B)yield*h(B,T.async||(T.async={}));else yield Y.encode(B);else yield C}}}useBuffer($){W=$,n=new DataView(W.buffer,W.byteOffset,W.byteLength),K=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let q=this.structures.slice(0),Q=new F$(q,this.sharedValues,this.sharedVersion),J=this.saveShared(Q,(G)=>(G&&G.version||0)==$);if(J===!1)Q=this.getShared()||{},this.structures=Q.structures||[],this.sharedValues=Q.packedValues,this.sharedVersion=Q.version,this.structures.nextId=this.structures.length;else q.forEach((G,U)=>this.structures[U]=G);return J}}function Q1($,q){if($<24)W[K++]=q|$;else if($<256)W[K++]=q|24,W[K++]=$;else if($<65536)W[K++]=q|25,W[K++]=$>>8,W[K++]=$&255;else W[K++]=q|26,n.setUint32(K,$),K+=4}class F${constructor($,q,Q){this.structures=$,this.packedValues=q,this.version=Q}}function I8($){if($<24)W[K++]=128|$;else if($<256)W[K++]=152,W[K++]=$;else if($<65536)W[K++]=153,W[K++]=$>>8,W[K++]=$&255;else W[K++]=154,n.setUint32(K,$),K+=4}var uQ=typeof Blob==="undefined"?function(){}:Blob;function A$($){if($ instanceof uQ)return!0;let q=$[Symbol.toStringTag];return q==="Blob"||q==="File"}function m0($,q){switch(typeof $){case"string":if($.length>3){if(q.objectMap[$]>-1||q.values.length>=q.maxValues)return;let J=q.get($);if(J){if(++J.count==2)q.values.push($)}else if(q.set($,{count:1}),q.samplingPackedValues){let G=q.samplingPackedValues.get($);if(G)G.count++;else q.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let J=0,G=$.length;J<G;J++)m0($[J],q);else{let J=!q.encoder.useRecords;for(var Q in $)if($.hasOwnProperty(Q)){if(J)m0(Q,q);m0($[Q],q)}}break;case"function":console.log($)}}var lQ=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;U1=[Date,Set,Error,RegExp,T8,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,F$];j$=[{tag:1,encode($,q){let Q=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&Q>=0&&Q<4294967296)W[K++]=26,n.setUint32(K,Q),K+=4;else W[K++]=251,n.setFloat64(K,Q),K+=8}},{tag:258,encode($,q){let Q=Array.from($);q(Q)}},{tag:27,encode($,q){q([$.name,$.message])}},{tag:27,encode($,q){q(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,q){q($.value)}},{encode($,q,Q){V$($,Q)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||M0&&this.tagUint8Array!==!1)return 64}},encode($,q,Q){V$($,Q)}},R8(68,1),R8(69,2),R8(70,4),R8(71,8),R8(72,1),R8(77,2),R8(78,4),R8(79,8),R8(85,4),R8(86,8),{encode($,q){let Q=$.packedValues||[],J=$.structures||[];if(Q.values.length>0){W[K++]=216,W[K++]=51,I8(4);let G=Q.values;q(G),I8(0),I8(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let U=0,X=G.length;U<X;U++)packedObjectMap[G[U]]=U}if(J){n.setUint32(K,3655335424),K+=3;let G=J.slice(0);G.unshift(57344),G.push(new T8($.version,1399353956)),q(G)}else q(new T8($.version,1399353956))}}];function R8($,q){if(!lQ&&q>1)$-=4;return{tag:$,encode:function Q(J,G){let U=J.byteLength,X=J.byteOffset||0,Z=J.buffer||J;G(M0?b0.from(Z,X,U):new Uint8Array(Z,X,U))}}}function V$($,q){let Q=$.byteLength;if(Q<24)W[K++]=64+Q;else if(Q<256)W[K++]=88,W[K++]=Q;else if(Q<65536)W[K++]=89,W[K++]=Q>>8,W[K++]=Q&255;else W[K++]=90,n.setUint32(K,Q),K+=4;if(K+Q>=W.length)q(K+Q);W.set($.buffer?$:new Uint8Array($),K),K+=Q}function dQ($,q){let Q,J=q.length*2,G=$.length-J;q.sort((U,X)=>U.offset>X.offset?1:-1);for(let U=0;U<q.length;U++){let X=q[U];X.id=U;for(let Z of X.references)$[Z++]=U>>8,$[Z]=U&255}while(Q=q.pop()){let U=Q.offset;$.copyWithin(U+J,U,G),J-=2;let X=U+J;$[X++]=216,$[X++]=28,G=U}return $}function J1($,q){n.setUint32(a.position+$,K-a.position-$+1);let Q=a;a=null,q(Q[0]),q(Q[1])}var P$=new h0({useRecords:!1}),nQ=P$.encode,iQ=P$.encodeAsIterable,oQ=P$.encodeAsAsyncIterable;var f$=512,rQ=1024,w$=2048;var p0=($)=>{let q=new Uint8Array($),Q="";for(let J=0;J<q.byteLength;J++)Q+=String.fromCharCode(q[J]);return btoa(Q).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},X1=($)=>{let q=atob($.replace(/-/g,"+").replace(/_/g,"/")),Q=new Uint8Array(q.length);for(let J=0;J<q.length;J++)Q[J]=q.charCodeAt(J);return Q.buffer};async function Y1($){let q=crypto.getRandomValues(new Uint8Array(32)),Q=crypto.getRandomValues(new Uint8Array(16)),J=await navigator.credentials.create({publicKey:{challenge:q,rp:{name:"Sorane Web/A Form"},user:{id:Q,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"preferred"},timeout:60000,attestation:"none"}});if(!J)throw new Error("Credential creation failed");return{id:J.id,rawId:p0(J.rawId),response:J.response}}async function Z1($,q){let Q=await navigator.credentials.get({publicKey:{challenge:q,allowCredentials:[{id:X1($),type:"public-key"}],userVerification:"required"}});if(!Q)throw new Error("Assertion failed");let J=Q.response;return{id:Q.id,signature:p0(J.signature),authenticatorData:p0(J.authenticatorData),clientDataJSON:p0(J.clientDataJSON)}}async function c0($,q){let Q=crypto.getRandomValues(new Uint8Array(32)),J=await navigator.credentials.get({publicKey:{challenge:Q,allowCredentials:[{id:X1($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:q}}}}});if(!J)throw new Error("Assertion failed");let U=J.getClientExtensionResults()?.prf?.results?.first;if(!U)throw new Error("PRF extension not available");return new Uint8Array(U)}function W0($){return Array.from($).map((q)=>q.toString(16).padStart(2,"0")).join("")}function N1($){let q=new Uint8Array($.length/2);for(let Q=0;Q<q.length;Q++)q[Q]=parseInt($.substring(Q*2,Q*2+2),16);return q}class O1{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),q=localStorage.getItem("weba_passkey_pub");if($&&q){this.credentialId=$,this.publicKey=N1(q),this.publicKeyType="p256",this.usePasskey=!0;return}let Q=localStorage.getItem("weba_private_key");if(Q)this.edPrivateKey=N1(Q),this.publicKey=_8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{console.log("Registering Passkey...");let $=await Y1("User"),q=new Uint8Array($.response.attestationObject),J=v0(q).authData,G=new DataView(J.buffer,J.byteOffset,J.byteLength),U=53,X=G.getUint16(U);U+=2,U+=X;let Z=J.slice(U),Y=v0(Z),M=Y.get(-2),N=Y.get(-3);if(!M||!N)throw new Error("Invalid COSE Key: x or y missing");let L=new Uint8Array(65);if(L[0]=4,L.set(M,1),L.set(N,33),this.credentialId=$.rawId,this.publicKey=L,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",W0(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}generateEdKey(){if(this.edPrivateKey=_8.utils.randomSecretKey(),this.publicKey=_8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",W0(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return`did:key:z${W0(this.publicKey)}`}getPublicKey(){return this.publicKey?W0(this.publicKey):""}async sign($,q="authentication"){if(!this.publicKey)await this.register();let Q=K1.default($),J=new TextEncoder().encode(Q);if(this.usePasskey&&this.credentialId){let G=await crypto.subtle.digest("SHA-256",J),U=await Z1(this.credentialId,G);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:U.signature,"srn:authenticatorData":U.authenticatorData,"srn:clientDataJSON":U.clientDataJSON,"srn:credentialId":U.id}}}else{if(!this.edPrivateKey)this.generateEdKey();let G=_8.sign(J,this.edPrivateKey);return{...$,proof:{type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:W0(G)}}}}}var t8=new O1;class x${oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor($,q){if($0($),d(q,void 0,"key"),this.iHash=$.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let Q=this.blockLen,J=new Uint8Array(Q);J.set(q.length>Q?$.create().update(q).digest():q);for(let G=0;G<J.length;G++)J[G]^=54;this.iHash.update(J),this.oHash=$.create();for(let G=0;G<J.length;G++)J[G]^=106;this.oHash.update(J),z8(J)}update($){return l8(this),this.iHash.update($),this}digestInto($){l8(this),d($,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto($),this.oHash.update($),this.oHash.digestInto($),this.destroy()}digest(){let $=new Uint8Array(this.oHash.outputLen);return this.digestInto($),$}_cloneInto($){$||=Object.create(Object.getPrototypeOf(this),{});let{oHash:q,iHash:Q,finished:J,destroyed:G,blockLen:U,outputLen:X}=this;return $=$,$.finished=J,$.destroyed=G,$.blockLen=U,$.outputLen=X,$.oHash=q._cloneInto($.oHash),$.iHash=Q._cloneInto($.iHash),$}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var u0=($,q,Q)=>new x$($,q).update(Q).digest();u0.create=($,q)=>new x$($,q);function sQ($,q,Q){if($0($),Q===void 0)Q=new Uint8Array($.outputLen);return u0($,Q,q)}var k$=Uint8Array.of(0),M1=Uint8Array.of();function aQ($,q,Q,J=32){$0($),D8(J,"length");let G=$.outputLen;if(J>255*G)throw new Error("Length must be <= 255*HashLen");let U=Math.ceil(J/G);if(Q===void 0)Q=M1;else d(Q,void 0,"info");let X=new Uint8Array(U*G),Z=u0.create($,q),Y=Z._cloneInto(),M=new Uint8Array(Z.outputLen);for(let N=0;N<U;N++)k$[0]=N+1,Y.update(N===0?M1:M).update(Q).update(k$).digestInto(M),X.set(M,G*N),Z._cloneInto(Y);return Z.destroy(),Y.destroy(),z8(M,k$),X.slice(0,J)}var N8=($,q,Q,J,G)=>aQ($,sQ($,q,Q),J,G);var C1=i$(O$(),1),W1="weba_l2_ed25519_sk";function K8($){if(typeof Buffer!=="undefined")return Buffer.from($).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");let q="";return $.forEach((J)=>{q+=String.fromCharCode(J)}),btoa(q).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function t($){let q=$.length%4===0?"":"=".repeat(4-$.length%4),Q=$.replace(/-/g,"+").replace(/_/g,"/")+q;if(typeof Buffer!=="undefined")return new Uint8Array(Buffer.from(Q,"base64"));let J=atob(Q),G=new Uint8Array(J.length);for(let U=0;U<J.length;U+=1)G[U]=J.charCodeAt(U);return G}function L0($){let q=C1.default($);if(q===void 0)throw new Error("Failed to canonicalize JSON");return q}function L1($){let q=new Uint8Array($);return crypto.getRandomValues(q),q}function tQ(){let $=localStorage.getItem(W1);if($)return t($);let q=_8.utils.randomSecretKey();return localStorage.setItem(W1,K8(q)),q}function eQ($,q,Q){let J={layer1_ref:$,recipient:q,weba_version:Q};return new TextEncoder().encode(L0(J))}function z1($,q){let Q=new Uint8Array($.length+q.length);return Q.set($,0),Q.set(q,$.length),Q}function E1($){let q=$.keyPolicy??"campaign+layer1";if(q==="campaign+layer1"&&!$.layer1Ref)throw new Error("layer1_ref is required for campaign+layer1 policy");let Q=L0({domain:"weba-l2/org-x25519",campaign_id:$.campaignId,key_policy:q,layer1_ref:q==="campaign+layer1"?$.layer1Ref:void 0}),J=new TextEncoder().encode(Q),G=N8(X8,$.orgRootKey,void 0,J,32);return{publicKey:o8.getPublicKey(G),privateKey:G,keyPolicy:q}}function D1($){let q=new TextEncoder().encode("weba-l2/user-x25519"),Q=N8(X8,$,void 0,q,32);return{publicKey:o8.getPublicKey(Q),privateKey:Q}}function H1(){return globalThis.webaPqcKem||null}async function T1($,q,Q,J){let G=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["encrypt"]),U=await crypto.subtle.encrypt({name:"AES-GCM",iv:Q,additionalData:J},G,$);return new Uint8Array(U)}async function R1($){let q=N8(X8,$.prfKey,void 0,void 0,32),Q=N8(X8,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),J=N8(X8,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),G=$.aad??new Uint8Array;return T1($.recipientSk,Q,J,G)}async function I1($,q,Q,J){let G=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["decrypt"]),U=await crypto.subtle.decrypt({name:"AES-GCM",iv:Q,additionalData:J},G,$);return new Uint8Array(U)}async function B1($){let q=$.config.weba_version??"0.1",Q=$.config.recipient_kid,J=$.config.layer1_ref,G=$.user_kid??"user#sig-1",U=tQ(),X=L0($.layer2_plain),Z=new TextEncoder().encode(X),Y=_8.sign(Z,U),M={alg:"Ed25519",kid:G,sig:K8(Y),created_at:new Date().toISOString()},N={layer2_plain:$.layer2_plain,layer2_sig:M},L=eQ(J,Q,q),E=new TextEncoder().encode(L0(N)),I=t($.config.recipient_x25519),w=L1(32),_=o8.getPublicKey(w),H=o8.getSharedSecret(w,I),V=H,A,D="X25519";if($.config.recipient_pqc){let j=$.pqcProvider??H1();if(!j)throw new Error("PQC requested but no provider is available");let x=t($.config.recipient_pqc),F=j.encapsulate(x);A=F.encapsulation,V=z1(H,F.sharedSecret),D=`X25519+${j.kemId}`}let k=N8(X8,V,L,void 0,32),y=N8(X8,k,void 0,new TextEncoder().encode("weba-l2/key"),32),m=N8(X8,k,void 0,new TextEncoder().encode("weba-l2/iv"),12),p=await T1(E,y,m,L);return{weba_version:q,layer1_ref:J,layer2:{enc:"HPKE-v1",suite:{kem:D,kdf:"HKDF-SHA256",aead:"AES-256-GCM"},recipient:Q,encapsulated:{classical:K8(_),...A?{pqc:K8(A)}:{}},ciphertext:K8(p),aad:K8(L)},meta:{created_at:new Date().toISOString(),nonce:K8(L1(16)),...$.config.campaign_id?{campaign_id:$.config.campaign_id}:{},...$.config.key_policy?{key_policy:$.config.key_policy}:{}}}}function A1(){let $=document.getElementById("weba-l2-config");if(!$||!$.textContent)return null;try{return JSON.parse($.textContent)}catch{return null}}async function l0($,q,Q){let J=t($.layer2.aad),G={layer1_ref:$.layer1_ref,recipient:$.layer2.recipient,weba_version:$.weba_version},U=new TextEncoder().encode(L0(G));if(K8(U)!==$.layer2.aad)throw new Error("AAD mismatch");let X=t($.layer2.encapsulated.classical),Z=o8.getSharedSecret(q,X),Y=Z;if($.layer2.encapsulated.pqc){let w=Q?.pqcProvider??H1(),_=Q?.pqcRecipientSk;if(!w||!_)throw new Error("Missing PQC KEM for envelope");let H=t($.layer2.encapsulated.pqc),V=w.decapsulate(_,H);Y=z1(Z,V)}let M=N8(X8,Y,J,void 0,32),N=N8(X8,M,void 0,new TextEncoder().encode("weba-l2/key"),32),L=N8(X8,M,void 0,new TextEncoder().encode("weba-l2/iv"),12),E=t($.layer2.ciphertext),I=await I1(E,N,L,J);return JSON.parse(new TextDecoder().decode(I))}async function w1($){let q=N8(X8,$.prfKey,void 0,void 0,32),Q=N8(X8,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),J=N8(X8,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),G=$.keywrap.aad?t($.keywrap.aad):new Uint8Array,U=t($.keywrap.wrapped_key);return I1(U,Q,J,G)}function $J($){$.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox"||Q.type==="radio")Q.checked=!1,Q.removeAttribute("checked");else Q.value="",Q.removeAttribute("value")}),$.querySelectorAll("textarea").forEach((Q)=>{Q.value="",Q.textContent=""}),$.querySelectorAll("select").forEach((Q)=>{Q.selectedIndex=-1,Q.querySelectorAll("option").forEach((J)=>J.removeAttribute("selected"))}),$.getElementById("json-ld")?.remove(),$.getElementById("data-layer")?.remove();let q=$.getElementById("json-debug");if(q)q.textContent=""}function qJ($,q){let Q=JSON.stringify(q,null,2),J=$.createElement("script");J.type="application/ld+json",J.id="weba-user-vc",J.textContent=Q,$.body.appendChild(J);let G=$.createElement("div");G.className="weba-user-verification no-print",G.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",G.innerHTML=`
    <details>
      <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
        <span></span> 
      </summary>
      <div style="padding: 1rem 0;">
        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
      </div>
    </details>
  `;let U=G.querySelector("pre");if(U)U.textContent=Q;$.body.appendChild(G)}function QJ($,q){let Q=$.createElement("script");Q.id="weba-l2-envelope",Q.type="application/json",Q.textContent=JSON.stringify(q,null,2),$.body.appendChild(Q)}function JJ($,q){let Q=new Date,J=Q.getFullYear()+("0"+(Q.getMonth()+1)).slice(-2)+("0"+Q.getDate()).slice(-2)+"-"+("0"+Q.getHours()).slice(-2)+("0"+Q.getMinutes()).slice(-2),G=Math.random().toString(36).substring(2,8);return`${$}_${J}_${q}_${G}.html`}function GJ($,q){let J=new DOMParser().parseFromString($,"text/html");if(q?.stripPlaintext)$J(J);if(q?.embeddedVc)qJ(J,q.embeddedVc);if(q?.l2Envelope)QJ(J,q.l2Envelope);return J.documentElement.outerHTML}function j1($){let q=GJ($.documentHtml,$.options),Q=new Blob([q],{type:"text/html"}),J=URL.createObjectURL(Q),G=document.createElement("a");if(G.href=J,G.download=JJ($.title,$.filenameSuffix),G.click(),$.isFinal)setTimeout(()=>window.location.reload(),1000)}class _${formId;constructor(){this.formId="WebA_"+window.location.pathname}updateJsonLd(){let q=window.generatedJsonStructure||{};document.querySelectorAll("[data-json-path]").forEach((G)=>{let U=G.dataset.jsonPath;if(U)q[U]=G.value}),document.querySelectorAll('[type="radio"]:checked').forEach((G)=>{q[G.name]=G.value}),document.querySelectorAll("table.data-table.dynamic").forEach((G)=>{let U=G.dataset.tableKey;if(U){let X=[];G.querySelectorAll("tbody tr").forEach((Z)=>{let Y={},M=!1;if(Z.querySelectorAll("[data-base-key]").forEach((N)=>{if(N.type==="checkbox"){if(Y[N.dataset.baseKey]=N.checked,N.checked)M=!0}else if(Y[N.dataset.baseKey]=N.value,N.value)M=!0}),M)X.push(Y)}),q[U]=X}});let Q=document.getElementById("json-ld");if(Q)Q.textContent=JSON.stringify(q,null,2);let J=document.getElementById("json-debug");if(J)J.textContent=JSON.stringify(q,null,2);return q}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=this.updateJsonLd(),q=window,Q=q.generatedJsonStructure&&q.generatedJsonStructure.name||"Response",J=window.location.href.split("#")[0],G=this.getL2Config(),U=document.getElementById("weba-l2-encrypt");if(!!(G?.enabled&&(U?U.checked:G.default_enabled))){if(!G?.recipient_kid||!G?.recipient_x25519||!G?.layer1_ref){alert("L2 encryption config is missing required fields.");return}try{let Y=await B1({layer2_plain:$,config:G,user_kid:G.user_kid});this.downloadHtml("submit",!0,{l2Envelope:Y,stripPlaintext:!0})}catch(Y){console.error(Y),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!t8.getPublicKey()){if(!await t8.register()){alert("Key registration failed.");return}}let Z={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:t8.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:J,answers:$}};try{let Y=await t8.sign(Z);this.downloadHtml("submitted",!0,{embeddedVc:Y})}catch(Y){console.error(Y),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let q=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((Q)=>{let J=Q.dataset.jsonPath;if(q[J]!==void 0)Q.value=q[J]}),document.querySelectorAll("table.data-table.dynamic").forEach((Q)=>{let J=Q.dataset.tableKey,G=q[J];if(Array.isArray(G)){let U=Q.querySelector("tbody");if(!U)return;let X=U.querySelectorAll(".template-row");G.forEach((Z,Y)=>{let M;if(Y===0)M=U.querySelector(".template-row");else{let N=U.querySelector(".template-row");if(N){M=N.cloneNode(!0),M.classList.remove("template-row");let L=M.querySelector(".remove-row-btn");if(L)L.style.visibility="visible";U.appendChild(M)}}if(M)M.querySelectorAll("input, select").forEach((N)=>{let L=N.dataset.baseKey;if(L&&Z[L]!==void 0)if(N.type==="checkbox")N.checked=!!Z[L];else N.value=Z[L]})})}})}catch(q){console.error(q)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,q,Q){let J=window,G=J.generatedJsonStructure&&J.generatedJsonStructure.name||"web-a-form";j1({documentHtml:document.documentElement.outerHTML,title:G,filenameSuffix:$,isFinal:q,options:Q})}saveDraft(){this.bakeValues(),this.downloadHtml("draft",!1)}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class S${calc;data;constructor($,q){this.calc=$,this.data=q}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save Progress",clear_btn:"Clear Data",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},q=(navigator.language||"en").startsWith("ja")?"ja":"en",Q=$[q]||$.en;document.querySelectorAll("[data-i18n]").forEach((J)=>{let G=J.dataset.i18n;if(Q[G])J.textContent=Q[G]})}initTables(){document.querySelectorAll(".data-table.dynamic tbody").forEach(($)=>{this.renumberRows($)})}renumberRows($){Array.from($.querySelectorAll("tr")).filter((Q)=>{return Q.querySelectorAll("td").length>0}).forEach((Q,J)=>{let G=J+1;Q.querySelectorAll(".auto-num").forEach((U)=>{if(U.value!=G)U.value=G.toString(),U.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let q=$.closest("tr"),Q=q.parentElement;if(q.classList.contains("template-row"))q.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox")J.checked=!1;else J.value=""});else{if(q.remove(),Q)this.renumberRows(Q);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,q){let Q=document.getElementById("tbl_"+q);if(!Q)return;let J=Q.querySelector("tbody");if(!J)return;let G=J.querySelector(".template-row");if(!G)return;let U=G.cloneNode(!0);U.classList.remove("template-row"),U.querySelectorAll("input").forEach((Z)=>{if(Z.type==="checkbox")Z.checked=Z.hasAttribute("checked");else Z.value=Z.getAttribute("value")||""});let X=U.querySelector(".remove-row-btn");if(X)X.style.visibility="visible";U.querySelectorAll("[data-copy-from]").forEach((Z)=>{let Y=Z.dataset.copyFrom;if(Y){let M=U.querySelector(`[data-base-key="${Y}"]`);if(M&&M.value)Z.value=M.value}}),J.appendChild(U),this.renumberRows(J),this.calc.recalculate()}switchTab($,q){document.querySelectorAll(".tab-btn").forEach((J)=>J.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((J)=>J.classList.remove("active")),$.classList.add("active");let Q=document.getElementById(q);if(Q)Q.classList.add("active")}}function V1($){let q=document.getElementById($);if(!q||!q.textContent)return null;try{return JSON.parse(q.textContent)}catch{return null}}function f1(){let $=V1("weba-l2-envelope");if(!$)return;let q=V1("weba-l2-keywrap"),Q=document.querySelector(".weba-form-container")||document.body,J=document.createElement("div");J.className="weba-l2-unlock",J.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #cbd5f5;border-radius:10px;background:#f8fafc;";let G=document.createElement("div");G.textContent="Encrypted Submission",G.style.cssText="font-weight:600;color:#334155;margin-bottom:0.5rem;",J.appendChild(G);let U=document.createElement("div");U.textContent="Locked. Unlock with Passkey.",U.style.cssText="color:#64748b;margin-bottom:0.75rem;",J.appendChild(U);let X=document.createElement("button");X.textContent="Unlock (Passkey)",X.style.cssText="padding:0.5rem 1rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;",J.appendChild(X);let Z=document.createElement("pre");Z.style.cssText="margin-top:1rem;padding:1rem;background:#0f172a;color:#e2e8f0;border-radius:8px;overflow:auto;font-size:0.85rem;display:none;",J.appendChild(Z);let Y=document.createElement("details");Y.style.cssText="margin-top:0.75rem; display:none;",Y.innerHTML='<summary style="cursor:pointer;color:#64748b;">Show signature</summary><pre style="margin-top:0.5rem;padding:0.75rem;background:#0b1220;color:#cbd5f5;border-radius:6px;overflow:auto;font-size:0.8rem;"></pre>',J.appendChild(Y);let M=document.createElement("button");M.textContent="Export JSON",M.style.cssText="margin-top:0.75rem;padding:0.45rem 0.9rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;display:none;",M.disabled=!0,J.appendChild(M),X.addEventListener("click",async()=>{if(!q){U.textContent="Key wrap package not found.";return}X.disabled=!0,U.textContent="Waiting for passkey...";try{let N=t(q.prf_salt),L=await c0(q.credential_id,N),E=await w1({keywrap:q,prfKey:L}),I=await l0($,E);UJ(I.layer2_plain),document.body.classList.add("weba-l2-readonly"),Z.textContent=JSON.stringify(I.layer2_plain,null,2),Z.style.display="block";let w=Y.querySelector("pre");if(w)w.textContent=JSON.stringify(I.layer2_sig,null,2);Y.style.display="block",M.style.display="inline-block",M.disabled=!1,U.textContent="Unlocked.",M.onclick=()=>{let _=new Blob([JSON.stringify(I,null,2)],{type:"application/json"}),H=URL.createObjectURL(_),V=document.createElement("a");V.href=H,V.download="weba-l2-decrypted.json",V.click()}}catch(N){console.error(N),U.textContent="Unlock failed.",X.disabled=!1}}),Q.appendChild(J)}function UJ($){if(!$||typeof $!=="object")return;let q=$;document.querySelectorAll("[data-json-path]").forEach((Q)=>{let J=Q.dataset.jsonPath;if(!J||!(J in q))return;let G=q[J];if(Q.type==="checkbox")Q.checked=Boolean(G);else if(Q.type==="radio")Q.checked=Q.value===String(G);else Q.value=G===null||G===void 0?"":String(G)}),document.querySelectorAll('input[type="radio"]').forEach((Q)=>{let J=Q.name;if(!J||!(J in q))return;let G=q[J];Q.checked=Q.value===String(G)}),document.querySelectorAll("table.data-table.dynamic").forEach((Q)=>{let J=Q.dataset.tableKey;if(!J)return;let G=q[J];if(!Array.isArray(G))return;let U=Q.querySelector("tbody");if(!U)return;let X=U.querySelector("tr.template-row");if(!X)return;Array.from(U.querySelectorAll("tr")).forEach((Z)=>{if(!Z.classList.contains("template-row"))Z.remove()}),G.forEach((Z,Y)=>{let M=Y===0?X:X.cloneNode(!0);if(Y>0){M.classList.remove("template-row");let N=M.querySelector(".remove-row-btn");if(N)N.style.visibility="visible";U.appendChild(M)}if(Z&&typeof Z==="object")M.querySelectorAll("input, select, textarea").forEach((N)=>{let L=N.dataset.baseKey;if(!L)return;let E=Z[L];if(N.type==="checkbox")N.checked=Boolean(E);else N.value=E===null||E===void 0?"":String(E)})})}),document.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox"||Q.type==="radio")Q.disabled=!0;else Q.readOnly=!0}),document.querySelectorAll("textarea").forEach((Q)=>{Q.readOnly=!0}),document.querySelectorAll("select").forEach((Q)=>{Q.disabled=!0}),document.querySelectorAll(".form-toolbar button, .add-row-btn, .remove-row-btn").forEach((Q)=>{Q.disabled=!0})}function B8($){return document.getElementById($)}function F1(){if(!B8("weba-l2-keywrap-tool"))return;let q=B8("kwp-recipient-sk"),Q=B8("kwp-credential-id"),J=B8("kwp-prf-salt"),G=B8("kwp-aad"),U=B8("kwp-kid"),X=B8("kwp-status"),Z=B8("kwp-output"),Y=B8("kwp-generate-salt"),M=B8("kwp-wrap");if(!q||!Q||!J||!X||!Z||!M)return;Y?.addEventListener("click",()=>{let N=new Uint8Array(32);crypto.getRandomValues(N),J.value=K8(N)}),M.addEventListener("click",async()=>{X.textContent="Waiting for passkey...",M.disabled=!0;try{if(!q.value||!Q.value||!J.value)throw new Error("Missing required fields.");let N=t(q.value.trim()),L=t(J.value.trim()),E=await c0(Q.value.trim(),L),I=G?.value?t(G.value.trim()):void 0,w=await R1({recipientSk:N,prfKey:E,aad:I}),_={alg:"WebAuthn-PRF-AESGCM-v1",kid:U?.value||"issuer#passkey-1",credential_id:Q.value.trim(),prf_salt:K8(L),wrapped_key:K8(w),...I?{aad:K8(I)}:{}};Z.textContent=JSON.stringify(_,null,2),X.textContent="Key wrap ready."}catch(N){console.error(N),X.textContent="Key wrap failed."}finally{M.disabled=!1}})}function x1($){let q={},Q=(J,G)=>{if(J===null||J===void 0){q[G]=null;return}if(Array.isArray(J)){J.forEach((U,X)=>{Q(U,G?`${G}[${X}]`:`[${X}]`)});return}if(typeof J==="object"){Object.entries(J).forEach(([U,X])=>{let Z=G?`${G}.${U}`:U;Q(X,Z)});return}q[G]=J};if(Q($,""),""in q)delete q[""];return q}function y$($){let q={_filename:$.filename},Q=new Set(["_filename"]);if($.includeJson)Q.add("_json"),q._json=JSON.stringify($.plain);let J=x1($.plain||{});for(let G of Object.keys(J)){if($.omitKey&&$.omitKey(G))continue;Q.add(G),q[G]=J[G]}if($.sig)Q.add("_l2_sig"),q._l2_sig=JSON.stringify($.sig);return{row:q,keys:Q}}function P1($){if($===null||$===void 0)return"";let q=String($);if(/[",\n]/.test(q))return`"${q.replace(/"/g,'""')}"`;return q}function k1($,q){let Q=[];return Q.push(q.map(P1).join(",")),$.forEach((J)=>{let G=q.map((U)=>P1(J[U])).join(",");Q.push(G)}),"\uFEFF"+Q.join(`
`)}function _1($){if(typeof DOMParser!=="undefined")return new DOMParser().parseFromString($,"text/html");if(typeof document!=="undefined"){let q=document.implementation.createHTMLDocument("");return q.documentElement.innerHTML=$,q}return null}function S1($,q){let Q=_1($);if(Q)return Q.getElementById(q)?.textContent??null;let J=new RegExp(`<script[^>]*id=["']${q}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),G=$.match(J);return G?G[1]:null}function XJ($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function YJ($,q){let Q=_1($);if(Q)return Q.querySelector(`script[type="${q}"]`)?.textContent??null;let J=new RegExp(`<script[^>]*type=["']${XJ(q)}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),G=$.match(J);return G?G[1]:null}function y1($){let q=S1($,"data-layer");if(q)try{return JSON.parse(q)}catch{return null}let Q=YJ($,"application/ld+json");if(Q)try{return JSON.parse(Q)}catch{return null}return null}function v1($){let q=S1($,"weba-l2-envelope");if(!q)return null;try{return JSON.parse(q)}catch{return null}}function ZJ($){if(!$.trim())return null;try{let q=JSON.parse($);if(!q.recipient_x25519_private&&!q.org_root_key)return null;return q}catch{return null}}function NJ(){let $=document.getElementById("weba-l2-keys");if(!$?.textContent)return null;return ZJ($.textContent)}function KJ(){let $=document.getElementById("weba-agg-spec");if(!$?.textContent)return null;try{let q=JSON.parse($.textContent);if(Array.isArray(q))return q[0]??null;return q}catch{return null}}function u8($,q){let Q=q.trim().replace(/^\$\./,"");if(!Q)return[];let J=Q.split("."),G=[$];for(let U of J){let X=U.match(/^(.*)\\[(\\d*)\\]$/),Z=X?X[1]:U,Y=X?X[2]:null,M=X&&Y==="",N=X&&Y!==""?parseInt(Y,10):null,L=[];for(let E of G){if(E===null||E===void 0)continue;let I=Z?E[Z]:E;if(M){if(Array.isArray(I))L.push(...I);continue}if(N!==null){if(Array.isArray(I)&&I[N]!==void 0)L.push(I[N]);continue}if(I!==void 0)L.push(I)}G=L}return G}function d0($){if(typeof $==="number"&&Number.isFinite($))return $;if(typeof $==="string"&&$.trim()!==""){let q=Number($.replace(/,/g,""));return Number.isFinite(q)?q:null}return null}function OJ($,q){let Q=u8($,q.path);if(q.op==="exists")return Q.length>0;let J=Q[0],G=q.value;if(q.op==="eq")return J===G;if(q.op==="neq")return J!==G;if(q.op==="in"&&Array.isArray(G))return G.includes(J);let U=d0(J),X=d0(G);if(U===null||X===null)return!1;if(q.op==="gt")return U>X;if(q.op==="gte")return U>=X;if(q.op==="lt")return U<X;if(q.op==="lte")return U<=X;return!1}function g$($,q){if(!q)return $;let Q=Array.isArray(q)?q:[q];return $.filter((J)=>Q.every((G)=>OJ(J,G)))}function g1($,q){let Q=g$($,q.filter);if(q.op==="count"){if(q.path)return Q.reduce((U,X)=>U+u8(X,q.path).length,0);return Q.length}let G=(q.path?Q.flatMap((U)=>u8(U,q.path)):Q).map((U)=>d0(U)).filter((U)=>U!==null);if(G.length===0)return null;if(q.op==="sum")return G.reduce((U,X)=>U+X,0);if(q.op==="avg")return G.reduce((U,X)=>U+X,0)/G.length;if(q.op==="min")return Math.min(...G);if(q.op==="max")return Math.max(...G);return null}function v$($,q){if($===null)return"-";if(q==="currency")return new Intl.NumberFormat(void 0,{style:"currency",currency:"JPY"}).format($);if(q==="percent")return new Intl.NumberFormat(void 0,{style:"percent",maximumFractionDigits:1}).format($);return new Intl.NumberFormat().format($)}function C0($,q){return v$($,q)}function b1($,q){if(!q)return $;let Q=[];for(let J of $){let G=u8(J,q);for(let U of G)if(Array.isArray(U))Q.push(...U);else if(U!==void 0&&U!==null)Q.push(U)}return Q}function MJ($,q){let Q=b1($,q.source),J=g$(Q,q.filter),G=new Map;for(let X of J){let Z=u8(X,q.x);if(Z.length===0)continue;for(let Y of Z){let M=Y===void 0||Y===null||Y===""?"Unknown":String(Y);G.set(M,(G.get(M)||0)+1)}}let U=Array.from(G.entries()).map(([X,Z])=>({label:X,value:Z}));if(q.sort){let X=q.sort.order==="asc"?1:-1;U.sort((Z,Y)=>{if(q.sort?.by==="label")return Z.label.localeCompare(Y.label)*X;return(Z.value-Y.value)*X})}if(q.limit)U=U.slice(0,q.limit);return U}function WJ($,q){let Q=b1($,q.source),J=g$(Q,q.filter),G=[];for(let L of J){let E=u8(L,q.value);for(let I of E){let w=d0(I);if(w!==null)G.push(w)}}if(G.length===0||q.bin<=0)return[];let U=q.min??0,X=q.max??Math.max(...G),Z=new Map,Y=0;for(let L of G){if(q.max!==void 0&&L>q.max){Y+=1;continue}let E=Math.max(0,Math.floor((L-U)/q.bin)),I=U+E*q.bin;Z.set(I,(Z.get(I)||0)+1)}let M=[],N=Math.max(1,Math.ceil((X-U+1)/q.bin));for(let L=0;L<N;L+=1){let E=U+L*q.bin,I=E+q.bin-1,w=`${C0(E,q.format)} - ${C0(I,q.format)}`;M.push({label:w,value:Z.get(E)||0})}if(Y>0&&q.max!==void 0)M.push({label:`${C0(q.max,q.format)}+`,value:Y});return M}function LJ($,q){if(q.length===0)return"";let Q=Math.max(...q.map((U)=>U.value)),J=$.title?`<div class="agg-chart-title">${$.title}</div>`:"",G=q.map((U)=>{let X=Q>0?U.value/Q*100:0,Z=C0(U.value,$.format);return`<div class="agg-bar"><div class="agg-bar-label">${U.label}</div><div class="agg-bar-track"><div class="agg-bar-fill" style="width:${X}%"></div></div><div class="agg-bar-value">${Z}</div></div>`}).join("");return`<div class="agg-chart">${J}<div class="agg-bar-list">${G}</div></div>`}function CJ($,q){if(q.length===0)return"";let Q=Math.max(...q.map((U)=>U.value)),J=$.title?`<div class="agg-chart-title">${$.title}</div>`:"",G=q.map((U)=>{let X=Q>0?U.value/Q*100:0,Z=C0(U.value,$.format);return`<div class="agg-bar"><div class="agg-bar-label">${U.label}</div><div class="agg-bar-track"><div class="agg-bar-fill" style="width:${X}%"></div></div><div class="agg-bar-value">${Z}</div></div>`}).join("");return`<div class="agg-chart">${J}<div class="agg-bar-list">${G}</div></div>`}function m1($,q,Q){if(!q?.dashboard||Q.length===0){$.innerHTML="";return}let J=Q.map((N)=>N.plain),G=q.dashboard.title?`<div class="agg-dashboard-title">${q.dashboard.title}</div>`:"",U=(q.dashboard.cards||[]).map((N)=>{let L=g1(J,N),E=v$(L,N.format);return`<div class="agg-card"><div class="agg-card-label">${N.label}</div><div class="agg-card-value">${E}</div></div>`}).join(""),X=U?`<div class="agg-card-grid">${U}</div>`:"",Z=(q.dashboard.charts||[]).map((N)=>{if(N.type==="bar"){let L=MJ(J,N);return LJ(N,L)}if(N.type==="hist"){let L=WJ(J,N);return CJ(N,L)}return""}).filter(Boolean).join(""),Y=Z?`<div class="agg-chart-grid">${Z}</div>`:"",M=(q.dashboard.tables||[]).map((N)=>{let L=new Map;for(let A of J){let D=u8(A,N.group_by)[0],k=D===void 0||D===null||D===""?"Unknown":String(D);if(!L.has(k))L.set(k,[]);L.get(k).push(A)}let E=Array.from(L.entries()).map(([A,D])=>{let k={};return N.metrics.forEach((y)=>{let m=g1(D,y);k[y.id]=v$(m,y.format)}),{groupKey:A,metricValues:k}});if(N.sort){let A=N.sort.order==="asc"?1:-1;E.sort((D,k)=>{let y=D.metricValues[N.sort.by],m=k.metricValues[N.sort.by];if(y===m)return 0;return y>m?A:-A})}let I=N.limit?E.slice(0,N.limit):E,_=["Group",...N.metrics.map((A)=>A.label||A.id)].map((A)=>`<th>${A}</th>`).join(""),H=I.map((A)=>{return`<tr>${[`<td>${A.groupKey}</td>`,...N.metrics.map((k)=>`<td>${A.metricValues[k.id]}</td>`)].join("")}</tr>`}).join("");return`<div class="agg-dashboard-table">${N.label?`<div class="agg-table-title">${N.label}</div>`:""}<table class="agg-table"><thead><tr>${_}</tr></thead><tbody>${H}</tbody></table></div>`}).join("");$.innerHTML=`${G}${X}${Y}${M}`}async function zJ($,q){let Q=v1($);if(Q){let G=null;if(q){if(q.recipient_kid&&Q.layer2?.recipient&&q.recipient_kid!==Q.layer2.recipient)throw new Error(`recipient_kid mismatch (${Q.layer2.recipient})`);if(q.org_root_key){let Z=q.org_campaign_id||Q.meta?.campaign_id;if(!Z)throw new Error("org_campaign_id is required for org_root_key");G=E1({orgRootKey:t(q.org_root_key),campaignId:Z,layer1Ref:Q.layer1_ref,keyPolicy:q.org_key_policy||Q.meta?.key_policy}).privateKey}else if(q.recipient_x25519_private)G=t(q.recipient_x25519_private)}if(!G){if(!q)throw new Error("No recipient key provided and not a demo campaign");throw new Error("No recipient key provided")}let U=q?.recipient_pqc_private&&q?.recipient_pqc_kem==="ML-KEM-768"?{pqcProvider:globalThis.webaPqcKem??null,pqcRecipientSk:t(q.recipient_pqc_private)}:void 0,X=await l0(Q,G,U);return{plain:X.layer2_plain??X,sig:X.layer2_sig,source:"l2"}}let J=y1($);if(J)return{plain:J,source:"jsonld"};return{source:null}}function EJ($,q,Q){if(q.length===0){$.innerHTML='<div class="agg-empty">No rows to display.</div>';return}let J=Q.map((U)=>`<th>${U}</th>`).join(""),G=q.slice(0,20).map((U)=>{return`<tr>${Q.map((Z)=>`<td>${U[Z]??""}</td>`).join("")}</tr>`}).join("");$.innerHTML=`<table class="agg-table"><thead><tr>${J}</tr></thead><tbody>${G}</tbody></table>`}function h1(){let $=document.getElementById("aggregator-root");if(!$)return;$.innerHTML=`
    <div class="agg-panel">
      <div class="agg-row">
        <label class="agg-label">Input HTML</label>
        <input id="weba-agg-files" type="file" accept=".html" multiple />
      </div>
      <div class="agg-row">
        <label class="agg-label">L2 Key (embedded)</label>
        <div id="weba-agg-key-status" class="agg-chip">Not loaded</div>
        <div class="agg-note">Use <code>&lt;script id="weba-l2-keys"&gt;</code> to embed.</div>
      </div>
      <div class="agg-row">
        <button id="weba-agg-passkey" class="agg-btn secondary">\uD83D\uDD11 Decrypt with Passkey</button>
      </div>
      <div class="agg-row">
        <label class="agg-label">Include JSON</label>
        <input id="weba-agg-include-json" type="checkbox" />
      </div>
      <div class="agg-row">
        <button id="weba-agg-run" class="agg-btn">Decrypt & Aggregate</button>
        <button id="weba-agg-download" class="agg-btn secondary" disabled>Download CSV</button>
        <button id="weba-agg-download-jsonl" class="agg-btn secondary" disabled>Download JSONL</button>
      </div>
      <div id="weba-agg-status" class="agg-status">Ready.</div>
    </div>
    <div id="weba-agg-dashboard" class="agg-dashboard"></div>
    <div id="weba-agg-output" class="agg-output"></div>
  `;let q=$.querySelector("#weba-agg-files"),Q=$.querySelector("#weba-agg-status"),J=$.querySelector("#weba-agg-output"),G=$.querySelector("#weba-agg-dashboard"),U=$.querySelector("#weba-agg-include-json"),X=$.querySelector("#weba-agg-run"),Z=$.querySelector("#weba-agg-download"),Y=$.querySelector("#weba-agg-download-jsonl"),M=$.querySelector("#weba-agg-key-status"),N=$.querySelector("#weba-agg-passkey"),L="",E="",I=[],w=null,_=NJ(),H=KJ(),V=Array.isArray(H?.samples)?H.samples.map((D,k)=>({filename:`sample-${k+1}.json`,plain:D})):[];if(M)M.textContent=_?.recipient_kid?`Loaded (${_.recipient_kid})`:_?"Loaded":"Not loaded",M.classList.toggle("ready",!!_);if(H?.export?.jsonl===!1&&Y)Y.disabled=!0;N?.addEventListener("click",async()=>{try{if(!prompt("User Name for Passkey:","demo-user"))return;alert("Please authenticate with your Passkey to decrypt.");let k=new Uint8Array(32),y=new Uint8Array(32),m=await navigator.credentials.get({publicKey:{challenge:k,userVerification:"required",extensions:{prf:{eval:{first:y}}}}});if(!m)throw new Error("No credential found.");let j=m.getClientExtensionResults()?.prf?.results?.first;if(!j)throw new Error("PRF not supported or enabled on this key.");let x=new Uint8Array(j),F=D1(x);w={recipient_x25519_private:K8(F.privateKey)},N.textContent=" Passkey Loaded",N.disabled=!0}catch(D){console.error(D),alert("Passkey error: "+D.message)}});let A=async()=>{if((!q?.files||q.files.length===0)&&V.length===0){if(Q)Q.textContent="Select HTML files first.";return}if(Q)Q.textContent="Processing...";if(Z)Z.disabled=!0;if(Y)Y.disabled=!0;let D=[],k=new Set(["_filename"]),y=0,m=0;I=[...V];let p=w||_;if(q?.files)for(let F of Array.from(q.files))try{let c=await F.text(),h=await zJ(c,p);if(h.source==="l2"&&h.plain){I.push({filename:F.name,plain:h.plain,sig:h.sig});let O=y$({plain:h.plain,filename:F.name,includeJson:U?.checked,sig:h.sig});O.keys.forEach((T)=>k.add(T)),D.push(O.row),y+=1;continue}if(h.source==="jsonld"&&h.plain){I.push({filename:F.name,plain:h.plain});let O=y$({plain:h.plain,filename:F.name,includeJson:U?.checked,omitKey:(T)=>T.startsWith("@")});O.keys.forEach((T)=>k.add(T)),D.push(O.row),y+=1;continue}m+=1}catch(c){console.error(c),m+=1}let j=Array.from(k).sort((F,c)=>{if(F==="_filename")return-1;if(c==="_filename")return 1;return F.localeCompare(c)});if(L=k1(D,j),Z)Z.disabled=D.length===0;let x=H?.export?.jsonl!==!1;if(E=I.map((F)=>JSON.stringify({_filename:F.filename,_l2_sig:F.sig??null,...F.plain})).join(`
`),Y)Y.disabled=I.length===0||!x;if(Q)Q.textContent=`Processed ${y} files. Errors: ${m}.`;if(G)m1(G,H,I);if(J)EJ(J,D,j)};if(V.length>0){if(I=[...V],E=I.map((D)=>JSON.stringify({_filename:D.filename,_l2_sig:D.sig??null,...D.plain})).join(`
`),G)m1(G,H,I);if(Y)Y.disabled=E.length===0||H?.export?.jsonl===!1;if(Q)Q.textContent=`Loaded ${V.length} sample records.`}X?.addEventListener("click",()=>{A().catch((D)=>{if(Q)Q.textContent="Failed to aggregate.";console.error(D)})}),Z?.addEventListener("click",()=>{if(!L)return;let D=new Blob([L],{type:"text/csv"}),k=URL.createObjectURL(D),y=document.createElement("a");y.href=k,y.download="weba-aggregated.csv",y.click(),URL.revokeObjectURL(k)}),Y?.addEventListener("click",()=>{if(!E)return;let D=new Blob([E],{type:"application/json"}),k=URL.createObjectURL(D),y=document.createElement("a");y.href=k,y.download="weba-aggregated.jsonl",y.click(),URL.revokeObjectURL(k)})}function p1(){console.log("Web/A Runtime Booting...");let $=new s0,q=new _$,Q=new S$($,q),J=window,G=document.getElementById("weba-structure");if(G?.textContent)try{J.generatedJsonStructure=JSON.parse(G.textContent)}catch(Z){console.warn("Failed to parse weba structure JSON",Z)}let U=A1();if(U)J.webaL2Config=U;J.saveDraft=()=>q.saveDraft(),J.submitDocument=()=>q.submitDocument(),J.signAndDownload=()=>q.signAndDownload(),J.clearData=()=>q.clearData(),J.removeTableRow=(Z)=>Q.removeTableRow(Z),J.addTableRow=(Z,Y)=>Q.addTableRow(Z,Y),J.switchTab=(Z,Y)=>Q.switchTab(Z,Y),J.recalculate=()=>$.recalculate(),J.escapeHtml=(Z)=>{if(!Z)return"";let Y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return Z.toString().replace(/[&<>"']/g,(M)=>Y[M]||M)},q.restoreFromLS(),Q.applyI18n(),Q.initTables(),$.recalculate(),f1(),F1(),h1();let X;document.addEventListener("input",(Z)=>{let Y=Z.target;if(Z.isTrusted)Y.dataset.dirty="true";let M=Y.dataset.baseKey||Y.dataset.jsonPath;if(M)(Y.closest("tr")||document).querySelectorAll(`[data-copy-from="${M}"]`).forEach((E)=>{if(!E.dataset.dirty){if(E.value!==Y.value)E.value=Y.value,E.dispatchEvent(new Event("input"))}});$.recalculate(),q.updateJsonLd(),clearTimeout(X),X=setTimeout(()=>q.saveToLS(),1000)}),console.log("Web/A Runtime Ready.")}class m${suggestionsVisible=!1;activeSearchInput=null;globalBox=null;constructor(){}init(){console.log("Initializing Search Engine (Bundle)...");let $=window;if($.generatedJsonStructure&&$.generatedJsonStructure.masterData){let q=Object.keys($.generatedJsonStructure.masterData);console.log("Master Data Keys available:",q.join(", "))}this.setupEventDelegation()}normalize($){if(!$)return"";let q=$.toString().toLowerCase();return q=q.replace(/[---]/g,(Q)=>{return String.fromCharCode(Q.charCodeAt(0)-65248)}),q=q.replace(/[-]/g,(Q)=>String.fromCharCode(Q.charCodeAt(0)-65248)),q.trim()}clean($){if(!$)return"";let q=this.normalize($);return q=q.replace(/(|||||npo||)/g,""),q=q.replace(/(\(\)|\(\)|\(\))/g,""),q.trim()}toIndex($){let q=parseInt($||"",10);return Number.isFinite(q)?q-1:-1}getGlobalBox(){if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",maxHeight:"200px",overflowY:"auto",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if($.target.classList.contains("search-input"))this.handleSearchInput($.target)}),document.body.addEventListener("click",($)=>{if($.target.classList.contains("suggestion-item"))this.handleSelection($.target)})}handleSearchInput($){this.activeSearchInput=$;let q=window,Q=$.dataset.masterSrc,J=$.dataset.suggestSource;if(!Q&&!J)return;let G=this.toIndex($.dataset.masterLabelIndex),U=this.toIndex($.dataset.masterValueIndex),X=$.value;if(!X){this.hideSuggestions();return}let Z=[],Y=this.normalize(X);if(J==="column"){let M=$.dataset.baseKey,N=$.closest("table");if(N&&M){let L=new Set;N.querySelectorAll(`[data-base-key="${M}"]`).forEach((E)=>{if(E===$)return;let I=E.value;if(I&&this.normalize(I).includes(Y)){if(!L.has(I))L.add(I),Z.push({val:I,row:[I],label:I,score:10})}})}}else if(Q){let M=q.generatedJsonStructure.masterData;if(!M||!M[Q])return;M[Q].forEach((L,E)=>{if(E===0)return;if(L.some((w)=>this.normalize(w||"").includes(Y))){let w=G>=0?L[G]||"":"",_=U>=0?L[U]||"":"",H=U>=0?_:G>=0?w:L[1]||L[0]||"";Z.push({val:H,row:L,label:w,score:10,idx:E})}})}this.renderSuggestions($,Z,G)}renderSuggestions($,q,Q){if(q.length===0){this.hideSuggestions();return}let J=window,G=q.slice(0,10),U="";G.forEach((N)=>{let L=J.escapeHtml(JSON.stringify(N.row)),E=Q>=0?N.label||N.row.join(" : "):N.row.join(" : ");U+=`<div class="suggestion-item" data-val="${J.escapeHtml(N.val)}" data-row="${L}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${J.escapeHtml(E)}</div>`});let X=this.getGlobalBox();X.innerHTML=U;let Z=$.getBoundingClientRect(),Y=window.scrollY||document.documentElement.scrollTop,M=window.scrollX||document.documentElement.scrollLeft;X.style.width=Math.max(Z.width,200)+"px",X.style.left=Z.left+M+"px",X.style.top=Z.bottom+Y+"px",X.querySelectorAll(".suggestion-item").forEach((N)=>{N.onmouseenter=()=>N.style.background="#f0f8ff",N.onmouseleave=()=>N.style.background="white"}),X.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;let q=window,Q=this.activeSearchInput,J=$.dataset.val||"",G=$.dataset.row||"[]";try{let U=JSON.parse(G),X=Q.dataset.masterSrc,Z=X?q.generatedJsonStructure.masterData[X][0]:[],Y=!1;if(Z.length>0&&U.length>0){let M=Q.closest("tr");if(M){let N=Array.from(M.querySelectorAll("input, select, textarea"));Z.forEach((L,E)=>{if(!L)return;let I=U[E];this.fillField(N,L,I,Q,()=>{Y=!0})})}}if(!Y)Q.value=J,Q.dispatchEvent(new Event("input",{bubbles:!0}))}catch(U){console.error(U)}this.hideSuggestions()}fillField($,q,Q,J,G){let U=this.normalize(q),X=$.find((Z)=>{let Y=Z.dataset.baseKey||Z.dataset.jsonPath,M=this.normalize(Z.getAttribute("placeholder")||"");return Y&&this.normalize(Y)===U||M===U});if(X){if(X.value=Q||"",X.dispatchEvent(new Event("input",{bubbles:!0})),X===J)G()}}}var c1=new m$;window.GlobalSearch=c1;p1();c1.init();
