var pQ=Object.create;var{getPrototypeOf:uQ,defineProperty:Lq,getOwnPropertyNames:cQ}=Object;var dQ=Object.prototype.hasOwnProperty;var Iq=($,q,J)=>{J=$!=null?pQ(uQ($)):{};let Q=q||!$||!$.__esModule?Lq(J,"default",{value:$,enumerable:!0}):J;for(let G of cQ($))if(!dQ.call(Q,G))Lq(Q,G,{get:()=>$[G],enumerable:!0});return Q};var lQ=($,q)=>()=>(q||$((q={exports:{}}).exports,q),q.exports);var f$=lQ((zG,RJ)=>{RJ.exports=function $(q){if(typeof q==="number"&&isNaN(q))throw new Error("NaN is not allowed");if(typeof q==="number"&&!isFinite(q))throw new Error("Infinity is not allowed");if(q===null||typeof q!=="object")return JSON.stringify(q);if(q.toJSON instanceof Function)return $(q.toJSON());if(Array.isArray(q))return`[${q.reduce((G,U,X)=>{return`${G}${X===0?"":","}${$(U===void 0||typeof U==="symbol"?null:U)}`},"")}]`;return`{${Object.keys(q).sort().reduce((Q,G)=>{if(q[G]===void 0||typeof q[G]==="symbol")return Q;let U=Q.length===0?"":",";return`${Q}${U}${$(G)}:${$(q[G])}`},"")}}`}});class E${runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let q=$.dataset.copyFrom;if(q){let G=($.closest("tr")||document).querySelector(`[data-base-key="${q}"], [data-json-path="${q}"]`);if(G&&G.value!==$.value)$.value=G.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let q=$.dataset.formula;if(!q)return;let J=$.closest("tr"),Q=$.closest("table"),G=(X)=>{let Z=0,Y="none";if(J){let N=`[data-base-key="${X}"], [data-json-path="${X}"]`,W=J.querySelector(N);if(W){if(Y="row-input",W.value!=="")Z=parseFloat(W.value)}}if(Y==="none"){let N=document.querySelector(`[data-json-path="${X}"]`);if(N){if(Y="static-input",N.value!=="")Z=parseFloat(N.value)}}return Z},U=q.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(X,Z)=>{let Y=0,N=Q||document,W=N.querySelectorAll(`[data-base-key="${Z}"], [data-json-path="${Z}"]`);if(W.length===0&&N!==document)W=document.querySelectorAll(`[data-base-key="${Z}"], [data-json-path="${Z}"]`);return W.forEach((K)=>{let E=parseFloat(K.value);if(!isNaN(E))Y+=E}),Y});U=U.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(X)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(X))return X;return String(G(X))});try{let X=new Function("return "+U)();if(typeof X==="number"&&!isNaN(X))$.value=Number.isInteger(X)?X:X.toFixed(0);else $.value=""}catch(X){console.error("Calc Error:",X),$.value="Err"}}),this.runAutoCopy()}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function W0($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function z8($,q=""){if(!Number.isSafeInteger($)||$<0){let J=q&&`"${q}" `;throw new Error(`${J}expected integer >= 0, got ${$}`)}}function u($,q,J=""){let Q=W0($),G=$?.length,U=q!==void 0;if(!Q||U&&G!==q){let X=J&&`"${J}" `,Z=U?` of length ${q}`:"",Y=Q?`length=${G}`:`type=${typeof $}`;throw new Error(X+"expected Uint8Array"+Z+", got "+Y)}return $}function M0($){if(typeof $!=="function"||typeof $.create!=="function")throw new Error("Hash must wrapped by utils.createHasher");z8($.outputLen),z8($.blockLen)}function j8($,q=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(q&&$.finished)throw new Error("Hash#digest() has already been called")}function F0($,q){u($,void 0,"digestInto() output");let J=q.outputLen;if($.length<J)throw new Error('"digestInto() output" expected to be of length >='+J)}function f0($){return new Uint32Array($.buffer,$.byteOffset,Math.floor($.byteLength/4))}function O8(...$){for(let q=0;q<$.length;q++)$[q].fill(0)}function S0($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function L8($,q){return $<<32-q|$>>>q}var nQ=(()=>new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68)();function iQ($){return $<<24&4278190080|$<<8&16711680|$>>>8&65280|$>>>24&255}function oQ($){for(let q=0;q<$.length;q++)$[q]=iQ($[q]);return $}var C$=nQ?($)=>$:oQ,Aq=(()=>typeof Uint8Array.from([]).toHex==="function"&&typeof Uint8Array.fromHex==="function")(),rQ=Array.from({length:256},($,q)=>q.toString(16).padStart(2,"0"));function t8($){if(u($),Aq)return $.toHex();let q="";for(let J=0;J<$.length;J++)q+=rQ[$[J]];return q}var w8={_0:48,_9:57,A:65,F:70,a:97,f:102};function Tq($){if($>=w8._0&&$<=w8._9)return $-w8._0;if($>=w8.A&&$<=w8.F)return $-(w8.A-10);if($>=w8.a&&$<=w8.f)return $-(w8.a-10);return}function N0($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);if(Aq)return Uint8Array.fromHex($);let q=$.length,J=q/2;if(q%2)throw new Error("hex string expected, got unpadded hex of length "+q);let Q=new Uint8Array(J);for(let G=0,U=0;G<J;G++,U+=2){let X=Tq($.charCodeAt(U)),Z=Tq($.charCodeAt(U+1));if(X===void 0||Z===void 0){let Y=$[U]+$[U+1];throw new Error('hex string expected, got non-hex character "'+Y+'" at index '+U)}Q[G]=X*16+Z}return Q}function e8(...$){let q=0;for(let Q=0;Q<$.length;Q++){let G=$[Q];u(G),q+=G.length}let J=new Uint8Array(q);for(let Q=0,G=0;Q<$.length;Q++){let U=$[Q];J.set(U,G),G+=U.length}return J}function $0($,q={}){let J=(G,U)=>$(U).update(G).digest(),Q=$(void 0);return J.outputLen=Q.outputLen,J.blockLen=Q.blockLen,J.create=(G)=>$(G),Object.assign(J,q),Object.freeze(J)}function p8($=32){let q=typeof globalThis==="object"?globalThis.crypto:null;if(typeof q?.getRandomValues!=="function")throw new Error("crypto.getRandomValues must be defined");return q.getRandomValues(new Uint8Array($))}var _8=($)=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,$])});function Bq($,q,J){return $&q^~$&J}function Vq($,q,J){return $&q^$&J^q&J}class x0{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor($,q,J,Q){this.blockLen=$,this.outputLen=q,this.padOffset=J,this.isLE=Q,this.buffer=new Uint8Array($),this.view=S0(this.buffer)}update($){j8(this),u($);let{view:q,buffer:J,blockLen:Q}=this,G=$.length;for(let U=0;U<G;){let X=Math.min(Q-this.pos,G-U);if(X===Q){let Z=S0($);for(;Q<=G-U;U+=Q)this.process(Z,U);continue}if(J.set($.subarray(U,U+X),this.pos),this.pos+=X,U+=X,this.pos===Q)this.process(q,0),this.pos=0}return this.length+=$.length,this.roundClean(),this}digestInto($){j8(this),F0($,this),this.finished=!0;let{buffer:q,view:J,blockLen:Q,isLE:G}=this,{pos:U}=this;if(q[U++]=128,O8(this.buffer.subarray(U)),this.padOffset>Q-U)this.process(J,0),U=0;for(let W=U;W<Q;W++)q[W]=0;J.setBigUint64(Q-8,BigInt(this.length*8),G),this.process(J,0);let X=S0($),Z=this.outputLen;if(Z%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let Y=Z/4,N=this.get();if(Y>N.length)throw new Error("_sha2: outputLen bigger than state");for(let W=0;W<Y;W++)X.setUint32(4*W,N[W],G)}digest(){let{buffer:$,outputLen:q}=this;this.digestInto($);let J=$.slice(0,q);return this.destroy(),J}_cloneInto($){$||=new this.constructor,$.set(...this.get());let{blockLen:q,buffer:J,length:Q,finished:G,destroyed:U,pos:X}=this;if($.destroyed=U,$.finished=G,$.length=Q,$.pos=X,Q%q)$.buffer.set(J);return $}clone(){return this._cloneInto()}}var P8=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),F8=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),q8=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),J8=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var _0=BigInt(4294967295),wq=BigInt(32);function aQ($,q=!1){if(q)return{h:Number($&_0),l:Number($>>wq&_0)};return{h:Number($>>wq&_0)|0,l:Number($&_0)|0}}function k0($,q=!1){let J=$.length,Q=new Uint32Array(J),G=new Uint32Array(J);for(let U=0;U<J;U++){let{h:X,l:Z}=aQ($[U],q);[Q[U],G[U]]=[X,Z]}return[Q,G]}var R$=($,q,J)=>$>>>J,H$=($,q,J)=>$<<32-J|q>>>J,u8=($,q,J)=>$>>>J|q<<32-J,c8=($,q,J)=>$<<32-J|q>>>J,O0=($,q,J)=>$<<64-J|q>>>J-32,K0=($,q,J)=>$>>>J-32|q<<64-J;var jq=($,q,J)=>$<<J|q>>>32-J,Pq=($,q,J)=>q<<J|$>>>32-J,Fq=($,q,J)=>q<<J-32|$>>>64-J,fq=($,q,J)=>$<<J-32|q>>>64-J;function I8($,q,J,Q){let G=(q>>>0)+(Q>>>0);return{h:$+J+(G/4294967296|0)|0,l:G|0}}var Sq=($,q,J)=>($>>>0)+(q>>>0)+(J>>>0),xq=($,q,J,Q)=>q+J+Q+($/4294967296|0)|0,_q=($,q,J,Q)=>($>>>0)+(q>>>0)+(J>>>0)+(Q>>>0),kq=($,q,J,Q,G)=>q+J+Q+G+($/4294967296|0)|0,vq=($,q,J,Q,G)=>($>>>0)+(q>>>0)+(J>>>0)+(Q>>>0)+(G>>>0),yq=($,q,J,Q,G,U)=>q+J+Q+G+U+($/4294967296|0)|0;var tQ=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),k8=new Uint32Array(64);class L$ extends x0{constructor($){super(64,$,8,!1)}get(){let{A:$,B:q,C:J,D:Q,E:G,F:U,G:X,H:Z}=this;return[$,q,J,Q,G,U,X,Z]}set($,q,J,Q,G,U,X,Z){this.A=$|0,this.B=q|0,this.C=J|0,this.D=Q|0,this.E=G|0,this.F=U|0,this.G=X|0,this.H=Z|0}process($,q){for(let W=0;W<16;W++,q+=4)k8[W]=$.getUint32(q,!1);for(let W=16;W<64;W++){let K=k8[W-15],E=k8[W-2],R=L8(K,7)^L8(K,18)^K>>>3,A=L8(E,17)^L8(E,19)^E>>>10;k8[W]=A+k8[W-7]+R+k8[W-16]|0}let{A:J,B:Q,C:G,D:U,E:X,F:Z,G:Y,H:N}=this;for(let W=0;W<64;W++){let K=L8(X,6)^L8(X,11)^L8(X,25),E=N+K+Bq(X,Z,Y)+tQ[W]+k8[W]|0,A=(L8(J,2)^L8(J,13)^L8(J,22))+Vq(J,Q,G)|0;N=Y,Y=Z,Z=X,X=U+E|0,U=G,G=Q,Q=J,J=E+A|0}J=J+this.A|0,Q=Q+this.B|0,G=G+this.C|0,U=U+this.D|0,X=X+this.E|0,Z=Z+this.F|0,Y=Y+this.G|0,N=N+this.H|0,this.set(J,Q,G,U,X,Z,Y,N)}roundClean(){O8(k8)}destroy(){this.set(0,0,0,0,0,0,0,0),O8(this.buffer)}}class gq extends L${A=P8[0]|0;B=P8[1]|0;C=P8[2]|0;D=P8[3]|0;E=P8[4]|0;F=P8[5]|0;G=P8[6]|0;H=P8[7]|0;constructor(){super(32)}}class eQ extends L${A=F8[0]|0;B=F8[1]|0;C=F8[2]|0;D=F8[3]|0;E=F8[4]|0;F=F8[5]|0;G=F8[6]|0;H=F8[7]|0;constructor(){super(28)}}var mq=(()=>k0(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(($)=>BigInt($))))(),$1=(()=>mq[0])(),q1=(()=>mq[1])(),v8=new Uint32Array(80),y8=new Uint32Array(80);class z0 extends x0{constructor($){super(128,$,16,!1)}get(){let{Ah:$,Al:q,Bh:J,Bl:Q,Ch:G,Cl:U,Dh:X,Dl:Z,Eh:Y,El:N,Fh:W,Fl:K,Gh:E,Gl:R,Hh:A,Hl:_}=this;return[$,q,J,Q,G,U,X,Z,Y,N,W,K,E,R,A,_]}set($,q,J,Q,G,U,X,Z,Y,N,W,K,E,R,A,_){this.Ah=$|0,this.Al=q|0,this.Bh=J|0,this.Bl=Q|0,this.Ch=G|0,this.Cl=U|0,this.Dh=X|0,this.Dl=Z|0,this.Eh=Y|0,this.El=N|0,this.Fh=W|0,this.Fl=K|0,this.Gh=E|0,this.Gl=R|0,this.Hh=A|0,this.Hl=_|0}process($,q){for(let C=0;C<16;C++,q+=4)v8[C]=$.getUint32(q),y8[C]=$.getUint32(q+=4);for(let C=16;C<80;C++){let D=v8[C-15]|0,F=y8[C-15]|0,f=u8(D,F,1)^u8(D,F,8)^R$(D,F,7),k=c8(D,F,1)^c8(D,F,8)^H$(D,F,7),y=v8[C-2]|0,V=y8[C-2]|0,P=u8(y,V,19)^O0(y,V,61)^R$(y,V,6),S=c8(y,V,19)^K0(y,V,61)^H$(y,V,6),g=_q(k,S,y8[C-7],y8[C-16]),p=kq(g,f,P,v8[C-7],v8[C-16]);v8[C]=p|0,y8[C]=g|0}let{Ah:J,Al:Q,Bh:G,Bl:U,Ch:X,Cl:Z,Dh:Y,Dl:N,Eh:W,El:K,Fh:E,Fl:R,Gh:A,Gl:_,Hh:L,Hl:j}=this;for(let C=0;C<80;C++){let D=u8(W,K,14)^u8(W,K,18)^O0(W,K,41),F=c8(W,K,14)^c8(W,K,18)^K0(W,K,41),f=W&E^~W&A,k=K&R^~K&_,y=vq(j,F,k,q1[C],y8[C]),V=yq(y,L,D,f,$1[C],v8[C]),P=y|0,S=u8(J,Q,28)^O0(J,Q,34)^O0(J,Q,39),g=c8(J,Q,28)^K0(J,Q,34)^K0(J,Q,39),p=J&G^J&X^G&X,O=Q&U^Q&Z^U&Z;L=A|0,j=_|0,A=E|0,_=R|0,E=W|0,R=K|0,{h:W,l:K}=I8(Y|0,N|0,V|0,P|0),Y=X|0,N=Z|0,X=G|0,Z=U|0,G=J|0,U=Q|0;let T=Sq(P,g,O);J=xq(T,V,S,p),Q=T|0}({h:J,l:Q}=I8(this.Ah|0,this.Al|0,J|0,Q|0)),{h:G,l:U}=I8(this.Bh|0,this.Bl|0,G|0,U|0),{h:X,l:Z}=I8(this.Ch|0,this.Cl|0,X|0,Z|0),{h:Y,l:N}=I8(this.Dh|0,this.Dl|0,Y|0,N|0),{h:W,l:K}=I8(this.Eh|0,this.El|0,W|0,K|0),{h:E,l:R}=I8(this.Fh|0,this.Fl|0,E|0,R|0),{h:A,l:_}=I8(this.Gh|0,this.Gl|0,A|0,_|0),{h:L,l:j}=I8(this.Hh|0,this.Hl|0,L|0,j|0),this.set(J,Q,G,U,X,Z,Y,N,W,K,E,R,A,_,L,j)}roundClean(){O8(v8,y8)}destroy(){O8(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class bq extends z0{Ah=J8[0]|0;Al=J8[1]|0;Bh=J8[2]|0;Bl=J8[3]|0;Ch=J8[4]|0;Cl=J8[5]|0;Dh=J8[6]|0;Dl=J8[7]|0;Eh=J8[8]|0;El=J8[9]|0;Fh=J8[10]|0;Fl=J8[11]|0;Gh=J8[12]|0;Gl=J8[13]|0;Hh=J8[14]|0;Hl=J8[15]|0;constructor(){super(64)}}class J1 extends z0{Ah=q8[0]|0;Al=q8[1]|0;Bh=q8[2]|0;Bl=q8[3]|0;Ch=q8[4]|0;Cl=q8[5]|0;Dh=q8[6]|0;Dl=q8[7]|0;Eh=q8[8]|0;El=q8[9]|0;Fh=q8[10]|0;Fl=q8[11]|0;Gh=q8[12]|0;Gl=q8[13]|0;Hh=q8[14]|0;Hl=q8[15]|0;constructor(){super(48)}}var Q8=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),G8=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class Q1 extends z0{Ah=Q8[0]|0;Al=Q8[1]|0;Bh=Q8[2]|0;Bl=Q8[3]|0;Ch=Q8[4]|0;Cl=Q8[5]|0;Dh=Q8[6]|0;Dl=Q8[7]|0;Eh=Q8[8]|0;El=Q8[9]|0;Fh=Q8[10]|0;Fl=Q8[11]|0;Gh=Q8[12]|0;Gl=Q8[13]|0;Hh=Q8[14]|0;Hl=Q8[15]|0;constructor(){super(28)}}class G1 extends z0{Ah=G8[0]|0;Al=G8[1]|0;Bh=G8[2]|0;Bl=G8[3]|0;Ch=G8[4]|0;Cl=G8[5]|0;Dh=G8[6]|0;Dl=G8[7]|0;Eh=G8[8]|0;El=G8[9]|0;Fh=G8[10]|0;Fl=G8[11]|0;Gh=G8[12]|0;Gl=G8[13]|0;Hh=G8[14]|0;Hl=G8[15]|0;constructor(){super(32)}}var Y8=$0(()=>new gq,_8(1));var hq=$0(()=>new bq,_8(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var uq=BigInt(0),pq=BigInt(1);function y0($,q=""){if(typeof $!=="boolean"){let J=q&&`"${q}" `;throw new Error(J+"expected boolean, got type="+typeof $)}return $}function U1($){if(typeof $==="bigint"){if(!v0($))throw new Error("positive bigint expected, got "+$)}else z8($);return $}function cq($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);return $===""?uq:BigInt("0x"+$)}function dq($){return cq(t8($))}function f8($){return cq(t8(d8(u($)).reverse()))}function I$($,q){z8(q),$=U1($);let J=N0($.toString(16).padStart(q*2,"0"));if(J.length!==q)throw new Error("number too large");return J}function g0($,q){return I$($,q).reverse()}function d8($){return Uint8Array.from($)}var v0=($)=>typeof $==="bigint"&&uq<=$;function X1($,q,J){return v0($)&&v0(q)&&v0(J)&&q<=$&&$<J}function q0($,q,J,Q){if(!X1(q,J,Q))throw new Error("expected valid "+$+": "+J+" <= n < "+Q+", got "+q)}var lq=($)=>(pq<<BigInt($))-pq;function l8($,q={},J={}){if(!$||typeof $!=="object")throw new Error("expected valid options object");function Q(U,X,Z){let Y=$[U];if(Z&&Y===void 0)return;let N=typeof Y;if(N!==X||Y===null)throw new Error(`param "${U}" is invalid: expected ${X}, got ${N}`)}let G=(U,X)=>Object.entries(U).forEach(([Z,Y])=>Q(Z,Y,X));G(q,!1),G(J,!0)}function T$($){let q=new WeakMap;return(J,...Q)=>{let G=q.get(J);if(G!==void 0)return G;let U=$(J,...Q);return q.set(J,U),U}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Z8=BigInt(0),U8=BigInt(1),n8=BigInt(2),oq=BigInt(3),rq=BigInt(4),aq=BigInt(5),Y1=BigInt(7),sq=BigInt(8),Z1=BigInt(9),tq=BigInt(16);function i($,q){let J=$%q;return J>=Z8?J:q+J}function E8($,q,J){let Q=$;while(q-- >Z8)Q*=Q,Q%=J;return Q}function nq($,q){if($===Z8)throw new Error("invert: expected non-zero number");if(q<=Z8)throw new Error("invert: expected positive modulus, got "+q);let J=i($,q),Q=q,G=Z8,U=U8,X=U8,Z=Z8;while(J!==Z8){let N=Q/J,W=Q%J,K=G-X*N,E=U-Z*N;Q=J,J=W,G=X,U=Z,X=K,Z=E}if(Q!==U8)throw new Error("invert: does not exist");return i(G,q)}function A$($,q,J){if(!$.eql($.sqr(q),J))throw new Error("Cannot find square root")}function eq($,q){let J=($.ORDER+U8)/rq,Q=$.pow(q,J);return A$($,Q,q),Q}function W1($,q){let J=($.ORDER-aq)/sq,Q=$.mul(q,n8),G=$.pow(Q,J),U=$.mul(q,G),X=$.mul($.mul(U,n8),G),Z=$.mul(U,$.sub(X,$.ONE));return A$($,Z,q),Z}function M1($){let q=b0($),J=$J($),Q=J(q,q.neg(q.ONE)),G=J(q,Q),U=J(q,q.neg(Q)),X=($+Y1)/tq;return(Z,Y)=>{let N=Z.pow(Y,X),W=Z.mul(N,Q),K=Z.mul(N,G),E=Z.mul(N,U),R=Z.eql(Z.sqr(W),Y),A=Z.eql(Z.sqr(K),Y);N=Z.cmov(N,W,R),W=Z.cmov(E,K,A);let _=Z.eql(Z.sqr(W),Y),L=Z.cmov(N,W,_);return A$(Z,L,Y),L}}function $J($){if($<oq)throw new Error("sqrt is not defined for small field");let q=$-U8,J=0;while(q%n8===Z8)q/=n8,J++;let Q=n8,G=b0($);while(iq(G,Q)===1)if(Q++>1000)throw new Error("Cannot find square root: probably non-prime P");if(J===1)return eq;let U=G.pow(Q,q),X=(q+U8)/n8;return function Z(Y,N){if(Y.is0(N))return N;if(iq(Y,N)!==1)throw new Error("Cannot find square root");let W=J,K=Y.mul(Y.ONE,U),E=Y.pow(N,q),R=Y.pow(N,X);while(!Y.eql(E,Y.ONE)){if(Y.is0(E))return Y.ZERO;let A=1,_=Y.sqr(E);while(!Y.eql(_,Y.ONE))if(A++,_=Y.sqr(_),A===W)throw new Error("Cannot find square root");let L=U8<<BigInt(W-A-1),j=Y.pow(K,L);W=A,K=Y.sqr(j),E=Y.mul(E,K),R=Y.mul(R,j)}return R}}function N1($){if($%rq===oq)return eq;if($%sq===aq)return W1;if($%tq===Z1)return M1($);return $J($)}var qJ=($,q)=>(i($,q)&U8)===U8,O1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function JJ($){let q={ORDER:"bigint",BYTES:"number",BITS:"number"},J=O1.reduce((Q,G)=>{return Q[G]="function",Q},q);return l8($,J),$}function K1($,q,J){if(J<Z8)throw new Error("invalid exponent, negatives unsupported");if(J===Z8)return $.ONE;if(J===U8)return q;let Q=$.ONE,G=q;while(J>Z8){if(J&U8)Q=$.mul(Q,G);G=$.sqr(G),J>>=U8}return Q}function m0($,q,J=!1){let Q=new Array(q.length).fill(J?$.ZERO:void 0),G=q.reduce((X,Z,Y)=>{if($.is0(Z))return X;return Q[Y]=X,$.mul(X,Z)},$.ONE),U=$.inv(G);return q.reduceRight((X,Z,Y)=>{if($.is0(Z))return X;return Q[Y]=$.mul(X,Q[Y]),$.mul(X,Z)},U),Q}function iq($,q){let J=($.ORDER-U8)/n8,Q=$.pow(q,J),G=$.eql(Q,$.ONE),U=$.eql(Q,$.ZERO),X=$.eql(Q,$.neg($.ONE));if(!G&&!U&&!X)throw new Error("invalid Legendre symbol result");return G?1:U?0:-1}function z1($,q){if(q!==void 0)z8(q);let J=q!==void 0?q:$.toString(2).length,Q=Math.ceil(J/8);return{nBitLength:J,nByteLength:Q}}class QJ{ORDER;BITS;BYTES;isLE;ZERO=Z8;ONE=U8;_lengths;_sqrt;_mod;constructor($,q={}){if($<=Z8)throw new Error("invalid field: expected ORDER > 0, got "+$);let J=void 0;if(this.isLE=!1,q!=null&&typeof q==="object"){if(typeof q.BITS==="number")J=q.BITS;if(typeof q.sqrt==="function")this.sqrt=q.sqrt;if(typeof q.isLE==="boolean")this.isLE=q.isLE;if(q.allowedLengths)this._lengths=q.allowedLengths?.slice();if(typeof q.modFromBytes==="boolean")this._mod=q.modFromBytes}let{nBitLength:Q,nByteLength:G}=z1($,J);if(G>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=$,this.BITS=Q,this.BYTES=G,this._sqrt=void 0,Object.preventExtensions(this)}create($){return i($,this.ORDER)}isValid($){if(typeof $!=="bigint")throw new Error("invalid field element: expected bigint, got "+typeof $);return Z8<=$&&$<this.ORDER}is0($){return $===Z8}isValidNot0($){return!this.is0($)&&this.isValid($)}isOdd($){return($&U8)===U8}neg($){return i(-$,this.ORDER)}eql($,q){return $===q}sqr($){return i($*$,this.ORDER)}add($,q){return i($+q,this.ORDER)}sub($,q){return i($-q,this.ORDER)}mul($,q){return i($*q,this.ORDER)}pow($,q){return K1(this,$,q)}div($,q){return i($*nq(q,this.ORDER),this.ORDER)}sqrN($){return $*$}addN($,q){return $+q}subN($,q){return $-q}mulN($,q){return $*q}inv($){return nq($,this.ORDER)}sqrt($){if(!this._sqrt)this._sqrt=N1(this.ORDER);return this._sqrt(this,$)}toBytes($){return this.isLE?g0($,this.BYTES):I$($,this.BYTES)}fromBytes($,q=!1){u($);let{_lengths:J,BYTES:Q,isLE:G,ORDER:U,_mod:X}=this;if(J){if(!J.includes($.length)||$.length>Q)throw new Error("Field.fromBytes: expected "+J+" bytes, got "+$.length);let Y=new Uint8Array(Q);Y.set($,G?0:Y.length-$.length),$=Y}if($.length!==Q)throw new Error("Field.fromBytes: expected "+Q+" bytes, got "+$.length);let Z=G?f8($):dq($);if(X)Z=i(Z,U);if(!q){if(!this.isValid(Z))throw new Error("invalid field element: outside of range 0..ORDER")}return Z}invertBatch($){return m0(this,$)}cmov($,q,J){return J?q:$}}function b0($,q={}){return new QJ($,q)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var h0=BigInt(0),j$=BigInt(1);function GJ($,q){let J=q.negate();return $?J:q}function p0($,q){let J=m0($.Fp,q.map((Q)=>Q.Z));return q.map((Q,G)=>$.fromAffine(Q.toAffine(J[G])))}function ZJ($,q){if(!Number.isSafeInteger($)||$<=0||$>q)throw new Error("invalid window size, expected [1.."+q+"], got W="+$)}function B$($,q){ZJ($,q);let J=Math.ceil(q/$)+1,Q=2**($-1),G=2**$,U=lq($),X=BigInt($);return{windows:J,windowSize:Q,mask:U,maxNumber:G,shiftBy:X}}function UJ($,q,J){let{windowSize:Q,mask:G,maxNumber:U,shiftBy:X}=J,Z=Number($&G),Y=$>>X;if(Z>Q)Z-=U,Y+=j$;let N=q*Q,W=N+Math.abs(Z)-1,K=Z===0,E=Z<0,R=q%2!==0;return{nextN:Y,offset:W,isZero:K,isNeg:E,isNegF:R,offsetF:N}}var V$=new WeakMap,WJ=new WeakMap;function w$($){return WJ.get($)||1}function XJ($){if($!==h0)throw new Error("invalid wNAF")}class P${BASE;ZERO;Fn;bits;constructor($,q){this.BASE=$.BASE,this.ZERO=$.ZERO,this.Fn=$.Fn,this.bits=q}_unsafeLadder($,q,J=this.ZERO){let Q=$;while(q>h0){if(q&j$)J=J.add(Q);Q=Q.double(),q>>=j$}return J}precomputeWindow($,q){let{windows:J,windowSize:Q}=B$(q,this.bits),G=[],U=$,X=U;for(let Z=0;Z<J;Z++){X=U,G.push(X);for(let Y=1;Y<Q;Y++)X=X.add(U),G.push(X);U=X.double()}return G}wNAF($,q,J){if(!this.Fn.isValid(J))throw new Error("invalid scalar");let Q=this.ZERO,G=this.BASE,U=B$($,this.bits);for(let X=0;X<U.windows;X++){let{nextN:Z,offset:Y,isZero:N,isNeg:W,isNegF:K,offsetF:E}=UJ(J,X,U);if(J=Z,N)G=G.add(GJ(K,q[E]));else Q=Q.add(GJ(W,q[Y]))}return XJ(J),{p:Q,f:G}}wNAFUnsafe($,q,J,Q=this.ZERO){let G=B$($,this.bits);for(let U=0;U<G.windows;U++){if(J===h0)break;let{nextN:X,offset:Z,isZero:Y,isNeg:N}=UJ(J,U,G);if(J=X,Y)continue;else{let W=q[Z];Q=Q.add(N?W.negate():W)}}return XJ(J),Q}getPrecomputes($,q,J){let Q=V$.get(q);if(!Q){if(Q=this.precomputeWindow(q,$),$!==1){if(typeof J==="function")Q=J(Q);V$.set(q,Q)}}return Q}cached($,q,J){let Q=w$($);return this.wNAF(Q,this.getPrecomputes(Q,$,J),q)}unsafe($,q,J,Q){let G=w$($);if(G===1)return this._unsafeLadder($,q,Q);return this.wNAFUnsafe(G,this.getPrecomputes(G,$,J),q,Q)}createCache($,q){ZJ(q,this.bits),WJ.set($,q),V$.delete($)}hasCache($){return w$($)!==1}}function YJ($,q,J){if(q){if(q.ORDER!==$)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return JJ(q),q}else return b0($,{isLE:J})}function MJ($,q,J={},Q){if(Q===void 0)Q=$==="edwards";if(!q||typeof q!=="object")throw new Error(`expected valid ${$} CURVE object`);for(let Y of["p","n","h"]){let N=q[Y];if(!(typeof N==="bigint"&&N>h0))throw new Error(`CURVE.${Y} must be positive bigint`)}let G=YJ(q.p,J.Fp,Q),U=YJ(q.n,J.Fn,Q),Z=["Gx","Gy","a",$==="weierstrass"?"b":"d"];for(let Y of Z)if(!G.isValid(q[Y]))throw new Error(`CURVE.${Y} must be valid field element of CURVE.Fp`);return q=Object.freeze(Object.assign({},q)),{CURVE:q,Fp:G,Fn:U}}function u0($,q){return function J(Q){let G=$(Q);return{secretKey:G,publicKey:q(G)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var g8=BigInt(0),e=BigInt(1),F$=BigInt(2),D1=BigInt(8);function E1($,q,J,Q){let G=$.sqr(J),U=$.sqr(Q),X=$.add($.mul(q.a,G),U),Z=$.add($.ONE,$.mul(q.d,$.mul(G,U)));return $.eql(X,Z)}function NJ($,q={}){let J=MJ("edwards",$,q,q.FpFnLE),{Fp:Q,Fn:G}=J,U=J.CURVE,{h:X}=U;l8(q,{},{uvRatio:"function"});let Z=F$<<BigInt(G.BYTES*8)-e,Y=(L)=>Q.create(L),N=q.uvRatio||((L,j)=>{try{return{isValid:!0,value:Q.sqrt(Q.div(L,j))}}catch(C){return{isValid:!1,value:g8}}});if(!E1(Q,U,U.Gx,U.Gy))throw new Error("bad curve params: generator point");function W(L,j,C=!1){let D=C?e:g8;return q0("coordinate "+L,j,D,Z),j}function K(L){if(!(L instanceof A))throw new Error("EdwardsPoint expected")}let E=T$((L,j)=>{let{X:C,Y:D,Z:F}=L,f=L.is0();if(j==null)j=f?D1:Q.inv(F);let k=Y(C*j),y=Y(D*j),V=Q.mul(F,j);if(f)return{x:g8,y:e};if(V!==e)throw new Error("invZ was invalid");return{x:k,y}}),R=T$((L)=>{let{a:j,d:C}=U;if(L.is0())throw new Error("bad point: ZERO");let{X:D,Y:F,Z:f,T:k}=L,y=Y(D*D),V=Y(F*F),P=Y(f*f),S=Y(P*P),g=Y(y*j),p=Y(P*Y(g+V)),O=Y(S+Y(C*Y(y*V)));if(p!==O)throw new Error("bad point: equation left != right (1)");let T=Y(D*F),H=Y(f*k);if(T!==H)throw new Error("bad point: equation left != right (2)");return!0});class A{static BASE=new A(U.Gx,U.Gy,e,Y(U.Gx*U.Gy));static ZERO=new A(g8,e,e,g8);static Fp=Q;static Fn=G;X;Y;Z;T;constructor(L,j,C,D){this.X=W("x",L),this.Y=W("y",j),this.Z=W("z",C,!0),this.T=W("t",D),Object.freeze(this)}static CURVE(){return U}static fromAffine(L){if(L instanceof A)throw new Error("extended point not allowed");let{x:j,y:C}=L||{};return W("x",j),W("y",C),new A(j,C,e,Y(j*C))}static fromBytes(L,j=!1){let C=Q.BYTES,{a:D,d:F}=U;L=d8(u(L,C,"point")),y0(j,"zip215");let f=d8(L),k=L[C-1];f[C-1]=k&-129;let y=f8(f),V=j?Z:Q.ORDER;q0("point.y",y,g8,V);let P=Y(y*y),S=Y(P-e),g=Y(F*P-D),{isValid:p,value:O}=N(S,g);if(!p)throw new Error("bad point: invalid y coordinate");let T=(O&e)===e,H=(k&128)!==0;if(!j&&O===g8&&H)throw new Error("bad point: x=0 and x_0=1");if(H!==T)O=Y(-O);return A.fromAffine({x:O,y})}static fromHex(L,j=!1){return A.fromBytes(N0(L),j)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(L=8,j=!0){if(_.createCache(this,L),!j)this.multiply(F$);return this}assertValidity(){R(this)}equals(L){K(L);let{X:j,Y:C,Z:D}=this,{X:F,Y:f,Z:k}=L,y=Y(j*k),V=Y(F*D),P=Y(C*k),S=Y(f*D);return y===V&&P===S}is0(){return this.equals(A.ZERO)}negate(){return new A(Y(-this.X),this.Y,this.Z,Y(-this.T))}double(){let{a:L}=U,{X:j,Y:C,Z:D}=this,F=Y(j*j),f=Y(C*C),k=Y(F$*Y(D*D)),y=Y(L*F),V=j+C,P=Y(Y(V*V)-F-f),S=y+f,g=S-k,p=y-f,O=Y(P*g),T=Y(S*p),H=Y(P*p),B=Y(g*S);return new A(O,T,B,H)}add(L){K(L);let{a:j,d:C}=U,{X:D,Y:F,Z:f,T:k}=this,{X:y,Y:V,Z:P,T:S}=L,g=Y(D*y),p=Y(F*V),O=Y(k*C*S),T=Y(f*P),H=Y((D+F)*(y+V)-g-p),B=T-O,w=T+O,x=Y(p-j*g),m=Y(H*B),b=Y(w*x),h=Y(H*x),c=Y(B*w);return new A(m,b,c,h)}subtract(L){return this.add(L.negate())}multiply(L){if(!G.isValidNot0(L))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:j,f:C}=_.cached(this,L,(D)=>p0(A,D));return p0(A,[j,C])[0]}multiplyUnsafe(L,j=A.ZERO){if(!G.isValid(L))throw new Error("invalid scalar: expected 0 <= sc < curve.n");if(L===g8)return A.ZERO;if(this.is0()||L===e)return this;return _.unsafe(this,L,(C)=>p0(A,C),j)}isSmallOrder(){return this.multiplyUnsafe(X).is0()}isTorsionFree(){return _.unsafe(this,U.n).is0()}toAffine(L){return E(this,L)}clearCofactor(){if(X===e)return this;return this.multiplyUnsafe(X)}toBytes(){let{x:L,y:j}=this.toAffine(),C=Q.toBytes(j);return C[C.length-1]|=L&e?128:0,C}toHex(){return t8(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let _=new P$(A,G.BITS);return A.BASE.precompute(8),A}function OJ($,q,J={}){if(typeof q!=="function")throw new Error('"hash" function param is required');l8(J,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:Q}=J,{BASE:G,Fp:U,Fn:X}=$,Z=J.randomBytes||p8,Y=J.adjustScalarBytes||((V)=>V),N=J.domain||((V,P,S)=>{if(y0(S,"phflag"),P.length||S)throw new Error("Contexts/pre-hash are not supported");return V});function W(V){return X.create(f8(V))}function K(V){let P=D.secretKey;u(V,D.secretKey,"secretKey");let S=u(q(V),2*P,"hashedSecretKey"),g=Y(S.slice(0,P)),p=S.slice(P,2*P),O=W(g);return{head:g,prefix:p,scalar:O}}function E(V){let{head:P,prefix:S,scalar:g}=K(V),p=G.multiply(g),O=p.toBytes();return{head:P,prefix:S,scalar:g,point:p,pointBytes:O}}function R(V){return E(V).pointBytes}function A(V=Uint8Array.of(),...P){let S=e8(...P);return W(q(N(S,u(V,void 0,"context"),!!Q)))}function _(V,P,S={}){if(V=u(V,void 0,"message"),Q)V=Q(V);let{prefix:g,scalar:p,pointBytes:O}=E(P),T=A(S.context,g,V),H=G.multiply(T).toBytes(),B=A(S.context,H,O,V),w=X.create(T+B*p);if(!X.isValid(w))throw new Error("sign failed: invalid s");let x=e8(H,X.toBytes(w));return u(x,D.signature,"result")}let L={zip215:!0};function j(V,P,S,g=L){let{context:p,zip215:O}=g,T=D.signature;if(V=u(V,T,"signature"),P=u(P,void 0,"message"),S=u(S,D.publicKey,"publicKey"),O!==void 0)y0(O,"zip215");if(Q)P=Q(P);let H=T/2,B=V.subarray(0,H),w=f8(V.subarray(H,T)),x,m,b;try{x=$.fromBytes(S,O),m=$.fromBytes(B,O),b=G.multiplyUnsafe(w)}catch(Z0){return!1}if(!O&&x.isSmallOrder())return!1;let h=A(p,m.toBytes(),x.toBytes(),P);return m.add(x.multiplyUnsafe(h)).subtract(b).clearCofactor().is0()}let C=U.BYTES,D={secretKey:C,publicKey:C,signature:2*C,seed:C};function F(V=Z(D.seed)){return u(V,D.seed,"seed")}function f(V){return W0(V)&&V.length===X.BYTES}function k(V,P){try{return!!$.fromBytes(V,P)}catch(S){return!1}}let y={getExtendedPublicKey:E,randomSecretKey:F,isValidSecretKey:f,isValidPublicKey:k,toMontgomery(V){let{y:P}=$.fromBytes(V),S=D.publicKey,g=S===32;if(!g&&S!==57)throw new Error("only defined for 25519 and 448");let p=g?U.div(e+P,e-P):U.div(P-e,P+e);return U.toBytes(p)},toMontgomerySecret(V){let P=D.secretKey;u(V,P);let S=q(V.subarray(0,P));return Y(S).subarray(0,P)}};return Object.freeze({keygen:u0(F,R),getPublicKey:R,sign:_,verify:j,utils:y,Point:$,lengths:D})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var D0=BigInt(0),J0=BigInt(1),c0=BigInt(2);function C1($){return l8($,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...$})}function KJ($){let q=C1($),{P:J,type:Q,adjustScalarBytes:G,powPminus2:U,randomBytes:X}=q,Z=Q==="x25519";if(!Z&&Q!=="x448")throw new Error("invalid type");let Y=X||p8,N=Z?255:448,W=Z?32:56,K=Z?BigInt(9):BigInt(5),E=Z?BigInt(121665):BigInt(39081),R=Z?c0**BigInt(254):c0**BigInt(447),A=Z?BigInt(8)*c0**BigInt(251)-J0:BigInt(4)*c0**BigInt(445)-J0,_=R+A+J0,L=(T)=>i(T,J),j=C(K);function C(T){return g0(L(T),W)}function D(T){let H=d8(u(T,W,"uCoordinate"));if(Z)H[31]&=127;return L(f8(H))}function F(T){return f8(G(d8(u(T,W,"scalar"))))}function f(T,H){let B=S(D(H),F(T));if(B===D0)throw new Error("invalid private or public key received");return C(B)}function k(T){return f(T,j)}let y=k,V=f;function P(T,H,B){let w=L(T*(H-B));return H=L(H-w),B=L(B+w),{x_2:H,x_3:B}}function S(T,H){q0("u",T,D0,J),q0("scalar",H,R,_);let B=H,w=T,x=J0,m=D0,b=T,h=J0,c=D0;for(let O$=BigInt(N-1);O$>=D0;O$--){let Kq=B>>O$&J0;c^=Kq,{x_2:x,x_3:b}=P(c,x,b),{x_2:m,x_3:h}=P(c,m,h),c=Kq;let K$=x+m,z$=L(K$*K$),D$=x-m,zq=L(D$*D$),Dq=z$-zq,bQ=b+h,hQ=b-h,Eq=L(hQ*K$),Cq=L(bQ*D$),Rq=Eq+Cq,Hq=Eq-Cq;b=L(Rq*Rq),h=L(w*L(Hq*Hq)),x=L(z$*zq),m=L(Dq*(z$+L(E*Dq)))}({x_2:x,x_3:b}=P(c,x,b)),{x_2:m,x_3:h}=P(c,m,h);let Z0=U(m);return L(x*Z0)}let g={secretKey:W,publicKey:W,seed:W},p=(T=Y(W))=>{return u(T,g.seed,"seed"),T},O={randomSecretKey:p};return Object.freeze({keygen:u0(p,y),getSharedSecret:V,getPublicKey:y,scalarMult:f,scalarMultBase:k,utils:O,GuBytes:j.slice(),lengths:g})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var R1=BigInt(1),zJ=BigInt(2),H1=BigInt(3),L1=BigInt(5),I1=BigInt(8),d0=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),T1=(()=>({p:d0,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:I1,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function EJ($){let q=BigInt(10),J=BigInt(20),Q=BigInt(40),G=BigInt(80),U=d0,Z=$*$%U*$%U,Y=E8(Z,zJ,U)*Z%U,N=E8(Y,R1,U)*$%U,W=E8(N,L1,U)*N%U,K=E8(W,q,U)*W%U,E=E8(K,J,U)*K%U,R=E8(E,Q,U)*E%U,A=E8(R,G,U)*R%U,_=E8(A,G,U)*R%U,L=E8(_,q,U)*W%U;return{pow_p_5_8:E8(L,zJ,U)*$%U,b2:Z}}function CJ($){return $[0]&=248,$[31]&=127,$[31]|=64,$}var DJ=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function A1($,q){let J=d0,Q=i(q*q*q,J),G=i(Q*Q*q,J),U=EJ($*G).pow_p_5_8,X=i($*Q*U,J),Z=i(q*X*X,J),Y=X,N=i(X*DJ,J),W=Z===$,K=Z===i(-$,J),E=Z===i(-$*DJ,J);if(W)X=Y;if(K||E)X=N;if(qJ(X,J))X=i(-X,J);return{isValid:W||K,value:X}}var B1=NJ(T1,{uvRatio:A1});function V1($){return OJ(B1,hq,Object.assign({adjustScalarBytes:CJ},$))}var m8=V1({});var Q0=(()=>{let $=d0;return KJ({P:$,type:"x25519",powPminus2:(q)=>{let{pow_p_5_8:J,b2:Q}=EJ(q);return i(E8(J,H1,$)*Q,$)},adjustScalarBytes:CJ})})();var hJ=Iq(f$(),1);var S$;try{S$=new TextDecoder}catch($){}var v,o8,I=0;var AJ=[],w1=105,j1=57342,P1=57343,HJ=57337;var LJ=6,G0={},E0=112810000,S8=16810000;var x$=AJ,_$=0,d={},o,i0,o0=0,R0=0,a,C8,r=[],k$=[],K8,W8,C0,IJ={useRecords:!1,mapsAsObjects:!0},H0=!1,BJ=2;try{new Function("")}catch($){BJ=1/0}class b8{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[q,J]of Object.entries($.keyMap))this.mapKey.set(J,q)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let q=new Map;for(let[J,Q]of Object.entries($))q.set(this._keyMap.hasOwnProperty(J)?this._keyMap[J]:J,Q);return q}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[J,Q]of Object.entries(this._keyMap))this._mapKey.set(Q,J)}let q={};return $.forEach((J,Q)=>q[R8(this._mapKey.has(Q)?this._mapKey.get(Q):Q)]=J),q}mapDecode($,q){let J=this.decode($);if(this._keyMap)switch(J.constructor.name){case"Array":return J.map((Q)=>this.decodeKeys(Q))}return J}decode($,q){if(v)return PJ(()=>{return r0(),this?this.decode($,q):b8.prototype.decode.call(IJ,$,q)});o8=q>-1?q:$.length,I=0,_$=0,R0=0,i0=null,x$=AJ,a=null,v=$;try{W8=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(J){if(v=null,$ instanceof Uint8Array)throw J;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof b8){if(d=this,K8=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return o=this.structures,l0();else if(!o||o.length>0)o=[]}else{if(d=IJ,!o||o.length>0)o=[];K8=null}return l0()}decodeMultiple($,q){let J,Q=0;try{let G=$.length;H0=!0;let U=this?this.decode($,G):h$.decode($,G);if(q){if(q(U)===!1)return;while(I<G)if(Q=I,q(l0())===!1)return}else{J=[U];while(I<G)Q=I,J.push(l0());return J}}catch(G){throw G.lastPosition=Q,G.values=J,G}finally{H0=!1,r0()}}}function l0(){try{let $=l();if(a){if(I>=a.postBundlePosition){let q=new Error("Unexpected bundle position");throw q.incomplete=!0,q}I=a.postBundlePosition,a=null}if(I==o8){if(o=null,v=null,C8)C8=null}else if(I>o8){let q=new Error("Unexpected end of CBOR data");throw q.incomplete=!0,q}else if(!H0)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(r0(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function l(){let $=v[I++],q=$>>5;if($=$&31,$>23)switch($){case 24:$=v[I++];break;case 25:if(q==7)return x1();$=W8.getUint16(I),I+=2;break;case 26:if(q==7){let J=W8.getFloat32(I);if(d.useFloat32>2){let Q=a0[(v[I]&127)<<1|v[I+1]>>7];return I+=4,(Q*J+(J>0?0.5:-0.5)>>0)/Q}return I+=4,J}$=W8.getUint32(I),I+=4;break;case 27:if(q==7){let J=W8.getFloat64(I);return I+=8,J}if(q>1){if(W8.getUint32(I)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=W8.getUint32(I+4)}else if(d.int64AsNumber)$=W8.getUint32(I)*4294967296,$+=W8.getUint32(I+4);else $=W8.getBigUint64(I);I+=8;break;case 31:switch(q){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let J=[],Q,G=0;while((Q=l())!=G0){if(G>=E0)throw new Error(`Array length exceeds ${E0}`);J[G++]=Q}return q==4?J:q==3?J.join(""):Buffer.concat(J);case 5:let U;if(d.mapsAsObjects){let X={},Z=0;if(d.keyMap)while((U=l())!=G0){if(Z++>=S8)throw new Error(`Property count exceeds ${S8}`);X[R8(d.decodeKey(U))]=l()}else while((U=l())!=G0){if(Z++>=S8)throw new Error(`Property count exceeds ${S8}`);X[R8(U)]=l()}return X}else{if(C0)d.mapsAsObjects=!0,C0=!1;let X=new Map;if(d.keyMap){let Z=0;while((U=l())!=G0){if(Z++>=S8)throw new Error(`Map size exceeds ${S8}`);X.set(d.decodeKey(U),l())}}else{let Z=0;while((U=l())!=G0){if(Z++>=S8)throw new Error(`Map size exceeds ${S8}`);X.set(U,l())}}return X}case 7:return G0;default:throw new Error("Invalid major type for indefinite length "+q)}default:throw new Error("Unknown token "+$)}switch(q){case 0:return $;case 1:return~$;case 2:return S1($);case 3:if(R0>=I)return i0.slice(I-o0,(I+=$)-o0);if(R0==0&&o8<140&&$<32){let G=$<16?VJ($):f1($);if(G!=null)return G}return F1($);case 4:if($>=E0)throw new Error(`Array length exceeds ${E0}`);let J=new Array($);for(let G=0;G<$;G++)J[G]=l();return J;case 5:if($>=S8)throw new Error(`Map size exceeds ${E0}`);if(d.mapsAsObjects){let G={};if(d.keyMap)for(let U=0;U<$;U++)G[R8(d.decodeKey(l()))]=l();else for(let U=0;U<$;U++)G[R8(l())]=l();return G}else{if(C0)d.mapsAsObjects=!0,C0=!1;let G=new Map;if(d.keyMap)for(let U=0;U<$;U++)G.set(d.decodeKey(l()),l());else for(let U=0;U<$;U++)G.set(l(),l());return G}case 6:if($>=HJ){let G=o[$&8191];if(G){if(!G.read)G.read=v$(G);return G.read()}if($<65536){if($==P1){let U=X0(),X=l(),Z=l();g$(X,Z);let Y={};if(d.keyMap)for(let N=2;N<U;N++){let W=d.decodeKey(Z[N-2]);Y[R8(W)]=l()}else for(let N=2;N<U;N++){let W=Z[N-2];Y[R8(W)]=l()}return Y}else if($==j1){let U=X0(),X=l();for(let Z=2;Z<U;Z++)g$(X++,l());return l()}else if($==HJ)return m1();if(d.getShared){if(b$(),G=o[$&8191],G){if(!G.read)G.read=v$(G);return G.read()}}}}let Q=r[$];if(Q)if(Q.handlesRead)return Q(l);else return Q(l());else{let G=l();for(let U=0;U<k$.length;U++){let X=k$[U]($,G);if(X!==void 0)return X}return new T8(G,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let G=(K8||i8())[$];if(G!==void 0)return G;throw new Error("Unknown token "+$)}default:if(isNaN($)){let G=new Error("Unexpected end of CBOR data");throw G.incomplete=!0,G}throw new Error("Unknown CBOR token "+$)}}var TJ=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function v$($){if(!$)throw new Error("Structure is required in record definition");function q(){let J=v[I++];if(J=J&31,J>23)switch(J){case 24:J=v[I++];break;case 25:J=W8.getUint16(I),I+=2;break;case 26:J=W8.getUint32(I),I+=4;break;default:throw new Error("Expected array header, but got "+v[I-1])}let Q=this.compiledReader;while(Q){if(Q.propertyCount===J)return Q(l);Q=Q.next}if(this.slowReads++>=BJ){let U=this.length==J?this:this.slice(0,J);if(Q=d.keyMap?new Function("r","return {"+U.map((X)=>d.decodeKey(X)).map((X)=>TJ.test(X)?R8(X)+":r()":"["+JSON.stringify(X)+"]:r()").join(",")+"}"):new Function("r","return {"+U.map((X)=>TJ.test(X)?R8(X)+":r()":"["+JSON.stringify(X)+"]:r()").join(",")+"}"),this.compiledReader)Q.next=this.compiledReader;return Q.propertyCount=J,this.compiledReader=Q,Q(l)}let G={};if(d.keyMap)for(let U=0;U<J;U++)G[R8(d.decodeKey(this[U]))]=l();else for(let U=0;U<J;U++)G[R8(this[U])]=l();return G}return $.slowReads=0,q}function R8($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var F1=y$;function y$($){let q;if($<16){if(q=VJ($))return q}if($>64&&S$)return S$.decode(v.subarray(I,I+=$));let J=I+$,Q=[];q="";while(I<J){let G=v[I++];if((G&128)===0)Q.push(G);else if((G&224)===192){let U=v[I++]&63;Q.push((G&31)<<6|U)}else if((G&240)===224){let U=v[I++]&63,X=v[I++]&63;Q.push((G&31)<<12|U<<6|X)}else if((G&248)===240){let U=v[I++]&63,X=v[I++]&63,Z=v[I++]&63,Y=(G&7)<<18|U<<12|X<<6|Z;if(Y>65535)Y-=65536,Q.push(Y>>>10&1023|55296),Y=56320|Y&1023;Q.push(Y)}else Q.push(G);if(Q.length>=4096)q+=$8.apply(String,Q),Q.length=0}if(Q.length>0)q+=$8.apply(String,Q);return q}var $8=String.fromCharCode;function f1($){let q=I,J=new Array($);for(let Q=0;Q<$;Q++){let G=v[I++];if((G&128)>0){I=q;return}J[Q]=G}return $8.apply(String,J)}function VJ($){if($<4)if($<2)if($===0)return"";else{let q=v[I++];if((q&128)>1){I-=1;return}return $8(q)}else{let q=v[I++],J=v[I++];if((q&128)>0||(J&128)>0){I-=2;return}if($<3)return $8(q,J);let Q=v[I++];if((Q&128)>0){I-=3;return}return $8(q,J,Q)}else{let q=v[I++],J=v[I++],Q=v[I++],G=v[I++];if((q&128)>0||(J&128)>0||(Q&128)>0||(G&128)>0){I-=4;return}if($<6)if($===4)return $8(q,J,Q,G);else{let U=v[I++];if((U&128)>0){I-=5;return}return $8(q,J,Q,G,U)}else if($<8){let U=v[I++],X=v[I++];if((U&128)>0||(X&128)>0){I-=6;return}if($<7)return $8(q,J,Q,G,U,X);let Z=v[I++];if((Z&128)>0){I-=7;return}return $8(q,J,Q,G,U,X,Z)}else{let U=v[I++],X=v[I++],Z=v[I++],Y=v[I++];if((U&128)>0||(X&128)>0||(Z&128)>0||(Y&128)>0){I-=8;return}if($<10)if($===8)return $8(q,J,Q,G,U,X,Z,Y);else{let N=v[I++];if((N&128)>0){I-=9;return}return $8(q,J,Q,G,U,X,Z,Y,N)}else if($<12){let N=v[I++],W=v[I++];if((N&128)>0||(W&128)>0){I-=10;return}if($<11)return $8(q,J,Q,G,U,X,Z,Y,N,W);let K=v[I++];if((K&128)>0){I-=11;return}return $8(q,J,Q,G,U,X,Z,Y,N,W,K)}else{let N=v[I++],W=v[I++],K=v[I++],E=v[I++];if((N&128)>0||(W&128)>0||(K&128)>0||(E&128)>0){I-=12;return}if($<14)if($===12)return $8(q,J,Q,G,U,X,Z,Y,N,W,K,E);else{let R=v[I++];if((R&128)>0){I-=13;return}return $8(q,J,Q,G,U,X,Z,Y,N,W,K,E,R)}else{let R=v[I++],A=v[I++];if((R&128)>0||(A&128)>0){I-=14;return}if($<15)return $8(q,J,Q,G,U,X,Z,Y,N,W,K,E,R,A);let _=v[I++];if((_&128)>0){I-=15;return}return $8(q,J,Q,G,U,X,Z,Y,N,W,K,E,R,A,_)}}}}}function S1($){return d.copyBuffers?Uint8Array.prototype.slice.call(v,I,I+=$):v.subarray(I,I+=$)}var wJ=new Float32Array(1),n0=new Uint8Array(wJ.buffer,0,4);function x1(){let $=v[I++],q=v[I++],J=($&127)>>2;if(J===31){if(q||$&3)return NaN;return $&128?-1/0:1/0}if(J===0){let Q=(($&3)<<8|q)/16777216;return $&128?-Q:Q}return n0[3]=$&128|(J>>1)+56,n0[2]=($&7)<<5|q>>3,n0[1]=q<<5,n0[0]=0,wJ[0]}var DG=new Array(4096);class T8{constructor($,q){this.value=$,this.tag=q}}r[0]=($)=>{return new Date($)};r[1]=($)=>{return new Date(Math.round($*1000))};r[2]=($)=>{let q=BigInt(0);for(let J=0,Q=$.byteLength;J<Q;J++)q=BigInt($[J])+(q<<BigInt(8));return q};r[3]=($)=>{return BigInt(-1)-r[2]($)};r[4]=($)=>{return+($[1]+"e"+$[0])};r[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var g$=($,q)=>{$=$-57344;let J=o[$];if(J&&J.isShared)(o.restoreStructures||(o.restoreStructures=[]))[$]=J;o[$]=q,q.read=v$(q)};r[w1]=($)=>{let q=$.length,J=$[1];g$($[0],J);let Q={};for(let G=2;G<q;G++){let U=J[G-2];Q[R8(U)]=$[G]}return Q};r[14]=($)=>{if(a)return a[0].slice(a.position0,a.position0+=$);return new T8($,14)};r[15]=($)=>{if(a)return a[1].slice(a.position1,a.position1+=$);return new T8($,15)};var _1={Error,RegExp};r[27]=($)=>{return(_1[$[0]]||Error)($[1],$[2])};var jJ=($)=>{if(v[I++]!=132){let J=new Error("Packed values structure must be followed by a 4 element array");if(v.length<I)J.incomplete=!0;throw J}let q=$();if(!q||!q.length){let J=new Error("Packed values structure must be followed by a 4 element array");throw J.incomplete=!0,J}return K8=K8?q.concat(K8.slice(q.length)):q,K8.prefixes=$(),K8.suffixes=$(),$()};jJ.handlesRead=!0;r[51]=jJ;r[LJ]=($)=>{if(!K8)if(d.getShared)b$();else return new T8($,LJ);if(typeof $=="number")return K8[16+($>=0?2*$:-2*$-1)];let q=new Error("No support for non-integer packed references yet");if($===void 0)q.incomplete=!0;throw q};r[28]=($)=>{if(!C8)C8=new Map,C8.id=0;let q=C8.id++,J=I,Q=v[I],G;if(Q>>5==4)G=[];else G={};let U={target:G};C8.set(q,U);let X=$();if(U.used){if(Object.getPrototypeOf(G)!==Object.getPrototypeOf(X))I=J,G=X,C8.set(q,{target:G}),X=$();return Object.assign(G,X)}return U.target=X,X};r[28].handlesRead=!0;r[29]=($)=>{let q=C8.get($);return q.used=!0,q.target};r[258]=($)=>new Set($);(r[259]=($)=>{if(d.mapsAsObjects)d.mapsAsObjects=!1,C0=!0;return $()}).handlesRead=!0;function U0($,q){if(typeof $==="string")return $+q;if($ instanceof Array)return $.concat(q);return Object.assign({},$,q)}function i8(){if(!K8)if(d.getShared)b$();else throw new Error("No packed values available");return K8}var k1=1399353956;k$.push(($,q)=>{if($>=225&&$<=255)return U0(i8().prefixes[$-224],q);if($>=28704&&$<=32767)return U0(i8().prefixes[$-28672],q);if($>=1879052288&&$<=2147483647)return U0(i8().prefixes[$-1879048192],q);if($>=216&&$<=223)return U0(q,i8().suffixes[$-216]);if($>=27647&&$<=28671)return U0(q,i8().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return U0(q,i8().suffixes[$-1811939328]);if($==k1)return{packedValues:K8,structures:o.slice(0),version:q};if($==55799)return q});var v1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,m$=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],y1=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<m$.length;$++)g1(m$[$],y1[$]);function g1($,q){let J="get"+$.name.slice(0,-5),Q;if(typeof $==="function")Q=$.BYTES_PER_ELEMENT;else $=null;for(let G=0;G<2;G++){if(!G&&Q==1)continue;let U=Q==2?1:Q==4?2:Q==8?3:0;r[G?q:q-4]=Q==1||G==v1?(X)=>{if(!$)throw new Error("Could not find typed array for code "+q);if(!d.copyBuffers){if(Q===1||Q===2&&!(X.byteOffset&1)||Q===4&&!(X.byteOffset&3)||Q===8&&!(X.byteOffset&7))return new $(X.buffer,X.byteOffset,X.byteLength>>U)}return new $(Uint8Array.prototype.slice.call(X,0).buffer)}:(X)=>{if(!$)throw new Error("Could not find typed array for code "+q);let Z=new DataView(X.buffer,X.byteOffset,X.byteLength),Y=X.length>>U,N=new $(Y),W=Z[J];for(let K=0;K<Y;K++)N[K]=W.call(Z,K<<U,G);return N}}}function m1(){let $=X0(),q=I+l();for(let Q=2;Q<$;Q++){let G=X0();I+=G}let J=I;return I=q,a=[y$(X0()),y$(X0())],a.position0=0,a.position1=0,a.postBundlePosition=I,I=J,l()}function X0(){let $=v[I++]&31;if($>23)switch($){case 24:$=v[I++];break;case 25:$=W8.getUint16(I),I+=2;break;case 26:$=W8.getUint32(I),I+=4;break}return $}function b$(){if(d.getShared){let $=PJ(()=>{return v=null,d.getShared()})||{},q=$.structures||[];if(d.sharedVersion=$.version,K8=d.sharedValues=$.packedValues,o===!0)d.structures=o=q;else o.splice.apply(o,[0,q.length].concat(q))}}function PJ($){let q=o8,J=I,Q=_$,G=o0,U=R0,X=i0,Z=x$,Y=C8,N=a,W=new Uint8Array(v.slice(0,o8)),K=o,E=d,R=H0,A=$();return o8=q,I=J,_$=Q,o0=G,R0=U,i0=X,x$=Z,C8=Y,a=N,v=W,H0=R,o=K,d=E,W8=new DataView(v.buffer,v.byteOffset,v.byteLength),A}function r0(){v=null,C8=null,o=null}var a0=new Array(147);for(let $=0;$<256;$++)a0[$]=+("1e"+Math.floor(45.15-$*0.30103));var h$=new b8({useRecords:!1}),s0=h$.decode,b1=h$.decodeMultiple;var t0;try{t0=new TextEncoder}catch($){}var l$,vJ,$$=typeof globalThis==="object"&&globalThis.Buffer,L0=typeof $$!=="undefined",p$=L0?$$.allocUnsafeSlow:Uint8Array,FJ=L0?$$:Uint8Array,fJ=256,SJ=L0?4294967296:2144337920;var u$,z,n,M=0,h8,s=null,h1=61440,p1=/[\u0080-\uFFFF]/,D8=Symbol("record-id");class q$ extends b8{constructor($){super($);this.offset=0;let q,J,Q,G,U,X;$=$||{};let Z=FJ.prototype.utf8Write?function(O,T,H){return z.utf8Write(O,T,H)}:t0&&t0.encodeInto?function(O,T){return t0.encodeInto(O,z.subarray(T)).written}:!1,Y=this,N=$.structures||$.saveStructures,W=$.maxSharedStructures;if(W==null)W=N?128:0;if(W>8190)throw new Error("Maximum maxSharedStructure is 8190");let K=$.sequential;if(K)W=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let E,R,A=$.sharedValues,_;if(A){_=Object.create(null);for(let O=0,T=A.length;O<T;O++)_[A[O]]=O}let L=[],j=0,C=0;this.mapEncode=function(O,T){if(this._keyMap&&!this._mapped)switch(O.constructor.name){case"Array":O=O.map((H)=>this.encodeKeys(H));break}return this.encode(O,T)},this.encode=function(O,T){if(!z)z=new p$(8192),n=new DataView(z.buffer,0,8192),M=0;if(h8=z.length-10,h8-M<2048)z=new p$(z.length),n=new DataView(z.buffer,0,z.length),h8=z.length-10,M=0;else if(T===i$)M=M+7&2147483640;if(J=M,Y.useSelfDescribedHeader)n.setUint32(M,3654940416),M+=3;if(X=Y.structuredClone?new Map:null,Y.bundleStrings&&typeof O!=="string")s=[],s.size=1/0;else s=null;if(Q=Y.structures,Q){if(Q.uninitialized){let B=Y.getShared()||{};Y.structures=Q=B.structures||[],Y.sharedVersion=B.version;let w=Y.sharedValues=B.packedValues;if(w){_={};for(let x=0,m=w.length;x<m;x++)_[w[x]]=x}}let H=Q.length;if(H>W&&!K)H=W;if(!Q.transitions){Q.transitions=Object.create(null);for(let B=0;B<H;B++){let w=Q[B];if(!w)continue;let x,m=Q.transitions;for(let b=0,h=w.length;b<h;b++){if(m[D8]===void 0)m[D8]=B;let c=w[b];if(x=m[c],!x)x=m[c]=Object.create(null);m=x}m[D8]=B|1048576}}if(!K)Q.nextId=H}if(G)G=!1;if(U=Q||[],R=_,$.pack){let H=new Map;if(H.values=[],H.encoder=Y,H.maxValues=$.maxPrivatePackedValues||(_?16:1/0),H.objectMap=_||!1,H.samplingPackedValues=E,e0(O,H),H.values.length>0){z[M++]=216,z[M++]=51,B8(4);let B=H.values;D(B),B8(0),B8(0),R=Object.create(_||null);for(let w=0,x=B.length;w<x;w++)R[B[w]]=w}}u$=T&d$;try{if(u$)return;if(D(O),s)_J(J,D);if(Y.offset=M,X&&X.idsToInsert){if(M+=X.idsToInsert.length*2,M>h8)f(M);Y.offset=M;let H=d1(z.subarray(J,M),X.idsToInsert);return X=null,H}if(T&i$)return z.start=J,z.end=M,z;return z.subarray(J,M)}finally{if(Q){if(C<10)C++;if(Q.length>W)Q.length=W;if(j>1e4){if(Q.transitions=null,C=0,j=0,L.length>0)L=[]}else if(L.length>0&&!K){for(let H=0,B=L.length;H<B;H++)L[H][D8]=void 0;L=[]}}if(G&&Y.saveShared){if(Y.structures.length>W)Y.structures=Y.structures.slice(0,W);let H=z.subarray(J,M);if(Y.updateSharedData()===!1)return Y.encode(O);return H}if(T&o1)M=J}},this.findCommonStringsToPack=()=>{if(E=new Map,!_)_=Object.create(null);return(O)=>{let T=O&&O.threshold||4,H=this.pack?O.maxPrivatePackedValues||16:0;if(!A)A=this.sharedValues=[];for(let[B,w]of E)if(w.count>T)_[B]=H++,A.push(B),G=!0;while(this.saveShared&&this.updateSharedData()===!1);E=null}};let D=(O)=>{if(M>h8)z=f(M);var T=typeof O,H;if(T==="string"){if(R){let m=R[O];if(m>=0){if(m<16)z[M++]=m+224;else if(z[M++]=198,m&1)D(15-m>>1);else D(m-16>>1);return}else if(E&&!$.pack){let b=E.get(O);if(b)b.count++;else E.set(O,{count:1})}}let B=O.length;if(s&&B>=4&&B<1024){if((s.size+=B)>h1){let b,h=(s[0]?s[0].length*3+s[1].length:0)+10;if(M+h>h8)z=f(M+h);if(z[M++]=217,z[M++]=223,z[M++]=249,z[M++]=s.position?132:130,z[M++]=26,b=M-J,M+=4,s.position)_J(J,D);s=["",""],s.size=0,s.position=b}let m=p1.test(O);s[m?0:1]+=O,z[M++]=m?206:207,D(B);return}let w;if(B<32)w=1;else if(B<256)w=2;else if(B<65536)w=3;else w=5;let x=B*3;if(M+x>h8)z=f(M+x);if(B<64||!Z){let m,b,h,c=M+w;for(m=0;m<B;m++)if(b=O.charCodeAt(m),b<128)z[c++]=b;else if(b<2048)z[c++]=b>>6|192,z[c++]=b&63|128;else if((b&64512)===55296&&((h=O.charCodeAt(m+1))&64512)===56320)b=65536+((b&1023)<<10)+(h&1023),m++,z[c++]=b>>18|240,z[c++]=b>>12&63|128,z[c++]=b>>6&63|128,z[c++]=b&63|128;else z[c++]=b>>12|224,z[c++]=b>>6&63|128,z[c++]=b&63|128;H=c-M-w}else H=Z(O,M+w,x);if(H<24)z[M++]=96|H;else if(H<256){if(w<2)z.copyWithin(M+2,M+1,M+1+H);z[M++]=120,z[M++]=H}else if(H<65536){if(w<3)z.copyWithin(M+3,M+2,M+2+H);z[M++]=121,z[M++]=H>>8,z[M++]=H&255}else{if(w<5)z.copyWithin(M+5,M+3,M+3+H);z[M++]=122,n.setUint32(M,H),M+=4}M+=H}else if(T==="number")if(!this.alwaysUseFloat&&O>>>0===O)if(O<24)z[M++]=O;else if(O<256)z[M++]=24,z[M++]=O;else if(O<65536)z[M++]=25,z[M++]=O>>8,z[M++]=O&255;else z[M++]=26,n.setUint32(M,O),M+=4;else if(!this.alwaysUseFloat&&O>>0===O)if(O>=-24)z[M++]=31-O;else if(O>=-256)z[M++]=56,z[M++]=~O;else if(O>=-65536)z[M++]=57,n.setUint16(M,~O),M+=2;else z[M++]=58,n.setUint32(M,~O),M+=4;else{let B;if((B=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){z[M++]=250,n.setFloat32(M,O);let w;if(B<4||(w=O*a0[(z[M]&127)<<1|z[M+1]>>7])>>0===w){M+=4;return}else M--}z[M++]=251,n.setFloat64(M,O),M+=8}else if(T==="object")if(!O)z[M++]=246;else{if(X){let w=X.get(O);if(w){if(z[M++]=216,z[M++]=29,z[M++]=25,!w.references){let x=X.idsToInsert||(X.idsToInsert=[]);w.references=[],x.push(w)}w.references.push(M-J),M+=2;return}else X.set(O,{offset:M-J})}let B=O.constructor;if(B===Object)F(O);else if(B===Array){if(H=O.length,H<24)z[M++]=128|H;else B8(H);for(let w=0;w<H;w++)D(O[w])}else if(B===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)z[M++]=217,z[M++]=1,z[M++]=3;if(H=O.size,H<24)z[M++]=160|H;else if(H<256)z[M++]=184,z[M++]=H;else if(H<65536)z[M++]=185,z[M++]=H>>8,z[M++]=H&255;else z[M++]=186,n.setUint32(M,H),M+=4;if(Y.keyMap)for(let[w,x]of O)D(Y.encodeKey(w)),D(x);else for(let[w,x]of O)D(w),D(x)}else{for(let w=0,x=l$.length;w<x;w++){let m=vJ[w];if(O instanceof m){let b=l$[w],h=b.tag;if(h==null)h=b.getTag&&b.getTag.call(this,O);if(h<24)z[M++]=192|h;else if(h<256)z[M++]=216,z[M++]=h;else if(h<65536)z[M++]=217,z[M++]=h>>8,z[M++]=h&255;else if(h>-1)z[M++]=218,n.setUint32(M,h),M+=4;b.encode.call(this,O,D,f);return}}if(O[Symbol.iterator]){if(u$){let w=new Error("Iterable should be serialized as iterator");throw w.iteratorNotHandled=!0,w}z[M++]=159;for(let w of O)D(w);z[M++]=255;return}if(O[Symbol.asyncIterator]||c$(O)){let w=new Error("Iterable/blob should be serialized as iterator");throw w.iteratorNotHandled=!0,w}if(this.useToJSON&&O.toJSON){let w=O.toJSON();if(w!==O)return D(w)}F(O)}}else if(T==="boolean")z[M++]=O?245:244;else if(T==="bigint"){if(O<BigInt(1)<<BigInt(64)&&O>=0)z[M++]=27,n.setBigUint64(M,O);else if(O>-(BigInt(1)<<BigInt(64))&&O<0)z[M++]=59,n.setBigUint64(M,-O-BigInt(1));else if(this.largeBigIntToFloat)z[M++]=251,n.setFloat64(M,Number(O));else{if(O>=BigInt(0))z[M++]=194;else z[M++]=195,O=BigInt(-1)-O;let B=[];while(O)B.push(Number(O&BigInt(255))),O>>=BigInt(8);n$(new Uint8Array(B.reverse()),f);return}M+=8}else if(T==="undefined")z[M++]=247;else throw new Error("Unknown type: "+T)},F=this.useRecords===!1?this.variableMapSize?(O)=>{let T=Object.keys(O),H=Object.values(O),B=T.length;if(B<24)z[M++]=160|B;else if(B<256)z[M++]=184,z[M++]=B;else if(B<65536)z[M++]=185,z[M++]=B>>8,z[M++]=B&255;else z[M++]=186,n.setUint32(M,B),M+=4;let w;if(Y.keyMap)for(let x=0;x<B;x++)D(Y.encodeKey(T[x])),D(H[x]);else for(let x=0;x<B;x++)D(T[x]),D(H[x])}:(O)=>{z[M++]=185;let T=M-J;M+=2;let H=0;if(Y.keyMap){for(let B in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(B))D(Y.encodeKey(B)),D(O[B]),H++}else for(let B in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(B))D(B),D(O[B]),H++;z[T+++J]=H>>8,z[T+J]=H&255}:(O,T)=>{let H,B=U.transitions||(U.transitions=Object.create(null)),w=0,x=0,m,b;if(this.keyMap){b=Object.keys(O).map((c)=>this.encodeKey(c)),x=b.length;for(let c=0;c<x;c++){let Z0=b[c];if(H=B[Z0],!H)H=B[Z0]=Object.create(null),w++;B=H}}else for(let c in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(c)){if(H=B[c],!H){if(B[D8]&1048576)m=B[D8]&65535;H=B[c]=Object.create(null),w++}B=H,x++}let h=B[D8];if(h!==void 0)h&=65535,z[M++]=217,z[M++]=h>>8|224,z[M++]=h&255;else{if(!b)b=B.__keys__||(B.__keys__=Object.keys(O));if(m===void 0){if(h=U.nextId++,!h)h=0,U.nextId=1;if(h>=fJ)U.nextId=(h=W)+1}else h=m;if(U[h]=b,h<W){z[M++]=217,z[M++]=h>>8|224,z[M++]=h&255,B=U.transitions;for(let c=0;c<x;c++){if(B[D8]===void 0||B[D8]&1048576)B[D8]=h;B=B[b[c]]}B[D8]=h|1048576,G=!0}else{if(B[D8]=h,n.setUint32(M,3655335680),M+=3,w)j+=C*w;if(L.length>=fJ-W)L.shift()[D8]=void 0;if(L.push(B),B8(x+2),D(57344+h),D(b),T)return;for(let c in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(c))D(O[c]);return}}if(x<24)z[M++]=128|x;else B8(x);if(T)return;for(let c in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(c))D(O[c])},f=(O)=>{let T;if(O>16777216){if(O-J>SJ)throw new Error("Encoded buffer would be larger than maximum buffer size");T=Math.min(SJ,Math.round(Math.max((O-J)*(O>67108864?1.25:2),4194304)/4096)*4096)}else T=(Math.max(O-J<<2,z.length-1)>>12)+1<<12;let H=new p$(T);if(n=new DataView(H.buffer,0,T),z.copy)z.copy(H,0,J,O);else H.set(z.slice(J,O));return M-=J,J=0,h8=H.length-10,z=H},k=100,y=1000;this.encodeAsIterable=function(O,T){return g(O,T,V)},this.encodeAsAsyncIterable=function(O,T){return g(O,T,p)};function*V(O,T,H){let B=O.constructor;if(B===Object){let w=Y.useRecords!==!1;if(w)F(O,!0);else xJ(Object.keys(O).length,160);for(let x in O){let m=O[x];if(!w)D(x);if(m&&typeof m==="object")if(T[x])yield*V(m,T[x]);else yield*P(m,T,x);else D(m)}}else if(B===Array){let w=O.length;B8(w);for(let x=0;x<w;x++){let m=O[x];if(m&&(typeof m==="object"||M-J>k))if(T.element)yield*V(m,T.element);else yield*P(m,T,"element");else D(m)}}else if(O[Symbol.iterator]&&!O.buffer){z[M++]=159;for(let w of O)if(w&&(typeof w==="object"||M-J>k))if(T.element)yield*V(w,T.element);else yield*P(w,T,"element");else D(w);z[M++]=255}else if(c$(O))xJ(O.size,64),yield z.subarray(J,M),yield O,S();else if(O[Symbol.asyncIterator])z[M++]=159,yield z.subarray(J,M),yield O,S(),z[M++]=255;else D(O);if(H&&M>J)yield z.subarray(J,M);else if(M-J>k)yield z.subarray(J,M),S()}function*P(O,T,H){let B=M-J;try{if(D(O),M-J>k)yield z.subarray(J,M),S()}catch(w){if(w.iteratorNotHandled)T[H]={},M=J+B,yield*V.call(this,O,T[H]);else throw w}}function S(){k=y,Y.encode(null,d$)}function g(O,T,H){if(T&&T.chunkThreshold)k=y=T.chunkThreshold;else k=100;if(O&&typeof O==="object")return Y.encode(null,d$),H(O,Y.iterateProperties||(Y.iterateProperties={}),!0);return[Y.encode(O)]}async function*p(O,T){for(let H of V(O,T,!0)){let B=H.constructor;if(B===FJ||B===Uint8Array)yield H;else if(c$(H)){let w=H.stream().getReader(),x;while(!(x=await w.read()).done)yield x.value}else if(H[Symbol.asyncIterator])for await(let w of H)if(S(),w)yield*p(w,T.async||(T.async={}));else yield Y.encode(w);else yield H}}}useBuffer($){z=$,n=new DataView(z.buffer,z.byteOffset,z.byteLength),M=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let q=this.structures.slice(0),J=new o$(q,this.sharedValues,this.sharedVersion),Q=this.saveShared(J,(G)=>(G&&G.version||0)==$);if(Q===!1)J=this.getShared()||{},this.structures=J.structures||[],this.sharedValues=J.packedValues,this.sharedVersion=J.version,this.structures.nextId=this.structures.length;else q.forEach((G,U)=>this.structures[U]=G);return Q}}function xJ($,q){if($<24)z[M++]=q|$;else if($<256)z[M++]=q|24,z[M++]=$;else if($<65536)z[M++]=q|25,z[M++]=$>>8,z[M++]=$&255;else z[M++]=q|26,n.setUint32(M,$),M+=4}class o${constructor($,q,J){this.structures=$,this.packedValues=q,this.version=J}}function B8($){if($<24)z[M++]=128|$;else if($<256)z[M++]=152,z[M++]=$;else if($<65536)z[M++]=153,z[M++]=$>>8,z[M++]=$&255;else z[M++]=154,n.setUint32(M,$),M+=4}var u1=typeof Blob==="undefined"?function(){}:Blob;function c$($){if($ instanceof u1)return!0;let q=$[Symbol.toStringTag];return q==="Blob"||q==="File"}function e0($,q){switch(typeof $){case"string":if($.length>3){if(q.objectMap[$]>-1||q.values.length>=q.maxValues)return;let Q=q.get($);if(Q){if(++Q.count==2)q.values.push($)}else if(q.set($,{count:1}),q.samplingPackedValues){let G=q.samplingPackedValues.get($);if(G)G.count++;else q.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let Q=0,G=$.length;Q<G;Q++)e0($[Q],q);else{let Q=!q.encoder.useRecords;for(var J in $)if($.hasOwnProperty(J)){if(Q)e0(J,q);e0($[J],q)}}break;case"function":console.log($)}}var c1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;vJ=[Date,Set,Error,RegExp,T8,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,o$];l$=[{tag:1,encode($,q){let J=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&J>=0&&J<4294967296)z[M++]=26,n.setUint32(M,J),M+=4;else z[M++]=251,n.setFloat64(M,J),M+=8}},{tag:258,encode($,q){let J=Array.from($);q(J)}},{tag:27,encode($,q){q([$.name,$.message])}},{tag:27,encode($,q){q(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,q){q($.value)}},{encode($,q,J){n$($,J)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||L0&&this.tagUint8Array!==!1)return 64}},encode($,q,J){n$($,J)}},A8(68,1),A8(69,2),A8(70,4),A8(71,8),A8(72,1),A8(77,2),A8(78,4),A8(79,8),A8(85,4),A8(86,8),{encode($,q){let J=$.packedValues||[],Q=$.structures||[];if(J.values.length>0){z[M++]=216,z[M++]=51,B8(4);let G=J.values;q(G),B8(0),B8(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let U=0,X=G.length;U<X;U++)packedObjectMap[G[U]]=U}if(Q){n.setUint32(M,3655335424),M+=3;let G=Q.slice(0);G.unshift(57344),G.push(new T8($.version,1399353956)),q(G)}else q(new T8($.version,1399353956))}}];function A8($,q){if(!c1&&q>1)$-=4;return{tag:$,encode:function J(Q,G){let U=Q.byteLength,X=Q.byteOffset||0,Z=Q.buffer||Q;G(L0?$$.from(Z,X,U):new Uint8Array(Z,X,U))}}}function n$($,q){let J=$.byteLength;if(J<24)z[M++]=64+J;else if(J<256)z[M++]=88,z[M++]=J;else if(J<65536)z[M++]=89,z[M++]=J>>8,z[M++]=J&255;else z[M++]=90,n.setUint32(M,J),M+=4;if(M+J>=z.length)q(M+J);z.set($.buffer?$:new Uint8Array($),M),M+=J}function d1($,q){let J,Q=q.length*2,G=$.length-Q;q.sort((U,X)=>U.offset>X.offset?1:-1);for(let U=0;U<q.length;U++){let X=q[U];X.id=U;for(let Z of X.references)$[Z++]=U>>8,$[Z]=U&255}while(J=q.pop()){let U=J.offset;$.copyWithin(U+Q,U,G),Q-=2;let X=U+Q;$[X++]=216,$[X++]=28,G=U}return $}function _J($,q){n.setUint32(s.position+$,M-s.position-$+1);let J=s;s=null,q(J[0]),q(J[1])}var r$=new q$({useRecords:!1}),l1=r$.encode,n1=r$.encodeAsIterable,i1=r$.encodeAsAsyncIterable;var i$=512,o1=1024,d$=2048;var J$=($)=>{let q=new Uint8Array($),J="";for(let Q=0;Q<q.byteLength;Q++)J+=String.fromCharCode(q[Q]);return btoa(J).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},yJ=($)=>{let q=atob($.replace(/-/g,"+").replace(/_/g,"/")),J=new Uint8Array(q.length);for(let Q=0;Q<q.length;Q++)J[Q]=q.charCodeAt(Q);return J.buffer};async function gJ($){let q=crypto.getRandomValues(new Uint8Array(32)),J=crypto.getRandomValues(new Uint8Array(16)),Q=await navigator.credentials.create({publicKey:{challenge:q,rp:{name:"Sorane Web/A Form"},user:{id:J,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"preferred"},timeout:60000,attestation:"none",extensions:{prf:{}}}});if(!Q)throw new Error("Credential creation failed");return{id:Q.id,rawId:J$(Q.rawId),response:Q.response}}async function mJ($,q){let J=await navigator.credentials.get({publicKey:{challenge:q,allowCredentials:[{id:yJ($),type:"public-key"}],userVerification:"required"}});if(!J)throw new Error("Assertion failed");let Q=J.response;return{id:J.id,signature:J$(Q.signature),authenticatorData:J$(Q.authenticatorData),clientDataJSON:J$(Q.clientDataJSON)}}async function Q$($,q){let J=crypto.getRandomValues(new Uint8Array(32)),Q=await navigator.credentials.get({publicKey:{challenge:J,allowCredentials:[{id:yJ($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:q}}}}});if(!Q)throw new Error("Assertion failed");let U=Q.getClientExtensionResults()?.prf?.results?.first;if(!U)throw new Error("PRF extension not available");return new Uint8Array(U)}function I0($){return Array.from($).map((q)=>q.toString(16).padStart(2,"0")).join("")}function bJ($){let q=new Uint8Array($.length/2);for(let J=0;J<q.length;J++)q[J]=parseInt($.substring(J*2,J*2+2),16);return q}class pJ{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),q=localStorage.getItem("weba_passkey_pub");if($&&q){this.credentialId=$,this.publicKey=bJ(q),this.publicKeyType="p256",this.usePasskey=!0;return}let J=localStorage.getItem("weba_private_key");if(J)this.edPrivateKey=bJ(J),this.publicKey=m8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{console.log("Registering Passkey...");let $=await gJ("User"),q=new Uint8Array($.response.attestationObject),Q=s0(q).authData,G=new DataView(Q.buffer,Q.byteOffset,Q.byteLength),U=53,X=G.getUint16(U);U+=2,U+=X;let Z=Q.slice(U),Y=s0(Z),N=Y.get(-2),W=Y.get(-3);if(!N||!W)throw new Error("Invalid COSE Key: x or y missing");let K=new Uint8Array(65);if(K[0]=4,K.set(N,1),K.set(W,33),this.credentialId=$.rawId,this.publicKey=K,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",I0(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}generateEdKey(){if(this.edPrivateKey=m8.utils.randomSecretKey(),this.publicKey=m8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",I0(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return`did:key:z${I0(this.publicKey)}`}getPublicKey(){return this.publicKey?I0(this.publicKey):""}async sign($,q="authentication"){if(!this.publicKey)await this.register();let J=hJ.default($),Q=new TextEncoder().encode(J);if(this.usePasskey&&this.credentialId){let G=await crypto.subtle.digest("SHA-256",Q),U=await mJ(this.credentialId,G);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:U.signature,"srn:authenticatorData":U.authenticatorData,"srn:clientDataJSON":U.clientDataJSON,"srn:credentialId":U.id}}}else{if(!this.edPrivateKey)this.generateEdKey();let G=m8.sign(Q,this.edPrivateKey);return{...$,proof:{type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:I0(G)}}}}}var Y0=new pJ;class a${oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor($,q){if(M0($),u(q,void 0,"key"),this.iHash=$.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let J=this.blockLen,Q=new Uint8Array(J);Q.set(q.length>J?$.create().update(q).digest():q);for(let G=0;G<Q.length;G++)Q[G]^=54;this.iHash.update(Q),this.oHash=$.create();for(let G=0;G<Q.length;G++)Q[G]^=106;this.oHash.update(Q),O8(Q)}update($){return j8(this),this.iHash.update($),this}digestInto($){j8(this),u($,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto($),this.oHash.update($),this.oHash.digestInto($),this.destroy()}digest(){let $=new Uint8Array(this.oHash.outputLen);return this.digestInto($),$}_cloneInto($){$||=Object.create(Object.getPrototypeOf(this),{});let{oHash:q,iHash:J,finished:Q,destroyed:G,blockLen:U,outputLen:X}=this;return $=$,$.finished=Q,$.destroyed=G,$.blockLen=U,$.outputLen=X,$.oHash=q._cloneInto($.oHash),$.iHash=J._cloneInto($.iHash),$}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var G$=($,q,J)=>new a$($,q).update(J).digest();G$.create=($,q)=>new a$($,q);function r1($,q,J){if(M0($),J===void 0)J=new Uint8Array($.outputLen);return G$($,J,q)}var s$=Uint8Array.of(0),uJ=Uint8Array.of();function a1($,q,J,Q=32){M0($),z8(Q,"length");let G=$.outputLen;if(Q>255*G)throw new Error("Length must be <= 255*HashLen");let U=Math.ceil(Q/G);if(J===void 0)J=uJ;else u(J,void 0,"info");let X=new Uint8Array(U*G),Z=G$.create($,q),Y=Z._cloneInto(),N=new Uint8Array(Z.outputLen);for(let W=0;W<U;W++)s$[0]=W+1,Y.update(W===0?uJ:N).update(J).update(s$).digestInto(N),X.set(N,G*W),Z._cloneInto(Y);return Z.destroy(),Y.destroy(),O8(N,s$),X.slice(0,Q)}var M8=($,q,J,Q,G)=>a1($,r1($,q,J),Q,G);var lJ=Iq(f$(),1),cJ="weba_l2_ed25519_sk";function N8($){if(typeof Buffer!=="undefined")return Buffer.from($).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");let q="";return $.forEach((Q)=>{q+=String.fromCharCode(Q)}),btoa(q).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function t($){let q=$.length%4===0?"":"=".repeat(4-$.length%4),J=$.replace(/-/g,"+").replace(/_/g,"/")+q;if(typeof Buffer!=="undefined")return new Uint8Array(Buffer.from(J,"base64"));let Q=atob(J),G=new Uint8Array(Q.length);for(let U=0;U<Q.length;U+=1)G[U]=Q.charCodeAt(U);return G}function T0($){let q=lJ.default($);if(q===void 0)throw new Error("Failed to canonicalize JSON");return q}function dJ($){let q=new Uint8Array($);return crypto.getRandomValues(q),q}function s1(){let $=localStorage.getItem(cJ);if($)return t($);let q=m8.utils.randomSecretKey();return localStorage.setItem(cJ,N8(q)),q}function t1($,q,J){let Q={layer1_ref:$,recipient:q,weba_version:J};return new TextEncoder().encode(T0(Q))}function nJ($,q){let J=new Uint8Array($.length+q.length);return J.set($,0),J.set(q,$.length),J}function iJ($){let q=$.keyPolicy??"campaign+layer1";if(q==="campaign+layer1"&&!$.layer1Ref)throw new Error("layer1_ref is required for campaign+layer1 policy");let J=T0({domain:"weba-l2/org-x25519",campaign_id:$.campaignId,key_policy:q,layer1_ref:q==="campaign+layer1"?$.layer1Ref:void 0}),Q=new TextEncoder().encode(J),G=M8(Y8,$.orgRootKey,void 0,Q,32);return{publicKey:Q0.getPublicKey(G),privateKey:G,keyPolicy:q}}function oJ($){let q=new TextEncoder().encode("weba-l2/user-x25519"),J=M8(Y8,$,void 0,q,32);return{publicKey:Q0.getPublicKey(J),privateKey:J}}function rJ(){return globalThis.webaPqcKem||null}async function aJ($,q,J,Q){let G=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["encrypt"]),U=await crypto.subtle.encrypt({name:"AES-GCM",iv:J,additionalData:Q},G,$);return new Uint8Array(U)}async function sJ($){let q=M8(Y8,$.prfKey,void 0,void 0,32),J=M8(Y8,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=M8(Y8,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),G=$.aad??new Uint8Array;return aJ($.recipientSk,J,Q,G)}async function tJ($,q,J,Q){let G=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["decrypt"]),U=await crypto.subtle.decrypt({name:"AES-GCM",iv:J,additionalData:Q},G,$);return new Uint8Array(U)}async function eJ($){let q=$.config.weba_version??"0.1",J=$.config.recipient_kid,Q=$.config.layer1_ref,G=$.user_kid??"user#sig-1",U=s1(),X=T0($.layer2_plain),Z=new TextEncoder().encode(X),Y=m8.sign(Z,U),N={alg:"Ed25519",kid:G,sig:N8(Y),created_at:new Date().toISOString()},W={layer2_plain:$.layer2_plain,layer2_sig:N},K=t1(Q,J,q),E=new TextEncoder().encode(T0(W)),R=t($.config.recipient_x25519),A=dJ(32),_=Q0.getPublicKey(A),L=Q0.getSharedSecret(A,R),j=L,C,D="X25519";if($.config.recipient_pqc){let V=$.pqcProvider??rJ();if(!V)throw new Error("PQC requested but no provider is available");let P=t($.config.recipient_pqc),S=V.encapsulate(P);C=S.encapsulation,j=nJ(L,S.sharedSecret),D=`X25519+${V.kemId}`}let F=M8(Y8,j,K,void 0,32),f=M8(Y8,F,void 0,new TextEncoder().encode("weba-l2/key"),32),k=M8(Y8,F,void 0,new TextEncoder().encode("weba-l2/iv"),12),y=await aJ(E,f,k,K);return{weba_version:q,layer1_ref:Q,layer2:{enc:"HPKE-v1",suite:{kem:D,kdf:"HKDF-SHA256",aead:"AES-256-GCM"},recipient:J,encapsulated:{classical:N8(_),...C?{pqc:N8(C)}:{}},ciphertext:N8(y),aad:N8(K)},meta:{created_at:new Date().toISOString(),nonce:N8(dJ(16)),...$.config.campaign_id?{campaign_id:$.config.campaign_id}:{},...$.config.key_policy?{key_policy:$.config.key_policy}:{}}}}function $Q(){let $=document.getElementById("weba-l2-config");if(!$||!$.textContent)return null;try{return JSON.parse($.textContent)}catch{return null}}async function U$($,q,J){let Q=t($.layer2.aad),G={layer1_ref:$.layer1_ref,recipient:$.layer2.recipient,weba_version:$.weba_version},U=new TextEncoder().encode(T0(G));if(N8(U)!==$.layer2.aad)throw new Error("AAD mismatch");let X=t($.layer2.encapsulated.classical),Z=Q0.getSharedSecret(q,X),Y=Z;if($.layer2.encapsulated.pqc){let A=J?.pqcProvider??rJ(),_=J?.pqcRecipientSk;if(!A||!_)throw new Error("Missing PQC KEM for envelope");let L=t($.layer2.encapsulated.pqc),j=A.decapsulate(_,L);Y=nJ(Z,j)}let N=M8(Y8,Y,Q,void 0,32),W=M8(Y8,N,void 0,new TextEncoder().encode("weba-l2/key"),32),K=M8(Y8,N,void 0,new TextEncoder().encode("weba-l2/iv"),12),E=t($.layer2.ciphertext),R=await tJ(E,W,K,Q);return JSON.parse(new TextDecoder().decode(R))}async function qQ($){let q=M8(Y8,$.prfKey,void 0,void 0,32),J=M8(Y8,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=M8(Y8,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),G=$.keywrap.aad?t($.keywrap.aad):new Uint8Array,U=t($.keywrap.wrapped_key);return tJ(U,J,Q,G)}function e1($){$.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox"||J.type==="radio")J.checked=!1,J.removeAttribute("checked");else J.value="",J.removeAttribute("value")}),$.querySelectorAll("textarea").forEach((J)=>{J.value="",J.textContent=""}),$.querySelectorAll("select").forEach((J)=>{J.selectedIndex=-1,J.querySelectorAll("option").forEach((Q)=>Q.removeAttribute("selected"))}),$.getElementById("json-ld")?.remove(),$.getElementById("data-layer")?.remove();let q=$.getElementById("json-debug");if(q)q.textContent=""}function $9($,q){let J=JSON.stringify(q,null,2),Q=$.createElement("script");Q.type="application/ld+json",Q.id="weba-user-vc",Q.textContent=J,$.body.appendChild(Q);let G=$.createElement("div");G.className="weba-user-verification no-print",G.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",G.innerHTML=`
    <details>
      <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
        <span></span> 
      </summary>
      <div style="padding: 1rem 0;">
        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
      </div>
    </details>
  `;let U=G.querySelector("pre");if(U)U.textContent=J;$.body.appendChild(G)}function q9($,q){let J=$.createElement("script");J.id="weba-l2-envelope",J.type="application/json",J.textContent=JSON.stringify(q,null,2),$.body.appendChild(J)}function J9($,q){let J=new Date,Q=J.getFullYear()+("0"+(J.getMonth()+1)).slice(-2)+("0"+J.getDate()).slice(-2)+"-"+("0"+J.getHours()).slice(-2)+("0"+J.getMinutes()).slice(-2),G=Math.random().toString(36).substring(2,8);return`${$}_${Q}_${q}_${G}.html`}function Q9($,q){let Q=new DOMParser().parseFromString($,"text/html");if(q?.stripPlaintext)e1(Q);if(q?.embeddedVc)$9(Q,q.embeddedVc);if(q?.l2Envelope)q9(Q,q.l2Envelope);return Q.documentElement.outerHTML}function JQ($){let q=Q9($.documentHtml,$.options),J=new Blob([q],{type:"text/html"}),Q=URL.createObjectURL(J),G=document.createElement("a");if(G.href=Q,G.download=J9($.title,$.filenameSuffix),G.click(),$.isFinal)setTimeout(()=>window.location.reload(),1000)}class t${formId;constructor(){this.formId="WebA_"+window.location.pathname}updateJsonLd(){let q=window.generatedJsonStructure||{};document.querySelectorAll("[data-json-path]").forEach((G)=>{let U=G.dataset.jsonPath;if(U)q[U]=G.value}),document.querySelectorAll('[type="radio"]:checked').forEach((G)=>{q[G.name]=G.value}),document.querySelectorAll("table.data-table.dynamic").forEach((G)=>{let U=G.dataset.tableKey;if(U){let X=[];G.querySelectorAll("tbody tr").forEach((Z)=>{let Y={},N=!1;if(Z.querySelectorAll("[data-base-key]").forEach((W)=>{if(W.type==="checkbox"){if(Y[W.dataset.baseKey]=W.checked,W.checked)N=!0}else if(Y[W.dataset.baseKey]=W.value,W.value)N=!0}),N)X.push(Y)}),q[U]=X}});let J=document.getElementById("json-ld");if(J)J.textContent=JSON.stringify(q,null,2);let Q=document.getElementById("json-debug");if(Q)Q.textContent=JSON.stringify(q,null,2);return q}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=this.updateJsonLd(),q=window,J=q.generatedJsonStructure&&q.generatedJsonStructure.name||"Response",Q=window.location.href.split("#")[0],G=this.getL2Config(),U=document.getElementById("weba-l2-encrypt");if(!!(G?.enabled&&(U?U.checked:G.default_enabled))){if(!G?.recipient_kid||!G?.recipient_x25519||!G?.layer1_ref){alert("L2 encryption config is missing required fields.");return}try{let Y=await eJ({layer2_plain:$,config:G,user_kid:G.user_kid});this.downloadHtml("submit",!0,{l2Envelope:Y,stripPlaintext:!0})}catch(Y){console.error(Y),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!Y0.getPublicKey()){if(!await Y0.register()){alert("Key registration failed.");return}}let Z={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:Y0.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:Q,answers:$}};try{let Y=await Y0.sign(Z);this.downloadHtml("submitted",!0,{embeddedVc:Y})}catch(Y){console.error(Y),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let q=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((J)=>{let Q=J.dataset.jsonPath;if(q[Q]!==void 0)J.value=q[Q]}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let Q=J.dataset.tableKey,G=q[Q];if(Array.isArray(G)){let U=J.querySelector("tbody");if(!U)return;let X=U.querySelectorAll(".template-row");G.forEach((Z,Y)=>{let N;if(Y===0)N=U.querySelector(".template-row");else{let W=U.querySelector(".template-row");if(W){N=W.cloneNode(!0),N.classList.remove("template-row");let K=N.querySelector(".remove-row-btn");if(K)K.style.visibility="visible";U.appendChild(N)}}if(N)N.querySelectorAll("input, select").forEach((W)=>{let K=W.dataset.baseKey;if(K&&Z[K]!==void 0)if(W.type==="checkbox")W.checked=!!Z[K];else W.value=Z[K]})})}})}catch(q){console.error(q)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,q,J){let Q=window,G=Q.generatedJsonStructure&&Q.generatedJsonStructure.name||"web-a-form";JQ({documentHtml:document.documentElement.outerHTML,title:G,filenameSuffix:$,isFinal:q,options:J})}saveDraft(){this.bakeValues(),this.downloadHtml("draft",!1)}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class e${calc;data;constructor($,q){this.calc=$,this.data=q}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save Progress",clear_btn:"Clear Data",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},q=(navigator.language||"en").startsWith("ja")?"ja":"en",J=$[q]||$.en;document.querySelectorAll("[data-i18n]").forEach((Q)=>{let G=Q.dataset.i18n;if(J[G])Q.textContent=J[G]})}initTables(){document.querySelectorAll(".data-table.dynamic tbody").forEach(($)=>{this.renumberRows($)})}renumberRows($){Array.from($.querySelectorAll("tr")).filter((J)=>{return J.querySelectorAll("td").length>0}).forEach((J,Q)=>{let G=Q+1;J.querySelectorAll(".auto-num").forEach((U)=>{if(U.value!=G)U.value=G.toString(),U.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let q=$.closest("tr"),J=q.parentElement;if(q.classList.contains("template-row"))q.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox")Q.checked=!1;else Q.value=""});else{if(q.remove(),J)this.renumberRows(J);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,q){let J=document.getElementById("tbl_"+q);if(!J)return;let Q=J.querySelector("tbody");if(!Q)return;let G=Q.querySelector(".template-row");if(!G)return;let U=G.cloneNode(!0);U.classList.remove("template-row"),U.querySelectorAll("input").forEach((Z)=>{if(Z.type==="checkbox")Z.checked=Z.hasAttribute("checked");else Z.value=Z.getAttribute("value")||""});let X=U.querySelector(".remove-row-btn");if(X)X.style.visibility="visible";U.querySelectorAll("[data-copy-from]").forEach((Z)=>{let Y=Z.dataset.copyFrom;if(Y){let N=U.querySelector(`[data-base-key="${Y}"]`);if(N&&N.value)Z.value=N.value}}),Q.appendChild(U),this.renumberRows(Q),this.calc.recalculate()}switchTab($,q){document.querySelectorAll(".tab-btn").forEach((Q)=>Q.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((Q)=>Q.classList.remove("active")),$.classList.add("active");let J=document.getElementById(q);if(J)J.classList.add("active")}}function QQ($){let q=document.getElementById($);if(!q||!q.textContent)return null;try{return JSON.parse(q.textContent)}catch{return null}}function GQ(){let $=QQ("weba-l2-envelope");if(!$)return;let q=QQ("weba-l2-keywrap"),J=document.querySelector(".weba-form-container")||document.body,Q=document.createElement("div");Q.className="weba-l2-unlock",Q.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #cbd5f5;border-radius:10px;background:#f8fafc;";let G=document.createElement("div");G.textContent="Encrypted Submission",G.style.cssText="font-weight:600;color:#334155;margin-bottom:0.5rem;",Q.appendChild(G);let U=document.createElement("div");U.textContent="Locked. Unlock with Passkey.",U.style.cssText="color:#64748b;margin-bottom:0.75rem;",Q.appendChild(U);let X=document.createElement("button");X.textContent="Unlock (Passkey)",X.style.cssText="padding:0.5rem 1rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;",Q.appendChild(X);let Z=document.createElement("pre");Z.style.cssText="margin-top:1rem;padding:1rem;background:#0f172a;color:#e2e8f0;border-radius:8px;overflow:auto;font-size:0.85rem;display:none;",Q.appendChild(Z);let Y=document.createElement("details");Y.style.cssText="margin-top:0.75rem; display:none;",Y.innerHTML='<summary style="cursor:pointer;color:#64748b;">Show signature</summary><pre style="margin-top:0.5rem;padding:0.75rem;background:#0b1220;color:#cbd5f5;border-radius:6px;overflow:auto;font-size:0.8rem;"></pre>',Q.appendChild(Y);let N=document.createElement("button");N.textContent="Export JSON",N.style.cssText="margin-top:0.75rem;padding:0.45rem 0.9rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;display:none;",N.disabled=!0,Q.appendChild(N),X.addEventListener("click",async()=>{if(!q){U.textContent="Key wrap package not found.";return}X.disabled=!0,U.textContent="Waiting for passkey...";try{let W=t(q.prf_salt),K=await Q$(q.credential_id,W),E=await qQ({keywrap:q,prfKey:K}),R=await U$($,E);G9(R.layer2_plain),document.body.classList.add("weba-l2-readonly"),Z.textContent=JSON.stringify(R.layer2_plain,null,2),Z.style.display="block";let A=Y.querySelector("pre");if(A)A.textContent=JSON.stringify(R.layer2_sig,null,2);Y.style.display="block",N.style.display="inline-block",N.disabled=!1,U.textContent="Unlocked.",N.onclick=()=>{let _=new Blob([JSON.stringify(R,null,2)],{type:"application/json"}),L=URL.createObjectURL(_),j=document.createElement("a");j.href=L,j.download="weba-l2-decrypted.json",j.click()}}catch(W){console.error(W),U.textContent="Unlock failed.",X.disabled=!1}}),J.appendChild(Q)}function G9($){if(!$||typeof $!=="object")return;let q=$;document.querySelectorAll("[data-json-path]").forEach((J)=>{let Q=J.dataset.jsonPath;if(!Q||!(Q in q))return;let G=q[Q];if(J.type==="checkbox")J.checked=Boolean(G);else if(J.type==="radio")J.checked=J.value===String(G);else J.value=G===null||G===void 0?"":String(G)}),document.querySelectorAll('input[type="radio"]').forEach((J)=>{let Q=J.name;if(!Q||!(Q in q))return;let G=q[Q];J.checked=J.value===String(G)}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let Q=J.dataset.tableKey;if(!Q)return;let G=q[Q];if(!Array.isArray(G))return;let U=J.querySelector("tbody");if(!U)return;let X=U.querySelector("tr.template-row");if(!X)return;Array.from(U.querySelectorAll("tr")).forEach((Z)=>{if(!Z.classList.contains("template-row"))Z.remove()}),G.forEach((Z,Y)=>{let N=Y===0?X:X.cloneNode(!0);if(Y>0){N.classList.remove("template-row");let W=N.querySelector(".remove-row-btn");if(W)W.style.visibility="visible";U.appendChild(N)}if(Z&&typeof Z==="object")N.querySelectorAll("input, select, textarea").forEach((W)=>{let K=W.dataset.baseKey;if(!K)return;let E=Z[K];if(W.type==="checkbox")W.checked=Boolean(E);else W.value=E===null||E===void 0?"":String(E)})})}),document.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox"||J.type==="radio")J.disabled=!0;else J.readOnly=!0}),document.querySelectorAll("textarea").forEach((J)=>{J.readOnly=!0}),document.querySelectorAll("select").forEach((J)=>{J.disabled=!0}),document.querySelectorAll(".form-toolbar button, .add-row-btn, .remove-row-btn").forEach((J)=>{J.disabled=!0})}function V8($){return document.getElementById($)}function UQ(){if(!V8("weba-l2-keywrap-tool"))return;let q=V8("kwp-recipient-sk"),J=V8("kwp-credential-id"),Q=V8("kwp-prf-salt"),G=V8("kwp-aad"),U=V8("kwp-kid"),X=V8("kwp-status"),Z=V8("kwp-output"),Y=V8("kwp-generate-salt"),N=V8("kwp-wrap");if(!q||!J||!Q||!X||!Z||!N)return;Y?.addEventListener("click",()=>{let W=new Uint8Array(32);crypto.getRandomValues(W),Q.value=N8(W)}),N.addEventListener("click",async()=>{X.textContent="Waiting for passkey...",N.disabled=!0;try{if(!q.value||!J.value||!Q.value)throw new Error("Missing required fields.");let W=t(q.value.trim()),K=t(Q.value.trim()),E=await Q$(J.value.trim(),K),R=G?.value?t(G.value.trim()):void 0,A=await sJ({recipientSk:W,prfKey:E,aad:R}),_={alg:"WebAuthn-PRF-AESGCM-v1",kid:U?.value||"issuer#passkey-1",credential_id:J.value.trim(),prf_salt:N8(K),wrapped_key:N8(A),...R?{aad:N8(R)}:{}};Z.textContent=JSON.stringify(_,null,2),X.textContent="Key wrap ready."}catch(W){console.error(W),X.textContent="Key wrap failed."}finally{N.disabled=!1}})}function YQ($){let q={},J=(Q,G)=>{if(Q===null||Q===void 0){q[G]=null;return}if(Array.isArray(Q)){Q.forEach((U,X)=>{J(U,G?`${G}[${X}]`:`[${X}]`)});return}if(typeof Q==="object"){Object.entries(Q).forEach(([U,X])=>{let Z=G?`${G}.${U}`:U;J(X,Z)});return}q[G]=Q};if(J($,""),""in q)delete q[""];return q}function $q($){let q={_filename:$.filename},J=new Set(["_filename"]);if($.includeJson)J.add("_json"),q._json=JSON.stringify($.plain);let Q=YQ($.plain||{});for(let G of Object.keys(Q)){if($.omitKey&&$.omitKey(G))continue;J.add(G),q[G]=Q[G]}if($.sig)J.add("_l2_sig"),q._l2_sig=JSON.stringify($.sig);return{row:q,keys:J}}function XQ($){if($===null||$===void 0)return"";let q=String($);if(/[",\n]/.test(q))return`"${q.replace(/"/g,'""')}"`;return q}function ZQ($,q){let J=[];return J.push(q.map(XQ).join(",")),$.forEach((Q)=>{let G=q.map((U)=>XQ(Q[U])).join(",");J.push(G)}),"\uFEFF"+J.join(`
`)}function WQ($){if(typeof DOMParser!=="undefined")return new DOMParser().parseFromString($,"text/html");if(typeof document!=="undefined"){let q=document.implementation.createHTMLDocument("");return q.documentElement.innerHTML=$,q}return null}function MQ($,q){let J=WQ($);if(J)return J.getElementById(q)?.textContent??null;let Q=new RegExp(`<script[^>]*id=["']${q}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),G=$.match(Q);return G?G[1]:null}function U9($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function X9($,q){let J=WQ($);if(J)return J.querySelector(`script[type="${q}"]`)?.textContent??null;let Q=new RegExp(`<script[^>]*type=["']${U9(q)}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),G=$.match(Q);return G?G[1]:null}function NQ($){let q=MQ($,"data-layer");if(q)try{return JSON.parse(q)}catch{return null}let J=X9($,"application/ld+json");if(J)try{return JSON.parse(J)}catch{return null}return null}function OQ($){let q=MQ($,"weba-l2-envelope");if(!q)return null;try{return JSON.parse(q)}catch{return null}}function Y9($){if(!$.trim())return null;try{let q=JSON.parse($);if(!q.recipient_x25519_private&&!q.org_root_key)return null;return q}catch{return null}}function Z9(){let $=document.getElementById("weba-l2-keys");if(!$?.textContent)return null;return Y9($.textContent)}function W9(){let $=document.getElementById("weba-agg-spec");if(!$?.textContent)return null;try{let q=JSON.parse($.textContent);if(Array.isArray(q))return q[0]??null;return q}catch{return null}}function r8($,q){let J=q.trim().replace(/^\$\./,"");if(!J)return[];let Q=J.split("."),G=[$];for(let U of Q){let X=U.match(/^(.*)\[(\d*)\]$/),Z=X?X[1]:U,Y=X?X[2]:null,N=X&&Y==="",W=X&&Y!==""&&Y!==null?parseInt(Y,10):null,K=[];for(let E of G){if(E===null||E===void 0)continue;let R=Z?E[Z]:E;if(N){if(Array.isArray(R))K.push(...R);continue}if(W!==null){if(Array.isArray(R)&&R[W]!==void 0)K.push(R[W]);continue}if(R!==void 0)K.push(R)}G=K}return G}function X$($){if(typeof $==="number"&&Number.isFinite($))return $;if(typeof $==="string"&&$.trim()!==""){let q=Number($.replace(/,/g,""));return Number.isFinite(q)?q:null}return null}function M9($,q){let J=r8($,q.path);if(q.op==="exists")return J.length>0;let Q=J[0],G=q.value;if(q.op==="eq")return Q===G;if(q.op==="neq")return Q!==G;if(q.op==="in"&&Array.isArray(G))return G.includes(Q);let U=X$(Q),X=X$(G);if(U===null||X===null)return!1;if(q.op==="gt")return U>X;if(q.op==="gte")return U>=X;if(q.op==="lt")return U<X;if(q.op==="lte")return U<=X;return!1}function Jq($,q){if(!q)return $;let J=Array.isArray(q)?q:[q];return $.filter((Q)=>J.every((G)=>M9(Q,G)))}function KQ($,q){let J=Jq($,q.filter);if(q.op==="count"){if(q.path)return J.reduce((U,X)=>U+r8(X,q.path).length,0);return J.length}let G=(q.path?J.flatMap((U)=>r8(U,q.path)):J).map((U)=>X$(U)).filter((U)=>U!==null);if(G.length===0)return null;if(q.op==="sum")return G.reduce((U,X)=>U+X,0);if(q.op==="avg")return G.reduce((U,X)=>U+X,0)/G.length;if(q.op==="min")return Math.min(...G);if(q.op==="max")return Math.max(...G);return null}function qq($,q){if($===null)return"-";if(q==="currency")return new Intl.NumberFormat(void 0,{style:"currency",currency:"JPY"}).format($);if(q==="percent")return new Intl.NumberFormat(void 0,{style:"percent",maximumFractionDigits:1}).format($);return new Intl.NumberFormat().format($)}function A0($,q){return qq($,q)}function DQ($,q){if(!q)return $;let J=[];for(let Q of $){let G=r8(Q,q);for(let U of G)if(Array.isArray(U))J.push(...U);else if(U!==void 0&&U!==null)J.push(U)}return J}function N9($,q){let J=DQ($,q.source),Q=Jq(J,q.filter),G=new Map;for(let X of Q){let Z=r8(X,q.x);if(Z.length===0)continue;for(let Y of Z){let N=Y===void 0||Y===null||Y===""?"Unknown":String(Y);G.set(N,(G.get(N)||0)+1)}}let U=Array.from(G.entries()).map(([X,Z])=>({label:X,value:Z}));if(q.sort){let X=q.sort.order==="asc"?1:-1;U.sort((Z,Y)=>{if(q.sort?.by==="label")return Z.label.localeCompare(Y.label)*X;return(Z.value-Y.value)*X})}if(q.limit)U=U.slice(0,q.limit);return U}function O9($,q){let J=DQ($,q.source),Q=Jq(J,q.filter),G=[];for(let K of Q){let E=r8(K,q.value);for(let R of E){let A=X$(R);if(A!==null)G.push(A)}}if(G.length===0||q.bin<=0)return[];let U=q.min??0,X=q.max??Math.max(...G),Z=new Map,Y=0;for(let K of G){if(q.max!==void 0&&K>q.max){Y+=1;continue}let E=Math.max(0,Math.floor((K-U)/q.bin)),R=U+E*q.bin;Z.set(R,(Z.get(R)||0)+1)}let N=[],W=Math.max(1,Math.ceil((X-U+1)/q.bin));for(let K=0;K<W;K+=1){let E=U+K*q.bin,R=E+q.bin-1,A=`${A0(E,q.format)} - ${A0(R,q.format)}`;N.push({label:A,value:Z.get(E)||0})}if(Y>0&&q.max!==void 0)N.push({label:`${A0(q.max,q.format)}+`,value:Y});return N}function K9($,q){if(q.length===0)return"";let J=Math.max(...q.map((U)=>U.value)),Q=$.title?`<div class="agg-chart-title">${$.title}</div>`:"",G=q.map((U)=>{let X=J>0?U.value/J*100:0,Z=A0(U.value,$.format);return`<div class="agg-bar"><div class="agg-bar-label">${U.label}</div><div class="agg-bar-track"><div class="agg-bar-fill" style="width:${X}%"></div></div><div class="agg-bar-value">${Z}</div></div>`}).join("");return`<div class="agg-chart">${Q}<div class="agg-bar-list">${G}</div></div>`}function z9($,q){if(q.length===0)return"";let J=Math.max(...q.map((U)=>U.value)),Q=$.title?`<div class="agg-chart-title">${$.title}</div>`:"",G=q.map((U)=>{let X=J>0?U.value/J*100:0,Z=A0(U.value,$.format);return`<div class="agg-bar"><div class="agg-bar-label">${U.label}</div><div class="agg-bar-track"><div class="agg-bar-fill" style="width:${X}%"></div></div><div class="agg-bar-value">${Z}</div></div>`}).join("");return`<div class="agg-chart">${Q}<div class="agg-bar-list">${G}</div></div>`}function zQ($,q,J){if(!q?.dashboard||J.length===0){$.innerHTML="";return}let Q=J.map((W)=>W.plain),G=q.dashboard.title?`<div class="agg-dashboard-title">${q.dashboard.title}</div>`:"",U=(q.dashboard.cards||[]).map((W)=>{let K=KQ(Q,W),E=qq(K,W.format);return`<div class="agg-card"><div class="agg-card-label">${W.label}</div><div class="agg-card-value">${E}</div></div>`}).join(""),X=U?`<div class="agg-card-grid">${U}</div>`:"",Z=(q.dashboard.charts||[]).map((W)=>{if(W.type==="bar"){let K=N9(Q,W);return K9(W,K)}if(W.type==="hist"){let K=O9(Q,W);return z9(W,K)}return""}).filter(Boolean).join(""),Y=Z?`<div class="agg-chart-grid">${Z}</div>`:"",N=(q.dashboard.tables||[]).map((W)=>{let K=new Map;for(let C of Q){let D=r8(C,W.group_by)[0],F=D===void 0||D===null||D===""?"Unknown":String(D);if(!K.has(F))K.set(F,[]);K.get(F).push(C)}let E=Array.from(K.entries()).map(([C,D])=>{let F={};return W.metrics.forEach((f)=>{let k=KQ(D,f);F[f.id]=qq(k,f.format)}),{groupKey:C,metricValues:F}});if(W.sort){let C=W.sort.order==="asc"?1:-1;E.sort((D,F)=>{let f=D.metricValues[W.sort.by]??"",k=F.metricValues[W.sort.by]??"";if(f===k)return 0;return f>k?C:-C})}let R=W.limit?E.slice(0,W.limit):E,_=["Group",...W.metrics.map((C)=>C.label||C.id)].map((C)=>`<th>${C}</th>`).join(""),L=R.map((C)=>{return`<tr>${[`<td>${C.groupKey}</td>`,...W.metrics.map((F)=>`<td>${C.metricValues[F.id]}</td>`)].join("")}</tr>`}).join("");return`<div class="agg-dashboard-table">${W.label?`<div class="agg-table-title">${W.label}</div>`:""}<table class="agg-table"><thead><tr>${_}</tr></thead><tbody>${L}</tbody></table></div>`}).join("");$.innerHTML=`${G}${X}${Y}${N}`}async function D9($,q){let J=OQ($);if(J){let G=null;if(q){if(q.recipient_kid&&J.layer2?.recipient&&q.recipient_kid!==J.layer2.recipient)throw new Error(`recipient_kid mismatch (${J.layer2.recipient})`);if(q.org_root_key){let Z=q.org_campaign_id||J.meta?.campaign_id;if(!Z)throw new Error("org_campaign_id is required for org_root_key");G=iJ({orgRootKey:t(q.org_root_key),campaignId:Z,layer1Ref:J.layer1_ref||"",keyPolicy:q.org_key_policy||J.meta?.key_policy}).privateKey}else if(q.recipient_x25519_private)G=t(q.recipient_x25519_private)}if(!G){if(!q)throw new Error("No recipient key provided and not a demo campaign");throw new Error("No recipient key provided")}let U=q?.recipient_pqc_private&&q?.recipient_pqc_kem==="ML-KEM-768"?{pqcProvider:globalThis.webaPqcKem??null,pqcRecipientSk:t(q.recipient_pqc_private)}:void 0,X=await U$(J,G,U);return{plain:X.layer2_plain??X,sig:X.layer2_sig,source:"l2"}}let Q=NQ($);if(Q)return{plain:Q,source:"jsonld"};return{source:null}}function E9($,q,J){if(q.length===0){$.innerHTML='<div class="agg-empty">No rows to display.</div>';return}let Q=J.map((U)=>`<th>${U}</th>`).join(""),G=q.map((U,X)=>{let Z=J.map((Y)=>`<td>${U[Y]??""}</td>`).join("");return`<tr style="cursor:pointer" onclick="window.showRecordDetail(${X})">${Z}</tr>`}).join("");$.innerHTML=`<div class="agg-table-title">Records (Click row to view details)</div><table class="agg-table"><thead><tr>${Q}</tr></thead><tbody>${G}</tbody></table>`,window._aggRows=q}function C9($){let q=window._aggRows;if(!q||!q[$])return;let J=q[$],Q=document.getElementById("weba-agg-detail");if(!Q)return;let G=J._raw||{},U="",X=(Z,Y="")=>{for(let N in Z){if(N==="_raw"||N==="_sig")continue;let W=Z[N],K=Y?`${Y}.${N}`:N;if(typeof W==="object"&&W!==null&&!Array.isArray(W))X(W,K);else{let E=Array.isArray(W)?JSON.stringify(W,null,2):W;U+=`<div class="detail-field">
          <div class="detail-label">${K}</div>
          <div class="detail-value">${E}</div>
        </div>`}}};X(G),Q.innerHTML=`
    <div class="detail-overlay" onclick="this.parentElement.innerHTML=''">
      <div class="detail-modal" onclick="event.stopPropagation()">
        <div class="detail-header">
          <h3>Record Detail: ${J._filename||"unnamed"}</h3>
          <button onclick="this.closest('.detail-overlay').parentElement.innerHTML=''"></button>
        </div>
        <div class="detail-body">
          ${U}
          <div class="detail-raw">
            <h4>Raw JSON</h4>
            <pre>${JSON.stringify(G,null,2)}</pre>
          </div>
        </div>
      </div>
    </div>
  `}window.showRecordDetail=C9;function EQ(){let $=document.getElementById("aggregator-root");if(!$)return;$.innerHTML=`
    <div class="agg-panel">
      <div class="agg-row">
        <label class="agg-label">Input HTML</label>
        <input id="weba-agg-files" type="file" accept=".html" multiple />
      </div>
      <div class="agg-row">
        <label class="agg-label">L2 Key (embedded)</label>
        <div id="weba-agg-key-status" class="agg-chip">Not loaded</div>
        <div class="agg-note">Use <code>&lt;script id="weba-l2-keys"&gt;</code> to embed.</div>
      </div>
      <div class="agg-row">
        <button id="weba-agg-passkey" class="agg-btn secondary">\uD83D\uDD11 Decrypt with Passkey</button>
      </div>
      <div class="agg-row">
        <label class="agg-label">Include JSON</label>
        <input id="weba-agg-include-json" type="checkbox" />
      </div>
      <div class="agg-row">
        <button id="weba-agg-run" class="agg-btn">Decrypt & Aggregate</button>
        <button id="weba-agg-download" class="agg-btn secondary" disabled>Download CSV</button>
        <button id="weba-agg-download-jsonl" class="agg-btn secondary" disabled>Download JSONL</button>
      </div>
      <div id="weba-agg-status" class="agg-status">Ready.</div>
    </div>
    <div id="weba-agg-dashboard" class="agg-dashboard"></div>
    <div id="weba-agg-output" class="agg-output"></div>
    <div id="weba-agg-detail"></div>
    <style>
      .detail-field { margin-bottom: 12px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
      .detail-label { font-size: 0.75rem; color: #666; font-weight: 600; text-transform: uppercase; }
      .detail-value { font-size: 1rem; color: #111; margin-top: 2px; white-space: pre-wrap; word-break: break-all; }
      .detail-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000; padding: 20px; }
      .detail-modal { background: #fff; width: 100%; max-width: 800px; max-height: 90vh; border-radius: 12px; display: flex; flex-direction: column; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
      .detail-header { padding: 16px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
      .detail-header h3 { margin: 0; font-size: 1.1rem; }
      .detail-header button { border: none; background: none; font-size: 1.5rem; cursor: pointer; color: #999; }
      .detail-body { padding: 20px; overflow-y: auto; flex: 1; }
      .detail-raw h4 { margin: 20px 0 10px; border-top: 2px solid #eee; padding-top: 20px; }
      .detail-raw pre { background: #f8fafc; padding: 12px; border-radius: 6px; font-size: 0.8rem; border: 1px solid #e2e8f0; }
      .agg-table tr:hover { background: #f8fafc; }
    </style>
  `;let q=$.querySelector("#weba-agg-files"),J=$.querySelector("#weba-agg-status"),Q=$.querySelector("#weba-agg-output"),G=$.querySelector("#weba-agg-dashboard"),U=$.querySelector("#weba-agg-include-json"),X=$.querySelector("#weba-agg-run"),Z=$.querySelector("#weba-agg-download"),Y=$.querySelector("#weba-agg-download-jsonl"),N=$.querySelector("#weba-agg-key-status"),W=$.querySelector("#weba-agg-passkey"),K="",E="",R=[],A=null,_=Z9(),L=W9(),j=Array.isArray(L?.samples)?L.samples.map((D,F)=>({filename:`sample-${F+1}.json`,plain:D})):[];if(N)N.textContent=_?.recipient_kid?`Loaded (${_.recipient_kid})`:_?"Loaded":"Not loaded",N.classList.toggle("ready",!!_);if(L?.export?.jsonl===!1&&Y)Y.disabled=!0;W?.addEventListener("click",async()=>{try{if(!prompt("User Name for Passkey:","demo-user"))return;alert("Please authenticate with your Passkey to decrypt.");let F=new Uint8Array(32),f=new Uint8Array(32),k=await navigator.credentials.get({publicKey:{challenge:F,userVerification:"required",extensions:{prf:{eval:{first:f}}}}});if(!k)throw new Error("No credential found.");let V=k.getClientExtensionResults()?.prf?.results?.first;if(!V)throw new Error("PRF not supported or enabled on this key.");let P=new Uint8Array(V),S=oJ(P);A={recipient_x25519_private:N8(S.privateKey)},W.textContent=" Passkey Loaded",W.disabled=!0}catch(D){console.error(D),alert("Passkey error: "+D.message)}});let C=async()=>{if((!q?.files||q.files.length===0)&&j.length===0){if(J)J.textContent="Select HTML files first.";return}if(J)J.textContent="Processing...";if(Z)Z.disabled=!0;if(Y)Y.disabled=!0;let D=[],F=new Set(["_filename"]),f=0,k=0;if(q?.files&&q.files.length>0)R=[];else R=[...j];let y=A||_;if(q?.files)for(let S of Array.from(q.files))try{let g=await S.text(),p=await D9(g,y);if(p.source==="l2"&&p.plain){R.push({filename:S.name,plain:p.plain,sig:p.sig});let O=$q({plain:p.plain,filename:S.name,includeJson:!!U?.checked,sig:p.sig});O.keys.forEach((T)=>F.add(T)),D.push({...O.row,_raw:p.plain,_sig:p.sig}),f+=1;continue}if(p.source==="jsonld"&&p.plain){R.push({filename:S.name,plain:p.plain});let O=$q({plain:p.plain,filename:S.name,includeJson:!!U?.checked,omitKey:(T)=>T.startsWith("@")});O.keys.forEach((T)=>F.add(T)),D.push({...O.row,_raw:p.plain}),f+=1;continue}k+=1}catch(g){console.error(g),k+=1}let V=Array.from(F).sort((S,g)=>{if(S==="_filename")return-1;if(g==="_filename")return 1;return S.localeCompare(g)});if(K=ZQ(D,V),Z)Z.disabled=D.length===0;let P=L?.export?.jsonl!==!1;if(E=R.map((S)=>JSON.stringify({_filename:S.filename,_l2_sig:S.sig??null,...S.plain})).join(`
`),Y)Y.disabled=R.length===0||!P;if(J)J.textContent=`Processed ${f} files. Errors: ${k}.`;if(G)zQ(G,L,R);if(Q)E9(Q,D,V)};if(j.length>0){if(R=[...j],E=R.map((D)=>JSON.stringify({_filename:D.filename,_l2_sig:D.sig??null,...D.plain})).join(`
`),G)zQ(G,L,R);if(Y)Y.disabled=E.length===0||L?.export?.jsonl===!1;if(J)J.textContent=`Loaded ${j.length} sample records.`}X?.addEventListener("click",()=>{C().catch((D)=>{if(J)J.textContent="Failed to aggregate.";console.error(D)})}),Z?.addEventListener("click",()=>{if(!K)return;let D=new Blob([K],{type:"text/csv"}),F=URL.createObjectURL(D),f=document.createElement("a");f.href=F,f.download="weba-aggregated.csv",f.click(),URL.revokeObjectURL(F)}),Y?.addEventListener("click",()=>{if(!E)return;let D=new Blob([E],{type:"application/json"}),F=URL.createObjectURL(D),f=document.createElement("a");f.href=F,f.download="weba-aggregated.jsonl",f.click(),URL.revokeObjectURL(F)})}function CQ(){console.log("Web/A Runtime Booting...");let $=new E$,q=new t$,J=new e$($,q),Q=window,G=document.getElementById("weba-structure");if(G?.textContent)try{Q.generatedJsonStructure=JSON.parse(G.textContent)}catch(Z){console.warn("Failed to parse weba structure JSON",Z)}let U=$Q();if(U)Q.webaL2Config=U;Q.saveDraft=()=>q.saveDraft(),Q.submitDocument=()=>q.submitDocument(),Q.signAndDownload=()=>q.signAndDownload(),Q.clearData=()=>q.clearData(),Q.removeTableRow=(Z)=>J.removeTableRow(Z),Q.addTableRow=(Z,Y)=>J.addTableRow(Z,Y),Q.switchTab=(Z,Y)=>J.switchTab(Z,Y),Q.recalculate=()=>$.recalculate(),Q.escapeHtml=(Z)=>{if(!Z)return"";let Y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return Z.toString().replace(/[&<>"']/g,(N)=>Y[N]||N)},q.restoreFromLS(),J.applyI18n(),J.initTables(),$.recalculate(),GQ(),UQ(),EQ();let X;document.addEventListener("input",(Z)=>{let Y=Z.target;if(Z.isTrusted)Y.dataset.dirty="true";let N=Y.dataset.baseKey||Y.dataset.jsonPath;if(N)(Y.closest("tr")||document).querySelectorAll(`[data-copy-from="${N}"]`).forEach((E)=>{if(!E.dataset.dirty){if(E.value!==Y.value)E.value=Y.value,E.dispatchEvent(new Event("input"))}});$.recalculate(),q.updateJsonLd(),clearTimeout(X),X=setTimeout(()=>q.saveToLS(),1000)}),console.log("Web/A Runtime Ready.")}class Qq{suggestionsVisible=!1;activeSearchInput=null;globalBox=null;constructor(){}init(){console.log("Initializing Search Engine (Bundle)...");let $=window;if($.generatedJsonStructure&&$.generatedJsonStructure.masterData){let q=Object.keys($.generatedJsonStructure.masterData);console.log("Master Data Keys available:",q.join(", "))}this.setupEventDelegation()}normalize($){if(!$)return"";let q=$.toString().toLowerCase();return q=q.replace(/[---]/g,(J)=>{return String.fromCharCode(J.charCodeAt(0)-65248)}),q=q.replace(/[-]/g,(J)=>String.fromCharCode(J.charCodeAt(0)-65248)),q.trim()}clean($){if(!$)return"";let q=this.normalize($);return q=q.replace(/(|||||npo||)/g,""),q=q.replace(/(\(\)|\(\)|\(\))/g,""),q.trim()}toIndex($){let q=parseInt($||"",10);return Number.isFinite(q)?q-1:-1}getGlobalBox(){if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",maxHeight:"200px",overflowY:"auto",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if($.target.classList.contains("search-input"))this.handleSearchInput($.target)}),document.body.addEventListener("click",($)=>{if($.target.classList.contains("suggestion-item"))this.handleSelection($.target)})}handleSearchInput($){this.activeSearchInput=$;let q=window,J=$.dataset.masterSrc,Q=$.dataset.suggestSource;if(!J&&!Q)return;let G=this.toIndex($.dataset.masterLabelIndex),U=this.toIndex($.dataset.masterValueIndex),X=$.value;if(!X){this.hideSuggestions();return}let Z=[],Y=this.normalize(X);if(Q==="column"){let N=$.dataset.baseKey,W=$.closest("table");if(W&&N){let K=new Set;W.querySelectorAll(`[data-base-key="${N}"]`).forEach((E)=>{if(E===$)return;let R=E.value;if(R&&this.normalize(R).includes(Y)){if(!K.has(R))K.add(R),Z.push({val:R,row:[R],label:R,score:10})}})}}else if(J){let N=q.generatedJsonStructure.masterData;if(!N||!N[J])return;N[J].forEach((K,E)=>{if(E===0)return;if(K.some((A)=>this.normalize(A||"").includes(Y))){let A=G>=0?K[G]||"":"",_=U>=0?K[U]||"":"",L=U>=0?_:G>=0?A:K[1]||K[0]||"";Z.push({val:L,row:K,label:A,score:10,idx:E})}})}this.renderSuggestions($,Z,G)}renderSuggestions($,q,J){if(q.length===0){this.hideSuggestions();return}let Q=window,G=q.slice(0,10),U="";G.forEach((W)=>{let K=Q.escapeHtml(JSON.stringify(W.row)),E=J>=0?W.label||W.row.join(" : "):W.row.join(" : ");U+=`<div class="suggestion-item" data-val="${Q.escapeHtml(W.val)}" data-row="${K}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${Q.escapeHtml(E)}</div>`});let X=this.getGlobalBox();X.innerHTML=U;let Z=$.getBoundingClientRect(),Y=window.scrollY||document.documentElement.scrollTop,N=window.scrollX||document.documentElement.scrollLeft;X.style.width=Math.max(Z.width,200)+"px",X.style.left=Z.left+N+"px",X.style.top=Z.bottom+Y+"px",X.querySelectorAll(".suggestion-item").forEach((W)=>{W.onmouseenter=()=>W.style.background="#f0f8ff",W.onmouseleave=()=>W.style.background="white"}),X.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;let q=window,J=this.activeSearchInput,Q=$.dataset.val||"",G=$.dataset.row||"[]";try{let U=JSON.parse(G),X=J.dataset.masterSrc,Z=X?q.generatedJsonStructure.masterData[X][0]:[],Y=!1;if(Z.length>0&&U.length>0){let N=J.closest("tr");if(N){let W=Array.from(N.querySelectorAll("input, select, textarea"));Z.forEach((K,E)=>{if(!K)return;let R=U[E];this.fillField(W,K,R,J,()=>{Y=!0})})}}if(!Y)J.value=Q,J.dispatchEvent(new Event("input",{bubbles:!0}))}catch(U){console.error(U)}this.hideSuggestions()}fillField($,q,J,Q,G){let U=this.normalize(q),X=$.find((Z)=>{let Y=Z.dataset.baseKey||Z.dataset.jsonPath,N=this.normalize(Z.getAttribute("placeholder")||"");return Y&&this.normalize(Y)===U||N===U});if(X){if(X.value=J||"",X.dispatchEvent(new Event("input",{bubbles:!0})),X===Q)G()}}}var R9=BigInt(0),B0=BigInt(1),H9=BigInt(2),L9=BigInt(7),I9=BigInt(256),T9=BigInt(113),LQ=[],IQ=[],TQ=[];for(let $=0,q=B0,J=1,Q=0;$<24;$++){[J,Q]=[Q,(2*J+3*Q)%5],LQ.push(2*(5*Q+J)),IQ.push(($+1)*($+2)/2%64);let G=R9;for(let U=0;U<7;U++)if(q=(q<<B0^(q>>L9)*T9)%I9,q&H9)G^=B0<<(B0<<BigInt(U))-B0;TQ.push(G)}var AQ=k0(TQ,!0),A9=AQ[0],B9=AQ[1],RQ=($,q,J)=>J>32?Fq($,q,J):jq($,q,J),HQ=($,q,J)=>J>32?fq($,q,J):Pq($,q,J);function V9($,q=24){let J=new Uint32Array(10);for(let Q=24-q;Q<24;Q++){for(let X=0;X<10;X++)J[X]=$[X]^$[X+10]^$[X+20]^$[X+30]^$[X+40];for(let X=0;X<10;X+=2){let Z=(X+8)%10,Y=(X+2)%10,N=J[Y],W=J[Y+1],K=RQ(N,W,1)^J[Z],E=HQ(N,W,1)^J[Z+1];for(let R=0;R<50;R+=10)$[X+R]^=K,$[X+R+1]^=E}let G=$[2],U=$[3];for(let X=0;X<24;X++){let Z=IQ[X],Y=RQ(G,U,Z),N=HQ(G,U,Z),W=LQ[X];G=$[W],U=$[W+1],$[W]=Y,$[W+1]=N}for(let X=0;X<50;X+=10){for(let Z=0;Z<10;Z++)J[Z]=$[X+Z];for(let Z=0;Z<10;Z++)$[X+Z]^=~J[(Z+2)%10]&J[(Z+4)%10]}$[0]^=A9[Q],$[1]^=B9[Q]}O8(J)}class Y${state;pos=0;posOut=0;finished=!1;state32;destroyed=!1;blockLen;suffix;outputLen;enableXOF=!1;rounds;constructor($,q,J,Q=!1,G=24){if(this.blockLen=$,this.suffix=q,this.outputLen=J,this.enableXOF=Q,this.rounds=G,z8(J,"outputLen"),!(0<$&&$<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=f0(this.state)}clone(){return this._cloneInto()}keccak(){C$(this.state32),V9(this.state32,this.rounds),C$(this.state32),this.posOut=0,this.pos=0}update($){j8(this),u($);let{blockLen:q,state:J}=this,Q=$.length;for(let G=0;G<Q;){let U=Math.min(q-this.pos,Q-G);for(let X=0;X<U;X++)J[this.pos++]^=$[G++];if(this.pos===q)this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:$,suffix:q,pos:J,blockLen:Q}=this;if($[J]^=q,(q&128)!==0&&J===Q-1)this.keccak();$[Q-1]^=128,this.keccak()}writeInto($){j8(this,!1),u($),this.finish();let q=this.state,{blockLen:J}=this;for(let Q=0,G=$.length;Q<G;){if(this.posOut>=J)this.keccak();let U=Math.min(J-this.posOut,G-Q);$.set(q.subarray(this.posOut,this.posOut+U),Q),this.posOut+=U,Q+=U}return $}xofInto($){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto($)}xof($){return z8($),this.xofInto(new Uint8Array($))}digestInto($){if(F0($,this),this.finished)throw new Error("digest() was already called");return this.writeInto($),this.destroy(),$}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,O8(this.state)}_cloneInto($){let{blockLen:q,suffix:J,outputLen:Q,rounds:G,enableXOF:U}=this;return $||=new Y$(q,J,Q,U,G),$.state32.set(this.state32),$.pos=this.pos,$.posOut=this.posOut,$.finished=this.finished,$.rounds=G,$.suffix=J,$.outputLen=Q,$.enableXOF=U,$.destroyed=this.destroyed,$}}var BQ=($,q,J,Q={})=>$0(()=>new Y$(q,$,J),Q);var VQ=BQ(6,136,32,_8(8));var wQ=BQ(6,72,64,_8(10));var jQ=($,q,J,Q={})=>$0((G={})=>new Y$(q,$,G.dkLen===void 0?J:G.dkLen,!0),Q),PQ=jQ(31,168,16,_8(11)),Z$=jQ(31,136,32,_8(12));function Gq($){if(!Number.isSafeInteger($)||$<0||$>4294967295)throw new Error("wrong u32 integer:"+$);return $}function fQ($){return Gq($),($&$-1)===0&&$!==0}function Uq($,q){Gq($);let J=0;for(let Q=0;Q<q;Q++,$>>>=1)J=J<<1|$&1;return J}function SQ($){return Gq($),31-Math.clz32($)}function FQ($){let q=$.length;if(q<2||!fQ(q))throw new Error("n must be a power of 2 and greater than 1. Got "+q);let J=SQ(q);for(let Q=0;Q<q;Q++){let G=Uq(Q,J);if(Q<G){let U=$[Q];$[Q]=$[G],$[G]=U}}return $}var Xq=($,q)=>{let{N:J,roots:Q,dit:G,invertButterflies:U=!1,skipStages:X=0,brp:Z=!0}=q,Y=SQ(J);if(!fQ(J))throw new Error("FFT: Polynomial size should be power of two");let N=G!==U;return(W)=>{if(W.length!==J)throw new Error("FFT: wrong Polynomial length");if(G&&Z)FQ(W);for(let K=0,E=1;K<Y-X;K++){let R=G?K+1+X:Y-K,A=1<<R,_=A>>1,L=J>>R;for(let j=0;j<J;j+=A)for(let C=0,D=E++;C<_;C++){let F=U?G?J-D:D:C*L,f=j+C,k=j+C+_,y=Q[F],V=W[k],P=W[f];if(N){let S=$.mul(V,y);W[f]=$.add(P,S),W[k]=$.sub(P,S)}else if(U)W[f]=$.add(V,P),W[k]=$.mul($.sub(V,P),y);else W[f]=$.add(P,V),W[k]=$.mul($.sub(P,V),y)}}if(!G&&Z)FQ(W);return W}};/*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) */var Yq=p8;function W$($,q){if($.length!==q.length)return!1;let J=0;for(let Q=0;Q<$.length;Q++)J|=$[Q]^q[Q];return J===0}function xQ($){return Uint8Array.from($)}function V0($,...q){let J=(G)=>typeof G==="number"?G:G.bytesLen,Q=q.reduce((G,U)=>G+J(U),0);return{bytesLen:Q,encode:(G)=>{let U=new Uint8Array(Q);for(let X=0,Z=0;X<q.length;X++){let Y=q[X],N=J(Y),W=typeof Y==="number"?G[X]:Y.encode(G[X]);if(u(W,N,$),U.set(W,Z),typeof Y!=="number")W.fill(0);Z+=N}return U},decode:(G)=>{u(G,Q,$);let U=[];for(let X of q){let Z=J(X),Y=G.subarray(0,Z);U.push(typeof X==="number"?Y:X.decode(Y)),G=G.subarray(Z)}return U}}}function M$($,q){let J=q*$.bytesLen;return{bytesLen:J,encode:(Q)=>{if(Q.length!==q)throw new Error(`vecCoder.encode: wrong length=${Q.length}. Expected: ${q}`);let G=new Uint8Array(J);for(let U=0,X=0;U<Q.length;U++){let Z=$.encode(Q[U]);G.set(Z,X),Z.fill(0),X+=Z.length}return G},decode:(Q)=>{u(Q,J);let G=[];for(let U=0;U<Q.length;U+=$.bytesLen)G.push($.decode(Q.subarray(U,U+$.bytesLen)));return G}}}function H8(...$){for(let q of $)if(Array.isArray(q))for(let J of q)J.fill(0);else q.fill(0)}function Zq($){return(1<<$)-1}var SU=Uint8Array.of();/*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) */var _Q=($)=>{let{newPoly:q,N:J,Q,F:G,ROOT_OF_UNITY:U,brvBits:X,isKyber:Z}=$,Y=(C,D=Q)=>{let F=C%D|0;return(F>=0?F|0:D+F|0)|0},N=(C,D=Q)=>{let F=Y(C,D)|0;return(F>D>>1?F-D|0:F)|0};function W(){let C=q(J);for(let D=0;D<J;D++){let F=Uq(D,X),f=BigInt(U)**BigInt(F)%BigInt(Q);C[D]=Number(f)|0}return C}let K=W(),E={add:(C,D)=>Y((C|0)+(D|0))|0,sub:(C,D)=>Y((C|0)-(D|0))|0,mul:(C,D)=>Y((C|0)*(D|0))|0,inv:(C)=>{throw new Error("not implemented")}},R={N:J,roots:K,invertButterflies:!0,skipStages:Z?1:0,brp:!1},A=Xq(E,{dit:!1,...R}),_=Xq(E,{dit:!0,...R});return{mod:Y,smod:N,nttZetas:K,NTT:{encode:(C)=>{return A(C)},decode:(C)=>{_(C);for(let D=0;D<C.length;D++)C[D]=Y(G*C[D]);return C}},bitsCoder:(C,D)=>{let F=Zq(C),f=C*(J/8);return{bytesLen:f,encode:(k)=>{let y=new Uint8Array(f);for(let V=0,P=0,S=0,g=0;V<k.length;V++){P|=(D.encode(k[V])&F)<<S,S+=C;for(;S>=8;S-=8,P>>=8)y[g++]=P&Zq(S)}return y},decode:(k)=>{let y=q(J);for(let V=0,P=0,S=0,g=0;V<k.length;V++){P|=k[V]<<S,S+=8;for(;S>=C;S-=C,P>>=C)y[g++]=D.decode(P&F)}return y}}}}},w9=($)=>(q,J)=>{if(!J)J=$.blockLen;let Q=new Uint8Array(q.length+2);Q.set(q);let G=q.length,U=new Uint8Array(J),X=$.create({}),Z=0,Y=0;return{stats:()=>({calls:Z,xofs:Y}),get:(N,W)=>{return Q[G+0]=N,Q[G+1]=W,X.destroy(),X=$.create({}).update(Q),Z++,()=>{return Y++,X.xofInto(U)}},clean:()=>{X.destroy(),H8(U,Q)}}},kQ=w9(PQ);/*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) */var X8=256,x8=3329,j9=3303,P9=17,{mod:P0,nttZetas:F9,NTT:a8,bitsCoder:f9}=_Q({N:X8,Q:x8,F:j9,ROOT_OF_UNITY:P9,newPoly:($)=>new Uint16Array($),brvBits:7,isKyber:!0}),Wq={512:{N:X8,Q:x8,K:2,ETA1:3,ETA2:2,du:10,dv:4,RBGstrength:128},768:{N:X8,Q:x8,K:3,ETA1:2,ETA2:2,du:10,dv:4,RBGstrength:192},1024:{N:X8,Q:x8,K:4,ETA1:2,ETA2:2,du:11,dv:5,RBGstrength:256}},S9=($)=>{if($>=12)return{encode:(J)=>J,decode:(J)=>J};let q=2**($-1);return{encode:(J)=>((J<<$)+x8/2)/x8,decode:(J)=>J*x8+q>>>$}},w0=($)=>f9($,S9($));function s8($,q){for(let J=0;J<X8;J++)$[J]=P0($[J]+q[J])}function x9($,q){for(let J=0;J<X8;J++)$[J]=P0($[J]-q[J])}function _9($,q,J,Q,G){let U=P0(q*Q*G+$*J),X=P0($*Q+q*J);return{c0:U,c1:X}}function N$($,q){for(let J=0;J<X8/2;J++){let Q=F9[64+(J>>1)];if(J&1)Q=-Q;let{c0:G,c1:U}=_9($[2*J+0],$[2*J+1],q[2*J+0],q[2*J+1],Q);$[2*J+0]=G,$[2*J+1]=U}return $}function vQ($){let q=new Uint16Array(X8);for(let J=0;J<X8;){let Q=$();if(Q.length%3)throw new Error("SampleNTT: unaligned block");for(let G=0;J<X8&&G+3<=Q.length;G+=3){let U=(Q[G+0]>>0|Q[G+1]<<8)&4095,X=(Q[G+1]>>4|Q[G+2]<<4)&4095;if(U<x8)q[J++]=U;if(J<X8&&X<x8)q[J++]=X}}return q}function j0($,q,J,Q){let G=$(Q*X8/4,q,J),U=new Uint16Array(X8),X=f0(G),Z=0;for(let Y=0,N=0,W=0,K=0;Y<X.length;Y++){let E=X[Y];for(let R=0;R<32;R++)if(W+=E&1,E>>=1,Z+=1,Z===Q)K=W,W=0;else if(Z===2*Q)U[N++]=P0(K-W),W=0,Z=0}if(Z)throw new Error(`sampleCBD: leftover bits: ${Z}`);return U}var k9=($)=>{let{K:q,PRF:J,XOF:Q,HASH512:G,ETA1:U,ETA2:X,du:Z,dv:Y}=$,N=w0(1),W=w0(Y),K=w0(Z),E=V0("publicKey",M$(w0(12),q),32),R=M$(w0(12),q),A=V0("ciphertext",M$(K,q),W),_=V0("seed",32,32);return{secretCoder:R,lengths:{secretKey:R.bytesLen,publicKey:E.bytesLen,cipherText:A.bytesLen},keygen:(L)=>{u(L,32,"seed");let j=new Uint8Array(33);j.set(L),j[32]=q;let C=G(j),[D,F]=_.decode(C),f=[],k=[];for(let P=0;P<q;P++)f.push(a8.encode(j0(J,F,P,U)));let y=Q(D);for(let P=0;P<q;P++){let S=a8.encode(j0(J,F,q+P,U));for(let g=0;g<q;g++){let p=vQ(y.get(g,P));s8(S,N$(p,f[g]))}k.push(S)}y.clean();let V={publicKey:E.encode([k,D]),secretKey:R.encode(f)};return H8(D,F,f,k,j,C),V},encrypt:(L,j,C)=>{let[D,F]=E.decode(L),f=[];for(let g=0;g<q;g++)f.push(a8.encode(j0(J,C,g,U)));let k=Q(F),y=new Uint16Array(X8),V=[];for(let g=0;g<q;g++){let p=j0(J,C,q+g,X),O=new Uint16Array(X8);for(let T=0;T<q;T++){let H=vQ(k.get(g,T));s8(O,N$(H,f[T]))}s8(p,a8.decode(O)),V.push(p),s8(y,N$(D[g],f[g])),H8(O)}k.clean();let P=j0(J,C,2*q,X);s8(P,a8.decode(y));let S=N.decode(j);return s8(S,P),H8(D,f,y,P),A.encode([V,S])},decrypt:(L,j)=>{let[C,D]=A.decode(L),F=R.decode(j),f=new Uint16Array(X8);for(let k=0;k<q;k++)s8(f,N$(F[k],a8.encode(C[k])));return x9(D,a8.decode(f)),H8(f,F,C),N.encode(D)}}};function Mq($){let q=k9($),{HASH256:J,HASH512:Q,KDF:G}=$,{secretCoder:U,lengths:X}=q,Z=V0("secretKey",X.secretKey,X.publicKey,32,32),Y=32,N=64;return{info:{type:"ml-kem"},lengths:{...X,seed:64,msg:32,msgRand:32,secretKey:Z.bytesLen},keygen:(W=Yq(64))=>{u(W,64,"seed");let{publicKey:K,secretKey:E}=q.keygen(W.subarray(0,32)),R=J(K),A=Z.encode([E,K,R,W.subarray(32)]);return H8(E,R),{publicKey:K,secretKey:A}},getPublicKey:(W)=>{let[K,E,R,A]=Z.decode(W);return Uint8Array.from(E)},encapsulate:(W,K=Yq(32))=>{u(W,X.publicKey,"publicKey"),u(K,32,"message");let E=W.subarray(0,384*$.K),R=U.encode(U.decode(xQ(E)));if(!W$(R,E))throw H8(R),new Error("ML-KEM.encapsulate: wrong publicKey modulus");H8(R);let A=Q.create().update(K).update(J(W)).digest(),_=q.encrypt(W,K,A.subarray(32,64));return H8(A.subarray(32)),{cipherText:_,sharedSecret:A.subarray(0,32)}},decapsulate:(W,K)=>{u(K,Z.bytesLen,"secretKey"),u(W,X.cipherText,"cipherText");let E=Z.bytesLen-96,R=E+32,A=J(K.subarray(E/2,R));if(!W$(A,K.subarray(R,R+32)))throw new Error("invalid secretKey: hash check failed");let[_,L,j,C]=Z.decode(K),D=q.decrypt(W,_),F=Q.create().update(D).update(j).digest(),f=F.subarray(0,32),k=q.encrypt(L,D,F.subarray(32,64)),y=W$(W,k),V=G.create({dkLen:32}).update(C).update(W).digest();return H8(D,k,!y?f:V),y?f:V}}}function v9($,q,J){return Z$.create({dkLen:$}).update(q).update(new Uint8Array([J])).digest()}var Nq={HASH256:VQ,HASH512:wQ,KDF:Z$,XOF:kQ,PRF:v9},uU=Mq({...Nq,...Wq[512]}),Oq=Mq({...Nq,...Wq[768]}),cU=Mq({...Nq,...Wq[1024]});function yQ(){return{kemId:"ML-KEM-768",encapsulate:($)=>{let{cipherText:q,sharedSecret:J}=Oq.encapsulate($);return{sharedSecret:J,encapsulation:q}},decapsulate:($,q)=>{return Oq.decapsulate(q,$)}}}function gQ($){globalThis.webaPqcKem=$}gQ(yQ());var mQ=new Qq;window.GlobalSearch=mQ;CQ();mQ.init();
