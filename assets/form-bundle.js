var xQ=Object.create;var{getPrototypeOf:SQ,defineProperty:Eq,getOwnPropertyNames:_Q}=Object;var kQ=Object.prototype.hasOwnProperty;var Dq=($,q,J)=>{J=$!=null?xQ(SQ($)):{};let Q=q||!$||!$.__esModule?Eq(J,"default",{value:$,enumerable:!0}):J;for(let G of _Q($))if(!kQ.call(Q,G))Eq(Q,G,{get:()=>$[G],enumerable:!0});return Q};var yQ=($,q)=>()=>(q||$((q={exports:{}}).exports,q),q.exports);var j$=yQ((JG,OJ)=>{OJ.exports=function $(q){if(typeof q==="number"&&isNaN(q))throw new Error("NaN is not allowed");if(typeof q==="number"&&!isFinite(q))throw new Error("Infinity is not allowed");if(q===null||typeof q!=="object")return JSON.stringify(q);if(q.toJSON instanceof Function)return $(q.toJSON());if(Array.isArray(q))return`[${q.reduce((G,X,U)=>{return`${G}${U===0?"":","}${$(X===void 0||typeof X==="symbol"?null:X)}`},"")}]`;return`{${Object.keys(q).sort().reduce((Q,G)=>{if(q[G]===void 0||typeof q[G]==="symbol")return Q;let X=Q.length===0?"":",";return`${Q}${X}${$(G)}:${$(q[G])}`},"")}}`}});class O${runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let q=$.dataset.copyFrom;if(q){let G=($.closest("tr")||document).querySelector(`[data-base-key="${q}"], [data-json-path="${q}"]`);if(G&&G.value!==$.value)$.value=G.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let q=$.dataset.formula;if(!q)return;let J=$.closest("tr"),Q=$.closest("table"),G=(U)=>{let Z=0,Y="none";if(J){let K=`[data-base-key="${U}"], [data-json-path="${U}"]`,W=J.querySelector(K);if(W){if(Y="row-input",W.value!=="")Z=parseFloat(W.value)}}if(Y==="none"){let K=document.querySelector(`[data-json-path="${U}"]`);if(K){if(Y="static-input",K.value!=="")Z=parseFloat(K.value)}}return Z},X=q.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(U,Z)=>{let Y=0,K=Q||document,W=K.querySelectorAll(`[data-base-key="${Z}"], [data-json-path="${Z}"]`);if(W.length===0&&K!==document)W=document.querySelectorAll(`[data-base-key="${Z}"], [data-json-path="${Z}"]`);return W.forEach((O)=>{let E=parseFloat(O.value);if(!isNaN(E))Y+=E}),Y});X=X.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(U)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(U))return U;return String(G(U))});try{let U=new Function("return "+X)();if(typeof U==="number"&&!isNaN(U))$.value=Number.isInteger(U)?U:U.toFixed(0);else $.value=""}catch(U){console.error("Calc Error:",U),$.value="Err"}}),this.runAutoCopy()}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Y0($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function z8($,q=""){if(!Number.isSafeInteger($)||$<0){let J=q&&`"${q}" `;throw new Error(`${J}expected integer >= 0, got ${$}`)}}function c($,q,J=""){let Q=Y0($),G=$?.length,X=q!==void 0;if(!Q||X&&G!==q){let U=J&&`"${J}" `,Z=X?` of length ${q}`:"",Y=Q?`length=${G}`:`type=${typeof $}`;throw new Error(U+"expected Uint8Array"+Z+", got "+Y)}return $}function Z0($){if(typeof $!=="function"||typeof $.create!=="function")throw new Error("Hash must wrapped by utils.createHasher");z8($.outputLen),z8($.blockLen)}function j8($,q=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(q&&$.finished)throw new Error("Hash#digest() has already been called")}function B0($,q){c($,void 0,"digestInto() output");let J=q.outputLen;if($.length<J)throw new Error('"digestInto() output" expected to be of length >='+J)}function j0($){return new Uint32Array($.buffer,$.byteOffset,Math.floor($.byteLength/4))}function M8(...$){for(let q=0;q<$.length;q++)$[q].fill(0)}function P0($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function L8($,q){return $<<32-q|$>>>q}var vQ=(()=>new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68)();function mQ($){return $<<24&4278190080|$<<8&16711680|$>>>8&65280|$>>>24&255}function gQ($){for(let q=0;q<$.length;q++)$[q]=mQ($[q]);return $}var z$=vQ?($)=>$:gQ,Rq=(()=>typeof Uint8Array.from([]).toHex==="function"&&typeof Uint8Array.fromHex==="function")(),bQ=Array.from({length:256},($,q)=>q.toString(16).padStart(2,"0"));function s8($){if(c($),Rq)return $.toHex();let q="";for(let J=0;J<$.length;J++)q+=bQ[$[J]];return q}var B8={_0:48,_9:57,A:65,F:70,a:97,f:102};function Cq($){if($>=B8._0&&$<=B8._9)return $-B8._0;if($>=B8.A&&$<=B8.F)return $-(B8.A-10);if($>=B8.a&&$<=B8.f)return $-(B8.a-10);return}function W0($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);if(Rq)return Uint8Array.fromHex($);let q=$.length,J=q/2;if(q%2)throw new Error("hex string expected, got unpadded hex of length "+q);let Q=new Uint8Array(J);for(let G=0,X=0;G<J;G++,X+=2){let U=Cq($.charCodeAt(X)),Z=Cq($.charCodeAt(X+1));if(U===void 0||Z===void 0){let Y=$[X]+$[X+1];throw new Error('hex string expected, got non-hex character "'+Y+'" at index '+X)}Q[G]=U*16+Z}return Q}function t8(...$){let q=0;for(let Q=0;Q<$.length;Q++){let G=$[Q];c(G),q+=G.length}let J=new Uint8Array(q);for(let Q=0,G=0;Q<$.length;Q++){let X=$[Q];J.set(X,G),G+=X.length}return J}function e8($,q={}){let J=(G,X)=>$(X).update(G).digest(),Q=$(void 0);return J.outputLen=Q.outputLen,J.blockLen=Q.blockLen,J.create=(G)=>$(G),Object.assign(J,q),Object.freeze(J)}function p8($=32){let q=typeof globalThis==="object"?globalThis.crypto:null;if(typeof q?.getRandomValues!=="function")throw new Error("crypto.getRandomValues must be defined");return q.getRandomValues(new Uint8Array($))}var _8=($)=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,$])});function Hq($,q,J){return $&q^~$&J}function Lq($,q,J){return $&q^$&J^q&J}class f0{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor($,q,J,Q){this.blockLen=$,this.outputLen=q,this.padOffset=J,this.isLE=Q,this.buffer=new Uint8Array($),this.view=P0(this.buffer)}update($){j8(this),c($);let{view:q,buffer:J,blockLen:Q}=this,G=$.length;for(let X=0;X<G;){let U=Math.min(Q-this.pos,G-X);if(U===Q){let Z=P0($);for(;Q<=G-X;X+=Q)this.process(Z,X);continue}if(J.set($.subarray(X,X+U),this.pos),this.pos+=U,X+=U,this.pos===Q)this.process(q,0),this.pos=0}return this.length+=$.length,this.roundClean(),this}digestInto($){j8(this),B0($,this),this.finished=!0;let{buffer:q,view:J,blockLen:Q,isLE:G}=this,{pos:X}=this;if(q[X++]=128,M8(this.buffer.subarray(X)),this.padOffset>Q-X)this.process(J,0),X=0;for(let W=X;W<Q;W++)q[W]=0;J.setBigUint64(Q-8,BigInt(this.length*8),G),this.process(J,0);let U=P0($),Z=this.outputLen;if(Z%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let Y=Z/4,K=this.get();if(Y>K.length)throw new Error("_sha2: outputLen bigger than state");for(let W=0;W<Y;W++)U.setUint32(4*W,K[W],G)}digest(){let{buffer:$,outputLen:q}=this;this.digestInto($);let J=$.slice(0,q);return this.destroy(),J}_cloneInto($){$||=new this.constructor,$.set(...this.get());let{blockLen:q,buffer:J,length:Q,finished:G,destroyed:X,pos:U}=this;if($.destroyed=X,$.finished=G,$.length=Q,$.pos=U,Q%q)$.buffer.set(J);return $}clone(){return this._cloneInto()}}var P8=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),f8=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),$8=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),q8=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var F0=BigInt(4294967295),Iq=BigInt(32);function hQ($,q=!1){if(q)return{h:Number($&F0),l:Number($>>Iq&F0)};return{h:Number($>>Iq&F0)|0,l:Number($&F0)|0}}function x0($,q=!1){let J=$.length,Q=new Uint32Array(J),G=new Uint32Array(J);for(let X=0;X<J;X++){let{h:U,l:Z}=hQ($[X],q);[Q[X],G[X]]=[U,Z]}return[Q,G]}var E$=($,q,J)=>$>>>J,D$=($,q,J)=>$<<32-J|q>>>J,c8=($,q,J)=>$>>>J|q<<32-J,u8=($,q,J)=>$<<32-J|q>>>J,M0=($,q,J)=>$<<64-J|q>>>J-32,N0=($,q,J)=>$>>>J-32|q<<64-J;var Tq=($,q,J)=>$<<J|q>>>32-J,wq=($,q,J)=>q<<J|$>>>32-J,Aq=($,q,J)=>q<<J-32|$>>>64-J,Vq=($,q,J)=>$<<J-32|q>>>64-J;function I8($,q,J,Q){let G=(q>>>0)+(Q>>>0);return{h:$+J+(G/4294967296|0)|0,l:G|0}}var Bq=($,q,J)=>($>>>0)+(q>>>0)+(J>>>0),jq=($,q,J,Q)=>q+J+Q+($/4294967296|0)|0,Pq=($,q,J,Q)=>($>>>0)+(q>>>0)+(J>>>0)+(Q>>>0),fq=($,q,J,Q,G)=>q+J+Q+G+($/4294967296|0)|0,Fq=($,q,J,Q,G)=>($>>>0)+(q>>>0)+(J>>>0)+(Q>>>0)+(G>>>0),xq=($,q,J,Q,G,X)=>q+J+Q+G+X+($/4294967296|0)|0;var cQ=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),k8=new Uint32Array(64);class C$ extends f0{constructor($){super(64,$,8,!1)}get(){let{A:$,B:q,C:J,D:Q,E:G,F:X,G:U,H:Z}=this;return[$,q,J,Q,G,X,U,Z]}set($,q,J,Q,G,X,U,Z){this.A=$|0,this.B=q|0,this.C=J|0,this.D=Q|0,this.E=G|0,this.F=X|0,this.G=U|0,this.H=Z|0}process($,q){for(let W=0;W<16;W++,q+=4)k8[W]=$.getUint32(q,!1);for(let W=16;W<64;W++){let O=k8[W-15],E=k8[W-2],H=L8(O,7)^L8(O,18)^O>>>3,w=L8(E,17)^L8(E,19)^E>>>10;k8[W]=w+k8[W-7]+H+k8[W-16]|0}let{A:J,B:Q,C:G,D:X,E:U,F:Z,G:Y,H:K}=this;for(let W=0;W<64;W++){let O=L8(U,6)^L8(U,11)^L8(U,25),E=K+O+Hq(U,Z,Y)+cQ[W]+k8[W]|0,w=(L8(J,2)^L8(J,13)^L8(J,22))+Lq(J,Q,G)|0;K=Y,Y=Z,Z=U,U=X+E|0,X=G,G=Q,Q=J,J=E+w|0}J=J+this.A|0,Q=Q+this.B|0,G=G+this.C|0,X=X+this.D|0,U=U+this.E|0,Z=Z+this.F|0,Y=Y+this.G|0,K=K+this.H|0,this.set(J,Q,G,X,U,Z,Y,K)}roundClean(){M8(k8)}destroy(){this.set(0,0,0,0,0,0,0,0),M8(this.buffer)}}class Sq extends C${A=P8[0]|0;B=P8[1]|0;C=P8[2]|0;D=P8[3]|0;E=P8[4]|0;F=P8[5]|0;G=P8[6]|0;H=P8[7]|0;constructor(){super(32)}}class uQ extends C${A=f8[0]|0;B=f8[1]|0;C=f8[2]|0;D=f8[3]|0;E=f8[4]|0;F=f8[5]|0;G=f8[6]|0;H=f8[7]|0;constructor(){super(28)}}var _q=(()=>x0(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(($)=>BigInt($))))(),dQ=(()=>_q[0])(),lQ=(()=>_q[1])(),y8=new Uint32Array(80),v8=new Uint32Array(80);class K0 extends f0{constructor($){super(128,$,16,!1)}get(){let{Ah:$,Al:q,Bh:J,Bl:Q,Ch:G,Cl:X,Dh:U,Dl:Z,Eh:Y,El:K,Fh:W,Fl:O,Gh:E,Gl:H,Hh:w,Hl:k}=this;return[$,q,J,Q,G,X,U,Z,Y,K,W,O,E,H,w,k]}set($,q,J,Q,G,X,U,Z,Y,K,W,O,E,H,w,k){this.Ah=$|0,this.Al=q|0,this.Bh=J|0,this.Bl=Q|0,this.Ch=G|0,this.Cl=X|0,this.Dh=U|0,this.Dl=Z|0,this.Eh=Y|0,this.El=K|0,this.Fh=W|0,this.Fl=O|0,this.Gh=E|0,this.Gl=H|0,this.Hh=w|0,this.Hl=k|0}process($,q){for(let R=0;R<16;R++,q+=4)y8[R]=$.getUint32(q),v8[R]=$.getUint32(q+=4);for(let R=16;R<80;R++){let C=y8[R-15]|0,f=v8[R-15]|0,F=c8(C,f,1)^c8(C,f,8)^E$(C,f,7),_=u8(C,f,1)^u8(C,f,8)^D$(C,f,7),y=y8[R-2]|0,V=v8[R-2]|0,j=c8(y,V,19)^M0(y,V,61)^E$(y,V,6),x=u8(y,V,19)^N0(y,V,61)^D$(y,V,6),g=Pq(_,x,v8[R-7],v8[R-16]),b=fq(g,F,j,y8[R-7],y8[R-16]);y8[R]=b|0,v8[R]=g|0}let{Ah:J,Al:Q,Bh:G,Bl:X,Ch:U,Cl:Z,Dh:Y,Dl:K,Eh:W,El:O,Fh:E,Fl:H,Gh:w,Gl:k,Hh:I,Hl:P}=this;for(let R=0;R<80;R++){let C=c8(W,O,14)^c8(W,O,18)^M0(W,O,41),f=u8(W,O,14)^u8(W,O,18)^N0(W,O,41),F=W&E^~W&w,_=O&H^~O&k,y=Fq(P,f,_,lQ[R],v8[R]),V=xq(y,I,C,F,dQ[R],y8[R]),j=y|0,x=c8(J,Q,28)^M0(J,Q,34)^M0(J,Q,39),g=u8(J,Q,28)^N0(J,Q,34)^N0(J,Q,39),b=J&G^J&U^G&U,N=Q&X^Q&Z^X&Z;I=w|0,P=k|0,w=E|0,k=H|0,E=W|0,H=O|0,{h:W,l:O}=I8(Y|0,K|0,V|0,j|0),Y=U|0,K=Z|0,U=G|0,Z=X|0,G=J|0,X=Q|0;let T=Bq(j,g,N);J=jq(T,V,x,b),Q=T|0}({h:J,l:Q}=I8(this.Ah|0,this.Al|0,J|0,Q|0)),{h:G,l:X}=I8(this.Bh|0,this.Bl|0,G|0,X|0),{h:U,l:Z}=I8(this.Ch|0,this.Cl|0,U|0,Z|0),{h:Y,l:K}=I8(this.Dh|0,this.Dl|0,Y|0,K|0),{h:W,l:O}=I8(this.Eh|0,this.El|0,W|0,O|0),{h:E,l:H}=I8(this.Fh|0,this.Fl|0,E|0,H|0),{h:w,l:k}=I8(this.Gh|0,this.Gl|0,w|0,k|0),{h:I,l:P}=I8(this.Hh|0,this.Hl|0,I|0,P|0),this.set(J,Q,G,X,U,Z,Y,K,W,O,E,H,w,k,I,P)}roundClean(){M8(y8,v8)}destroy(){M8(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class kq extends K0{Ah=q8[0]|0;Al=q8[1]|0;Bh=q8[2]|0;Bl=q8[3]|0;Ch=q8[4]|0;Cl=q8[5]|0;Dh=q8[6]|0;Dl=q8[7]|0;Eh=q8[8]|0;El=q8[9]|0;Fh=q8[10]|0;Fl=q8[11]|0;Gh=q8[12]|0;Gl=q8[13]|0;Hh=q8[14]|0;Hl=q8[15]|0;constructor(){super(64)}}class nQ extends K0{Ah=$8[0]|0;Al=$8[1]|0;Bh=$8[2]|0;Bl=$8[3]|0;Ch=$8[4]|0;Cl=$8[5]|0;Dh=$8[6]|0;Dl=$8[7]|0;Eh=$8[8]|0;El=$8[9]|0;Fh=$8[10]|0;Fl=$8[11]|0;Gh=$8[12]|0;Gl=$8[13]|0;Hh=$8[14]|0;Hl=$8[15]|0;constructor(){super(48)}}var Q8=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),G8=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class iQ extends K0{Ah=Q8[0]|0;Al=Q8[1]|0;Bh=Q8[2]|0;Bl=Q8[3]|0;Ch=Q8[4]|0;Cl=Q8[5]|0;Dh=Q8[6]|0;Dl=Q8[7]|0;Eh=Q8[8]|0;El=Q8[9]|0;Fh=Q8[10]|0;Fl=Q8[11]|0;Gh=Q8[12]|0;Gl=Q8[13]|0;Hh=Q8[14]|0;Hl=Q8[15]|0;constructor(){super(28)}}class rQ extends K0{Ah=G8[0]|0;Al=G8[1]|0;Bh=G8[2]|0;Bl=G8[3]|0;Ch=G8[4]|0;Cl=G8[5]|0;Dh=G8[6]|0;Dl=G8[7]|0;Eh=G8[8]|0;El=G8[9]|0;Fh=G8[10]|0;Fl=G8[11]|0;Gh=G8[12]|0;Gl=G8[13]|0;Hh=G8[14]|0;Hl=G8[15]|0;constructor(){super(32)}}var N8=e8(()=>new Sq,_8(1));var yq=e8(()=>new kq,_8(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var mq=BigInt(0),vq=BigInt(1);function _0($,q=""){if(typeof $!=="boolean"){let J=q&&`"${q}" `;throw new Error(J+"expected boolean, got type="+typeof $)}return $}function oQ($){if(typeof $==="bigint"){if(!S0($))throw new Error("positive bigint expected, got "+$)}else z8($);return $}function gq($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);return $===""?mq:BigInt("0x"+$)}function bq($){return gq(s8($))}function F8($){return gq(s8(d8(c($)).reverse()))}function R$($,q){z8(q),$=oQ($);let J=W0($.toString(16).padStart(q*2,"0"));if(J.length!==q)throw new Error("number too large");return J}function k0($,q){return R$($,q).reverse()}function d8($){return Uint8Array.from($)}var S0=($)=>typeof $==="bigint"&&mq<=$;function aQ($,q,J){return S0($)&&S0(q)&&S0(J)&&q<=$&&$<J}function $0($,q,J,Q){if(!aQ(q,J,Q))throw new Error("expected valid "+$+": "+J+" <= n < "+Q+", got "+q)}var hq=($)=>(vq<<BigInt($))-vq;function l8($,q={},J={}){if(!$||typeof $!=="object")throw new Error("expected valid options object");function Q(X,U,Z){let Y=$[X];if(Z&&Y===void 0)return;let K=typeof Y;if(K!==U||Y===null)throw new Error(`param "${X}" is invalid: expected ${U}, got ${K}`)}let G=(X,U)=>Object.entries(X).forEach(([Z,Y])=>Q(Z,Y,U));G(q,!1),G(J,!0)}function H$($){let q=new WeakMap;return(J,...Q)=>{let G=q.get(J);if(G!==void 0)return G;let X=$(J,...Q);return q.set(J,X),X}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Y8=BigInt(0),X8=BigInt(1),n8=BigInt(2),uq=BigInt(3),dq=BigInt(4),lq=BigInt(5),sQ=BigInt(7),nq=BigInt(8),tQ=BigInt(9),iq=BigInt(16);function i($,q){let J=$%q;return J>=Y8?J:q+J}function D8($,q,J){let Q=$;while(q-- >Y8)Q*=Q,Q%=J;return Q}function pq($,q){if($===Y8)throw new Error("invert: expected non-zero number");if(q<=Y8)throw new Error("invert: expected positive modulus, got "+q);let J=i($,q),Q=q,G=Y8,X=X8,U=X8,Z=Y8;while(J!==Y8){let K=Q/J,W=Q%J,O=G-U*K,E=X-Z*K;Q=J,J=W,G=U,X=Z,U=O,Z=E}if(Q!==X8)throw new Error("invert: does not exist");return i(G,q)}function L$($,q,J){if(!$.eql($.sqr(q),J))throw new Error("Cannot find square root")}function rq($,q){let J=($.ORDER+X8)/dq,Q=$.pow(q,J);return L$($,Q,q),Q}function eQ($,q){let J=($.ORDER-lq)/nq,Q=$.mul(q,n8),G=$.pow(Q,J),X=$.mul(q,G),U=$.mul($.mul(X,n8),G),Z=$.mul(X,$.sub(U,$.ONE));return L$($,Z,q),Z}function $1($){let q=v0($),J=oq($),Q=J(q,q.neg(q.ONE)),G=J(q,Q),X=J(q,q.neg(Q)),U=($+sQ)/iq;return(Z,Y)=>{let K=Z.pow(Y,U),W=Z.mul(K,Q),O=Z.mul(K,G),E=Z.mul(K,X),H=Z.eql(Z.sqr(W),Y),w=Z.eql(Z.sqr(O),Y);K=Z.cmov(K,W,H),W=Z.cmov(E,O,w);let k=Z.eql(Z.sqr(W),Y),I=Z.cmov(K,W,k);return L$(Z,I,Y),I}}function oq($){if($<uq)throw new Error("sqrt is not defined for small field");let q=$-X8,J=0;while(q%n8===Y8)q/=n8,J++;let Q=n8,G=v0($);while(cq(G,Q)===1)if(Q++>1000)throw new Error("Cannot find square root: probably non-prime P");if(J===1)return rq;let X=G.pow(Q,q),U=(q+X8)/n8;return function Z(Y,K){if(Y.is0(K))return K;if(cq(Y,K)!==1)throw new Error("Cannot find square root");let W=J,O=Y.mul(Y.ONE,X),E=Y.pow(K,q),H=Y.pow(K,U);while(!Y.eql(E,Y.ONE)){if(Y.is0(E))return Y.ZERO;let w=1,k=Y.sqr(E);while(!Y.eql(k,Y.ONE))if(w++,k=Y.sqr(k),w===W)throw new Error("Cannot find square root");let I=X8<<BigInt(W-w-1),P=Y.pow(O,I);W=w,O=Y.sqr(P),E=Y.mul(E,O),H=Y.mul(H,P)}return H}}function q1($){if($%dq===uq)return rq;if($%nq===lq)return eQ;if($%iq===tQ)return $1($);return oq($)}var aq=($,q)=>(i($,q)&X8)===X8,J1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sq($){let q={ORDER:"bigint",BYTES:"number",BITS:"number"},J=J1.reduce((Q,G)=>{return Q[G]="function",Q},q);return l8($,J),$}function Q1($,q,J){if(J<Y8)throw new Error("invalid exponent, negatives unsupported");if(J===Y8)return $.ONE;if(J===X8)return q;let Q=$.ONE,G=q;while(J>Y8){if(J&X8)Q=$.mul(Q,G);G=$.sqr(G),J>>=X8}return Q}function y0($,q,J=!1){let Q=new Array(q.length).fill(J?$.ZERO:void 0),G=q.reduce((U,Z,Y)=>{if($.is0(Z))return U;return Q[Y]=U,$.mul(U,Z)},$.ONE),X=$.inv(G);return q.reduceRight((U,Z,Y)=>{if($.is0(Z))return U;return Q[Y]=$.mul(U,Q[Y]),$.mul(U,Z)},X),Q}function cq($,q){let J=($.ORDER-X8)/n8,Q=$.pow(q,J),G=$.eql(Q,$.ONE),X=$.eql(Q,$.ZERO),U=$.eql(Q,$.neg($.ONE));if(!G&&!X&&!U)throw new Error("invalid Legendre symbol result");return G?1:X?0:-1}function G1($,q){if(q!==void 0)z8(q);let J=q!==void 0?q:$.toString(2).length,Q=Math.ceil(J/8);return{nBitLength:J,nByteLength:Q}}class tq{ORDER;BITS;BYTES;isLE;ZERO=Y8;ONE=X8;_lengths;_sqrt;_mod;constructor($,q={}){if($<=Y8)throw new Error("invalid field: expected ORDER > 0, got "+$);let J=void 0;if(this.isLE=!1,q!=null&&typeof q==="object"){if(typeof q.BITS==="number")J=q.BITS;if(typeof q.sqrt==="function")this.sqrt=q.sqrt;if(typeof q.isLE==="boolean")this.isLE=q.isLE;if(q.allowedLengths)this._lengths=q.allowedLengths?.slice();if(typeof q.modFromBytes==="boolean")this._mod=q.modFromBytes}let{nBitLength:Q,nByteLength:G}=G1($,J);if(G>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=$,this.BITS=Q,this.BYTES=G,this._sqrt=void 0,Object.preventExtensions(this)}create($){return i($,this.ORDER)}isValid($){if(typeof $!=="bigint")throw new Error("invalid field element: expected bigint, got "+typeof $);return Y8<=$&&$<this.ORDER}is0($){return $===Y8}isValidNot0($){return!this.is0($)&&this.isValid($)}isOdd($){return($&X8)===X8}neg($){return i(-$,this.ORDER)}eql($,q){return $===q}sqr($){return i($*$,this.ORDER)}add($,q){return i($+q,this.ORDER)}sub($,q){return i($-q,this.ORDER)}mul($,q){return i($*q,this.ORDER)}pow($,q){return Q1(this,$,q)}div($,q){return i($*pq(q,this.ORDER),this.ORDER)}sqrN($){return $*$}addN($,q){return $+q}subN($,q){return $-q}mulN($,q){return $*q}inv($){return pq($,this.ORDER)}sqrt($){if(!this._sqrt)this._sqrt=q1(this.ORDER);return this._sqrt(this,$)}toBytes($){return this.isLE?k0($,this.BYTES):R$($,this.BYTES)}fromBytes($,q=!1){c($);let{_lengths:J,BYTES:Q,isLE:G,ORDER:X,_mod:U}=this;if(J){if(!J.includes($.length)||$.length>Q)throw new Error("Field.fromBytes: expected "+J+" bytes, got "+$.length);let Y=new Uint8Array(Q);Y.set($,G?0:Y.length-$.length),$=Y}if($.length!==Q)throw new Error("Field.fromBytes: expected "+Q+" bytes, got "+$.length);let Z=G?F8($):bq($);if(U)Z=i(Z,X);if(!q){if(!this.isValid(Z))throw new Error("invalid field element: outside of range 0..ORDER")}return Z}invertBatch($){return y0(this,$)}cmov($,q,J){return J?q:$}}function v0($,q={}){return new tq($,q)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var m0=BigInt(0),A$=BigInt(1);function eq($,q){let J=q.negate();return $?J:q}function g0($,q){let J=y0($.Fp,q.map((Q)=>Q.Z));return q.map((Q,G)=>$.fromAffine(Q.toAffine(J[G])))}function QJ($,q){if(!Number.isSafeInteger($)||$<=0||$>q)throw new Error("invalid window size, expected [1.."+q+"], got W="+$)}function I$($,q){QJ($,q);let J=Math.ceil(q/$)+1,Q=2**($-1),G=2**$,X=hq($),U=BigInt($);return{windows:J,windowSize:Q,mask:X,maxNumber:G,shiftBy:U}}function $J($,q,J){let{windowSize:Q,mask:G,maxNumber:X,shiftBy:U}=J,Z=Number($&G),Y=$>>U;if(Z>Q)Z-=X,Y+=A$;let K=q*Q,W=K+Math.abs(Z)-1,O=Z===0,E=Z<0,H=q%2!==0;return{nextN:Y,offset:W,isZero:O,isNeg:E,isNegF:H,offsetF:K}}var T$=new WeakMap,GJ=new WeakMap;function w$($){return GJ.get($)||1}function qJ($){if($!==m0)throw new Error("invalid wNAF")}class V${BASE;ZERO;Fn;bits;constructor($,q){this.BASE=$.BASE,this.ZERO=$.ZERO,this.Fn=$.Fn,this.bits=q}_unsafeLadder($,q,J=this.ZERO){let Q=$;while(q>m0){if(q&A$)J=J.add(Q);Q=Q.double(),q>>=A$}return J}precomputeWindow($,q){let{windows:J,windowSize:Q}=I$(q,this.bits),G=[],X=$,U=X;for(let Z=0;Z<J;Z++){U=X,G.push(U);for(let Y=1;Y<Q;Y++)U=U.add(X),G.push(U);X=U.double()}return G}wNAF($,q,J){if(!this.Fn.isValid(J))throw new Error("invalid scalar");let Q=this.ZERO,G=this.BASE,X=I$($,this.bits);for(let U=0;U<X.windows;U++){let{nextN:Z,offset:Y,isZero:K,isNeg:W,isNegF:O,offsetF:E}=$J(J,U,X);if(J=Z,K)G=G.add(eq(O,q[E]));else Q=Q.add(eq(W,q[Y]))}return qJ(J),{p:Q,f:G}}wNAFUnsafe($,q,J,Q=this.ZERO){let G=I$($,this.bits);for(let X=0;X<G.windows;X++){if(J===m0)break;let{nextN:U,offset:Z,isZero:Y,isNeg:K}=$J(J,X,G);if(J=U,Y)continue;else{let W=q[Z];Q=Q.add(K?W.negate():W)}}return qJ(J),Q}getPrecomputes($,q,J){let Q=T$.get(q);if(!Q){if(Q=this.precomputeWindow(q,$),$!==1){if(typeof J==="function")Q=J(Q);T$.set(q,Q)}}return Q}cached($,q,J){let Q=w$($);return this.wNAF(Q,this.getPrecomputes(Q,$,J),q)}unsafe($,q,J,Q){let G=w$($);if(G===1)return this._unsafeLadder($,q,Q);return this.wNAFUnsafe(G,this.getPrecomputes(G,$,J),q,Q)}createCache($,q){QJ(q,this.bits),GJ.set($,q),T$.delete($)}hasCache($){return w$($)!==1}}function JJ($,q,J){if(q){if(q.ORDER!==$)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return sq(q),q}else return v0($,{isLE:J})}function XJ($,q,J={},Q){if(Q===void 0)Q=$==="edwards";if(!q||typeof q!=="object")throw new Error(`expected valid ${$} CURVE object`);for(let Y of["p","n","h"]){let K=q[Y];if(!(typeof K==="bigint"&&K>m0))throw new Error(`CURVE.${Y} must be positive bigint`)}let G=JJ(q.p,J.Fp,Q),X=JJ(q.n,J.Fn,Q),Z=["Gx","Gy","a",$==="weierstrass"?"b":"d"];for(let Y of Z)if(!G.isValid(q[Y]))throw new Error(`CURVE.${Y} must be valid field element of CURVE.Fp`);return q=Object.freeze(Object.assign({},q)),{CURVE:q,Fp:G,Fn:X}}function b0($,q){return function J(Q){let G=$(Q);return{secretKey:G,publicKey:q(G)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var m8=BigInt(0),t=BigInt(1),B$=BigInt(2),X1=BigInt(8);function U1($,q,J,Q){let G=$.sqr(J),X=$.sqr(Q),U=$.add($.mul(q.a,G),X),Z=$.add($.ONE,$.mul(q.d,$.mul(G,X)));return $.eql(U,Z)}function UJ($,q={}){let J=XJ("edwards",$,q,q.FpFnLE),{Fp:Q,Fn:G}=J,X=J.CURVE,{h:U}=X;l8(q,{},{uvRatio:"function"});let Z=B$<<BigInt(G.BYTES*8)-t,Y=(I)=>Q.create(I),K=q.uvRatio||((I,P)=>{try{return{isValid:!0,value:Q.sqrt(Q.div(I,P))}}catch(R){return{isValid:!1,value:m8}}});if(!U1(Q,X,X.Gx,X.Gy))throw new Error("bad curve params: generator point");function W(I,P,R=!1){let C=R?t:m8;return $0("coordinate "+I,P,C,Z),P}function O(I){if(!(I instanceof w))throw new Error("EdwardsPoint expected")}let E=H$((I,P)=>{let{X:R,Y:C,Z:f}=I,F=I.is0();if(P==null)P=F?X1:Q.inv(f);let _=Y(R*P),y=Y(C*P),V=Q.mul(f,P);if(F)return{x:m8,y:t};if(V!==t)throw new Error("invZ was invalid");return{x:_,y}}),H=H$((I)=>{let{a:P,d:R}=X;if(I.is0())throw new Error("bad point: ZERO");let{X:C,Y:f,Z:F,T:_}=I,y=Y(C*C),V=Y(f*f),j=Y(F*F),x=Y(j*j),g=Y(y*P),b=Y(j*Y(g+V)),N=Y(x+Y(R*Y(y*V)));if(b!==N)throw new Error("bad point: equation left != right (1)");let T=Y(C*f),D=Y(F*_);if(T!==D)throw new Error("bad point: equation left != right (2)");return!0});class w{static BASE=new w(X.Gx,X.Gy,t,Y(X.Gx*X.Gy));static ZERO=new w(m8,t,t,m8);static Fp=Q;static Fn=G;X;Y;Z;T;constructor(I,P,R,C){this.X=W("x",I),this.Y=W("y",P),this.Z=W("z",R,!0),this.T=W("t",C),Object.freeze(this)}static CURVE(){return X}static fromAffine(I){if(I instanceof w)throw new Error("extended point not allowed");let{x:P,y:R}=I||{};return W("x",P),W("y",R),new w(P,R,t,Y(P*R))}static fromBytes(I,P=!1){let R=Q.BYTES,{a:C,d:f}=X;I=d8(c(I,R,"point")),_0(P,"zip215");let F=d8(I),_=I[R-1];F[R-1]=_&-129;let y=F8(F),V=P?Z:Q.ORDER;$0("point.y",y,m8,V);let j=Y(y*y),x=Y(j-t),g=Y(f*j-C),{isValid:b,value:N}=K(x,g);if(!b)throw new Error("bad point: invalid y coordinate");let T=(N&t)===t,D=(_&128)!==0;if(!P&&N===m8&&D)throw new Error("bad point: x=0 and x_0=1");if(D!==T)N=Y(-N);return w.fromAffine({x:N,y})}static fromHex(I,P=!1){return w.fromBytes(W0(I),P)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(I=8,P=!0){if(k.createCache(this,I),!P)this.multiply(B$);return this}assertValidity(){H(this)}equals(I){O(I);let{X:P,Y:R,Z:C}=this,{X:f,Y:F,Z:_}=I,y=Y(P*_),V=Y(f*C),j=Y(R*_),x=Y(F*C);return y===V&&j===x}is0(){return this.equals(w.ZERO)}negate(){return new w(Y(-this.X),this.Y,this.Z,Y(-this.T))}double(){let{a:I}=X,{X:P,Y:R,Z:C}=this,f=Y(P*P),F=Y(R*R),_=Y(B$*Y(C*C)),y=Y(I*f),V=P+R,j=Y(Y(V*V)-f-F),x=y+F,g=x-_,b=y-F,N=Y(j*g),T=Y(x*b),D=Y(j*b),A=Y(g*x);return new w(N,T,A,D)}add(I){O(I);let{a:P,d:R}=X,{X:C,Y:f,Z:F,T:_}=this,{X:y,Y:V,Z:j,T:x}=I,g=Y(C*y),b=Y(f*V),N=Y(_*R*x),T=Y(F*j),D=Y((C+f)*(y+V)-g-b),A=T-N,B=T+N,S=Y(b-P*g),m=Y(D*A),h=Y(B*S),p=Y(D*S),u=Y(A*B);return new w(m,h,u,p)}subtract(I){return this.add(I.negate())}multiply(I){if(!G.isValidNot0(I))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:P,f:R}=k.cached(this,I,(C)=>g0(w,C));return g0(w,[P,R])[0]}multiplyUnsafe(I,P=w.ZERO){if(!G.isValid(I))throw new Error("invalid scalar: expected 0 <= sc < curve.n");if(I===m8)return w.ZERO;if(this.is0()||I===t)return this;return k.unsafe(this,I,(R)=>g0(w,R),P)}isSmallOrder(){return this.multiplyUnsafe(U).is0()}isTorsionFree(){return k.unsafe(this,X.n).is0()}toAffine(I){return E(this,I)}clearCofactor(){if(U===t)return this;return this.multiplyUnsafe(U)}toBytes(){let{x:I,y:P}=this.toAffine(),R=Q.toBytes(P);return R[R.length-1]|=I&t?128:0,R}toHex(){return s8(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let k=new V$(w,G.BITS);return w.BASE.precompute(8),w}function YJ($,q,J={}){if(typeof q!=="function")throw new Error('"hash" function param is required');l8(J,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:Q}=J,{BASE:G,Fp:X,Fn:U}=$,Z=J.randomBytes||p8,Y=J.adjustScalarBytes||((V)=>V),K=J.domain||((V,j,x)=>{if(_0(x,"phflag"),j.length||x)throw new Error("Contexts/pre-hash are not supported");return V});function W(V){return U.create(F8(V))}function O(V){let j=C.secretKey;c(V,C.secretKey,"secretKey");let x=c(q(V),2*j,"hashedSecretKey"),g=Y(x.slice(0,j)),b=x.slice(j,2*j),N=W(g);return{head:g,prefix:b,scalar:N}}function E(V){let{head:j,prefix:x,scalar:g}=O(V),b=G.multiply(g),N=b.toBytes();return{head:j,prefix:x,scalar:g,point:b,pointBytes:N}}function H(V){return E(V).pointBytes}function w(V=Uint8Array.of(),...j){let x=t8(...j);return W(q(K(x,c(V,void 0,"context"),!!Q)))}function k(V,j,x={}){if(V=c(V,void 0,"message"),Q)V=Q(V);let{prefix:g,scalar:b,pointBytes:N}=E(j),T=w(x.context,g,V),D=G.multiply(T).toBytes(),A=w(x.context,D,N,V),B=U.create(T+A*b);if(!U.isValid(B))throw new Error("sign failed: invalid s");let S=t8(D,U.toBytes(B));return c(S,C.signature,"result")}let I={zip215:!0};function P(V,j,x,g=I){let{context:b,zip215:N}=g,T=C.signature;if(V=c(V,T,"signature"),j=c(j,void 0,"message"),x=c(x,C.publicKey,"publicKey"),N!==void 0)_0(N,"zip215");if(Q)j=Q(j);let D=T/2,A=V.subarray(0,D),B=F8(V.subarray(D,T)),S,m,h;try{S=$.fromBytes(x,N),m=$.fromBytes(A,N),h=G.multiplyUnsafe(B)}catch(U0){return!1}if(!N&&S.isSmallOrder())return!1;let p=w(b,m.toBytes(),S.toBytes(),j);return m.add(S.multiplyUnsafe(p)).subtract(h).clearCofactor().is0()}let R=X.BYTES,C={secretKey:R,publicKey:R,signature:2*R,seed:R};function f(V=Z(C.seed)){return c(V,C.seed,"seed")}function F(V){return Y0(V)&&V.length===U.BYTES}function _(V,j){try{return!!$.fromBytes(V,j)}catch(x){return!1}}let y={getExtendedPublicKey:E,randomSecretKey:f,isValidSecretKey:F,isValidPublicKey:_,toMontgomery(V){let{y:j}=$.fromBytes(V),x=C.publicKey,g=x===32;if(!g&&x!==57)throw new Error("only defined for 25519 and 448");let b=g?X.div(t+j,t-j):X.div(j-t,j+t);return X.toBytes(b)},toMontgomerySecret(V){let j=C.secretKey;c(V,j);let x=q(V.subarray(0,j));return Y(x).subarray(0,j)}};return Object.freeze({keygen:b0(f,H),getPublicKey:H,sign:k,verify:P,utils:y,Point:$,lengths:C})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var O0=BigInt(0),q0=BigInt(1),h0=BigInt(2);function Y1($){return l8($,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...$})}function ZJ($){let q=Y1($),{P:J,type:Q,adjustScalarBytes:G,powPminus2:X,randomBytes:U}=q,Z=Q==="x25519";if(!Z&&Q!=="x448")throw new Error("invalid type");let Y=U||p8,K=Z?255:448,W=Z?32:56,O=Z?BigInt(9):BigInt(5),E=Z?BigInt(121665):BigInt(39081),H=Z?h0**BigInt(254):h0**BigInt(447),w=Z?BigInt(8)*h0**BigInt(251)-q0:BigInt(4)*h0**BigInt(445)-q0,k=H+w+q0,I=(T)=>i(T,J),P=R(O);function R(T){return k0(I(T),W)}function C(T){let D=d8(c(T,W,"uCoordinate"));if(Z)D[31]&=127;return I(F8(D))}function f(T){return F8(G(d8(c(T,W,"scalar"))))}function F(T,D){let A=x(C(D),f(T));if(A===O0)throw new Error("invalid private or public key received");return R(A)}function _(T){return F(T,P)}let y=_,V=F;function j(T,D,A){let B=I(T*(D-A));return D=I(D-B),A=I(A+B),{x_2:D,x_3:A}}function x(T,D){$0("u",T,O0,J),$0("scalar",D,H,k);let A=D,B=T,S=q0,m=O0,h=T,p=q0,u=O0;for(let W$=BigInt(K-1);W$>=O0;W$--){let Zq=A>>W$&q0;u^=Zq,{x_2:S,x_3:h}=j(u,S,h),{x_2:m,x_3:p}=j(u,m,p),u=Zq;let M$=S+m,N$=I(M$*M$),K$=S-m,Wq=I(K$*K$),Mq=N$-Wq,fQ=h+p,FQ=h-p,Nq=I(FQ*M$),Kq=I(fQ*K$),Oq=Nq+Kq,zq=Nq-Kq;h=I(Oq*Oq),p=I(B*I(zq*zq)),S=I(N$*Wq),m=I(Mq*(N$+I(E*Mq)))}({x_2:S,x_3:h}=j(u,S,h)),{x_2:m,x_3:p}=j(u,m,p);let U0=X(m);return I(S*U0)}let g={secretKey:W,publicKey:W,seed:W},b=(T=Y(W))=>{return c(T,g.seed,"seed"),T},N={randomSecretKey:b};return Object.freeze({keygen:b0(b,y),getSharedSecret:V,getPublicKey:y,scalarMult:F,scalarMultBase:_,utils:N,GuBytes:P.slice(),lengths:g})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Z1=BigInt(1),WJ=BigInt(2),W1=BigInt(3),M1=BigInt(5),N1=BigInt(8),p0=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),K1=(()=>({p:p0,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:N1,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function NJ($){let q=BigInt(10),J=BigInt(20),Q=BigInt(40),G=BigInt(80),X=p0,Z=$*$%X*$%X,Y=D8(Z,WJ,X)*Z%X,K=D8(Y,Z1,X)*$%X,W=D8(K,M1,X)*K%X,O=D8(W,q,X)*W%X,E=D8(O,J,X)*O%X,H=D8(E,Q,X)*E%X,w=D8(H,G,X)*H%X,k=D8(w,G,X)*H%X,I=D8(k,q,X)*W%X;return{pow_p_5_8:D8(I,WJ,X)*$%X,b2:Z}}function KJ($){return $[0]&=248,$[31]&=127,$[31]|=64,$}var MJ=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function O1($,q){let J=p0,Q=i(q*q*q,J),G=i(Q*Q*q,J),X=NJ($*G).pow_p_5_8,U=i($*Q*X,J),Z=i(q*U*U,J),Y=U,K=i(U*MJ,J),W=Z===$,O=Z===i(-$,J),E=Z===i(-$*MJ,J);if(W)U=Y;if(O||E)U=K;if(aq(U,J))U=i(-U,J);return{isValid:W||O,value:U}}var z1=UJ(K1,{uvRatio:O1});function E1($){return YJ(z1,yq,Object.assign({adjustScalarBytes:KJ},$))}var g8=E1({});var z0=(()=>{let $=p0;return ZJ({P:$,type:"x25519",powPminus2:(q)=>{let{pow_p_5_8:J,b2:Q}=NJ(q);return i(D8(J,W1,$)*Q,$)},adjustScalarBytes:KJ})})();var yJ=Dq(j$(),1);var P$;try{P$=new TextDecoder}catch($){}var v,r8,L=0;var RJ=[],D1=105,C1=57342,R1=57343,zJ=57337;var EJ=6,J0={},E0=112810000,x8=16810000;var f$=RJ,F$=0,d={},r,d0,l0=0,C0=0,a,C8,o=[],x$=[],K8,Z8,D0,DJ={useRecords:!1,mapsAsObjects:!0},R0=!1,HJ=2;try{new Function("")}catch($){HJ=1/0}class b8{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[q,J]of Object.entries($.keyMap))this.mapKey.set(J,q)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let q=new Map;for(let[J,Q]of Object.entries($))q.set(this._keyMap.hasOwnProperty(J)?this._keyMap[J]:J,Q);return q}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[J,Q]of Object.entries(this._keyMap))this._mapKey.set(Q,J)}let q={};return $.forEach((J,Q)=>q[R8(this._mapKey.has(Q)?this._mapKey.get(Q):Q)]=J),q}mapDecode($,q){let J=this.decode($);if(this._keyMap)switch(J.constructor.name){case"Array":return J.map((Q)=>this.decodeKeys(Q))}return J}decode($,q){if(v)return wJ(()=>{return n0(),this?this.decode($,q):b8.prototype.decode.call(DJ,$,q)});r8=q>-1?q:$.length,L=0,F$=0,C0=0,d0=null,f$=RJ,a=null,v=$;try{Z8=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(J){if(v=null,$ instanceof Uint8Array)throw J;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof b8){if(d=this,K8=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return r=this.structures,c0();else if(!r||r.length>0)r=[]}else{if(d=DJ,!r||r.length>0)r=[];K8=null}return c0()}decodeMultiple($,q){let J,Q=0;try{let G=$.length;R0=!0;let X=this?this.decode($,G):m$.decode($,G);if(q){if(q(X)===!1)return;while(L<G)if(Q=L,q(c0())===!1)return}else{J=[X];while(L<G)Q=L,J.push(c0());return J}}catch(G){throw G.lastPosition=Q,G.values=J,G}finally{R0=!1,n0()}}}function c0(){try{let $=l();if(a){if(L>=a.postBundlePosition){let q=new Error("Unexpected bundle position");throw q.incomplete=!0,q}L=a.postBundlePosition,a=null}if(L==r8){if(r=null,v=null,C8)C8=null}else if(L>r8){let q=new Error("Unexpected end of CBOR data");throw q.incomplete=!0,q}else if(!R0)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(n0(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function l(){let $=v[L++],q=$>>5;if($=$&31,$>23)switch($){case 24:$=v[L++];break;case 25:if(q==7)return T1();$=Z8.getUint16(L),L+=2;break;case 26:if(q==7){let J=Z8.getFloat32(L);if(d.useFloat32>2){let Q=i0[(v[L]&127)<<1|v[L+1]>>7];return L+=4,(Q*J+(J>0?0.5:-0.5)>>0)/Q}return L+=4,J}$=Z8.getUint32(L),L+=4;break;case 27:if(q==7){let J=Z8.getFloat64(L);return L+=8,J}if(q>1){if(Z8.getUint32(L)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=Z8.getUint32(L+4)}else if(d.int64AsNumber)$=Z8.getUint32(L)*4294967296,$+=Z8.getUint32(L+4);else $=Z8.getBigUint64(L);L+=8;break;case 31:switch(q){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let J=[],Q,G=0;while((Q=l())!=J0){if(G>=E0)throw new Error(`Array length exceeds ${E0}`);J[G++]=Q}return q==4?J:q==3?J.join(""):Buffer.concat(J);case 5:let X;if(d.mapsAsObjects){let U={},Z=0;if(d.keyMap)while((X=l())!=J0){if(Z++>=x8)throw new Error(`Property count exceeds ${x8}`);U[R8(d.decodeKey(X))]=l()}else while((X=l())!=J0){if(Z++>=x8)throw new Error(`Property count exceeds ${x8}`);U[R8(X)]=l()}return U}else{if(D0)d.mapsAsObjects=!0,D0=!1;let U=new Map;if(d.keyMap){let Z=0;while((X=l())!=J0){if(Z++>=x8)throw new Error(`Map size exceeds ${x8}`);U.set(d.decodeKey(X),l())}}else{let Z=0;while((X=l())!=J0){if(Z++>=x8)throw new Error(`Map size exceeds ${x8}`);U.set(X,l())}}return U}case 7:return J0;default:throw new Error("Invalid major type for indefinite length "+q)}default:throw new Error("Unknown token "+$)}switch(q){case 0:return $;case 1:return~$;case 2:return I1($);case 3:if(C0>=L)return d0.slice(L-l0,(L+=$)-l0);if(C0==0&&r8<140&&$<32){let G=$<16?LJ($):L1($);if(G!=null)return G}return H1($);case 4:if($>=E0)throw new Error(`Array length exceeds ${E0}`);let J=new Array($);for(let G=0;G<$;G++)J[G]=l();return J;case 5:if($>=x8)throw new Error(`Map size exceeds ${E0}`);if(d.mapsAsObjects){let G={};if(d.keyMap)for(let X=0;X<$;X++)G[R8(d.decodeKey(l()))]=l();else for(let X=0;X<$;X++)G[R8(l())]=l();return G}else{if(D0)d.mapsAsObjects=!0,D0=!1;let G=new Map;if(d.keyMap)for(let X=0;X<$;X++)G.set(d.decodeKey(l()),l());else for(let X=0;X<$;X++)G.set(l(),l());return G}case 6:if($>=zJ){let G=r[$&8191];if(G){if(!G.read)G.read=S$(G);return G.read()}if($<65536){if($==R1){let X=G0(),U=l(),Z=l();k$(U,Z);let Y={};if(d.keyMap)for(let K=2;K<X;K++){let W=d.decodeKey(Z[K-2]);Y[R8(W)]=l()}else for(let K=2;K<X;K++){let W=Z[K-2];Y[R8(W)]=l()}return Y}else if($==C1){let X=G0(),U=l();for(let Z=2;Z<X;Z++)k$(U++,l());return l()}else if($==zJ)return P1();if(d.getShared){if(v$(),G=r[$&8191],G){if(!G.read)G.read=S$(G);return G.read()}}}}let Q=o[$];if(Q)if(Q.handlesRead)return Q(l);else return Q(l());else{let G=l();for(let X=0;X<x$.length;X++){let U=x$[X]($,G);if(U!==void 0)return U}return new T8(G,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let G=(K8||i8())[$];if(G!==void 0)return G;throw new Error("Unknown token "+$)}default:if(isNaN($)){let G=new Error("Unexpected end of CBOR data");throw G.incomplete=!0,G}throw new Error("Unknown CBOR token "+$)}}var CJ=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function S$($){if(!$)throw new Error("Structure is required in record definition");function q(){let J=v[L++];if(J=J&31,J>23)switch(J){case 24:J=v[L++];break;case 25:J=Z8.getUint16(L),L+=2;break;case 26:J=Z8.getUint32(L),L+=4;break;default:throw new Error("Expected array header, but got "+v[L-1])}let Q=this.compiledReader;while(Q){if(Q.propertyCount===J)return Q(l);Q=Q.next}if(this.slowReads++>=HJ){let X=this.length==J?this:this.slice(0,J);if(Q=d.keyMap?new Function("r","return {"+X.map((U)=>d.decodeKey(U)).map((U)=>CJ.test(U)?R8(U)+":r()":"["+JSON.stringify(U)+"]:r()").join(",")+"}"):new Function("r","return {"+X.map((U)=>CJ.test(U)?R8(U)+":r()":"["+JSON.stringify(U)+"]:r()").join(",")+"}"),this.compiledReader)Q.next=this.compiledReader;return Q.propertyCount=J,this.compiledReader=Q,Q(l)}let G={};if(d.keyMap)for(let X=0;X<J;X++)G[R8(d.decodeKey(this[X]))]=l();else for(let X=0;X<J;X++)G[R8(this[X])]=l();return G}return $.slowReads=0,q}function R8($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var H1=_$;function _$($){let q;if($<16){if(q=LJ($))return q}if($>64&&P$)return P$.decode(v.subarray(L,L+=$));let J=L+$,Q=[];q="";while(L<J){let G=v[L++];if((G&128)===0)Q.push(G);else if((G&224)===192){let X=v[L++]&63;Q.push((G&31)<<6|X)}else if((G&240)===224){let X=v[L++]&63,U=v[L++]&63;Q.push((G&31)<<12|X<<6|U)}else if((G&248)===240){let X=v[L++]&63,U=v[L++]&63,Z=v[L++]&63,Y=(G&7)<<18|X<<12|U<<6|Z;if(Y>65535)Y-=65536,Q.push(Y>>>10&1023|55296),Y=56320|Y&1023;Q.push(Y)}else Q.push(G);if(Q.length>=4096)q+=e.apply(String,Q),Q.length=0}if(Q.length>0)q+=e.apply(String,Q);return q}var e=String.fromCharCode;function L1($){let q=L,J=new Array($);for(let Q=0;Q<$;Q++){let G=v[L++];if((G&128)>0){L=q;return}J[Q]=G}return e.apply(String,J)}function LJ($){if($<4)if($<2)if($===0)return"";else{let q=v[L++];if((q&128)>1){L-=1;return}return e(q)}else{let q=v[L++],J=v[L++];if((q&128)>0||(J&128)>0){L-=2;return}if($<3)return e(q,J);let Q=v[L++];if((Q&128)>0){L-=3;return}return e(q,J,Q)}else{let q=v[L++],J=v[L++],Q=v[L++],G=v[L++];if((q&128)>0||(J&128)>0||(Q&128)>0||(G&128)>0){L-=4;return}if($<6)if($===4)return e(q,J,Q,G);else{let X=v[L++];if((X&128)>0){L-=5;return}return e(q,J,Q,G,X)}else if($<8){let X=v[L++],U=v[L++];if((X&128)>0||(U&128)>0){L-=6;return}if($<7)return e(q,J,Q,G,X,U);let Z=v[L++];if((Z&128)>0){L-=7;return}return e(q,J,Q,G,X,U,Z)}else{let X=v[L++],U=v[L++],Z=v[L++],Y=v[L++];if((X&128)>0||(U&128)>0||(Z&128)>0||(Y&128)>0){L-=8;return}if($<10)if($===8)return e(q,J,Q,G,X,U,Z,Y);else{let K=v[L++];if((K&128)>0){L-=9;return}return e(q,J,Q,G,X,U,Z,Y,K)}else if($<12){let K=v[L++],W=v[L++];if((K&128)>0||(W&128)>0){L-=10;return}if($<11)return e(q,J,Q,G,X,U,Z,Y,K,W);let O=v[L++];if((O&128)>0){L-=11;return}return e(q,J,Q,G,X,U,Z,Y,K,W,O)}else{let K=v[L++],W=v[L++],O=v[L++],E=v[L++];if((K&128)>0||(W&128)>0||(O&128)>0||(E&128)>0){L-=12;return}if($<14)if($===12)return e(q,J,Q,G,X,U,Z,Y,K,W,O,E);else{let H=v[L++];if((H&128)>0){L-=13;return}return e(q,J,Q,G,X,U,Z,Y,K,W,O,E,H)}else{let H=v[L++],w=v[L++];if((H&128)>0||(w&128)>0){L-=14;return}if($<15)return e(q,J,Q,G,X,U,Z,Y,K,W,O,E,H,w);let k=v[L++];if((k&128)>0){L-=15;return}return e(q,J,Q,G,X,U,Z,Y,K,W,O,E,H,w,k)}}}}}function I1($){return d.copyBuffers?Uint8Array.prototype.slice.call(v,L,L+=$):v.subarray(L,L+=$)}var IJ=new Float32Array(1),u0=new Uint8Array(IJ.buffer,0,4);function T1(){let $=v[L++],q=v[L++],J=($&127)>>2;if(J===31){if(q||$&3)return NaN;return $&128?-1/0:1/0}if(J===0){let Q=(($&3)<<8|q)/16777216;return $&128?-Q:Q}return u0[3]=$&128|(J>>1)+56,u0[2]=($&7)<<5|q>>3,u0[1]=q<<5,u0[0]=0,IJ[0]}var QG=new Array(4096);class T8{constructor($,q){this.value=$,this.tag=q}}o[0]=($)=>{return new Date($)};o[1]=($)=>{return new Date(Math.round($*1000))};o[2]=($)=>{let q=BigInt(0);for(let J=0,Q=$.byteLength;J<Q;J++)q=BigInt($[J])+(q<<BigInt(8));return q};o[3]=($)=>{return BigInt(-1)-o[2]($)};o[4]=($)=>{return+($[1]+"e"+$[0])};o[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var k$=($,q)=>{$=$-57344;let J=r[$];if(J&&J.isShared)(r.restoreStructures||(r.restoreStructures=[]))[$]=J;r[$]=q,q.read=S$(q)};o[D1]=($)=>{let q=$.length,J=$[1];k$($[0],J);let Q={};for(let G=2;G<q;G++){let X=J[G-2];Q[R8(X)]=$[G]}return Q};o[14]=($)=>{if(a)return a[0].slice(a.position0,a.position0+=$);return new T8($,14)};o[15]=($)=>{if(a)return a[1].slice(a.position1,a.position1+=$);return new T8($,15)};var w1={Error,RegExp};o[27]=($)=>{return(w1[$[0]]||Error)($[1],$[2])};var TJ=($)=>{if(v[L++]!=132){let J=new Error("Packed values structure must be followed by a 4 element array");if(v.length<L)J.incomplete=!0;throw J}let q=$();if(!q||!q.length){let J=new Error("Packed values structure must be followed by a 4 element array");throw J.incomplete=!0,J}return K8=K8?q.concat(K8.slice(q.length)):q,K8.prefixes=$(),K8.suffixes=$(),$()};TJ.handlesRead=!0;o[51]=TJ;o[EJ]=($)=>{if(!K8)if(d.getShared)v$();else return new T8($,EJ);if(typeof $=="number")return K8[16+($>=0?2*$:-2*$-1)];let q=new Error("No support for non-integer packed references yet");if($===void 0)q.incomplete=!0;throw q};o[28]=($)=>{if(!C8)C8=new Map,C8.id=0;let q=C8.id++,J=L,Q=v[L],G;if(Q>>5==4)G=[];else G={};let X={target:G};C8.set(q,X);let U=$();if(X.used){if(Object.getPrototypeOf(G)!==Object.getPrototypeOf(U))L=J,G=U,C8.set(q,{target:G}),U=$();return Object.assign(G,U)}return X.target=U,U};o[28].handlesRead=!0;o[29]=($)=>{let q=C8.get($);return q.used=!0,q.target};o[258]=($)=>new Set($);(o[259]=($)=>{if(d.mapsAsObjects)d.mapsAsObjects=!1,D0=!0;return $()}).handlesRead=!0;function Q0($,q){if(typeof $==="string")return $+q;if($ instanceof Array)return $.concat(q);return Object.assign({},$,q)}function i8(){if(!K8)if(d.getShared)v$();else throw new Error("No packed values available");return K8}var A1=1399353956;x$.push(($,q)=>{if($>=225&&$<=255)return Q0(i8().prefixes[$-224],q);if($>=28704&&$<=32767)return Q0(i8().prefixes[$-28672],q);if($>=1879052288&&$<=2147483647)return Q0(i8().prefixes[$-1879048192],q);if($>=216&&$<=223)return Q0(q,i8().suffixes[$-216]);if($>=27647&&$<=28671)return Q0(q,i8().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return Q0(q,i8().suffixes[$-1811939328]);if($==A1)return{packedValues:K8,structures:r.slice(0),version:q};if($==55799)return q});var V1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,y$=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],B1=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<y$.length;$++)j1(y$[$],B1[$]);function j1($,q){let J="get"+$.name.slice(0,-5),Q;if(typeof $==="function")Q=$.BYTES_PER_ELEMENT;else $=null;for(let G=0;G<2;G++){if(!G&&Q==1)continue;let X=Q==2?1:Q==4?2:Q==8?3:0;o[G?q:q-4]=Q==1||G==V1?(U)=>{if(!$)throw new Error("Could not find typed array for code "+q);if(!d.copyBuffers){if(Q===1||Q===2&&!(U.byteOffset&1)||Q===4&&!(U.byteOffset&3)||Q===8&&!(U.byteOffset&7))return new $(U.buffer,U.byteOffset,U.byteLength>>X)}return new $(Uint8Array.prototype.slice.call(U,0).buffer)}:(U)=>{if(!$)throw new Error("Could not find typed array for code "+q);let Z=new DataView(U.buffer,U.byteOffset,U.byteLength),Y=U.length>>X,K=new $(Y),W=Z[J];for(let O=0;O<Y;O++)K[O]=W.call(Z,O<<X,G);return K}}}function P1(){let $=G0(),q=L+l();for(let Q=2;Q<$;Q++){let G=G0();L+=G}let J=L;return L=q,a=[_$(G0()),_$(G0())],a.position0=0,a.position1=0,a.postBundlePosition=L,L=J,l()}function G0(){let $=v[L++]&31;if($>23)switch($){case 24:$=v[L++];break;case 25:$=Z8.getUint16(L),L+=2;break;case 26:$=Z8.getUint32(L),L+=4;break}return $}function v$(){if(d.getShared){let $=wJ(()=>{return v=null,d.getShared()})||{},q=$.structures||[];if(d.sharedVersion=$.version,K8=d.sharedValues=$.packedValues,r===!0)d.structures=r=q;else r.splice.apply(r,[0,q.length].concat(q))}}function wJ($){let q=r8,J=L,Q=F$,G=l0,X=C0,U=d0,Z=f$,Y=C8,K=a,W=new Uint8Array(v.slice(0,r8)),O=r,E=d,H=R0,w=$();return r8=q,L=J,F$=Q,l0=G,C0=X,d0=U,f$=Z,C8=Y,a=K,v=W,R0=H,r=O,d=E,Z8=new DataView(v.buffer,v.byteOffset,v.byteLength),w}function n0(){v=null,C8=null,r=null}var i0=new Array(147);for(let $=0;$<256;$++)i0[$]=+("1e"+Math.floor(45.15-$*0.30103));var m$=new b8({useRecords:!1}),r0=m$.decode,f1=m$.decodeMultiple;var o0;try{o0=new TextEncoder}catch($){}var c$,FJ,s0=typeof globalThis==="object"&&globalThis.Buffer,H0=typeof s0!=="undefined",g$=H0?s0.allocUnsafeSlow:Uint8Array,AJ=H0?s0:Uint8Array,VJ=256,BJ=H0?4294967296:2144337920;var b$,z,n,M=0,h8,s=null,F1=61440,x1=/[\u0080-\uFFFF]/,E8=Symbol("record-id");class t0 extends b8{constructor($){super($);this.offset=0;let q,J,Q,G,X,U;$=$||{};let Z=AJ.prototype.utf8Write?function(N,T,D){return z.utf8Write(N,T,D)}:o0&&o0.encodeInto?function(N,T){return o0.encodeInto(N,z.subarray(T)).written}:!1,Y=this,K=$.structures||$.saveStructures,W=$.maxSharedStructures;if(W==null)W=K?128:0;if(W>8190)throw new Error("Maximum maxSharedStructure is 8190");let O=$.sequential;if(O)W=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let E,H,w=$.sharedValues,k;if(w){k=Object.create(null);for(let N=0,T=w.length;N<T;N++)k[w[N]]=N}let I=[],P=0,R=0;this.mapEncode=function(N,T){if(this._keyMap&&!this._mapped)switch(N.constructor.name){case"Array":N=N.map((D)=>this.encodeKeys(D));break}return this.encode(N,T)},this.encode=function(N,T){if(!z)z=new g$(8192),n=new DataView(z.buffer,0,8192),M=0;if(h8=z.length-10,h8-M<2048)z=new g$(z.length),n=new DataView(z.buffer,0,z.length),h8=z.length-10,M=0;else if(T===d$)M=M+7&2147483640;if(J=M,Y.useSelfDescribedHeader)n.setUint32(M,3654940416),M+=3;if(U=Y.structuredClone?new Map:null,Y.bundleStrings&&typeof N!=="string")s=[],s.size=1/0;else s=null;if(Q=Y.structures,Q){if(Q.uninitialized){let A=Y.getShared()||{};Y.structures=Q=A.structures||[],Y.sharedVersion=A.version;let B=Y.sharedValues=A.packedValues;if(B){k={};for(let S=0,m=B.length;S<m;S++)k[B[S]]=S}}let D=Q.length;if(D>W&&!O)D=W;if(!Q.transitions){Q.transitions=Object.create(null);for(let A=0;A<D;A++){let B=Q[A];if(!B)continue;let S,m=Q.transitions;for(let h=0,p=B.length;h<p;h++){if(m[E8]===void 0)m[E8]=A;let u=B[h];if(S=m[u],!S)S=m[u]=Object.create(null);m=S}m[E8]=A|1048576}}if(!O)Q.nextId=D}if(G)G=!1;if(X=Q||[],H=k,$.pack){let D=new Map;if(D.values=[],D.encoder=Y,D.maxValues=$.maxPrivatePackedValues||(k?16:1/0),D.objectMap=k||!1,D.samplingPackedValues=E,a0(N,D),D.values.length>0){z[M++]=216,z[M++]=51,A8(4);let A=D.values;C(A),A8(0),A8(0),H=Object.create(k||null);for(let B=0,S=A.length;B<S;B++)H[A[B]]=B}}b$=T&p$;try{if(b$)return;if(C(N),s)PJ(J,C);if(Y.offset=M,U&&U.idsToInsert){if(M+=U.idsToInsert.length*2,M>h8)F(M);Y.offset=M;let D=k1(z.subarray(J,M),U.idsToInsert);return U=null,D}if(T&d$)return z.start=J,z.end=M,z;return z.subarray(J,M)}finally{if(Q){if(R<10)R++;if(Q.length>W)Q.length=W;if(P>1e4){if(Q.transitions=null,R=0,P=0,I.length>0)I=[]}else if(I.length>0&&!O){for(let D=0,A=I.length;D<A;D++)I[D][E8]=void 0;I=[]}}if(G&&Y.saveShared){if(Y.structures.length>W)Y.structures=Y.structures.slice(0,W);let D=z.subarray(J,M);if(Y.updateSharedData()===!1)return Y.encode(N);return D}if(T&g1)M=J}},this.findCommonStringsToPack=()=>{if(E=new Map,!k)k=Object.create(null);return(N)=>{let T=N&&N.threshold||4,D=this.pack?N.maxPrivatePackedValues||16:0;if(!w)w=this.sharedValues=[];for(let[A,B]of E)if(B.count>T)k[A]=D++,w.push(A),G=!0;while(this.saveShared&&this.updateSharedData()===!1);E=null}};let C=(N)=>{if(M>h8)z=F(M);var T=typeof N,D;if(T==="string"){if(H){let m=H[N];if(m>=0){if(m<16)z[M++]=m+224;else if(z[M++]=198,m&1)C(15-m>>1);else C(m-16>>1);return}else if(E&&!$.pack){let h=E.get(N);if(h)h.count++;else E.set(N,{count:1})}}let A=N.length;if(s&&A>=4&&A<1024){if((s.size+=A)>F1){let h,p=(s[0]?s[0].length*3+s[1].length:0)+10;if(M+p>h8)z=F(M+p);if(z[M++]=217,z[M++]=223,z[M++]=249,z[M++]=s.position?132:130,z[M++]=26,h=M-J,M+=4,s.position)PJ(J,C);s=["",""],s.size=0,s.position=h}let m=x1.test(N);s[m?0:1]+=N,z[M++]=m?206:207,C(A);return}let B;if(A<32)B=1;else if(A<256)B=2;else if(A<65536)B=3;else B=5;let S=A*3;if(M+S>h8)z=F(M+S);if(A<64||!Z){let m,h,p,u=M+B;for(m=0;m<A;m++)if(h=N.charCodeAt(m),h<128)z[u++]=h;else if(h<2048)z[u++]=h>>6|192,z[u++]=h&63|128;else if((h&64512)===55296&&((p=N.charCodeAt(m+1))&64512)===56320)h=65536+((h&1023)<<10)+(p&1023),m++,z[u++]=h>>18|240,z[u++]=h>>12&63|128,z[u++]=h>>6&63|128,z[u++]=h&63|128;else z[u++]=h>>12|224,z[u++]=h>>6&63|128,z[u++]=h&63|128;D=u-M-B}else D=Z(N,M+B,S);if(D<24)z[M++]=96|D;else if(D<256){if(B<2)z.copyWithin(M+2,M+1,M+1+D);z[M++]=120,z[M++]=D}else if(D<65536){if(B<3)z.copyWithin(M+3,M+2,M+2+D);z[M++]=121,z[M++]=D>>8,z[M++]=D&255}else{if(B<5)z.copyWithin(M+5,M+3,M+3+D);z[M++]=122,n.setUint32(M,D),M+=4}M+=D}else if(T==="number")if(!this.alwaysUseFloat&&N>>>0===N)if(N<24)z[M++]=N;else if(N<256)z[M++]=24,z[M++]=N;else if(N<65536)z[M++]=25,z[M++]=N>>8,z[M++]=N&255;else z[M++]=26,n.setUint32(M,N),M+=4;else if(!this.alwaysUseFloat&&N>>0===N)if(N>=-24)z[M++]=31-N;else if(N>=-256)z[M++]=56,z[M++]=~N;else if(N>=-65536)z[M++]=57,n.setUint16(M,~N),M+=2;else z[M++]=58,n.setUint32(M,~N),M+=4;else{let A;if((A=this.useFloat32)>0&&N<4294967296&&N>=-2147483648){z[M++]=250,n.setFloat32(M,N);let B;if(A<4||(B=N*i0[(z[M]&127)<<1|z[M+1]>>7])>>0===B){M+=4;return}else M--}z[M++]=251,n.setFloat64(M,N),M+=8}else if(T==="object")if(!N)z[M++]=246;else{if(U){let B=U.get(N);if(B){if(z[M++]=216,z[M++]=29,z[M++]=25,!B.references){let S=U.idsToInsert||(U.idsToInsert=[]);B.references=[],S.push(B)}B.references.push(M-J),M+=2;return}else U.set(N,{offset:M-J})}let A=N.constructor;if(A===Object)f(N);else if(A===Array){if(D=N.length,D<24)z[M++]=128|D;else A8(D);for(let B=0;B<D;B++)C(N[B])}else if(A===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)z[M++]=217,z[M++]=1,z[M++]=3;if(D=N.size,D<24)z[M++]=160|D;else if(D<256)z[M++]=184,z[M++]=D;else if(D<65536)z[M++]=185,z[M++]=D>>8,z[M++]=D&255;else z[M++]=186,n.setUint32(M,D),M+=4;if(Y.keyMap)for(let[B,S]of N)C(Y.encodeKey(B)),C(S);else for(let[B,S]of N)C(B),C(S)}else{for(let B=0,S=c$.length;B<S;B++){let m=FJ[B];if(N instanceof m){let h=c$[B],p=h.tag;if(p==null)p=h.getTag&&h.getTag.call(this,N);if(p<24)z[M++]=192|p;else if(p<256)z[M++]=216,z[M++]=p;else if(p<65536)z[M++]=217,z[M++]=p>>8,z[M++]=p&255;else if(p>-1)z[M++]=218,n.setUint32(M,p),M+=4;h.encode.call(this,N,C,F);return}}if(N[Symbol.iterator]){if(b$){let B=new Error("Iterable should be serialized as iterator");throw B.iteratorNotHandled=!0,B}z[M++]=159;for(let B of N)C(B);z[M++]=255;return}if(N[Symbol.asyncIterator]||h$(N)){let B=new Error("Iterable/blob should be serialized as iterator");throw B.iteratorNotHandled=!0,B}if(this.useToJSON&&N.toJSON){let B=N.toJSON();if(B!==N)return C(B)}f(N)}}else if(T==="boolean")z[M++]=N?245:244;else if(T==="bigint"){if(N<BigInt(1)<<BigInt(64)&&N>=0)z[M++]=27,n.setBigUint64(M,N);else if(N>-(BigInt(1)<<BigInt(64))&&N<0)z[M++]=59,n.setBigUint64(M,-N-BigInt(1));else if(this.largeBigIntToFloat)z[M++]=251,n.setFloat64(M,Number(N));else{if(N>=BigInt(0))z[M++]=194;else z[M++]=195,N=BigInt(-1)-N;let A=[];while(N)A.push(Number(N&BigInt(255))),N>>=BigInt(8);u$(new Uint8Array(A.reverse()),F);return}M+=8}else if(T==="undefined")z[M++]=247;else throw new Error("Unknown type: "+T)},f=this.useRecords===!1?this.variableMapSize?(N)=>{let T=Object.keys(N),D=Object.values(N),A=T.length;if(A<24)z[M++]=160|A;else if(A<256)z[M++]=184,z[M++]=A;else if(A<65536)z[M++]=185,z[M++]=A>>8,z[M++]=A&255;else z[M++]=186,n.setUint32(M,A),M+=4;let B;if(Y.keyMap)for(let S=0;S<A;S++)C(Y.encodeKey(T[S])),C(D[S]);else for(let S=0;S<A;S++)C(T[S]),C(D[S])}:(N)=>{z[M++]=185;let T=M-J;M+=2;let D=0;if(Y.keyMap){for(let A in N)if(typeof N.hasOwnProperty!=="function"||N.hasOwnProperty(A))C(Y.encodeKey(A)),C(N[A]),D++}else for(let A in N)if(typeof N.hasOwnProperty!=="function"||N.hasOwnProperty(A))C(A),C(N[A]),D++;z[T+++J]=D>>8,z[T+J]=D&255}:(N,T)=>{let D,A=X.transitions||(X.transitions=Object.create(null)),B=0,S=0,m,h;if(this.keyMap){h=Object.keys(N).map((u)=>this.encodeKey(u)),S=h.length;for(let u=0;u<S;u++){let U0=h[u];if(D=A[U0],!D)D=A[U0]=Object.create(null),B++;A=D}}else for(let u in N)if(typeof N.hasOwnProperty!=="function"||N.hasOwnProperty(u)){if(D=A[u],!D){if(A[E8]&1048576)m=A[E8]&65535;D=A[u]=Object.create(null),B++}A=D,S++}let p=A[E8];if(p!==void 0)p&=65535,z[M++]=217,z[M++]=p>>8|224,z[M++]=p&255;else{if(!h)h=A.__keys__||(A.__keys__=Object.keys(N));if(m===void 0){if(p=X.nextId++,!p)p=0,X.nextId=1;if(p>=VJ)X.nextId=(p=W)+1}else p=m;if(X[p]=h,p<W){z[M++]=217,z[M++]=p>>8|224,z[M++]=p&255,A=X.transitions;for(let u=0;u<S;u++){if(A[E8]===void 0||A[E8]&1048576)A[E8]=p;A=A[h[u]]}A[E8]=p|1048576,G=!0}else{if(A[E8]=p,n.setUint32(M,3655335680),M+=3,B)P+=R*B;if(I.length>=VJ-W)I.shift()[E8]=void 0;if(I.push(A),A8(S+2),C(57344+p),C(h),T)return;for(let u in N)if(typeof N.hasOwnProperty!=="function"||N.hasOwnProperty(u))C(N[u]);return}}if(S<24)z[M++]=128|S;else A8(S);if(T)return;for(let u in N)if(typeof N.hasOwnProperty!=="function"||N.hasOwnProperty(u))C(N[u])},F=(N)=>{let T;if(N>16777216){if(N-J>BJ)throw new Error("Encoded buffer would be larger than maximum buffer size");T=Math.min(BJ,Math.round(Math.max((N-J)*(N>67108864?1.25:2),4194304)/4096)*4096)}else T=(Math.max(N-J<<2,z.length-1)>>12)+1<<12;let D=new g$(T);if(n=new DataView(D.buffer,0,T),z.copy)z.copy(D,0,J,N);else D.set(z.slice(J,N));return M-=J,J=0,h8=D.length-10,z=D},_=100,y=1000;this.encodeAsIterable=function(N,T){return g(N,T,V)},this.encodeAsAsyncIterable=function(N,T){return g(N,T,b)};function*V(N,T,D){let A=N.constructor;if(A===Object){let B=Y.useRecords!==!1;if(B)f(N,!0);else jJ(Object.keys(N).length,160);for(let S in N){let m=N[S];if(!B)C(S);if(m&&typeof m==="object")if(T[S])yield*V(m,T[S]);else yield*j(m,T,S);else C(m)}}else if(A===Array){let B=N.length;A8(B);for(let S=0;S<B;S++){let m=N[S];if(m&&(typeof m==="object"||M-J>_))if(T.element)yield*V(m,T.element);else yield*j(m,T,"element");else C(m)}}else if(N[Symbol.iterator]&&!N.buffer){z[M++]=159;for(let B of N)if(B&&(typeof B==="object"||M-J>_))if(T.element)yield*V(B,T.element);else yield*j(B,T,"element");else C(B);z[M++]=255}else if(h$(N))jJ(N.size,64),yield z.subarray(J,M),yield N,x();else if(N[Symbol.asyncIterator])z[M++]=159,yield z.subarray(J,M),yield N,x(),z[M++]=255;else C(N);if(D&&M>J)yield z.subarray(J,M);else if(M-J>_)yield z.subarray(J,M),x()}function*j(N,T,D){let A=M-J;try{if(C(N),M-J>_)yield z.subarray(J,M),x()}catch(B){if(B.iteratorNotHandled)T[D]={},M=J+A,yield*V.call(this,N,T[D]);else throw B}}function x(){_=y,Y.encode(null,p$)}function g(N,T,D){if(T&&T.chunkThreshold)_=y=T.chunkThreshold;else _=100;if(N&&typeof N==="object")return Y.encode(null,p$),D(N,Y.iterateProperties||(Y.iterateProperties={}),!0);return[Y.encode(N)]}async function*b(N,T){for(let D of V(N,T,!0)){let A=D.constructor;if(A===AJ||A===Uint8Array)yield D;else if(h$(D)){let B=D.stream().getReader(),S;while(!(S=await B.read()).done)yield S.value}else if(D[Symbol.asyncIterator])for await(let B of D)if(x(),B)yield*b(B,T.async||(T.async={}));else yield Y.encode(B);else yield D}}}useBuffer($){z=$,n=new DataView(z.buffer,z.byteOffset,z.byteLength),M=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let q=this.structures.slice(0),J=new l$(q,this.sharedValues,this.sharedVersion),Q=this.saveShared(J,(G)=>(G&&G.version||0)==$);if(Q===!1)J=this.getShared()||{},this.structures=J.structures||[],this.sharedValues=J.packedValues,this.sharedVersion=J.version,this.structures.nextId=this.structures.length;else q.forEach((G,X)=>this.structures[X]=G);return Q}}function jJ($,q){if($<24)z[M++]=q|$;else if($<256)z[M++]=q|24,z[M++]=$;else if($<65536)z[M++]=q|25,z[M++]=$>>8,z[M++]=$&255;else z[M++]=q|26,n.setUint32(M,$),M+=4}class l${constructor($,q,J){this.structures=$,this.packedValues=q,this.version=J}}function A8($){if($<24)z[M++]=128|$;else if($<256)z[M++]=152,z[M++]=$;else if($<65536)z[M++]=153,z[M++]=$>>8,z[M++]=$&255;else z[M++]=154,n.setUint32(M,$),M+=4}var S1=typeof Blob==="undefined"?function(){}:Blob;function h$($){if($ instanceof S1)return!0;let q=$[Symbol.toStringTag];return q==="Blob"||q==="File"}function a0($,q){switch(typeof $){case"string":if($.length>3){if(q.objectMap[$]>-1||q.values.length>=q.maxValues)return;let Q=q.get($);if(Q){if(++Q.count==2)q.values.push($)}else if(q.set($,{count:1}),q.samplingPackedValues){let G=q.samplingPackedValues.get($);if(G)G.count++;else q.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let Q=0,G=$.length;Q<G;Q++)a0($[Q],q);else{let Q=!q.encoder.useRecords;for(var J in $)if($.hasOwnProperty(J)){if(Q)a0(J,q);a0($[J],q)}}break;case"function":console.log($)}}var _1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;FJ=[Date,Set,Error,RegExp,T8,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,l$];c$=[{tag:1,encode($,q){let J=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&J>=0&&J<4294967296)z[M++]=26,n.setUint32(M,J),M+=4;else z[M++]=251,n.setFloat64(M,J),M+=8}},{tag:258,encode($,q){let J=Array.from($);q(J)}},{tag:27,encode($,q){q([$.name,$.message])}},{tag:27,encode($,q){q(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,q){q($.value)}},{encode($,q,J){u$($,J)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||H0&&this.tagUint8Array!==!1)return 64}},encode($,q,J){u$($,J)}},w8(68,1),w8(69,2),w8(70,4),w8(71,8),w8(72,1),w8(77,2),w8(78,4),w8(79,8),w8(85,4),w8(86,8),{encode($,q){let J=$.packedValues||[],Q=$.structures||[];if(J.values.length>0){z[M++]=216,z[M++]=51,A8(4);let G=J.values;q(G),A8(0),A8(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let X=0,U=G.length;X<U;X++)packedObjectMap[G[X]]=X}if(Q){n.setUint32(M,3655335424),M+=3;let G=Q.slice(0);G.unshift(57344),G.push(new T8($.version,1399353956)),q(G)}else q(new T8($.version,1399353956))}}];function w8($,q){if(!_1&&q>1)$-=4;return{tag:$,encode:function J(Q,G){let X=Q.byteLength,U=Q.byteOffset||0,Z=Q.buffer||Q;G(H0?s0.from(Z,U,X):new Uint8Array(Z,U,X))}}}function u$($,q){let J=$.byteLength;if(J<24)z[M++]=64+J;else if(J<256)z[M++]=88,z[M++]=J;else if(J<65536)z[M++]=89,z[M++]=J>>8,z[M++]=J&255;else z[M++]=90,n.setUint32(M,J),M+=4;if(M+J>=z.length)q(M+J);z.set($.buffer?$:new Uint8Array($),M),M+=J}function k1($,q){let J,Q=q.length*2,G=$.length-Q;q.sort((X,U)=>X.offset>U.offset?1:-1);for(let X=0;X<q.length;X++){let U=q[X];U.id=X;for(let Z of U.references)$[Z++]=X>>8,$[Z]=X&255}while(J=q.pop()){let X=J.offset;$.copyWithin(X+Q,X,G),Q-=2;let U=X+Q;$[U++]=216,$[U++]=28,G=X}return $}function PJ($,q){n.setUint32(s.position+$,M-s.position-$+1);let J=s;s=null,q(J[0]),q(J[1])}var n$=new t0({useRecords:!1}),y1=n$.encode,v1=n$.encodeAsIterable,m1=n$.encodeAsAsyncIterable;var d$=512,g1=1024,p$=2048;var e0=($)=>{let q=new Uint8Array($);return btoa(String.fromCharCode(...q)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},xJ=($)=>{let q=atob($.replace(/-/g,"+").replace(/_/g,"/")),J=new Uint8Array(q.length);for(let Q=0;Q<q.length;Q++)J[Q]=q.charCodeAt(Q);return J.buffer};async function SJ($){let q=crypto.getRandomValues(new Uint8Array(32)),Q=new TextEncoder().encode($),G=await crypto.subtle.digest("SHA-256",Q),X=new Uint8Array(G).slice(0,16),U=await navigator.credentials.create({publicKey:{challenge:q,rp:{name:"Sorane Web/A Form"},user:{id:X,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"required"},timeout:60000,attestation:"none",extensions:{prf:{}}}});if(!U)throw new Error("Credential creation failed");return{id:U.id,rawId:e0(U.rawId),response:U.response}}async function _J($,q){let J=await navigator.credentials.get({publicKey:{challenge:q,allowCredentials:[{id:xJ($),type:"public-key"}],userVerification:"required"}});if(!J)throw new Error("Assertion failed");let Q=J.response;return{id:J.id,signature:e0(Q.signature),authenticatorData:e0(Q.authenticatorData),clientDataJSON:e0(Q.clientDataJSON)}}async function $$($,q){let J=crypto.getRandomValues(new Uint8Array(32)),Q=await navigator.credentials.get({publicKey:{challenge:J,allowCredentials:[{id:xJ($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:q}}}}});if(!Q)throw new Error("Assertion failed");let X=Q.getClientExtensionResults()?.prf?.results?.first;if(!X)throw new Error("PRF extension not available");return new Uint8Array(X)}function L0($){return Array.from($).map((q)=>q.toString(16).padStart(2,"0")).join("")}function kJ($){let q=new Uint8Array($.length/2);for(let J=0;J<q.length;J++)q[J]=parseInt($.substring(J*2,J*2+2),16);return q}class vJ{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),q=localStorage.getItem("weba_passkey_pub");if($&&q){this.credentialId=$,this.publicKey=kJ(q),this.publicKeyType="p256",this.usePasskey=!0;return}let J=localStorage.getItem("weba_private_key");if(J)this.edPrivateKey=kJ(J),this.publicKey=g8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{let $=prompt("Enter a name for this Passkey:","demo-user")||"User";console.log(`Registering Passkey for ${$}...`);let q=await SJ($),J=new Uint8Array(q.response.attestationObject),G=r0(J).authData,X=new DataView(G.buffer,G.byteOffset,G.byteLength),U=53,Z=X.getUint16(U);U+=2,U+=Z;let Y=G.slice(U),K=r0(Y),W=K.get(-2),O=K.get(-3);if(!W||!O)throw new Error("Invalid COSE Key: x or y missing");let E=new Uint8Array(65);if(E[0]=4,E.set(W,1),E.set(O,33),this.credentialId=q.rawId,this.publicKey=E,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",L0(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}generateEdKey(){if(this.edPrivateKey=g8.utils.randomSecretKey(),this.publicKey=g8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",L0(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return`did:key:z${L0(this.publicKey)}`}getPublicKey(){return this.publicKey?L0(this.publicKey):""}async sign($,q="authentication"){if(!this.publicKey)await this.register();let J=yJ.default($),Q=new TextEncoder().encode(J);if(this.usePasskey&&this.credentialId){let G=await crypto.subtle.digest("SHA-256",Q),X=await _J(this.credentialId,G);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:X.signature,"srn:authenticatorData":X.authenticatorData,"srn:clientDataJSON":X.clientDataJSON,"srn:credentialId":X.id}}}else{if(!this.edPrivateKey)this.generateEdKey();let G=g8.sign(Q,this.edPrivateKey);return{...$,proof:{type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:L0(G)}}}}}var X0=new vJ;class i${oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor($,q){if(Z0($),c(q,void 0,"key"),this.iHash=$.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let J=this.blockLen,Q=new Uint8Array(J);Q.set(q.length>J?$.create().update(q).digest():q);for(let G=0;G<Q.length;G++)Q[G]^=54;this.iHash.update(Q),this.oHash=$.create();for(let G=0;G<Q.length;G++)Q[G]^=106;this.oHash.update(Q),M8(Q)}update($){return j8(this),this.iHash.update($),this}digestInto($){j8(this),c($,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto($),this.oHash.update($),this.oHash.digestInto($),this.destroy()}digest(){let $=new Uint8Array(this.oHash.outputLen);return this.digestInto($),$}_cloneInto($){$||=Object.create(Object.getPrototypeOf(this),{});let{oHash:q,iHash:J,finished:Q,destroyed:G,blockLen:X,outputLen:U}=this;return $=$,$.finished=Q,$.destroyed=G,$.blockLen=X,$.outputLen=U,$.oHash=q._cloneInto($.oHash),$.iHash=J._cloneInto($.iHash),$}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var q$=($,q,J)=>new i$($,q).update(J).digest();q$.create=($,q)=>new i$($,q);function b1($,q,J){if(Z0($),J===void 0)J=new Uint8Array($.outputLen);return q$($,J,q)}var r$=Uint8Array.of(0),mJ=Uint8Array.of();function h1($,q,J,Q=32){Z0($),z8(Q,"length");let G=$.outputLen;if(Q>255*G)throw new Error("Length must be <= 255*HashLen");let X=Math.ceil(Q/G);if(J===void 0)J=mJ;else c(J,void 0,"info");let U=new Uint8Array(X*G),Z=q$.create($,q),Y=Z._cloneInto(),K=new Uint8Array(Z.outputLen);for(let W=0;W<X;W++)r$[0]=W+1,Y.update(W===0?mJ:K).update(J).update(r$).digestInto(K),U.set(K,G*W),Z._cloneInto(Y);return Z.destroy(),Y.destroy(),M8(K,r$),U.slice(0,Q)}var O8=($,q,J,Q,G)=>h1($,b1($,q,J),Q,G);var hJ=Dq(j$(),1),gJ="weba_l2_ed25519_sk";function W8($){if(typeof Buffer!=="undefined")return Buffer.from($).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");let q="";return $.forEach((Q)=>{q+=String.fromCharCode(Q)}),btoa(q).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function J8($){let q=$.length%4===0?"":"=".repeat(4-$.length%4),J=$.replace(/-/g,"+").replace(/_/g,"/")+q;if(typeof Buffer!=="undefined")return new Uint8Array(Buffer.from(J,"base64"));let Q=atob(J),G=new Uint8Array(Q.length);for(let X=0;X<Q.length;X+=1)G[X]=Q.charCodeAt(X);return G}function J$($){let q=hJ.default($);if(q===void 0)throw new Error("Failed to canonicalize JSON");return q}function bJ($){let q=new Uint8Array($);return crypto.getRandomValues(q),q}function p1(){let $=localStorage.getItem(gJ);if($)return J8($);let q=g8.utils.randomSecretKey();return localStorage.setItem(gJ,W8(q)),q}function c1($,q,J){let Q={layer1_ref:$,recipient:q,weba_version:J};return new TextEncoder().encode(J$(Q))}function pJ($,q){let J=new Uint8Array($.length+q.length);return J.set($,0),J.set(q,$.length),J}function cJ($){let q=new TextEncoder().encode("weba-l2/user-x25519"),J=O8(N8,$,void 0,q,32);return{publicKey:z0.getPublicKey(J),privateKey:J}}function uJ(){return globalThis.webaPqcKem||null}async function dJ($,q,J,Q){let G=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["encrypt"]),X=await crypto.subtle.encrypt({name:"AES-GCM",iv:J,additionalData:Q},G,$);return new Uint8Array(X)}async function lJ($){let q=O8(N8,$.prfKey,void 0,void 0,32),J=O8(N8,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=O8(N8,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),G=$.aad??new Uint8Array;return dJ($.recipientSk,J,Q,G)}async function nJ($,q,J,Q){let G=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["decrypt"]),X=await crypto.subtle.decrypt({name:"AES-GCM",iv:J,additionalData:Q},G,$);return new Uint8Array(X)}async function iJ($){let q=$.config.weba_version??"0.1",J=$.config.recipient_kid,Q=$.config.layer1_ref,G=$.user_kid??"user#sig-1",X=p1(),U=J$($.layer2_plain),Z=new TextEncoder().encode(U),Y=g8.sign(Z,X),K={alg:"Ed25519",kid:G,sig:W8(Y),created_at:new Date().toISOString()},W={layer2_plain:$.layer2_plain,layer2_sig:K},O=c1(Q,J,q),E=new TextEncoder().encode(J$(W)),H=J8($.config.recipient_x25519),w=bJ(32),k=z0.getPublicKey(w),I=z0.getSharedSecret(w,H),P=I,R,C="X25519";if($.config.recipient_pqc){let V=$.pqcProvider??uJ();if(!V)throw new Error("PQC requested but no provider is available");let j=J8($.config.recipient_pqc),x=V.encapsulate(j);R=x.encapsulation,P=pJ(I,x.sharedSecret),C=`X25519+${V.kemId}`}let f=O8(N8,P,O,void 0,32),F=O8(N8,f,void 0,new TextEncoder().encode("weba-l2/key"),32),_=O8(N8,f,void 0,new TextEncoder().encode("weba-l2/iv"),12),y=await dJ(E,F,_,O);return{weba_version:q,layer1_ref:Q,layer2:{enc:"HPKE-v1",suite:{kem:C,kdf:"HKDF-SHA256",aead:"AES-256-GCM"},recipient:J,encapsulated:{classical:W8(k),...R?{pqc:W8(R)}:{}},ciphertext:W8(y),aad:W8(O)},meta:{created_at:new Date().toISOString(),nonce:W8(bJ(16)),...$.config.campaign_id?{campaign_id:$.config.campaign_id}:{},...$.config.key_policy?{key_policy:$.config.key_policy}:{}}}}function rJ(){let $=document.getElementById("weba-l2-config");if(!$||!$.textContent)return null;try{return JSON.parse($.textContent)}catch{return null}}async function Q$($,q,J){let Q=J8($.layer2.aad),G={layer1_ref:$.layer1_ref,recipient:$.layer2.recipient,weba_version:$.weba_version},X=new TextEncoder().encode(J$(G));if(W8(X)!==$.layer2.aad)throw new Error("AAD mismatch");let U=J8($.layer2.encapsulated.classical),Z=z0.getSharedSecret(q,U),Y=Z;if($.layer2.encapsulated.pqc){let w=J?.pqcProvider??uJ(),k=J?.pqcRecipientSk;if(!w||!k)throw new Error("Missing PQC KEM for envelope");let I=J8($.layer2.encapsulated.pqc),P=w.decapsulate(k,I);Y=pJ(Z,P)}let K=O8(N8,Y,Q,void 0,32),W=O8(N8,K,void 0,new TextEncoder().encode("weba-l2/key"),32),O=O8(N8,K,void 0,new TextEncoder().encode("weba-l2/iv"),12),E=J8($.layer2.ciphertext),H=await nJ(E,W,O,Q);return JSON.parse(new TextDecoder().decode(H))}async function oJ($){let q=O8(N8,$.prfKey,void 0,void 0,32),J=O8(N8,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=O8(N8,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),G=$.keywrap.aad?J8($.keywrap.aad):new Uint8Array,X=J8($.keywrap.wrapped_key);return nJ(X,J,Q,G)}function u1($){$.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox"||J.type==="radio")J.checked=!1,J.removeAttribute("checked");else J.value="",J.removeAttribute("value")}),$.querySelectorAll("textarea").forEach((J)=>{J.value="",J.textContent=""}),$.querySelectorAll("select").forEach((J)=>{J.selectedIndex=-1,J.querySelectorAll("option").forEach((Q)=>Q.removeAttribute("selected"))}),$.getElementById("json-ld")?.remove(),$.getElementById("data-layer")?.remove();let q=$.getElementById("json-debug");if(q)q.textContent=""}function d1($,q){let J=JSON.stringify(q,null,2),Q=$.createElement("script");Q.type="application/ld+json",Q.id="weba-user-vc",Q.textContent=J,$.body.appendChild(Q);let G=$.createElement("div");G.className="weba-user-verification no-print",G.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",G.innerHTML=`
    <details>
      <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
        <span></span> 
      </summary>
      <div style="padding: 1rem 0;">
        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
      </div>
    </details>
  `;let X=G.querySelector("pre");if(X)X.textContent=J;$.body.appendChild(G)}function l1($,q){let J=$.createElement("script");J.id="weba-l2-envelope",J.type="application/json",J.textContent=JSON.stringify(q,null,2),$.body.appendChild(J)}function n1($,q){let J=new Date,Q=J.getFullYear()+("0"+(J.getMonth()+1)).slice(-2)+("0"+J.getDate()).slice(-2)+"-"+("0"+J.getHours()).slice(-2)+("0"+J.getMinutes()).slice(-2),G=Math.random().toString(36).substring(2,8);return`${$}_${Q}_${q}_${G}.html`}function i1($,q){let Q=new DOMParser().parseFromString($,"text/html");if(q?.stripPlaintext)u1(Q);if(q?.embeddedVc)d1(Q,q.embeddedVc);if(q?.l2Envelope)l1(Q,q.l2Envelope);return Q.documentElement.outerHTML}function aJ($){let q=i1($.documentHtml,$.options),J=new Blob([q],{type:"text/html"}),Q=URL.createObjectURL(J),G=document.createElement("a");if(G.href=Q,G.download=n1($.title,$.filenameSuffix),G.click(),$.isFinal)setTimeout(()=>window.location.reload(),1000)}class o${formId;constructor(){this.formId="WebA_"+window.location.pathname}updateJsonLd(){let q=window.generatedJsonStructure||{};document.querySelectorAll("[data-json-path]").forEach((G)=>{let X=G.dataset.jsonPath;if(X)q[X]=G.value}),document.querySelectorAll('[type="radio"]:checked').forEach((G)=>{q[G.name]=G.value}),document.querySelectorAll("table.data-table.dynamic").forEach((G)=>{let X=G.dataset.tableKey;if(X){let U=[];G.querySelectorAll("tbody tr").forEach((Z)=>{let Y={},K=!1;if(Z.querySelectorAll("[data-base-key]").forEach((W)=>{if(W.type==="checkbox"){if(Y[W.dataset.baseKey]=W.checked,W.checked)K=!0}else if(Y[W.dataset.baseKey]=W.value,W.value)K=!0}),K)U.push(Y)}),q[X]=U}});let J=document.getElementById("json-ld");if(J)J.textContent=JSON.stringify(q,null,2);let Q=document.getElementById("json-debug");if(Q)Q.textContent=JSON.stringify(q,null,2);return q}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=this.updateJsonLd(),q=window,J=q.generatedJsonStructure&&q.generatedJsonStructure.name||"Response",Q=window.location.href.split("#")[0],G=this.getL2Config(),X=document.getElementById("weba-l2-encrypt");if(!!(G?.enabled&&(X?X.checked:G.default_enabled))){if(!G?.recipient_kid||!G?.recipient_x25519||!G?.layer1_ref){alert("L2 encryption config is missing required fields.");return}try{let Y=await iJ({layer2_plain:$,config:G,user_kid:G.user_kid});this.downloadHtml("submit",!0,{l2Envelope:Y,stripPlaintext:!0})}catch(Y){console.error(Y),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!X0.getPublicKey()){if(!await X0.register()){alert("Key registration failed.");return}}let Z={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:X0.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:Q,answers:$}};try{let Y=await X0.sign(Z);this.downloadHtml("submitted",!0,{embeddedVc:Y})}catch(Y){console.error(Y),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let q=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((J)=>{let Q=J.dataset.jsonPath;if(q[Q]!==void 0)J.value=q[Q]}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let Q=J.dataset.tableKey,G=q[Q];if(Array.isArray(G)){let X=J.querySelector("tbody");if(!X)return;let U=X.querySelectorAll(".template-row");G.forEach((Z,Y)=>{let K;if(Y===0)K=X.querySelector(".template-row");else{let W=X.querySelector(".template-row");if(W){K=W.cloneNode(!0),K.classList.remove("template-row");let O=K.querySelector(".remove-row-btn");if(O)O.style.visibility="visible";X.appendChild(K)}}if(K)K.querySelectorAll("input, select").forEach((W)=>{let O=W.dataset.baseKey;if(O&&Z[O]!==void 0)if(W.type==="checkbox")W.checked=!!Z[O];else W.value=Z[O]})})}})}catch(q){console.error(q)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,q,J){let Q=window,G=Q.generatedJsonStructure&&Q.generatedJsonStructure.name||"web-a-form";aJ({documentHtml:document.documentElement.outerHTML,title:G,filenameSuffix:$,isFinal:q,options:J})}saveDraft(){this.bakeValues(),this.downloadHtml("draft",!1)}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class a${calc;data;constructor($,q){this.calc=$,this.data=q}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save Progress",clear_btn:"Clear Data",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},q=(navigator.language||"en").startsWith("ja")?"ja":"en",J=$[q]||$.en;document.querySelectorAll("[data-i18n]").forEach((Q)=>{let G=Q.dataset.i18n;if(J[G])Q.textContent=J[G]})}initTables(){document.querySelectorAll(".data-table.dynamic tbody").forEach(($)=>{this.renumberRows($)})}renumberRows($){Array.from($.querySelectorAll("tr")).filter((J)=>{return J.querySelectorAll("td").length>0}).forEach((J,Q)=>{let G=Q+1;J.querySelectorAll(".auto-num").forEach((X)=>{if(X.value!=G)X.value=G.toString(),X.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let q=$.closest("tr"),J=q.parentElement;if(q.classList.contains("template-row"))q.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox")Q.checked=!1;else Q.value=""});else{if(q.remove(),J)this.renumberRows(J);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,q){let J=document.getElementById("tbl_"+q);if(!J)return;let Q=J.querySelector("tbody");if(!Q)return;let G=Q.querySelector(".template-row");if(!G)return;let X=G.cloneNode(!0);X.classList.remove("template-row"),X.querySelectorAll("input").forEach((Z)=>{if(Z.type==="checkbox")Z.checked=Z.hasAttribute("checked");else Z.value=Z.getAttribute("value")||""});let U=X.querySelector(".remove-row-btn");if(U)U.style.visibility="visible";X.querySelectorAll("[data-copy-from]").forEach((Z)=>{let Y=Z.dataset.copyFrom;if(Y){let K=X.querySelector(`[data-base-key="${Y}"]`);if(K&&K.value)Z.value=K.value}}),Q.appendChild(X),this.renumberRows(Q),this.calc.recalculate()}switchTab($,q){document.querySelectorAll(".tab-btn").forEach((Q)=>Q.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((Q)=>Q.classList.remove("active")),$.classList.add("active");let J=document.getElementById(q);if(J)J.classList.add("active")}}function sJ($){let q=document.getElementById($);if(!q||!q.textContent)return null;try{return JSON.parse(q.textContent)}catch{return null}}function tJ(){let $=sJ("weba-l2-envelope");if(!$)return;let q=sJ("weba-l2-keywrap"),J=document.querySelector(".weba-form-container")||document.body,Q=document.createElement("div");Q.className="weba-l2-unlock",Q.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #cbd5f5;border-radius:10px;background:#f8fafc;";let G=document.createElement("div");G.textContent="Encrypted Submission",G.style.cssText="font-weight:600;color:#334155;margin-bottom:0.5rem;",Q.appendChild(G);let X=document.createElement("div");X.textContent="Locked. Unlock with Passkey.",X.style.cssText="color:#64748b;margin-bottom:0.75rem;",Q.appendChild(X);let U=document.createElement("button");U.textContent="Unlock (Passkey)",U.style.cssText="padding:0.5rem 1rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;",Q.appendChild(U);let Z=document.createElement("pre");Z.style.cssText="margin-top:1rem;padding:1rem;background:#0f172a;color:#e2e8f0;border-radius:8px;overflow:auto;font-size:0.85rem;display:none;",Q.appendChild(Z);let Y=document.createElement("details");Y.style.cssText="margin-top:0.75rem; display:none;",Y.innerHTML='<summary style="cursor:pointer;color:#64748b;">Show signature</summary><pre style="margin-top:0.5rem;padding:0.75rem;background:#0b1220;color:#cbd5f5;border-radius:6px;overflow:auto;font-size:0.8rem;"></pre>',Q.appendChild(Y);let K=document.createElement("button");K.textContent="Export JSON",K.style.cssText="margin-top:0.75rem;padding:0.45rem 0.9rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;display:none;",K.disabled=!0,Q.appendChild(K),U.addEventListener("click",async()=>{if(!q){X.textContent="Key wrap package not found.";return}U.disabled=!0,X.textContent="Waiting for passkey...";try{let W=J8(q.prf_salt),O=await $$(q.credential_id,W),E=await oJ({keywrap:q,prfKey:O}),H=await Q$($,E);r1(H.layer2_plain),document.body.classList.add("weba-l2-readonly"),Z.textContent=JSON.stringify(H.layer2_plain,null,2),Z.style.display="block";let w=Y.querySelector("pre");if(w)w.textContent=JSON.stringify(H.layer2_sig,null,2);Y.style.display="block",K.style.display="inline-block",K.disabled=!1,X.textContent="Unlocked.",K.onclick=()=>{let k=new Blob([JSON.stringify(H,null,2)],{type:"application/json"}),I=URL.createObjectURL(k),P=document.createElement("a");P.href=I,P.download="weba-l2-decrypted.json",P.click()}}catch(W){console.error(W),X.textContent="Unlock failed.",U.disabled=!1}}),J.appendChild(Q)}function r1($){if(!$||typeof $!=="object")return;let q=$;document.querySelectorAll("[data-json-path]").forEach((J)=>{let Q=J.dataset.jsonPath;if(!Q||!(Q in q))return;let G=q[Q];if(J.type==="checkbox")J.checked=Boolean(G);else if(J.type==="radio")J.checked=J.value===String(G);else J.value=G===null||G===void 0?"":String(G)}),document.querySelectorAll('input[type="radio"]').forEach((J)=>{let Q=J.name;if(!Q||!(Q in q))return;let G=q[Q];J.checked=J.value===String(G)}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let Q=J.dataset.tableKey;if(!Q)return;let G=q[Q];if(!Array.isArray(G))return;let X=J.querySelector("tbody");if(!X)return;let U=X.querySelector("tr.template-row");if(!U)return;Array.from(X.querySelectorAll("tr")).forEach((Z)=>{if(!Z.classList.contains("template-row"))Z.remove()}),G.forEach((Z,Y)=>{let K=Y===0?U:U.cloneNode(!0);if(Y>0){K.classList.remove("template-row");let W=K.querySelector(".remove-row-btn");if(W)W.style.visibility="visible";X.appendChild(K)}if(Z&&typeof Z==="object")K.querySelectorAll("input, select, textarea").forEach((W)=>{let O=W.dataset.baseKey;if(!O)return;let E=Z[O];if(W.type==="checkbox")W.checked=Boolean(E);else W.value=E===null||E===void 0?"":String(E)})})}),document.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox"||J.type==="radio")J.disabled=!0;else J.readOnly=!0}),document.querySelectorAll("textarea").forEach((J)=>{J.readOnly=!0}),document.querySelectorAll("select").forEach((J)=>{J.disabled=!0}),document.querySelectorAll(".form-toolbar button, .add-row-btn, .remove-row-btn").forEach((J)=>{J.disabled=!0})}function V8($){return document.getElementById($)}function eJ(){if(!V8("weba-l2-keywrap-tool"))return;let q=V8("kwp-recipient-sk"),J=V8("kwp-credential-id"),Q=V8("kwp-prf-salt"),G=V8("kwp-aad"),X=V8("kwp-kid"),U=V8("kwp-status"),Z=V8("kwp-output"),Y=V8("kwp-generate-salt"),K=V8("kwp-wrap");if(!q||!J||!Q||!U||!Z||!K)return;Y?.addEventListener("click",()=>{let W=new Uint8Array(32);crypto.getRandomValues(W),Q.value=W8(W)}),K.addEventListener("click",async()=>{U.textContent="Waiting for passkey...",K.disabled=!0;try{if(!q.value||!J.value||!Q.value)throw new Error("Missing required fields.");let W=J8(q.value.trim()),O=J8(Q.value.trim()),E=await $$(J.value.trim(),O),H=G?.value?J8(G.value.trim()):void 0,w=await lJ({recipientSk:W,prfKey:E,aad:H}),k={alg:"WebAuthn-PRF-AESGCM-v1",kid:X?.value||"issuer#passkey-1",credential_id:J.value.trim(),prf_salt:W8(O),wrapped_key:W8(w),...H?{aad:W8(H)}:{}};Z.textContent=JSON.stringify(k,null,2),U.textContent="Key wrap ready."}catch(W){console.error(W),U.textContent="Key wrap failed."}finally{K.disabled=!1}})}function $Q($){if(typeof DOMParser!=="undefined")return new DOMParser().parseFromString($,"text/html");if(typeof document!=="undefined"){let q=document.implementation.createHTMLDocument("");return q.documentElement.innerHTML=$,q}return null}function qQ($,q){let J=$Q($);if(J)return J.getElementById(q)?.textContent??null;let Q=new RegExp(`<script[^>]*id=["']${q}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),G=$.match(Q);return G?G[1]:null}function o1($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function a1($,q){let J=$Q($);if(J)return J.querySelector(`script[type="${q}"]`)?.textContent??null;let Q=new RegExp(`<script[^>]*type=["']${o1(q)}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),G=$.match(Q);return G?G[1]:null}function JQ($){let q=qQ($,"data-layer");if(q)try{return JSON.parse(q)}catch{return null}let J=a1($,"application/ld+json");if(J)try{return JSON.parse(J)}catch{return null}return null}function QQ($){let q=qQ($,"weba-l2-envelope");if(!q)return null;try{return JSON.parse(q)}catch{return null}}function s1($){let q={},J=(Q,G)=>{if(Q===null||Q===void 0){q[G]=null;return}if(Array.isArray(Q)){Q.forEach((X,U)=>{J(X,G?`${G}[${U}]`:`[${U}]`)});return}if(typeof Q==="object"){Object.entries(Q).forEach(([X,U])=>{let Z=G?`${G}.${X}`:X;J(U,Z)});return}q[G]=Q};if(J($,""),""in q)delete q[""];return q}function s$($){let q={_filename:$.filename},J=new Set(["_filename"]);if($.includeJson)J.add("_json"),q._json=JSON.stringify($.plain);let Q=s1($.plain||{});for(let G of Object.keys(Q)){if($.omitKey&&$.omitKey(G))continue;J.add(G),q[G]=Q[G]}if($.sig)J.add("_l2_sig"),q._l2_sig=JSON.stringify($.sig);return{row:q,keys:J}}function GQ($){if($===null||$===void 0)return"";let q=String($);if(/[",\n]/.test(q))return`"${q.replace(/"/g,'""')}"`;return q}function XQ($,q){let J=[];return J.push(q.map(GQ).join(",")),$.forEach((Q)=>{let G=q.map((X)=>GQ(Q[X])).join(",");J.push(G)}),"\uFEFF"+J.join(`
`)}function t1($,q){let J=q.trim().replace(/^\$\./,"");if(!J)return[];let Q=J.split("."),G=[$];for(let X of Q){let U=X.match(/^(.*)\[(\d*)\]$/),Z=U?U[1]:X,Y=U?U[2]:null,K=U&&Y==="",W=U&&Y!==""&&Y!==null?parseInt(Y,10):null,O=[];for(let E of G){if(E===null||E===void 0)continue;let H=Z?E[Z]:E;if(K){if(Array.isArray(H))O.push(...H);continue}if(W!==null){if(Array.isArray(H)&&H[W]!==void 0)O.push(H[W]);continue}if(H!==void 0)O.push(H)}G=O}return G}function e1($,q){let J=[];switch(q.forEach((Q)=>{let G=t1(Q.plain,$.path);J.push(...G)}),$.type){case"count":return J.length;case"sum":return J.reduce((Q,G)=>Q+(Number(G)||0),0);case"avg":return J.length?J.reduce((Q,G)=>Q+(Number(G)||0),0)/J.length:0;case"boolean_count":return J.filter((Q)=>!!Q).length;case"percent":{let Q=J.filter((G)=>!!G).length;return J.length?`${(Q/J.length*100).toFixed(1)}%`:"0%"}default:return 0}}function $9($,q,J){if(!q?.metrics||q.metrics.length===0){$.innerHTML="";return}let Q=q.metrics.map((G)=>{let X=e1(G,J);return`
      <div class="metric-card">
        <label>${G.name}</label>
        <div class="value">${X}</div>
      </div>
    `}).join("");$.innerHTML=`<div class="dashboard-grid">${Q}</div>`}function q9($,q,J){if(q.length===0){$.innerHTML=`<div class="agg-empty-state">
      <div class="icon">\uD83D\uDCC2</div>
      <p>No records found. Please upload HTML files and click "Run Aggregation".</p>
    </div>`;return}let Q=J.map((X)=>`<th>${X}</th>`).join(""),G=q.map((X,U)=>{let Z=J.map((Y)=>`<td>${X[Y]??""}</td>`).join("");return`<tr onclick="window.showRecordDetail(${U})">${Z}</tr>`}).join("");$.innerHTML=`
    <div class="agg-section-header">
      <h3>\uD83D\uDCCB Extracted Records</h3>
      <span class="count-badge">${q.length} records</span>
    </div>
    <div class="agg-table-container">
      <table class="agg-table">
        <thead><tr>${Q}</tr></thead>
        <tbody>${G}</tbody>
      </table>
    </div>
  `,window._aggRows=q}function J9($){let q=window._aggRows;if(!q||!q[$])return;let J=q[$],Q=document.getElementById("weba-agg-detail");if(!Q)return;let G=J._raw||{},X="",U=(O)=>{if(O===null||O===void 0)return'<span class="val-null">N/A</span>';if(typeof O==="boolean")return`<span class="val-bool ${O}">${O?"Yes":"No"}</span>`;if(Array.isArray(O))return`<div class="val-array">${O.map((E)=>`<div class="array-item">${typeof E==="object"?JSON.stringify(E):E}</div>`).join("")}</div>`;if(typeof O==="object")return`<pre class="val-json">${JSON.stringify(O,null,2)}</pre>`;return`<span class="val-text">${O}</span>`},Z=(O,E="")=>{for(let H in O){if(H==="_raw"||H==="_sig"||H.startsWith("@"))continue;let w=O[H],k=E?`${E}  ${H}`:H;if(typeof w==="object"&&w!==null&&!Array.isArray(w))X+=`<div class="detail-group-header">${k}</div>`,Z(w,k);else X+=`
          <div class="detail-row">
            <div class="detail-key">${H}</div>
            <div class="detail-val-box">${U(w)}</div>
          </div>
        `}};Z(G),Q.innerHTML=`
    <div class="detail-overlay" id="weba-detail-overlay">
      <div class="detail-modal">
        <div class="detail-modal-header">
          <div class="header-info">
            <span class="file-icon">\uD83D\uDCC4</span>
            <div class="text">
              <h3>Record Details</h3>
              <p>${J._filename||"Standalone Record"}</p>
            </div>
          </div>
          <button class="close-btn" id="weba-detail-close"></button>
        </div>
        <div class="detail-modal-body">
          <div class="form-view">
            ${X}
          </div>
          <details class="raw-data-section">
            <summary>View Raw Source Data (JSON)</summary>
            <pre>${JSON.stringify(G,null,2)}</pre>
            ${J._sig?`<h4>Signature</h4><pre>${JSON.stringify(J._sig,null,2)}</pre>`:""}
          </details>
        </div>
      </div>
    </div>
  `,document.body.style.overflow="hidden";let Y=document.getElementById("weba-detail-overlay"),K=document.getElementById("weba-detail-close"),W=()=>{if(Q)Q.innerHTML="";document.body.style.overflow=""};Y?.addEventListener("click",(O)=>{if(O.stopPropagation(),O.target===Y)W()}),K?.addEventListener("click",(O)=>{O.stopPropagation(),W()})}window.showRecordDetail=J9;function Q9(){let $=document.getElementById("weba-l2-key");if(!$)return null;try{return JSON.parse($.textContent)}catch{return null}}function G9(){let $=document.getElementById("weba-agg-spec");if(!$)return null;try{return JSON.parse($.textContent)}catch{return null}}async function X9($,q){let J=QQ($);if(J){if(!q)return{source:"l2",plain:null};try{let G=null;if(q.recipient_x25519_private)G=J8(q.recipient_x25519_private);if(!G&&q.org_root_key);if(G){let X=await Q$(J,G);return{source:"l2",plain:X.layer2_plain,sig:X.layer2_sig}}}catch(G){console.warn("L2 decryption failed",G)}}let Q=JQ($);if(Q)return{source:"jsonld",plain:Q.credentialSubject?.answers||Q};return{source:"unknown",plain:null}}function UQ(){let $=document.getElementById("aggregator-root");if(!$)return;$.innerHTML=`
    <div class="agg-layout">
      <aside class="agg-sidebar">
        <div class="agg-brand">
          <div class="brand-logo">Agg</div>
          <h1>Web/A Aggregator</h1>
        </div>
        
        <div class="agg-config-card">
          <div class="card-header">1. Data Source</div>
          <div class="agg-form-field">
            <label>Upload HTML Forms</label>
            <input id="weba-agg-files" type="file" accept=".html" multiple />
            <p class="field-hint">Select multiple submitted form files.</p>
          </div>
          
          <div class="agg-form-field">
            <label>Decryption Method</label>
            <div id="weba-agg-key-status" class="agg-status-chip">No keys detected</div>
            <div class="btn-group">
               <button id="weba-agg-passkey" class="agg-btn-small outline">\uD83D\uDD11 Use Passkey</button>
            </div>
            <p class="field-hint">Encryption is used for Layer 2 security.</p>
          </div>

          <div class="agg-form-field-row">
            <input id="weba-agg-include-json" type="checkbox" />
            <label for="weba-agg-include-json">Include JSON column in table</label>
          </div>
        </div>

        <div class="agg-actions-card">
           <button id="weba-agg-run" class="agg-btn-primary"> Run Aggregation</button>
           <div class="btn-grid">
             <button id="weba-agg-download" class="agg-btn-secondary" disabled>\uD83D\uDCE5 CSV</button>
             <button id="weba-agg-download-jsonl" class="agg-btn-secondary" disabled>\uD83D\uDCE5 JSONL</button>
           </div>
           <button id="weba-agg-clear" class="agg-btn-text">\uD83D\uDDD1 Clear Data</button>
           <div id="weba-agg-status" class="agg-status-message">Ready.</div>
        </div>
      </aside>

      <main class="agg-main">
        <div id="weba-agg-dashboard" class="agg-dashboard"></div>
        <div id="weba-agg-output" class="agg-output"></div>
      </main>
    </div>
    
    <div id="weba-agg-detail"></div>

    <style>
      :root {
        --agg-primary: #2563eb;
        --agg-bg: #f8fafc;
        --agg-card-bg: #ffffff;
        --agg-text: #1e293b;
        --agg-text-dim: #64748b;
        --agg-border: #e2e8f0;
      }

      .agg-layout { display: flex; min-height: 80vh; gap: 24px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; color: var(--agg-text); }
      .agg-sidebar { width: 320px; flex-shrink: 0; display: flex; flex-direction: column; gap: 20px; }
      .agg-main { flex: 1; display: flex; flex-direction: column; gap: 24px; }

      .agg-brand { padding: 12px 0; display: flex; align-items: center; gap: 12px; }
      .brand-logo { background: var(--agg-primary); color: white; width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; }
      .agg-brand h1 { font-size: 1.25rem; font-weight: 700; margin: 0; }

      .agg-config-card, .agg-actions-card { background: var(--agg-card-bg); border: 1px solid var(--agg-border); border-radius: 12px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
      .card-header { font-size: 0.85rem; font-weight: 600; text-transform: uppercase; color: var(--agg-text-dim); margin-bottom: 16px; border-bottom: 1px solid var(--agg-border); padding-bottom: 8px; }

      .agg-form-field { margin-bottom: 16px; }
      .agg-form-field label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 6px; }
      .agg-form-field input[type="file"] { width: 100%; font-size: 0.85rem; }
      .field-hint { font-size: 0.75rem; color: var(--agg-text-dim); margin: 4px 0 0; }

      .agg-form-field-row { display: flex; align-items: center; gap: 8px; margin-top: 12px; }
      .agg-form-field-row label { font-size: 0.85rem; cursor: pointer; }

      .agg-status-chip { background: #f1f5f9; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; color: var(--agg-text-dim); display: inline-block; margin-bottom: 8px; }
      .agg-status-chip.ready { background: #dcfce7; color: #166534; }

      .btn-group { display: flex; gap: 8px; }
      .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
      
      .agg-btn-primary { background: var(--agg-primary); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; margin-bottom: 12px; transition: opacity 0.2s; }
      .agg-btn-primary:active { opacity: 0.8; }
      
      .agg-btn-secondary { background: white; border: 1px solid var(--agg-border); color: var(--agg-text); padding: 8px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; }
      .agg-btn-secondary:disabled { opacity: 0.5; cursor: not-allowed; }
      
      .agg-btn-small { padding: 4px 12px; border-radius: 6px; font-size: 0.8rem; cursor: pointer; }
      .agg-btn-small.outline { background: white; border: 1px solid var(--agg-primary); color: var(--agg-primary); }

      .agg-btn-text { background: none; border: none; color: #ef4444; font-size: 0.85rem; padding: 8px; cursor: pointer; width: 100%; margin-top: 12px; }

      .agg-status-message { font-size: 0.85rem; color: var(--agg-text-dim); text-align: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--agg-border); }

      /* Dashboard */
      .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 16px; }
      .metric-card { background: white; border: 1px solid var(--agg-border); border-radius: 12px; padding: 16px; display: flex; flex-direction: column; gap: 4px; border-left: 4px solid var(--agg-primary); }
      .metric-card label { font-size: 0.75rem; color: var(--agg-text-dim); font-weight: 600; text-transform: uppercase; }
      .metric-card .value { font-size: 1.5rem; font-weight: 700; color: var(--agg-text); }

      /* Results Styling */
      .agg-section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
      .count-badge { background: var(--agg-primary); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; }

      .agg-table-container { background: white; border: 1px solid var(--agg-border); border-radius: 12px; overflow: auto; box-shadow: 0 1px 3px rgba(0,0,0,0.05); max-height: 500px; }
      .agg-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; text-align: left; }
      .agg-table th { background: #f8fafc; padding: 12px; border-bottom: 1px solid var(--agg-border); font-weight: 600; color: var(--agg-text-dim); position: sticky; top: 0; }
      .agg-table td { padding: 12px; border-bottom: 1px solid var(--agg-border); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }
      .agg-table tr:hover { background: #f1f5f9; cursor: pointer; }

      .agg-empty-state { text-align: center; padding: 48px; color: var(--agg-text-dim); background: white; border: 2px dashed var(--agg-border); border-radius: 12px; }
      .agg-empty-state .icon { font-size: 2rem; margin-bottom: 12px; }

      /* Detail Modal Overhaul */
      .detail-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.75); backdrop-filter: blur(4px); display: flex; align-items: flex-end; justify-content: center; z-index: 10000; }
      @media (min-width: 768px) { .detail-overlay { align-items: center; } }

      .detail-modal { background: white; width: 100%; max-width: 720px; border-radius: 20px 20px 0 0; display: flex; flex-direction: column; max-height: 94vh; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); animation: slideUp 0.3s ease-out; }
      @media (min-width: 768px) { .detail-modal { border-radius: 16px; max-height: 85vh; } }
      
      @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

      .detail-modal-header { padding: 16px 24px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
      .header-info { display: flex; gap: 12px; align-items: center; }
      .file-icon { font-size: 1.5rem; }
      .header-info h3 { margin: 0; font-size: 1.1rem; }
      .header-info p { margin: 0; font-size: 0.8rem; color: var(--agg-text-dim); }
      .close-btn { border: none; background: #f1f5f9; width: 32px; height: 32px; border-radius: 50%; font-size: 1rem; cursor: pointer; color: #64748b; }

      .detail-modal-body { padding: 24px; overflow-y: auto; flex: 1; }
      
      .form-view { display: flex; flex-direction: column; gap: 16px; }
      .detail-group-header { font-size: 0.8rem; font-weight: 700; color: var(--agg-primary); text-transform: uppercase; background: #eff6ff; padding: 4px 12px; border-radius: 4px; margin-top: 12px; }
      
      .detail-row { display: grid; grid-template-columns: 140px 1fr; gap: 16px; border-bottom: 1px solid #f1f5f9; padding-bottom: 12px; align-items: flex-start; }
      .detail-key { font-size: 0.85rem; font-weight: 600; color: #64748b; padding-top: 2px; }
      
      .val-null { color: #cbd5e1; font-family: monospace; }
      .val-bool.true { color: #16a34a; font-weight: bold; }
      .val-bool.false { color: #dc2626; font-weight: bold; }
      .val-text { line-height: 1.5; color: #0f172a; }
      .val-json { font-size: 0.8rem; background: #f8fafc; padding: 8px; border-radius: 6px; border: 1px solid #e2e8f0; margin: 0; }
      
      .raw-data-section { margin-top: 32px; border-top: 1px solid #e2e8f0; padding-top: 20px; }
      .raw-data-section summary { font-size: 0.85rem; font-weight: 600; cursor: pointer; color: var(--agg-text-dim); }
      .raw-data-section pre { margin-top: 12px; font-size: 0.75rem; background: #1e293b; color: #e2e8f0; padding: 12px; border-radius: 8px; overflow-x: auto; }
    </style>
  `;let q=$.querySelector("#weba-agg-files"),J=$.querySelector("#weba-agg-status"),Q=$.querySelector("#weba-agg-output"),G=$.querySelector("#weba-agg-dashboard"),X=$.querySelector("#weba-agg-include-json"),U=$.querySelector("#weba-agg-run"),Z=$.querySelector("#weba-agg-download"),Y=$.querySelector("#weba-agg-download-jsonl"),K=$.querySelector("#weba-agg-key-status"),W=$.querySelector("#weba-agg-passkey"),O=$.querySelector("#weba-agg-clear"),E="",H="",w=[],k=null,I=Q9(),P=G9(),R=Array.isArray(P?.samples)?P.samples.map((f,F)=>({filename:`sample-${F+1}.json`,plain:f})):[];if(K)K.textContent=I?.recipient_kid?`Loaded (${I.recipient_kid})`:I?"Loaded":"No keys detected",K.classList.toggle("ready",!!I);if(P?.export?.jsonl===!1&&Y)Y.disabled=!0;W?.addEventListener("click",async()=>{try{if(!prompt("User Name for Passkey:","demo-user"))return;alert("Please authenticate with your Passkey to decrypt.");let F=new Uint8Array(32),_=new Uint8Array(32),y=await navigator.credentials.get({publicKey:{challenge:F,userVerification:"required",extensions:{prf:{eval:{first:_}}}}});if(!y)throw new Error("No credential found.");let j=y.getClientExtensionResults()?.prf?.results?.first;if(!j)throw new Error("PRF not supported or enabled on this key.");let x=new Uint8Array(j),g=cJ(x);if(k={recipient_x25519_private:W8(g.privateKey)},W.textContent=" Passkey Active",W.disabled=!0,K)K.textContent="Passkey Enabled",K.classList.add("ready")}catch(f){console.error(f),alert("Passkey error: "+f.message)}});let C=async()=>{let f=!!(q?.files&&q.files.length>0);if(!f&&R.length===0){if(J)J.textContent="Select HTML files first.";return}if(J)J.textContent="Processing...";if(Z)Z.disabled=!0;if(Y)Y.disabled=!0;w=[];let F=[],_=new Set(["_filename"]),y=0,V=0,j=k||I;if(f)for(let b of Array.from(q.files))try{let N=await b.text(),T=await X9(N,j);if(T.source!=="unknown"&&T.plain){w.push({filename:b.name,plain:T.plain,sig:T.sig});let D=s$({plain:T.plain,filename:b.name,includeJson:!!X?.checked,sig:T.sig,omitKey:(A)=>A.startsWith("@")});D.keys.forEach((A)=>_.add(A)),F.push({...D.row,_raw:T.plain,_sig:T.sig}),y+=1}else console.warn(`Could not extract from ${b.name}`),V+=1}catch(N){console.error(`Error processing ${b.name}`,N),V+=1}else R.forEach((b)=>{w.push(b);let N=s$({plain:b.plain,filename:b.filename,includeJson:!!X?.checked});N.keys.forEach((T)=>_.add(T)),F.push({...N.row,_raw:b.plain}),y+=1});let x=Array.from(_).sort((b,N)=>{if(b==="_filename")return-1;if(N==="_filename")return 1;return b.localeCompare(N)});if(E=XQ(F,x),Z)Z.disabled=F.length===0;let g=P?.export?.jsonl!==!1;if(H=w.map((b)=>JSON.stringify({_filename:b.filename,_l2_sig:b.sig??null,...b.plain})).join(`
`),Y)Y.disabled=w.length===0||!g;if(J)J.textContent=`Completed. Processed ${y} entries. Errors: ${V}.`;if(G)$9(G,P,w);if(Q)q9(Q,F,x)};if(R.length>0&&(!q?.files||q.files.length===0))C();O?.addEventListener("click",()=>{if(w=[],E="",H="",q)q.value="";if(J)J.textContent="Data cleared.";if(Z)Z.disabled=!0;if(Y)Y.disabled=!0;if(G)G.innerHTML="";if(Q)Q.innerHTML="";window._aggRows=[]}),U?.addEventListener("click",()=>{C().catch((f)=>{if(J)J.textContent="Failed to aggregate.";console.error(f)})}),Z?.addEventListener("click",()=>{if(!E)return;let f=new Blob([E],{type:"text/csv;charset=utf-8"}),F=URL.createObjectURL(f),_=document.createElement("a");_.href=F,_.download="weba-aggregated.csv",_.click(),URL.revokeObjectURL(F)}),Y?.addEventListener("click",()=>{if(!H)return;let f=new Blob([H],{type:"application/x-jsonlines;charset=utf-8"}),F=URL.createObjectURL(f),_=document.createElement("a");_.href=F,_.download="weba-aggregated.jsonl",_.click(),URL.revokeObjectURL(F)})}function YQ(){console.log("Web/A Runtime Booting...");let $=new O$,q=new o$,J=new a$($,q),Q=window,G=document.getElementById("weba-structure");if(G?.textContent)try{Q.generatedJsonStructure=JSON.parse(G.textContent)}catch(Z){console.warn("Failed to parse weba structure JSON",Z)}let X=rJ();if(X)Q.webaL2Config=X;Q.saveDraft=()=>q.saveDraft(),Q.submitDocument=()=>q.submitDocument(),Q.signAndDownload=()=>q.signAndDownload(),Q.clearData=()=>q.clearData(),Q.removeTableRow=(Z)=>J.removeTableRow(Z),Q.addTableRow=(Z,Y)=>J.addTableRow(Z,Y),Q.switchTab=(Z,Y)=>J.switchTab(Z,Y),Q.recalculate=()=>$.recalculate(),Q.escapeHtml=(Z)=>{if(!Z)return"";let Y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return Z.toString().replace(/[&<>"']/g,(K)=>Y[K]||K)},q.restoreFromLS(),J.applyI18n(),J.initTables(),$.recalculate(),tJ(),eJ(),UQ();let U;document.addEventListener("input",(Z)=>{let Y=Z.target;if(Z.isTrusted)Y.dataset.dirty="true";let K=Y.dataset.baseKey||Y.dataset.jsonPath;if(K)(Y.closest("tr")||document).querySelectorAll(`[data-copy-from="${K}"]`).forEach((E)=>{if(!E.dataset.dirty){if(E.value!==Y.value)E.value=Y.value,E.dispatchEvent(new Event("input"))}});$.recalculate(),q.updateJsonLd(),clearTimeout(U),U=setTimeout(()=>q.saveToLS(),1000)}),console.log("Web/A Runtime Ready.")}class t${suggestionsVisible=!1;activeSearchInput=null;globalBox=null;constructor(){}init(){console.log("Initializing Search Engine (Bundle)...");let $=window;if($.generatedJsonStructure&&$.generatedJsonStructure.masterData){let q=Object.keys($.generatedJsonStructure.masterData);console.log("Master Data Keys available:",q.join(", "))}this.setupEventDelegation()}normalize($){if(!$)return"";let q=$.toString().toLowerCase();return q=q.replace(/[---]/g,(J)=>{return String.fromCharCode(J.charCodeAt(0)-65248)}),q=q.replace(/[-]/g,(J)=>String.fromCharCode(J.charCodeAt(0)-65248)),q.trim()}clean($){if(!$)return"";let q=this.normalize($);return q=q.replace(/(|||||npo||)/g,""),q=q.replace(/(\(\)|\(\)|\(\))/g,""),q.trim()}toIndex($){let q=parseInt($||"",10);return Number.isFinite(q)?q-1:-1}getGlobalBox(){if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",maxHeight:"200px",overflowY:"auto",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if($.target.classList.contains("search-input"))this.handleSearchInput($.target)}),document.body.addEventListener("click",($)=>{if($.target.classList.contains("suggestion-item"))this.handleSelection($.target)})}handleSearchInput($){this.activeSearchInput=$;let q=window,J=$.dataset.masterSrc,Q=$.dataset.suggestSource;if(!J&&!Q)return;let G=this.toIndex($.dataset.masterLabelIndex),X=this.toIndex($.dataset.masterValueIndex),U=$.value;if(!U){this.hideSuggestions();return}let Z=[],Y=this.normalize(U);if(Q==="column"){let K=$.dataset.baseKey,W=$.closest("table");if(W&&K){let O=new Set;W.querySelectorAll(`[data-base-key="${K}"]`).forEach((E)=>{if(E===$)return;let H=E.value;if(H&&this.normalize(H).includes(Y)){if(!O.has(H))O.add(H),Z.push({val:H,row:[H],label:H,score:10})}})}}else if(J){let K=q.generatedJsonStructure.masterData;if(!K||!K[J])return;K[J].forEach((O,E)=>{if(E===0)return;if(O.some((w)=>this.normalize(w||"").includes(Y))){let w=G>=0?O[G]||"":"",k=X>=0?O[X]||"":"",I=X>=0?k:G>=0?w:O[1]||O[0]||"";Z.push({val:I,row:O,label:w,score:10,idx:E})}})}this.renderSuggestions($,Z,G)}renderSuggestions($,q,J){if(q.length===0){this.hideSuggestions();return}let Q=window,G=q.slice(0,10),X="";G.forEach((W)=>{let O=Q.escapeHtml(JSON.stringify(W.row)),E=J>=0?W.label||W.row.join(" : "):W.row.join(" : ");X+=`<div class="suggestion-item" data-val="${Q.escapeHtml(W.val)}" data-row="${O}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${Q.escapeHtml(E)}</div>`});let U=this.getGlobalBox();U.innerHTML=X;let Z=$.getBoundingClientRect(),Y=window.scrollY||document.documentElement.scrollTop,K=window.scrollX||document.documentElement.scrollLeft;U.style.width=Math.max(Z.width,200)+"px",U.style.left=Z.left+K+"px",U.style.top=Z.bottom+Y+"px",U.querySelectorAll(".suggestion-item").forEach((W)=>{W.onmouseenter=()=>W.style.background="#f0f8ff",W.onmouseleave=()=>W.style.background="white"}),U.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;let q=window,J=this.activeSearchInput,Q=$.dataset.val||"",G=$.dataset.row||"[]";try{let X=JSON.parse(G),U=J.dataset.masterSrc,Z=U?q.generatedJsonStructure.masterData[U][0]:[],Y=!1;if(Z.length>0&&X.length>0){let K=J.closest("tr");if(K){let W=Array.from(K.querySelectorAll("input, select, textarea"));Z.forEach((O,E)=>{if(!O)return;let H=X[E];this.fillField(W,O,H,J,()=>{Y=!0})})}}if(!Y)J.value=Q,J.dispatchEvent(new Event("input",{bubbles:!0}))}catch(X){console.error(X)}this.hideSuggestions()}fillField($,q,J,Q,G){let X=this.normalize(q),U=$.find((Z)=>{let Y=Z.dataset.baseKey||Z.dataset.jsonPath,K=this.normalize(Z.getAttribute("placeholder")||"");return Y&&this.normalize(Y)===X||K===X});if(U){if(U.value=J||"",U.dispatchEvent(new Event("input",{bubbles:!0})),U===Q)G()}}}var U9=BigInt(0),I0=BigInt(1),Y9=BigInt(2),Z9=BigInt(7),W9=BigInt(256),M9=BigInt(113),MQ=[],NQ=[],KQ=[];for(let $=0,q=I0,J=1,Q=0;$<24;$++){[J,Q]=[Q,(2*J+3*Q)%5],MQ.push(2*(5*Q+J)),NQ.push(($+1)*($+2)/2%64);let G=U9;for(let X=0;X<7;X++)if(q=(q<<I0^(q>>Z9)*M9)%W9,q&Y9)G^=I0<<(I0<<BigInt(X))-I0;KQ.push(G)}var OQ=x0(KQ,!0),N9=OQ[0],K9=OQ[1],ZQ=($,q,J)=>J>32?Aq($,q,J):Tq($,q,J),WQ=($,q,J)=>J>32?Vq($,q,J):wq($,q,J);function O9($,q=24){let J=new Uint32Array(10);for(let Q=24-q;Q<24;Q++){for(let U=0;U<10;U++)J[U]=$[U]^$[U+10]^$[U+20]^$[U+30]^$[U+40];for(let U=0;U<10;U+=2){let Z=(U+8)%10,Y=(U+2)%10,K=J[Y],W=J[Y+1],O=ZQ(K,W,1)^J[Z],E=WQ(K,W,1)^J[Z+1];for(let H=0;H<50;H+=10)$[U+H]^=O,$[U+H+1]^=E}let G=$[2],X=$[3];for(let U=0;U<24;U++){let Z=NQ[U],Y=ZQ(G,X,Z),K=WQ(G,X,Z),W=MQ[U];G=$[W],X=$[W+1],$[W]=Y,$[W+1]=K}for(let U=0;U<50;U+=10){for(let Z=0;Z<10;Z++)J[Z]=$[U+Z];for(let Z=0;Z<10;Z++)$[U+Z]^=~J[(Z+2)%10]&J[(Z+4)%10]}$[0]^=N9[Q],$[1]^=K9[Q]}M8(J)}class G${state;pos=0;posOut=0;finished=!1;state32;destroyed=!1;blockLen;suffix;outputLen;enableXOF=!1;rounds;constructor($,q,J,Q=!1,G=24){if(this.blockLen=$,this.suffix=q,this.outputLen=J,this.enableXOF=Q,this.rounds=G,z8(J,"outputLen"),!(0<$&&$<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=j0(this.state)}clone(){return this._cloneInto()}keccak(){z$(this.state32),O9(this.state32,this.rounds),z$(this.state32),this.posOut=0,this.pos=0}update($){j8(this),c($);let{blockLen:q,state:J}=this,Q=$.length;for(let G=0;G<Q;){let X=Math.min(q-this.pos,Q-G);for(let U=0;U<X;U++)J[this.pos++]^=$[G++];if(this.pos===q)this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:$,suffix:q,pos:J,blockLen:Q}=this;if($[J]^=q,(q&128)!==0&&J===Q-1)this.keccak();$[Q-1]^=128,this.keccak()}writeInto($){j8(this,!1),c($),this.finish();let q=this.state,{blockLen:J}=this;for(let Q=0,G=$.length;Q<G;){if(this.posOut>=J)this.keccak();let X=Math.min(J-this.posOut,G-Q);$.set(q.subarray(this.posOut,this.posOut+X),Q),this.posOut+=X,Q+=X}return $}xofInto($){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto($)}xof($){return z8($),this.xofInto(new Uint8Array($))}digestInto($){if(B0($,this),this.finished)throw new Error("digest() was already called");return this.writeInto($),this.destroy(),$}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,M8(this.state)}_cloneInto($){let{blockLen:q,suffix:J,outputLen:Q,rounds:G,enableXOF:X}=this;return $||=new G$(q,J,Q,X,G),$.state32.set(this.state32),$.pos=this.pos,$.posOut=this.posOut,$.finished=this.finished,$.rounds=G,$.suffix=J,$.outputLen=Q,$.enableXOF=X,$.destroyed=this.destroyed,$}}var zQ=($,q,J,Q={})=>e8(()=>new G$(q,$,J),Q);var EQ=zQ(6,136,32,_8(8));var DQ=zQ(6,72,64,_8(10));var CQ=($,q,J,Q={})=>e8((G={})=>new G$(q,$,G.dkLen===void 0?J:G.dkLen,!0),Q),RQ=CQ(31,168,16,_8(11)),X$=CQ(31,136,32,_8(12));function e$($){if(!Number.isSafeInteger($)||$<0||$>4294967295)throw new Error("wrong u32 integer:"+$);return $}function LQ($){return e$($),($&$-1)===0&&$!==0}function $q($,q){e$($);let J=0;for(let Q=0;Q<q;Q++,$>>>=1)J=J<<1|$&1;return J}function IQ($){return e$($),31-Math.clz32($)}function HQ($){let q=$.length;if(q<2||!LQ(q))throw new Error("n must be a power of 2 and greater than 1. Got "+q);let J=IQ(q);for(let Q=0;Q<q;Q++){let G=$q(Q,J);if(Q<G){let X=$[Q];$[Q]=$[G],$[G]=X}}return $}var qq=($,q)=>{let{N:J,roots:Q,dit:G,invertButterflies:X=!1,skipStages:U=0,brp:Z=!0}=q,Y=IQ(J);if(!LQ(J))throw new Error("FFT: Polynomial size should be power of two");let K=G!==X;return(W)=>{if(W.length!==J)throw new Error("FFT: wrong Polynomial length");if(G&&Z)HQ(W);for(let O=0,E=1;O<Y-U;O++){let H=G?O+1+U:Y-O,w=1<<H,k=w>>1,I=J>>H;for(let P=0;P<J;P+=w)for(let R=0,C=E++;R<k;R++){let f=X?G?J-C:C:R*I,F=P+R,_=P+R+k,y=Q[f],V=W[_],j=W[F];if(K){let x=$.mul(V,y);W[F]=$.add(j,x),W[_]=$.sub(j,x)}else if(X)W[F]=$.add(V,j),W[_]=$.mul($.sub(V,j),y);else W[F]=$.add(j,V),W[_]=$.mul($.sub(j,V),y)}}if(!G&&Z)HQ(W);return W}};/*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) */var Jq=p8;function U$($,q){if($.length!==q.length)return!1;let J=0;for(let Q=0;Q<$.length;Q++)J|=$[Q]^q[Q];return J===0}function TQ($){return Uint8Array.from($)}function T0($,...q){let J=(G)=>typeof G==="number"?G:G.bytesLen,Q=q.reduce((G,X)=>G+J(X),0);return{bytesLen:Q,encode:(G)=>{let X=new Uint8Array(Q);for(let U=0,Z=0;U<q.length;U++){let Y=q[U],K=J(Y),W=typeof Y==="number"?G[U]:Y.encode(G[U]);if(c(W,K,$),X.set(W,Z),typeof Y!=="number")W.fill(0);Z+=K}return X},decode:(G)=>{c(G,Q,$);let X=[];for(let U of q){let Z=J(U),Y=G.subarray(0,Z);X.push(typeof U==="number"?Y:U.decode(Y)),G=G.subarray(Z)}return X}}}function Y$($,q){let J=q*$.bytesLen;return{bytesLen:J,encode:(Q)=>{if(Q.length!==q)throw new Error(`vecCoder.encode: wrong length=${Q.length}. Expected: ${q}`);let G=new Uint8Array(J);for(let X=0,U=0;X<Q.length;X++){let Z=$.encode(Q[X]);G.set(Z,U),Z.fill(0),U+=Z.length}return G},decode:(Q)=>{c(Q,J);let G=[];for(let X=0;X<Q.length;X+=$.bytesLen)G.push($.decode(Q.subarray(X,X+$.bytesLen)));return G}}}function H8(...$){for(let q of $)if(Array.isArray(q))for(let J of q)J.fill(0);else q.fill(0)}function Qq($){return(1<<$)-1}var HX=Uint8Array.of();/*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) */var wQ=($)=>{let{newPoly:q,N:J,Q,F:G,ROOT_OF_UNITY:X,brvBits:U,isKyber:Z}=$,Y=(R,C=Q)=>{let f=R%C|0;return(f>=0?f|0:C+f|0)|0},K=(R,C=Q)=>{let f=Y(R,C)|0;return(f>C>>1?f-C|0:f)|0};function W(){let R=q(J);for(let C=0;C<J;C++){let f=$q(C,U),F=BigInt(X)**BigInt(f)%BigInt(Q);R[C]=Number(F)|0}return R}let O=W(),E={add:(R,C)=>Y((R|0)+(C|0))|0,sub:(R,C)=>Y((R|0)-(C|0))|0,mul:(R,C)=>Y((R|0)*(C|0))|0,inv:(R)=>{throw new Error("not implemented")}},H={N:J,roots:O,invertButterflies:!0,skipStages:Z?1:0,brp:!1},w=qq(E,{dit:!1,...H}),k=qq(E,{dit:!0,...H});return{mod:Y,smod:K,nttZetas:O,NTT:{encode:(R)=>{return w(R)},decode:(R)=>{k(R);for(let C=0;C<R.length;C++)R[C]=Y(G*R[C]);return R}},bitsCoder:(R,C)=>{let f=Qq(R),F=R*(J/8);return{bytesLen:F,encode:(_)=>{let y=new Uint8Array(F);for(let V=0,j=0,x=0,g=0;V<_.length;V++){j|=(C.encode(_[V])&f)<<x,x+=R;for(;x>=8;x-=8,j>>=8)y[g++]=j&Qq(x)}return y},decode:(_)=>{let y=q(J);for(let V=0,j=0,x=0,g=0;V<_.length;V++){j|=_[V]<<x,x+=8;for(;x>=R;x-=R,j>>=R)y[g++]=C.decode(j&f)}return y}}}}},z9=($)=>(q,J)=>{if(!J)J=$.blockLen;let Q=new Uint8Array(q.length+2);Q.set(q);let G=q.length,X=new Uint8Array(J),U=$.create({}),Z=0,Y=0;return{stats:()=>({calls:Z,xofs:Y}),get:(K,W)=>{return Q[G+0]=K,Q[G+1]=W,U.destroy(),U=$.create({}).update(Q),Z++,()=>{return Y++,U.xofInto(X)}},clean:()=>{U.destroy(),H8(X,Q)}}},AQ=z9(RQ);/*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) */var U8=256,S8=3329,E9=3303,D9=17,{mod:V0,nttZetas:C9,NTT:o8,bitsCoder:R9}=wQ({N:U8,Q:S8,F:E9,ROOT_OF_UNITY:D9,newPoly:($)=>new Uint16Array($),brvBits:7,isKyber:!0}),Gq={512:{N:U8,Q:S8,K:2,ETA1:3,ETA2:2,du:10,dv:4,RBGstrength:128},768:{N:U8,Q:S8,K:3,ETA1:2,ETA2:2,du:10,dv:4,RBGstrength:192},1024:{N:U8,Q:S8,K:4,ETA1:2,ETA2:2,du:11,dv:5,RBGstrength:256}},H9=($)=>{if($>=12)return{encode:(J)=>J,decode:(J)=>J};let q=2**($-1);return{encode:(J)=>((J<<$)+S8/2)/S8,decode:(J)=>J*S8+q>>>$}},w0=($)=>R9($,H9($));function a8($,q){for(let J=0;J<U8;J++)$[J]=V0($[J]+q[J])}function L9($,q){for(let J=0;J<U8;J++)$[J]=V0($[J]-q[J])}function I9($,q,J,Q,G){let X=V0(q*Q*G+$*J),U=V0($*Q+q*J);return{c0:X,c1:U}}function Z$($,q){for(let J=0;J<U8/2;J++){let Q=C9[64+(J>>1)];if(J&1)Q=-Q;let{c0:G,c1:X}=I9($[2*J+0],$[2*J+1],q[2*J+0],q[2*J+1],Q);$[2*J+0]=G,$[2*J+1]=X}return $}function VQ($){let q=new Uint16Array(U8);for(let J=0;J<U8;){let Q=$();if(Q.length%3)throw new Error("SampleNTT: unaligned block");for(let G=0;J<U8&&G+3<=Q.length;G+=3){let X=(Q[G+0]>>0|Q[G+1]<<8)&4095,U=(Q[G+1]>>4|Q[G+2]<<4)&4095;if(X<S8)q[J++]=X;if(J<U8&&U<S8)q[J++]=U}}return q}function A0($,q,J,Q){let G=$(Q*U8/4,q,J),X=new Uint16Array(U8),U=j0(G),Z=0;for(let Y=0,K=0,W=0,O=0;Y<U.length;Y++){let E=U[Y];for(let H=0;H<32;H++)if(W+=E&1,E>>=1,Z+=1,Z===Q)O=W,W=0;else if(Z===2*Q)X[K++]=V0(O-W),W=0,Z=0}if(Z)throw new Error(`sampleCBD: leftover bits: ${Z}`);return X}var T9=($)=>{let{K:q,PRF:J,XOF:Q,HASH512:G,ETA1:X,ETA2:U,du:Z,dv:Y}=$,K=w0(1),W=w0(Y),O=w0(Z),E=T0("publicKey",Y$(w0(12),q),32),H=Y$(w0(12),q),w=T0("ciphertext",Y$(O,q),W),k=T0("seed",32,32);return{secretCoder:H,lengths:{secretKey:H.bytesLen,publicKey:E.bytesLen,cipherText:w.bytesLen},keygen:(I)=>{c(I,32,"seed");let P=new Uint8Array(33);P.set(I),P[32]=q;let R=G(P),[C,f]=k.decode(R),F=[],_=[];for(let j=0;j<q;j++)F.push(o8.encode(A0(J,f,j,X)));let y=Q(C);for(let j=0;j<q;j++){let x=o8.encode(A0(J,f,q+j,X));for(let g=0;g<q;g++){let b=VQ(y.get(g,j));a8(x,Z$(b,F[g]))}_.push(x)}y.clean();let V={publicKey:E.encode([_,C]),secretKey:H.encode(F)};return H8(C,f,F,_,P,R),V},encrypt:(I,P,R)=>{let[C,f]=E.decode(I),F=[];for(let g=0;g<q;g++)F.push(o8.encode(A0(J,R,g,X)));let _=Q(f),y=new Uint16Array(U8),V=[];for(let g=0;g<q;g++){let b=A0(J,R,q+g,U),N=new Uint16Array(U8);for(let T=0;T<q;T++){let D=VQ(_.get(g,T));a8(N,Z$(D,F[T]))}a8(b,o8.decode(N)),V.push(b),a8(y,Z$(C[g],F[g])),H8(N)}_.clean();let j=A0(J,R,2*q,U);a8(j,o8.decode(y));let x=K.decode(P);return a8(x,j),H8(C,F,y,j),w.encode([V,x])},decrypt:(I,P)=>{let[R,C]=w.decode(I),f=H.decode(P),F=new Uint16Array(U8);for(let _=0;_<q;_++)a8(F,Z$(f[_],o8.encode(R[_])));return L9(C,o8.decode(F)),H8(F,f,R),K.encode(C)}}};function Xq($){let q=T9($),{HASH256:J,HASH512:Q,KDF:G}=$,{secretCoder:X,lengths:U}=q,Z=T0("secretKey",U.secretKey,U.publicKey,32,32),Y=32,K=64;return{info:{type:"ml-kem"},lengths:{...U,seed:64,msg:32,msgRand:32,secretKey:Z.bytesLen},keygen:(W=Jq(64))=>{c(W,64,"seed");let{publicKey:O,secretKey:E}=q.keygen(W.subarray(0,32)),H=J(O),w=Z.encode([E,O,H,W.subarray(32)]);return H8(E,H),{publicKey:O,secretKey:w}},getPublicKey:(W)=>{let[O,E,H,w]=Z.decode(W);return Uint8Array.from(E)},encapsulate:(W,O=Jq(32))=>{c(W,U.publicKey,"publicKey"),c(O,32,"message");let E=W.subarray(0,384*$.K),H=X.encode(X.decode(TQ(E)));if(!U$(H,E))throw H8(H),new Error("ML-KEM.encapsulate: wrong publicKey modulus");H8(H);let w=Q.create().update(O).update(J(W)).digest(),k=q.encrypt(W,O,w.subarray(32,64));return H8(w.subarray(32)),{cipherText:k,sharedSecret:w.subarray(0,32)}},decapsulate:(W,O)=>{c(O,Z.bytesLen,"secretKey"),c(W,U.cipherText,"cipherText");let E=Z.bytesLen-96,H=E+32,w=J(O.subarray(E/2,H));if(!U$(w,O.subarray(H,H+32)))throw new Error("invalid secretKey: hash check failed");let[k,I,P,R]=Z.decode(O),C=q.decrypt(W,k),f=Q.create().update(C).update(P).digest(),F=f.subarray(0,32),_=q.encrypt(I,C,f.subarray(32,64)),y=U$(W,_),V=G.create({dkLen:32}).update(R).update(W).digest();return H8(C,_,!y?F:V),y?F:V}}}function w9($,q,J){return X$.create({dkLen:$}).update(q).update(new Uint8Array([J])).digest()}var Uq={HASH256:EQ,HASH512:DQ,KDF:X$,XOF:AQ,PRF:w9},FX=Xq({...Uq,...Gq[512]}),Yq=Xq({...Uq,...Gq[768]}),xX=Xq({...Uq,...Gq[1024]});function BQ(){return{kemId:"ML-KEM-768",encapsulate:($)=>{let{cipherText:q,sharedSecret:J}=Yq.encapsulate($);return{sharedSecret:J,encapsulation:q}},decapsulate:($,q)=>{return Yq.decapsulate(q,$)}}}function jQ($){globalThis.webaPqcKem=$}jQ(BQ());var PQ=new t$;window.GlobalSearch=PQ;YQ();PQ.init();
