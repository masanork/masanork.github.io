var Y$=Object.create;var{getPrototypeOf:Z$,defineProperty:Y8,getOwnPropertyNames:H$}=Object;var q$=Object.prototype.hasOwnProperty;var c8=($,G,X)=>{X=$!=null?Y$(Z$($)):{};let Q=G||!$||!$.__esModule?Y8(X,"default",{value:$,enumerable:!0}):X;for(let U of H$($))if(!q$.call(Q,U))Y8(Q,U,{get:()=>$[U],enumerable:!0});return Q};var B$=($,G)=>()=>(G||$((G={exports:{}}).exports,G),G.exports);var m0=($,G)=>{for(var X in G)Y8($,X,{get:G[X],enumerable:!0,configurable:!0,set:(Q)=>G[X]=()=>Q})};var Z8=($,G)=>()=>($&&(G=$($=0)),G);var J$=(($)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy($,{get:(G,X)=>(typeof require!=="undefined"?require:G)[X]}):$)(function($){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+$+'" is not supported')});var l8=B$((_X,u8)=>{u8.exports=function $(G){if(typeof G==="number"&&isNaN(G))throw new Error("NaN is not allowed");if(typeof G==="number"&&!isFinite(G))throw new Error("Infinity is not allowed");if(G===null||typeof G!=="object")return JSON.stringify(G);if(G.toJSON instanceof Function)return $(G.toJSON());if(Array.isArray(G))return`[${G.reduce((U,Z,Y)=>{return`${U}${Y===0?"":","}${$(Z===void 0||typeof Z==="symbol"?null:Z)}`},"")}]`;return`{${Object.keys(G).sort().reduce((Q,U)=>{if(G[U]===void 0||typeof G[U]==="symbol")return Q;let Z=Q.length===0?"":",";return`${Q}${Z}${$(U)}:${$(G[U])}`},"")}}`}});function _0($){let G=M.__externref_table_alloc();return M.__wbindgen_externrefs.set(G,$),G}function e($,G){return $=$>>>0,x0().subarray($/1,$/1+G)}function W0($,G){return $=$>>>0,m$($,G)}function x0(){if(f0===null||f0.byteLength===0)f0=new Uint8Array(M.memory.buffer);return f0}function T0($,G){try{return $.apply(this,G)}catch(X){let Q=_0(X);M.__wbindgen_exn_store(Q)}}function v0($){return $===void 0||$===null}function y($,G){let X=G($.length*1,1)>>>0;return x0().set($,X/1),_=$.length,X}function S0($,G,X){if(X===void 0){let H=h0.encode($),B=G(H.length,1)>>>0;return x0().subarray(B,B+H.length).set(H),_=H.length,B}let Q=$.length,U=G(Q,1)>>>0,Z=x0(),Y=0;for(;Y<Q;Y++){let H=$.charCodeAt(Y);if(H>127)break;Z[U+Y]=H}if(Y!==Q){if(Y!==0)$=$.slice(Y);U=X(U,Q,Q=Y+$.length*3,1)>>>0;let H=x0().subarray(U+Y,U+Q),B=h0.encodeInto($,H);Y+=B.written,U=X(U,Q,Y,1)>>>0}return _=Y,U}function s($){let G=M.__wbindgen_externrefs.get($);return M.__externref_table_dealloc($),G}function m$($,G){if(E8+=G,E8>=b$)$8=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),$8.decode(),E8=G;return $8.decode(x0().subarray($,$+G))}function O4($,G,X,Q){let U=y($,M.__wbindgen_malloc),Z=_,Y=y(G,M.__wbindgen_malloc),H=_,B=y(X,M.__wbindgen_malloc),J=_,q=y(Q,M.__wbindgen_malloc),L=_,O=M.aes_gcm_decrypt(U,Z,Y,H,B,J,q,L);if(O[3])throw s(O[2]);var D=e(O[0],O[1]).slice();return M.__wbindgen_free(O[0],O[1]*1,1),D}function D4($,G,X,Q){let U=y($,M.__wbindgen_malloc),Z=_,Y=y(G,M.__wbindgen_malloc),H=_,B=y(X,M.__wbindgen_malloc),J=_,q=y(Q,M.__wbindgen_malloc),L=_,O=M.aes_gcm_encrypt(U,Z,Y,H,B,J,q,L);if(O[3])throw s(O[2]);var D=e(O[0],O[1]).slice();return M.__wbindgen_free(O[0],O[1]*1,1),D}function z4($,G,X,Q,U){let Z,Y;try{let J=S0($,M.__wbindgen_malloc,M.__wbindgen_realloc),q=_,L=y(G,M.__wbindgen_malloc),O=_,D=S0(X,M.__wbindgen_malloc,M.__wbindgen_realloc),j=_,I=S0(Q,M.__wbindgen_malloc,M.__wbindgen_realloc),E=_,u=S0(U,M.__wbindgen_malloc,M.__wbindgen_realloc),p=_,x=M.build_l2_envelope_wasm(J,q,L,O,D,j,I,E,u,p);var H=x[0],B=x[1];if(x[3])throw H=0,B=0,s(x[2]);return Z=H,Y=B,W0(H,B)}finally{M.__wbindgen_free(Z,Y,1)}}function M4($,G){let X=y($,M.__wbindgen_malloc),Q=_,U=y(G,M.__wbindgen_malloc),Z=_;return M.constant_time_equal(X,Q,U,Z)!==0}function C4($,G,X){let Q,U;try{let J=S0($,M.__wbindgen_malloc,M.__wbindgen_realloc),q=_,L=y(G,M.__wbindgen_malloc),O=_;var Z=v0(X)?0:y(X,M.__wbindgen_malloc),Y=_;let D=M.decrypt_l2_envelope_wasm(J,q,L,O,Z,Y);var H=D[0],B=D[1];if(D[3])throw H=0,B=0,s(D[2]);return Q=H,U=B,W0(H,B)}finally{M.__wbindgen_free(Q,U,1)}}function A4(){let $=M.ed25519_generate_keypair();if($[3])throw s($[2]);var G=e($[0],$[1]).slice();return M.__wbindgen_free($[0],$[1]*1,1),G}function W4($){let G=y($,M.__wbindgen_malloc),X=_,Q=M.ed25519_public_key_to_x25519_public_key(G,X);if(Q[3])throw s(Q[2]);var U=e(Q[0],Q[1]).slice();return M.__wbindgen_free(Q[0],Q[1]*1,1),U}function x4($,G){let X=y($,M.__wbindgen_malloc),Q=_,U=y(G,M.__wbindgen_malloc),Z=_,Y=M.ed25519_sign(X,Q,U,Z);if(Y[3])throw s(Y[2]);var H=e(Y[0],Y[1]).slice();return M.__wbindgen_free(Y[0],Y[1]*1,1),H}function F4($,G,X){let Q=y($,M.__wbindgen_malloc),U=_,Z=y(G,M.__wbindgen_malloc),Y=_,H=y(X,M.__wbindgen_malloc),B=_,J=M.ed25519_verify(Q,U,Z,Y,H,B);if(J[2])throw s(J[1]);return J[0]!==0}function R4($){return M.get_padding_target_size($)>>>0}function w8(){let $,G;try{let X=M.get_version();return $=X[0],G=X[1],W0(X[0],X[1])}finally{M.__wbindgen_free($,G,1)}}function I4($,G,X,Q){let U=y($,M.__wbindgen_malloc),Z=_,Y=y(G,M.__wbindgen_malloc),H=_,B=y(X,M.__wbindgen_malloc),J=_,q=M.hkdf_sha256_wasm(U,Z,Y,H,B,J,Q);if(q[3])throw s(q[2]);var L=e(q[0],q[1]).slice();return M.__wbindgen_free(q[0],q[1]*1,1),L}function V4(){let $=M.ml_dsa_44_generate_keypair();if($[3])throw s($[2]);var G=e($[0],$[1]).slice();return M.__wbindgen_free($[0],$[1]*1,1),G}function j4($,G){let X=y($,M.__wbindgen_malloc),Q=_,U=y(G,M.__wbindgen_malloc),Z=_,Y=M.ml_dsa_44_sign(X,Q,U,Z);if(Y[3])throw s(Y[2]);var H=e(Y[0],Y[1]).slice();return M.__wbindgen_free(Y[0],Y[1]*1,1),H}function E4($,G,X){let Q=y($,M.__wbindgen_malloc),U=_,Z=y(G,M.__wbindgen_malloc),Y=_,H=y(X,M.__wbindgen_malloc),B=_,J=M.ml_dsa_44_verify(Q,U,Z,Y,H,B);if(J[2])throw s(J[1]);return J[0]!==0}function w4($,G){let X=y($,M.__wbindgen_malloc),Q=_,U=y(G,M.__wbindgen_malloc),Z=_,Y=M.ml_kem_768_decapsulate(X,Q,U,Z);if(Y[3])throw s(Y[2]);var H=e(Y[0],Y[1]).slice();return M.__wbindgen_free(Y[0],Y[1]*1,1),H}function T4($){let G=y($,M.__wbindgen_malloc),X=_,Q=M.ml_kem_768_encapsulate(G,X);if(Q[3])throw s(Q[2]);var U=e(Q[0],Q[1]).slice();return M.__wbindgen_free(Q[0],Q[1]*1,1),U}function _4(){let $=M.ml_kem_768_generate_keypair();if($[3])throw s($[2]);var G=e($[0],$[1]).slice();return M.__wbindgen_free($[0],$[1]*1,1),G}function f4(){let $=M.p256_generate_keypair();if($[3])throw s($[2]);var G=e($[0],$[1]).slice();return M.__wbindgen_free($[0],$[1]*1,1),G}function v4($,G){let X=y($,M.__wbindgen_malloc),Q=_,U=y(G,M.__wbindgen_malloc),Z=_,Y=M.p256_sign(X,Q,U,Z);if(Y[3])throw s(Y[2]);var H=e(Y[0],Y[1]).slice();return M.__wbindgen_free(Y[0],Y[1]*1,1),H}function S4($,G,X){let Q=y($,M.__wbindgen_malloc),U=_,Z=y(G,M.__wbindgen_malloc),Y=_,H=y(X,M.__wbindgen_malloc),B=_,J=M.p256_verify(Q,U,Z,Y,H,B);if(J[2])throw s(J[1]);return J[0]!==0}function h4($){let G=y($,M.__wbindgen_malloc),X=_,Q=M.sha256_wasm(G,X);var U=e(Q[0],Q[1]).slice();return M.__wbindgen_free(Q[0],Q[1]*1,1),U}function y4(){let $=M.x25519_generate_keypair();if($[3])throw s($[2]);var G=e($[0],$[1]).slice();return M.__wbindgen_free($[0],$[1]*1,1),G}function k4($){let G=y($,M.__wbindgen_malloc),X=_,Q=M.x25519_get_public_key(G,X);if(Q[3])throw s(Q[2]);var U=e(Q[0],Q[1]).slice();return M.__wbindgen_free(Q[0],Q[1]*1,1),U}function b4($,G){let X=y($,M.__wbindgen_malloc),Q=_,U=y(G,M.__wbindgen_malloc),Z=_,Y=M.x25519_get_shared_secret(X,Q,U,Z);if(Y[3])throw s(Y[2]);var H=e(Y[0],Y[1]).slice();return M.__wbindgen_free(Y[0],Y[1]*1,1),H}async function p$($,G){if(typeof Response==="function"&&$ instanceof Response){if(typeof WebAssembly.instantiateStreaming==="function")try{return await WebAssembly.instantiateStreaming($,G)}catch(Q){if($.ok&&g$.has($.type)&&$.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",Q);else throw Q}let X=await $.arrayBuffer();return await WebAssembly.instantiate(X,G)}else{let X=await WebAssembly.instantiate($,G);if(X instanceof WebAssembly.Instance)return{instance:X,module:$};else return X}}function c$(){let $={};return $.wbg={},$.wbg.__wbg___wbindgen_is_function_8d400b8b1af978cd=function(G){return typeof G==="function"},$.wbg.__wbg___wbindgen_is_object_ce774f3490692386=function(G){let X=G;return typeof X==="object"&&X!==null},$.wbg.__wbg___wbindgen_is_string_704ef9c8fc131030=function(G){return typeof G==="string"},$.wbg.__wbg___wbindgen_is_undefined_f6b95eab589e0269=function(G){return G===void 0},$.wbg.__wbg___wbindgen_throw_dd24417ed36fc46e=function(G,X){throw new Error(W0(G,X))},$.wbg.__wbg_call_3020136f7a2d6e44=function(){return T0(function(G,X,Q){return G.call(X,Q)},arguments)},$.wbg.__wbg_call_abb4ff46ce38be40=function(){return T0(function(G,X){return G.call(X)},arguments)},$.wbg.__wbg_crypto_574e78ad8b13b65f=function(G){return G.crypto},$.wbg.__wbg_getRandomValues_b8f5dbd5f3995a9e=function(){return T0(function(G,X){G.getRandomValues(X)},arguments)},$.wbg.__wbg_length_22ac23eaec9d8053=function(G){return G.length},$.wbg.__wbg_msCrypto_a61aeb35a24c1329=function(G){return G.msCrypto},$.wbg.__wbg_new_no_args_cb138f77cf6151ee=function(G,X){return new Function(W0(G,X))},$.wbg.__wbg_new_with_length_aa5eaf41d35235e5=function(G){return new Uint8Array(G>>>0)},$.wbg.__wbg_node_905d3e251edff8a2=function(G){return G.node},$.wbg.__wbg_process_dc0fbacc7c1c06f7=function(G){return G.process},$.wbg.__wbg_prototypesetcall_dfe9b766cdc1f1fd=function(G,X,Q){Uint8Array.prototype.set.call(e(G,X),Q)},$.wbg.__wbg_randomFillSync_ac0988aba3254290=function(){return T0(function(G,X){G.randomFillSync(X)},arguments)},$.wbg.__wbg_require_60cc747a6bc5215a=function(){return T0(function(){return l$.require},arguments)},$.wbg.__wbg_static_accessor_GLOBAL_769e6b65d6557335=function(){let G=typeof window==="undefined"?null:window;return v0(G)?0:_0(G)},$.wbg.__wbg_static_accessor_GLOBAL_THIS_60cf02db4de8e1c1=function(){let G=typeof globalThis==="undefined"?null:globalThis;return v0(G)?0:_0(G)},$.wbg.__wbg_static_accessor_SELF_08f5a74c69739274=function(){let G=typeof self==="undefined"?null:self;return v0(G)?0:_0(G)},$.wbg.__wbg_static_accessor_WINDOW_a8924b26aa92d024=function(){let G=typeof window==="undefined"?null:window;return v0(G)?0:_0(G)},$.wbg.__wbg_subarray_845f2f5bce7d061a=function(G,X,Q){return G.subarray(X>>>0,Q>>>0)},$.wbg.__wbg_versions_c01dfd4722a88165=function(G){return G.versions},$.wbg.__wbindgen_cast_2241b6af4c4b2941=function(G,X){return W0(G,X)},$.wbg.__wbindgen_cast_cb9088102bce6b30=function(G,X){return e(G,X)},$.wbg.__wbindgen_init_externref_table=function(){let G=M.__wbindgen_externrefs,X=G.grow(4);G.set(0,void 0),G.set(X+0,void 0),G.set(X+1,null),G.set(X+2,!0),G.set(X+3,!1)},$}function u$($,G){return M=$.exports,m4.__wbindgen_wasm_module=G,f0=null,M.__wbindgen_start(),M}async function m4($){if(M!==void 0)return M;if(typeof $!=="undefined")if(Object.getPrototypeOf($)===Object.prototype)({module_or_path:$}=$);else console.warn("using deprecated parameters for the initialization function; pass a single object instead");if(typeof $==="undefined")$=new URL("weba_crypto_wasm_bg.wasm",import.meta.url);let G=c$();if(typeof $==="string"||typeof Request==="function"&&$ instanceof Request||typeof URL==="function"&&$ instanceof URL)$=fetch($);let{instance:X,module:Q}=await p$(await $,G);return u$(X,Q)}var M,f0=null,$8,b$=2146435072,E8=0,h0,_=0,g$,G8;var g4=Z8(()=>{$8=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});$8.decode();h0=new TextEncoder;if(!("encodeInto"in h0))h0.encodeInto=function($,G){let X=h0.encode($);return G.set(X),{read:$.length,written:X.length}};g$=new Set(["basic","cors","default"]);G8=m4});var p4="";var n4={};m0(n4,{win32:()=>T8,toNamespacedPath:()=>HG,sep:()=>NG,resolve:()=>XG,relative:()=>ZG,posix:()=>N0,parse:()=>LG,normalize:()=>QG,join:()=>YG,isAbsolute:()=>UG,format:()=>KG,extname:()=>JG,dirname:()=>qG,delimiter:()=>PG,default:()=>GG,basename:()=>BG});var d$,u4,n$,o$,s$,i$,a$=($,G)=>()=>(G||$((G={exports:{}}).exports,G),G.exports),r$=($,G,X,Q)=>{if(G&&typeof G=="object"||typeof G=="function")for(let U of o$(G))!i$.call($,U)&&U!==X&&u4($,U,{get:()=>G[U],enumerable:!(Q=n$(G,U))||Q.enumerable});return $},t$=($,G,X)=>(X=$!=null?d$(s$($)):{},r$(G||!$||!$.__esModule?u4(X,"default",{value:$,enumerable:!0}):X,$)),e$,l4,i,$G,c4=function($){return $},d4=function(){throw new Error("Not implemented")},N0,T8,GG,XG,QG,UG,YG,ZG,HG,qG,BG,JG,KG,LG,NG,PG;var o4=Z8(()=>{d$=Object.create,u4=Object.defineProperty,n$=Object.getOwnPropertyDescriptor,o$=Object.getOwnPropertyNames,s$=Object.getPrototypeOf,i$=Object.prototype.hasOwnProperty,e$=a$(($,G)=>{function X(Y){if(typeof Y!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(Y))}function Q(Y,H){for(var B="",J=0,q=-1,L=0,O,D=0;D<=Y.length;++D){if(D<Y.length)O=Y.charCodeAt(D);else{if(O===47)break;O=47}if(O===47){if(!(q===D-1||L===1))if(q!==D-1&&L===2){if(B.length<2||J!==2||B.charCodeAt(B.length-1)!==46||B.charCodeAt(B.length-2)!==46){if(B.length>2){var j=B.lastIndexOf("/");if(j!==B.length-1){j===-1?(B="",J=0):(B=B.slice(0,j),J=B.length-1-B.lastIndexOf("/")),q=D,L=0;continue}}else if(B.length===2||B.length===1){B="",J=0,q=D,L=0;continue}}H&&(B.length>0?B+="/..":B="..",J=2)}else B.length>0?B+="/"+Y.slice(q+1,D):B=Y.slice(q+1,D),J=D-q-1;q=D,L=0}else O===46&&L!==-1?++L:L=-1}return B}function U(Y,H){var B=H.dir||H.root,J=H.base||(H.name||"")+(H.ext||"");return B?B===H.root?B+J:B+Y+J:J}var Z={resolve:function(){for(var Y="",H=!1,B,J=arguments.length-1;J>=-1&&!H;J--){var q;J>=0?q=arguments[J]:(B===void 0&&(B=window.process.cwd()),q=B),X(q),q.length!==0&&(Y=q+"/"+Y,H=q.charCodeAt(0)===47)}return Y=Q(Y,!H),H?Y.length>0?"/"+Y:"/":Y.length>0?Y:"."},normalize:function(Y){if(X(Y),Y.length===0)return".";var H=Y.charCodeAt(0)===47,B=Y.charCodeAt(Y.length-1)===47;return Y=Q(Y,!H),Y.length===0&&!H&&(Y="."),Y.length>0&&B&&(Y+="/"),H?"/"+Y:Y},isAbsolute:function(Y){return X(Y),Y.length>0&&Y.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var Y,H=0;H<arguments.length;++H){var B=arguments[H];X(B),B.length>0&&(Y===void 0?Y=B:Y+="/"+B)}return Y===void 0?".":Z.normalize(Y)},relative:function(Y,H){if(X(Y),X(H),Y===H||(Y=Z.resolve(Y),H=Z.resolve(H),Y===H))return"";for(var B=1;B<Y.length&&Y.charCodeAt(B)===47;++B);for(var J=Y.length,q=J-B,L=1;L<H.length&&H.charCodeAt(L)===47;++L);for(var O=H.length,D=O-L,j=q<D?q:D,I=-1,E=0;E<=j;++E){if(E===j){if(D>j){if(H.charCodeAt(L+E)===47)return H.slice(L+E+1);if(E===0)return H.slice(L+E)}else q>j&&(Y.charCodeAt(B+E)===47?I=E:E===0&&(I=0));break}var u=Y.charCodeAt(B+E),p=H.charCodeAt(L+E);if(u!==p)break;u===47&&(I=E)}var x="";for(E=B+I+1;E<=J;++E)(E===J||Y.charCodeAt(E)===47)&&(x.length===0?x+="..":x+="/..");return x.length>0?x+H.slice(L+I):(L+=I,H.charCodeAt(L)===47&&++L,H.slice(L))},_makeLong:function(Y){return Y},dirname:function(Y){if(X(Y),Y.length===0)return".";for(var H=Y.charCodeAt(0),B=H===47,J=-1,q=!0,L=Y.length-1;L>=1;--L)if(H=Y.charCodeAt(L),H===47){if(!q){J=L;break}}else q=!1;return J===-1?B?"/":".":B&&J===1?"//":Y.slice(0,J)},basename:function(Y,H){if(H!==void 0&&typeof H!="string")throw new TypeError('"ext" argument must be a string');X(Y);var B=0,J=-1,q=!0,L;if(H!==void 0&&H.length>0&&H.length<=Y.length){if(H.length===Y.length&&H===Y)return"";var O=H.length-1,D=-1;for(L=Y.length-1;L>=0;--L){var j=Y.charCodeAt(L);if(j===47){if(!q){B=L+1;break}}else D===-1&&(q=!1,D=L+1),O>=0&&(j===H.charCodeAt(O)?--O===-1&&(J=L):(O=-1,J=D))}return B===J?J=D:J===-1&&(J=Y.length),Y.slice(B,J)}else{for(L=Y.length-1;L>=0;--L)if(Y.charCodeAt(L)===47){if(!q){B=L+1;break}}else J===-1&&(q=!1,J=L+1);return J===-1?"":Y.slice(B,J)}},extname:function(Y){X(Y);for(var H=-1,B=0,J=-1,q=!0,L=0,O=Y.length-1;O>=0;--O){var D=Y.charCodeAt(O);if(D===47){if(!q){B=O+1;break}continue}J===-1&&(q=!1,J=O+1),D===46?H===-1?H=O:L!==1&&(L=1):H!==-1&&(L=-1)}return H===-1||J===-1||L===0||L===1&&H===J-1&&H===B+1?"":Y.slice(H,J)},format:function(Y){if(Y===null||typeof Y!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof Y);return U("/",Y)},parse:function(Y){X(Y);var H={root:"",dir:"",base:"",ext:"",name:""};if(Y.length===0)return H;var B=Y.charCodeAt(0),J=B===47,q;J?(H.root="/",q=1):q=0;for(var L=-1,O=0,D=-1,j=!0,I=Y.length-1,E=0;I>=q;--I){if(B=Y.charCodeAt(I),B===47){if(!j){O=I+1;break}continue}D===-1&&(j=!1,D=I+1),B===46?L===-1?L=I:E!==1&&(E=1):L!==-1&&(E=-1)}return L===-1||D===-1||E===0||E===1&&L===D-1&&L===O+1?D!==-1&&(O===0&&J?H.base=H.name=Y.slice(1,D):H.base=H.name=Y.slice(O,D)):(O===0&&J?(H.name=Y.slice(1,L),H.base=Y.slice(1,D)):(H.name=Y.slice(O,L),H.base=Y.slice(O,D)),H.ext=Y.slice(L,D)),O>0?H.dir=Y.slice(0,O-1):J&&(H.dir="/"),H},sep:"/",delimiter:":",win32:null,posix:null};Z.posix=Z,G.exports=Z}),l4=t$(e$()),i=l4,$G=l4;i.parse??=d4;$G.parse??=d4;N0={resolve:i.resolve.bind(i),normalize:i.normalize.bind(i),isAbsolute:i.isAbsolute.bind(i),join:i.join.bind(i),relative:i.relative.bind(i),toNamespacedPath:c4,dirname:i.dirname.bind(i),basename:i.basename.bind(i),extname:i.extname.bind(i),format:i.format.bind(i),parse:i.parse.bind(i),sep:"/",delimiter:":",win32:void 0,posix:void 0,_makeLong:c4},T8={sep:"\\",delimiter:";",win32:void 0,...N0,posix:N0};N0.win32=T8.win32=T8;N0.posix=N0;GG=N0,{resolve:XG,normalize:QG,isAbsolute:UG,join:YG,relative:ZG,toNamespacedPath:HG,dirname:qG,basename:BG,extname:JG,format:KG,parse:LG,sep:NG,delimiter:PG}=N0});var f8={};m0(f8,{x25519GetSharedSecret:()=>AG,x25519GetPublicKey:()=>CG,x25519GenerateKeyPair:()=>MG,sha256Hash:()=>vG,p256Verify:()=>VG,p256Sign:()=>IG,p256GenerateKeyPair:()=>RG,mlKem768GenerateKeyPair:()=>jG,mlKem768Encapsulate:()=>EG,mlKem768Decapsulate:()=>wG,mlDsa44Verify:()=>fG,mlDsa44Sign:()=>_G,mlDsa44GenerateKeyPair:()=>TG,initWasmFromB64:()=>_8,initWasm:()=>s4,hkdfSha256:()=>SG,getPaddingTargetSize:()=>hG,ed25519Verify:()=>FG,ed25519Sign:()=>xG,ed25519PublicKeyToX25519PublicKey:()=>bG,ed25519GenerateKeyPair:()=>WG,decryptL2Envelope:()=>kG,constantTimeEqual:()=>OG,buildL2Envelope:()=>yG,aesGcmEncrypt:()=>DG,aesGcmDecrypt:()=>zG});async function s4($){if(c)return;if($)await G8($);else if(typeof window!=="undefined"&&window.__WEBA_MANIFEST){let X=window.__WEBA_MANIFEST.blobs?.find((Q)=>Q.id==="weba-crypto-wasm");if(X){let Q=document.getElementById("weba-blob-"+X.digest.split(":")[1]);if(Q){let U=atob(Q.textContent.trim()),Z=new Uint8Array(U.length);for(let Y=0;Y<U.length;Y++)Z[Y]=U.charCodeAt(Y);await G8(Z),c=!0,console.log(`WASM Crypto Initialized from Manifest: ${w8()}`);return}}await _8()}else if(typeof window.process!=="undefined"&&window.process.versions&&window.process.versions.node){let G=await import("node:fs"),Q=(await Promise.resolve().then(() => (o4(),n4))).join(import.meta.dirname,"wasm_bindings/weba_crypto_wasm_bg.wasm"),U=G.readFileSync(Q);await G8(U)}else try{await _8()}catch(G){throw new Error("WASM source must be provided in browser environment")}if(c=!0,!c)console.log(`WASM Crypto Initialized: ${w8()}`)}async function _8(){if(c)return;let $=atob(p4),G=new Uint8Array($.length);for(let X=0;X<$.length;X++)G[X]=$.charCodeAt(X);await s4(G)}function OG($,G){if(!c)throw new Error("WASM not initialized");return M4($,G)}function DG($,G,X,Q){if(!c)throw new Error("WASM not initialized");return D4($,G,X,Q)}function zG($,G,X,Q){if(!c)throw new Error("WASM not initialized");return O4($,G,X,Q)}function MG(){if(!c)throw new Error("WASM not initialized");let $=y4();return{privateKey:$.slice(0,32),publicKey:$.slice(32,64)}}function CG($){if(!c)throw new Error("WASM not initialized");return k4($)}function AG($,G){if(!c)throw new Error("WASM not initialized");return b4($,G)}function WG(){if(!c)throw new Error("WASM not initialized");let $=A4();return{privateKey:$.slice(0,32),publicKey:$.slice(32,64)}}function xG($,G){if(!c)throw new Error("WASM not initialized");return x4($,G)}function FG($,G,X){if(!c)throw new Error("WASM not initialized");return F4($,G,X)}function RG(){if(!c)throw new Error("WASM not initialized");let $=f4();return{privateKey:$.slice(0,32),publicKey:$.slice(32,97)}}function IG($,G){if(!c)throw new Error("WASM not initialized");return v4($,G)}function VG($,G,X){if(!c)throw new Error("WASM not initialized");return S4($,G,X)}function jG(){if(!c)throw new Error("WASM not initialized");let $=_4();return{privateKey:$.slice(0,2400),publicKey:$.slice(2400,3584)}}function EG($){if(!c)throw new Error("WASM not initialized");let G=T4($);return{sharedSecret:G.slice(0,32),ciphertext:G.slice(32,1120)}}function wG($,G){if(!c)throw new Error("WASM not initialized");return w4($,G)}function TG(){if(!c)throw new Error("WASM not initialized");let $=V4();return{privateKey:$.slice(0,2560),publicKey:$.slice(2560,3872)}}function _G($,G){if(!c)throw new Error("WASM not initialized");return j4($,G)}function fG($,G,X){if(!c)throw new Error("WASM not initialized");return E4($,G,X)}function vG($){if(!c)throw new Error("WASM not initialized");return h4($)}function SG($,G,X,Q){if(!c)throw new Error("WASM not initialized");return I4($,G||new Uint8Array(0),X,Q)}function hG($){if(!c)throw new Error("WASM not initialized");return R4($)}function yG($,G,X,Q,U){if(!c)throw new Error("WASM not initialized");return z4($,G,X,Q,U)}function kG($,G,X){if(!c)throw new Error("WASM not initialized");return C4($,G,X)}function bG($){if(!c)throw new Error("WASM not initialized");return W4($)}var c=!1;var v8=Z8(()=>{g4()});var X8={};m0(X8,{wrapRecipientPrivateKey:()=>tG,unwrapRecipientPrivateKey:()=>YX,sendGuestMessage:()=>HX,selectEpochKey:()=>UX,loadL2Config:()=>$X,getPaddingTargetSize:()=>oG,getOrCreateGuestDid:()=>ZX,fetchPreKey:()=>XX,fetchGuestInbox:()=>qX,fetchEpochRegistry:()=>QX,deriveOrgX25519KeyPair:()=>aG,deriveKeyPairFromPrf:()=>rG,decryptLayer2Envelope:()=>GX,buildLayer2Envelope:()=>eG,b64urlEncode:()=>sG,b64urlDecode:()=>iG,ReplayGuard:()=>t4});async function oG($){return $}function sG($){return""}function iG($){return new Uint8Array(0)}async function aG($){throw new Error("L2 Stub: Not implemented")}async function rG($){throw new Error("L2 Stub: Not implemented")}async function tG($){throw new Error("L2 Stub: Not implemented")}async function eG($){throw new Error("L2 Stub: Not implemented")}function $X(){return null}class t4{constructor($){}async checkAndMark($){return!0}async reset(){}}async function GX($,G,X){throw new Error("L2 Stub: Not implemented")}async function XX($){return null}async function QX($){return null}function UX($){return null}async function YX($){throw new Error("L2 Stub: Not implemented")}async function ZX($=!1){throw new Error("Guest DID Stub: Not implemented")}async function HX($,G,X){throw new Error("Guest DID Stub: Not implemented")}async function qX($){throw new Error("Guest DID Stub: Not implemented")}var $$={};m0($$,{wrapRecipientPrivateKey:()=>PX,unwrapRecipientPrivateKey:()=>WX,sendGuestMessage:()=>FX,selectEpochKey:()=>AX,loadL2Config:()=>DX,getPaddingTargetSize:()=>BX,getOrCreateGuestDid:()=>xX,fetchPreKey:()=>MX,fetchGuestInbox:()=>RX,fetchEpochRegistry:()=>CX,deriveOrgX25519KeyPair:()=>LX,deriveKeyPairFromPrf:()=>NX,decryptLayer2Envelope:()=>zX,buildLayer2Envelope:()=>OX,b64urlEncode:()=>JX,b64urlDecode:()=>KX,ReplayGuard:()=>e4});async function BX($){return $}function JX($){return""}function KX($){return new Uint8Array(0)}async function LX($){throw new Error("L2 Stub: Not implemented")}async function NX($){throw new Error("L2 Stub: Not implemented")}async function PX($){throw new Error("L2 Stub: Not implemented")}async function OX($){throw new Error("L2 Stub: Not implemented")}function DX(){return null}class e4{constructor($){}async checkAndMark($){return!0}async reset(){}}async function zX($,G,X){throw new Error("L2 Stub: Not implemented")}async function MX($){return null}async function CX($){return null}function AX($){return null}async function WX($){throw new Error("L2 Stub: Not implemented")}async function xX($=!1){throw new Error("Guest DID Stub: Not implemented")}async function FX($,G,X){throw new Error("Guest DID Stub: Not implemented")}async function RX($){throw new Error("Guest DID Stub: Not implemented")}class H8{runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let G=$.dataset.copyFrom;if(G){let U=($.closest("tr")||document).querySelector(`[data-base-key="${G}"], [data-json-path="${G}"]`);if(U&&U.value!==$.value)$.value=U.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let G=$.dataset.formula;if(!G)return;let X=$.closest("tr"),Q=$.closest("table"),U=(Y)=>{let H=0,B="none";if(X){let J=`[data-base-key="${Y}"], [data-json-path="${Y}"]`,q=X.querySelector(J);if(q){if(B="row-input",q.value!=="")H=parseFloat(q.value)}}if(B==="none"){let J=document.querySelector(`[data-json-path="${Y}"]`);if(J){if(B="static-input",J.value!=="")H=parseFloat(J.value)}}return H},Z=G.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(Y,H)=>{let B=0,J=Q||document,q=J.querySelectorAll(`[data-base-key="${H}"], [data-json-path="${H}"]`);if(q.length===0&&J!==document)q=document.querySelectorAll(`[data-base-key="${H}"], [data-json-path="${H}"]`);return q.forEach((L)=>{let O=parseFloat(L.value);if(!isNaN(O))B+=O}),B});Z=Z.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(Y)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(Y))return Y;return String(U(Y))});try{let Y=new Function("return "+Z)();if(typeof Y==="number"&&!isNaN(Y))$.value=Number.isInteger(Y)?Y:Y.toFixed(0);else $.value=""}catch(Y){console.error("Calc Error:",Y),$.value="Err"}}),this.runAutoCopy()}}var i4=c8(l8(),1);var q8;try{q8=new TextDecoder}catch($){}var F,O0,z=0;var i8=[],K$=105,L$=57342,N$=57343,d8=57337;var n8=6,M0={},I0=112810000,J0=16810000;var B8=i8,J8=0,b={},o,c0,u0=0,j0=0,r,U0,a=[],K8=[],X0,G0,V0,o8={useRecords:!1,mapsAsObjects:!0},E0=!1,a8=2;try{new Function("")}catch($){a8=1/0}class K0{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[G,X]of Object.entries($.keyMap))this.mapKey.set(X,G)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let G=new Map;for(let[X,Q]of Object.entries($))G.set(this._keyMap.hasOwnProperty(X)?this._keyMap[X]:X,Q);return G}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[X,Q]of Object.entries(this._keyMap))this._mapKey.set(Q,X)}let G={};return $.forEach((X,Q)=>G[Y0(this._mapKey.has(Q)?this._mapKey.get(Q):Q)]=X),G}mapDecode($,G){let X=this.decode($);if(this._keyMap)switch(X.constructor.name){case"Array":return X.map((Q)=>this.decodeKeys(Q))}return X}decode($,G){if(F)return $4(()=>{return l0(),this?this.decode($,G):K0.prototype.decode.call(o8,$,G)});O0=G>-1?G:$.length,z=0,J8=0,j0=0,c0=null,B8=i8,r=null,F=$;try{G0=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(X){if(F=null,$ instanceof Uint8Array)throw X;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof K0){if(b=this,X0=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return o=this.structures,g0();else if(!o||o.length>0)o=[]}else{if(b=o8,!o||o.length>0)o=[];X0=null}return g0()}decodeMultiple($,G){let X,Q=0;try{let U=$.length;E0=!0;let Z=this?this.decode($,U):z8.decode($,U);if(G){if(G(Z)===!1)return;while(z<U)if(Q=z,G(g0())===!1)return}else{X=[Z];while(z<U)Q=z,X.push(g0());return X}}catch(U){throw U.lastPosition=Q,U.values=X,U}finally{E0=!1,l0()}}}function g0(){try{let $=m();if(r){if(z>=r.postBundlePosition){let G=new Error("Unexpected bundle position");throw G.incomplete=!0,G}z=r.postBundlePosition,r=null}if(z==O0){if(o=null,F=null,U0)U0=null}else if(z>O0){let G=new Error("Unexpected end of CBOR data");throw G.incomplete=!0,G}else if(!E0)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(l0(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function m(){let $=F[z++],G=$>>5;if($=$&31,$>23)switch($){case 24:$=F[z++];break;case 25:if(G==7)return z$();$=G0.getUint16(z),z+=2;break;case 26:if(G==7){let X=G0.getFloat32(z);if(b.useFloat32>2){let Q=d0[(F[z]&127)<<1|F[z+1]>>7];return z+=4,(Q*X+(X>0?0.5:-0.5)>>0)/Q}return z+=4,X}$=G0.getUint32(z),z+=4;break;case 27:if(G==7){let X=G0.getFloat64(z);return z+=8,X}if(G>1){if(G0.getUint32(z)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=G0.getUint32(z+4)}else if(b.int64AsNumber)$=G0.getUint32(z)*4294967296,$+=G0.getUint32(z+4);else $=G0.getBigUint64(z);z+=8;break;case 31:switch(G){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let X=[],Q,U=0;while((Q=m())!=M0){if(U>=I0)throw new Error(`Array length exceeds ${I0}`);X[U++]=Q}return G==4?X:G==3?X.join(""):Buffer.concat(X);case 5:let Z;if(b.mapsAsObjects){let Y={},H=0;if(b.keyMap)while((Z=m())!=M0){if(H++>=J0)throw new Error(`Property count exceeds ${J0}`);Y[Y0(b.decodeKey(Z))]=m()}else while((Z=m())!=M0){if(H++>=J0)throw new Error(`Property count exceeds ${J0}`);Y[Y0(Z)]=m()}return Y}else{if(V0)b.mapsAsObjects=!0,V0=!1;let Y=new Map;if(b.keyMap){let H=0;while((Z=m())!=M0){if(H++>=J0)throw new Error(`Map size exceeds ${J0}`);Y.set(b.decodeKey(Z),m())}}else{let H=0;while((Z=m())!=M0){if(H++>=J0)throw new Error(`Map size exceeds ${J0}`);Y.set(Z,m())}}return Y}case 7:return M0;default:throw new Error("Invalid major type for indefinite length "+G)}default:throw new Error("Unknown token "+$)}switch(G){case 0:return $;case 1:return~$;case 2:return D$($);case 3:if(j0>=z)return c0.slice(z-u0,(z+=$)-u0);if(j0==0&&O0<140&&$<32){let U=$<16?r8($):O$($);if(U!=null)return U}return P$($);case 4:if($>=I0)throw new Error(`Array length exceeds ${I0}`);let X=new Array($);for(let U=0;U<$;U++)X[U]=m();return X;case 5:if($>=J0)throw new Error(`Map size exceeds ${I0}`);if(b.mapsAsObjects){let U={};if(b.keyMap)for(let Z=0;Z<$;Z++)U[Y0(b.decodeKey(m()))]=m();else for(let Z=0;Z<$;Z++)U[Y0(m())]=m();return U}else{if(V0)b.mapsAsObjects=!0,V0=!1;let U=new Map;if(b.keyMap)for(let Z=0;Z<$;Z++)U.set(b.decodeKey(m()),m());else for(let Z=0;Z<$;Z++)U.set(m(),m());return U}case 6:if($>=d8){let U=o[$&8191];if(U){if(!U.read)U.read=L8(U);return U.read()}if($<65536){if($==N$){let Z=A0(),Y=m(),H=m();P8(Y,H);let B={};if(b.keyMap)for(let J=2;J<Z;J++){let q=b.decodeKey(H[J-2]);B[Y0(q)]=m()}else for(let J=2;J<Z;J++){let q=H[J-2];B[Y0(q)]=m()}return B}else if($==L$){let Z=A0(),Y=m();for(let H=2;H<Z;H++)P8(Y++,m());return m()}else if($==d8)return F$();if(b.getShared){if(D8(),U=o[$&8191],U){if(!U.read)U.read=L8(U);return U.read()}}}}let Q=a[$];if(Q)if(Q.handlesRead)return Q(m);else return Q(m());else{let U=m();for(let Z=0;Z<K8.length;Z++){let Y=K8[Z]($,U);if(Y!==void 0)return Y}return new Z0(U,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let U=(X0||P0())[$];if(U!==void 0)return U;throw new Error("Unknown token "+$)}default:if(isNaN($)){let U=new Error("Unexpected end of CBOR data");throw U.incomplete=!0,U}throw new Error("Unknown CBOR token "+$)}}var s8=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function L8($){if(!$)throw new Error("Structure is required in record definition");function G(){let X=F[z++];if(X=X&31,X>23)switch(X){case 24:X=F[z++];break;case 25:X=G0.getUint16(z),z+=2;break;case 26:X=G0.getUint32(z),z+=4;break;default:throw new Error("Expected array header, but got "+F[z-1])}let Q=this.compiledReader;while(Q){if(Q.propertyCount===X)return Q(m);Q=Q.next}if(this.slowReads++>=a8){let Z=this.length==X?this:this.slice(0,X);if(Q=b.keyMap?new Function("r","return {"+Z.map((Y)=>b.decodeKey(Y)).map((Y)=>s8.test(Y)?Y0(Y)+":r()":"["+JSON.stringify(Y)+"]:r()").join(",")+"}"):new Function("r","return {"+Z.map((Y)=>s8.test(Y)?Y0(Y)+":r()":"["+JSON.stringify(Y)+"]:r()").join(",")+"}"),this.compiledReader)Q.next=this.compiledReader;return Q.propertyCount=X,this.compiledReader=Q,Q(m)}let U={};if(b.keyMap)for(let Z=0;Z<X;Z++)U[Y0(b.decodeKey(this[Z]))]=m();else for(let Z=0;Z<X;Z++)U[Y0(this[Z])]=m();return U}return $.slowReads=0,G}function Y0($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var P$=N8;function N8($){let G;if($<16){if(G=r8($))return G}if($>64&&q8)return q8.decode(F.subarray(z,z+=$));let X=z+$,Q=[];G="";while(z<X){let U=F[z++];if((U&128)===0)Q.push(U);else if((U&224)===192){let Z=F[z++]&63;Q.push((U&31)<<6|Z)}else if((U&240)===224){let Z=F[z++]&63,Y=F[z++]&63;Q.push((U&31)<<12|Z<<6|Y)}else if((U&248)===240){let Z=F[z++]&63,Y=F[z++]&63,H=F[z++]&63,B=(U&7)<<18|Z<<12|Y<<6|H;if(B>65535)B-=65536,Q.push(B>>>10&1023|55296),B=56320|B&1023;Q.push(B)}else Q.push(U);if(Q.length>=4096)G+=$0.apply(String,Q),Q.length=0}if(Q.length>0)G+=$0.apply(String,Q);return G}var $0=String.fromCharCode;function O$($){let G=z,X=new Array($);for(let Q=0;Q<$;Q++){let U=F[z++];if((U&128)>0){z=G;return}X[Q]=U}return $0.apply(String,X)}function r8($){if($<4)if($<2)if($===0)return"";else{let G=F[z++];if((G&128)>1){z-=1;return}return $0(G)}else{let G=F[z++],X=F[z++];if((G&128)>0||(X&128)>0){z-=2;return}if($<3)return $0(G,X);let Q=F[z++];if((Q&128)>0){z-=3;return}return $0(G,X,Q)}else{let G=F[z++],X=F[z++],Q=F[z++],U=F[z++];if((G&128)>0||(X&128)>0||(Q&128)>0||(U&128)>0){z-=4;return}if($<6)if($===4)return $0(G,X,Q,U);else{let Z=F[z++];if((Z&128)>0){z-=5;return}return $0(G,X,Q,U,Z)}else if($<8){let Z=F[z++],Y=F[z++];if((Z&128)>0||(Y&128)>0){z-=6;return}if($<7)return $0(G,X,Q,U,Z,Y);let H=F[z++];if((H&128)>0){z-=7;return}return $0(G,X,Q,U,Z,Y,H)}else{let Z=F[z++],Y=F[z++],H=F[z++],B=F[z++];if((Z&128)>0||(Y&128)>0||(H&128)>0||(B&128)>0){z-=8;return}if($<10)if($===8)return $0(G,X,Q,U,Z,Y,H,B);else{let J=F[z++];if((J&128)>0){z-=9;return}return $0(G,X,Q,U,Z,Y,H,B,J)}else if($<12){let J=F[z++],q=F[z++];if((J&128)>0||(q&128)>0){z-=10;return}if($<11)return $0(G,X,Q,U,Z,Y,H,B,J,q);let L=F[z++];if((L&128)>0){z-=11;return}return $0(G,X,Q,U,Z,Y,H,B,J,q,L)}else{let J=F[z++],q=F[z++],L=F[z++],O=F[z++];if((J&128)>0||(q&128)>0||(L&128)>0||(O&128)>0){z-=12;return}if($<14)if($===12)return $0(G,X,Q,U,Z,Y,H,B,J,q,L,O);else{let D=F[z++];if((D&128)>0){z-=13;return}return $0(G,X,Q,U,Z,Y,H,B,J,q,L,O,D)}else{let D=F[z++],j=F[z++];if((D&128)>0||(j&128)>0){z-=14;return}if($<15)return $0(G,X,Q,U,Z,Y,H,B,J,q,L,O,D,j);let I=F[z++];if((I&128)>0){z-=15;return}return $0(G,X,Q,U,Z,Y,H,B,J,q,L,O,D,j,I)}}}}}function D$($){return b.copyBuffers?Uint8Array.prototype.slice.call(F,z,z+=$):F.subarray(z,z+=$)}var t8=new Float32Array(1),p0=new Uint8Array(t8.buffer,0,4);function z$(){let $=F[z++],G=F[z++],X=($&127)>>2;if(X===31){if(G||$&3)return NaN;return $&128?-1/0:1/0}if(X===0){let Q=(($&3)<<8|G)/16777216;return $&128?-Q:Q}return p0[3]=$&128|(X>>1)+56,p0[2]=($&7)<<5|G>>3,p0[1]=G<<5,p0[0]=0,t8[0]}var fX=new Array(4096);class Z0{constructor($,G){this.value=$,this.tag=G}}a[0]=($)=>{return new Date($)};a[1]=($)=>{return new Date(Math.round($*1000))};a[2]=($)=>{let G=BigInt(0);for(let X=0,Q=$.byteLength;X<Q;X++)G=BigInt($[X])+(G<<BigInt(8));return G};a[3]=($)=>{return BigInt(-1)-a[2]($)};a[4]=($)=>{return+($[1]+"e"+$[0])};a[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var P8=($,G)=>{$=$-57344;let X=o[$];if(X&&X.isShared)(o.restoreStructures||(o.restoreStructures=[]))[$]=X;o[$]=G,G.read=L8(G)};a[K$]=($)=>{let G=$.length,X=$[1];P8($[0],X);let Q={};for(let U=2;U<G;U++){let Z=X[U-2];Q[Y0(Z)]=$[U]}return Q};a[14]=($)=>{if(r)return r[0].slice(r.position0,r.position0+=$);return new Z0($,14)};a[15]=($)=>{if(r)return r[1].slice(r.position1,r.position1+=$);return new Z0($,15)};var M$={Error,RegExp};a[27]=($)=>{return(M$[$[0]]||Error)($[1],$[2])};var e8=($)=>{if(F[z++]!=132){let X=new Error("Packed values structure must be followed by a 4 element array");if(F.length<z)X.incomplete=!0;throw X}let G=$();if(!G||!G.length){let X=new Error("Packed values structure must be followed by a 4 element array");throw X.incomplete=!0,X}return X0=X0?G.concat(X0.slice(G.length)):G,X0.prefixes=$(),X0.suffixes=$(),$()};e8.handlesRead=!0;a[51]=e8;a[n8]=($)=>{if(!X0)if(b.getShared)D8();else return new Z0($,n8);if(typeof $=="number")return X0[16+($>=0?2*$:-2*$-1)];let G=new Error("No support for non-integer packed references yet");if($===void 0)G.incomplete=!0;throw G};a[28]=($)=>{if(!U0)U0=new Map,U0.id=0;let G=U0.id++,X=z,Q=F[z],U;if(Q>>5==4)U=[];else U={};let Z={target:U};U0.set(G,Z);let Y=$();if(Z.used){if(Object.getPrototypeOf(U)!==Object.getPrototypeOf(Y))z=X,U=Y,U0.set(G,{target:U}),Y=$();return Object.assign(U,Y)}return Z.target=Y,Y};a[28].handlesRead=!0;a[29]=($)=>{let G=U0.get($);return G.used=!0,G.target};a[258]=($)=>new Set($);(a[259]=($)=>{if(b.mapsAsObjects)b.mapsAsObjects=!1,V0=!0;return $()}).handlesRead=!0;function C0($,G){if(typeof $==="string")return $+G;if($ instanceof Array)return $.concat(G);return Object.assign({},$,G)}function P0(){if(!X0)if(b.getShared)D8();else throw new Error("No packed values available");return X0}var C$=1399353956;K8.push(($,G)=>{if($>=225&&$<=255)return C0(P0().prefixes[$-224],G);if($>=28704&&$<=32767)return C0(P0().prefixes[$-28672],G);if($>=1879052288&&$<=2147483647)return C0(P0().prefixes[$-1879048192],G);if($>=216&&$<=223)return C0(G,P0().suffixes[$-216]);if($>=27647&&$<=28671)return C0(G,P0().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return C0(G,P0().suffixes[$-1811939328]);if($==C$)return{packedValues:X0,structures:o.slice(0),version:G};if($==55799)return G});var A$=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,O8=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],W$=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<O8.length;$++)x$(O8[$],W$[$]);function x$($,G){let X="get"+$.name.slice(0,-5),Q;if(typeof $==="function")Q=$.BYTES_PER_ELEMENT;else $=null;for(let U=0;U<2;U++){if(!U&&Q==1)continue;let Z=Q==2?1:Q==4?2:Q==8?3:0;a[U?G:G-4]=Q==1||U==A$?(Y)=>{if(!$)throw new Error("Could not find typed array for code "+G);if(!b.copyBuffers){if(Q===1||Q===2&&!(Y.byteOffset&1)||Q===4&&!(Y.byteOffset&3)||Q===8&&!(Y.byteOffset&7))return new $(Y.buffer,Y.byteOffset,Y.byteLength>>Z)}return new $(Uint8Array.prototype.slice.call(Y,0).buffer)}:(Y)=>{if(!$)throw new Error("Could not find typed array for code "+G);let H=new DataView(Y.buffer,Y.byteOffset,Y.byteLength),B=Y.length>>Z,J=new $(B),q=H[X];for(let L=0;L<B;L++)J[L]=q.call(H,L<<Z,U);return J}}}function F$(){let $=A0(),G=z+m();for(let Q=2;Q<$;Q++){let U=A0();z+=U}let X=z;return z=G,r=[N8(A0()),N8(A0())],r.position0=0,r.position1=0,r.postBundlePosition=z,z=X,m()}function A0(){let $=F[z++]&31;if($>23)switch($){case 24:$=F[z++];break;case 25:$=G0.getUint16(z),z+=2;break;case 26:$=G0.getUint32(z),z+=4;break}return $}function D8(){if(b.getShared){let $=$4(()=>{return F=null,b.getShared()})||{},G=$.structures||[];if(b.sharedVersion=$.version,X0=b.sharedValues=$.packedValues,o===!0)b.structures=o=G;else o.splice.apply(o,[0,G.length].concat(G))}}function $4($){let G=O0,X=z,Q=J8,U=u0,Z=j0,Y=c0,H=B8,B=U0,J=r,q=new Uint8Array(F.slice(0,O0)),L=o,O=b,D=E0,j=$();return O0=G,z=X,J8=Q,u0=U,j0=Z,c0=Y,B8=H,U0=B,r=J,F=q,E0=D,o=L,b=O,G0=new DataView(F.buffer,F.byteOffset,F.byteLength),j}function l0(){F=null,U0=null,o=null}var d0=new Array(147);for(let $=0;$<256;$++)d0[$]=+("1e"+Math.floor(45.15-$*0.30103));var z8=new K0({useRecords:!1}),n0=z8.decode,R$=z8.decodeMultiple;var o0;try{o0=new TextEncoder}catch($){}var x8,H4,i0=typeof globalThis==="object"&&globalThis.Buffer,w0=typeof i0!=="undefined",M8=w0?i0.allocUnsafeSlow:Uint8Array,G4=w0?i0:Uint8Array,X4=256,Q4=w0?4294967296:2144337920;var C8,N,l,K=0,L0,t=null,I$=61440,V$=/[\u0080-\uFFFF]/,Q0=Symbol("record-id");class a0 extends K0{constructor($){super($);this.offset=0;let G,X,Q,U,Z,Y;$=$||{};let H=G4.prototype.utf8Write?function(P,R,C){return N.utf8Write(P,R,C)}:o0&&o0.encodeInto?function(P,R){return o0.encodeInto(P,N.subarray(R)).written}:!1,B=this,J=$.structures||$.saveStructures,q=$.maxSharedStructures;if(q==null)q=J?128:0;if(q>8190)throw new Error("Maximum maxSharedStructure is 8190");let L=$.sequential;if(L)q=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let O,D,j=$.sharedValues,I;if(j){I=Object.create(null);for(let P=0,R=j.length;P<R;P++)I[j[P]]=P}let E=[],u=0,p=0;this.mapEncode=function(P,R){if(this._keyMap&&!this._mapped)switch(P.constructor.name){case"Array":P=P.map((C)=>this.encodeKeys(C));break}return this.encode(P,R)},this.encode=function(P,R){if(!N)N=new M8(8192),l=new DataView(N.buffer,0,8192),K=0;if(L0=N.length-10,L0-K<2048)N=new M8(N.length),l=new DataView(N.buffer,0,N.length),L0=N.length-10,K=0;else if(R===R8)K=K+7&2147483640;if(X=K,B.useSelfDescribedHeader)l.setUint32(K,3654940416),K+=3;if(Y=B.structuredClone?new Map:null,B.bundleStrings&&typeof P!=="string")t=[],t.size=1/0;else t=null;if(Q=B.structures,Q){if(Q.uninitialized){let A=B.getShared()||{};B.structures=Q=A.structures||[],B.sharedVersion=A.version;let W=B.sharedValues=A.packedValues;if(W){I={};for(let V=0,S=W.length;V<S;V++)I[W[V]]=V}}let C=Q.length;if(C>q&&!L)C=q;if(!Q.transitions){Q.transitions=Object.create(null);for(let A=0;A<C;A++){let W=Q[A];if(!W)continue;let V,S=Q.transitions;for(let h=0,k=W.length;h<k;h++){if(S[Q0]===void 0)S[Q0]=A;let g=W[h];if(V=S[g],!V)V=S[g]=Object.create(null);S=V}S[Q0]=A|1048576}}if(!L)Q.nextId=C}if(U)U=!1;if(Z=Q||[],D=I,$.pack){let C=new Map;if(C.values=[],C.encoder=B,C.maxValues=$.maxPrivatePackedValues||(I?16:1/0),C.objectMap=I||!1,C.samplingPackedValues=O,s0(P,C),C.values.length>0){N[K++]=216,N[K++]=51,q0(4);let A=C.values;x(A),q0(0),q0(0),D=Object.create(I||null);for(let W=0,V=A.length;W<V;W++)D[A[W]]=W}}C8=R&W8;try{if(C8)return;if(x(P),t)Y4(X,x);if(B.offset=K,Y&&Y.idsToInsert){if(K+=Y.idsToInsert.length*2,K>L0)f(K);B.offset=K;let C=w$(N.subarray(X,K),Y.idsToInsert);return Y=null,C}if(R&R8)return N.start=X,N.end=K,N;return N.subarray(X,K)}finally{if(Q){if(p<10)p++;if(Q.length>q)Q.length=q;if(u>1e4){if(Q.transitions=null,p=0,u=0,E.length>0)E=[]}else if(E.length>0&&!L){for(let C=0,A=E.length;C<A;C++)E[C][Q0]=void 0;E=[]}}if(U&&B.saveShared){if(B.structures.length>q)B.structures=B.structures.slice(0,q);let C=N.subarray(X,K);if(B.updateSharedData()===!1)return B.encode(P);return C}if(R&v$)K=X}},this.findCommonStringsToPack=()=>{if(O=new Map,!I)I=Object.create(null);return(P)=>{let R=P&&P.threshold||4,C=this.pack?P.maxPrivatePackedValues||16:0;if(!j)j=this.sharedValues=[];for(let[A,W]of O)if(W.count>R)I[A]=C++,j.push(A),U=!0;while(this.saveShared&&this.updateSharedData()===!1);O=null}};let x=(P)=>{if(K>L0)N=f(K);var R=typeof P,C;if(R==="string"){if(D){let S=D[P];if(S>=0){if(S<16)N[K++]=S+224;else if(N[K++]=198,S&1)x(15-S>>1);else x(S-16>>1);return}else if(O&&!$.pack){let h=O.get(P);if(h)h.count++;else O.set(P,{count:1})}}let A=P.length;if(t&&A>=4&&A<1024){if((t.size+=A)>I$){let h,k=(t[0]?t[0].length*3+t[1].length:0)+10;if(K+k>L0)N=f(K+k);if(N[K++]=217,N[K++]=223,N[K++]=249,N[K++]=t.position?132:130,N[K++]=26,h=K-X,K+=4,t.position)Y4(X,x);t=["",""],t.size=0,t.position=h}let S=V$.test(P);t[S?0:1]+=P,N[K++]=S?206:207,x(A);return}let W;if(A<32)W=1;else if(A<256)W=2;else if(A<65536)W=3;else W=5;let V=A*3;if(K+V>L0)N=f(K+V);if(A<64||!H){let S,h,k,g=K+W;for(S=0;S<A;S++)if(h=P.charCodeAt(S),h<128)N[g++]=h;else if(h<2048)N[g++]=h>>6|192,N[g++]=h&63|128;else if((h&64512)===55296&&((k=P.charCodeAt(S+1))&64512)===56320)h=65536+((h&1023)<<10)+(k&1023),S++,N[g++]=h>>18|240,N[g++]=h>>12&63|128,N[g++]=h>>6&63|128,N[g++]=h&63|128;else N[g++]=h>>12|224,N[g++]=h>>6&63|128,N[g++]=h&63|128;C=g-K-W}else C=H(P,K+W,V);if(C<24)N[K++]=96|C;else if(C<256){if(W<2)N.copyWithin(K+2,K+1,K+1+C);N[K++]=120,N[K++]=C}else if(C<65536){if(W<3)N.copyWithin(K+3,K+2,K+2+C);N[K++]=121,N[K++]=C>>8,N[K++]=C&255}else{if(W<5)N.copyWithin(K+5,K+3,K+3+C);N[K++]=122,l.setUint32(K,C),K+=4}K+=C}else if(R==="number")if(!this.alwaysUseFloat&&P>>>0===P)if(P<24)N[K++]=P;else if(P<256)N[K++]=24,N[K++]=P;else if(P<65536)N[K++]=25,N[K++]=P>>8,N[K++]=P&255;else N[K++]=26,l.setUint32(K,P),K+=4;else if(!this.alwaysUseFloat&&P>>0===P)if(P>=-24)N[K++]=31-P;else if(P>=-256)N[K++]=56,N[K++]=~P;else if(P>=-65536)N[K++]=57,l.setUint16(K,~P),K+=2;else N[K++]=58,l.setUint32(K,~P),K+=4;else{let A;if((A=this.useFloat32)>0&&P<4294967296&&P>=-2147483648){N[K++]=250,l.setFloat32(K,P);let W;if(A<4||(W=P*d0[(N[K]&127)<<1|N[K+1]>>7])>>0===W){K+=4;return}else K--}N[K++]=251,l.setFloat64(K,P),K+=8}else if(R==="object")if(!P)N[K++]=246;else{if(Y){let W=Y.get(P);if(W){if(N[K++]=216,N[K++]=29,N[K++]=25,!W.references){let V=Y.idsToInsert||(Y.idsToInsert=[]);W.references=[],V.push(W)}W.references.push(K-X),K+=2;return}else Y.set(P,{offset:K-X})}let A=P.constructor;if(A===Object)w(P);else if(A===Array){if(C=P.length,C<24)N[K++]=128|C;else q0(C);for(let W=0;W<C;W++)x(P[W])}else if(A===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)N[K++]=217,N[K++]=1,N[K++]=3;if(C=P.size,C<24)N[K++]=160|C;else if(C<256)N[K++]=184,N[K++]=C;else if(C<65536)N[K++]=185,N[K++]=C>>8,N[K++]=C&255;else N[K++]=186,l.setUint32(K,C),K+=4;if(B.keyMap)for(let[W,V]of P)x(B.encodeKey(W)),x(V);else for(let[W,V]of P)x(W),x(V)}else{for(let W=0,V=x8.length;W<V;W++){let S=H4[W];if(P instanceof S){let h=x8[W],k=h.tag;if(k==null)k=h.getTag&&h.getTag.call(this,P);if(k<24)N[K++]=192|k;else if(k<256)N[K++]=216,N[K++]=k;else if(k<65536)N[K++]=217,N[K++]=k>>8,N[K++]=k&255;else if(k>-1)N[K++]=218,l.setUint32(K,k),K+=4;h.encode.call(this,P,x,f);return}}if(P[Symbol.iterator]){if(C8){let W=new Error("Iterable should be serialized as iterator");throw W.iteratorNotHandled=!0,W}N[K++]=159;for(let W of P)x(W);N[K++]=255;return}if(P[Symbol.asyncIterator]||A8(P)){let W=new Error("Iterable/blob should be serialized as iterator");throw W.iteratorNotHandled=!0,W}if(this.useToJSON&&P.toJSON){let W=P.toJSON();if(W!==P)return x(W)}w(P)}}else if(R==="boolean")N[K++]=P?245:244;else if(R==="bigint"){if(P<BigInt(1)<<BigInt(64)&&P>=0)N[K++]=27,l.setBigUint64(K,P);else if(P>-(BigInt(1)<<BigInt(64))&&P<0)N[K++]=59,l.setBigUint64(K,-P-BigInt(1));else if(this.largeBigIntToFloat)N[K++]=251,l.setFloat64(K,Number(P));else{if(P>=BigInt(0))N[K++]=194;else N[K++]=195,P=BigInt(-1)-P;let A=[];while(P)A.push(Number(P&BigInt(255))),P>>=BigInt(8);F8(new Uint8Array(A.reverse()),f);return}K+=8}else if(R==="undefined")N[K++]=247;else throw new Error("Unknown type: "+R)},w=this.useRecords===!1?this.variableMapSize?(P)=>{let R=Object.keys(P),C=Object.values(P),A=R.length;if(A<24)N[K++]=160|A;else if(A<256)N[K++]=184,N[K++]=A;else if(A<65536)N[K++]=185,N[K++]=A>>8,N[K++]=A&255;else N[K++]=186,l.setUint32(K,A),K+=4;let W;if(B.keyMap)for(let V=0;V<A;V++)x(B.encodeKey(R[V])),x(C[V]);else for(let V=0;V<A;V++)x(R[V]),x(C[V])}:(P)=>{N[K++]=185;let R=K-X;K+=2;let C=0;if(B.keyMap){for(let A in P)if(typeof P.hasOwnProperty!=="function"||P.hasOwnProperty(A))x(B.encodeKey(A)),x(P[A]),C++}else for(let A in P)if(typeof P.hasOwnProperty!=="function"||P.hasOwnProperty(A))x(A),x(P[A]),C++;N[R+++X]=C>>8,N[R+X]=C&255}:(P,R)=>{let C,A=Z.transitions||(Z.transitions=Object.create(null)),W=0,V=0,S,h;if(this.keyMap){h=Object.keys(P).map((g)=>this.encodeKey(g)),V=h.length;for(let g=0;g<V;g++){let p8=h[g];if(C=A[p8],!C)C=A[p8]=Object.create(null),W++;A=C}}else for(let g in P)if(typeof P.hasOwnProperty!=="function"||P.hasOwnProperty(g)){if(C=A[g],!C){if(A[Q0]&1048576)S=A[Q0]&65535;C=A[g]=Object.create(null),W++}A=C,V++}let k=A[Q0];if(k!==void 0)k&=65535,N[K++]=217,N[K++]=k>>8|224,N[K++]=k&255;else{if(!h)h=A.__keys__||(A.__keys__=Object.keys(P));if(S===void 0){if(k=Z.nextId++,!k)k=0,Z.nextId=1;if(k>=X4)Z.nextId=(k=q)+1}else k=S;if(Z[k]=h,k<q){N[K++]=217,N[K++]=k>>8|224,N[K++]=k&255,A=Z.transitions;for(let g=0;g<V;g++){if(A[Q0]===void 0||A[Q0]&1048576)A[Q0]=k;A=A[h[g]]}A[Q0]=k|1048576,U=!0}else{if(A[Q0]=k,l.setUint32(K,3655335680),K+=3,W)u+=p*W;if(E.length>=X4-q)E.shift()[Q0]=void 0;if(E.push(A),q0(V+2),x(57344+k),x(h),R)return;for(let g in P)if(typeof P.hasOwnProperty!=="function"||P.hasOwnProperty(g))x(P[g]);return}}if(V<24)N[K++]=128|V;else q0(V);if(R)return;for(let g in P)if(typeof P.hasOwnProperty!=="function"||P.hasOwnProperty(g))x(P[g])},f=(P)=>{let R;if(P>16777216){if(P-X>Q4)throw new Error("Encoded buffer would be larger than maximum buffer size");R=Math.min(Q4,Math.round(Math.max((P-X)*(P>67108864?1.25:2),4194304)/4096)*4096)}else R=(Math.max(P-X<<2,N.length-1)>>12)+1<<12;let C=new M8(R);if(l=new DataView(C.buffer,0,R),N.copy)N.copy(C,0,X,P);else C.set(N.slice(X,P));return K-=X,X=0,L0=C.length-10,N=C},v=100,T=1000;this.encodeAsIterable=function(P,R){return z0(P,R,n)},this.encodeAsAsyncIterable=function(P,R){return z0(P,R,g8)};function*n(P,R,C){let A=P.constructor;if(A===Object){let W=B.useRecords!==!1;if(W)w(P,!0);else U4(Object.keys(P).length,160);for(let V in P){let S=P[V];if(!W)x(V);if(S&&typeof S==="object")if(R[V])yield*n(S,R[V]);else yield*d(S,R,V);else x(S)}}else if(A===Array){let W=P.length;q0(W);for(let V=0;V<W;V++){let S=P[V];if(S&&(typeof S==="object"||K-X>v))if(R.element)yield*n(S,R.element);else yield*d(S,R,"element");else x(S)}}else if(P[Symbol.iterator]&&!P.buffer){N[K++]=159;for(let W of P)if(W&&(typeof W==="object"||K-X>v))if(R.element)yield*n(W,R.element);else yield*d(W,R,"element");else x(W);N[K++]=255}else if(A8(P))U4(P.size,64),yield N.subarray(X,K),yield P,B0();else if(P[Symbol.asyncIterator])N[K++]=159,yield N.subarray(X,K),yield P,B0(),N[K++]=255;else x(P);if(C&&K>X)yield N.subarray(X,K);else if(K-X>v)yield N.subarray(X,K),B0()}function*d(P,R,C){let A=K-X;try{if(x(P),K-X>v)yield N.subarray(X,K),B0()}catch(W){if(W.iteratorNotHandled)R[C]={},K=X+A,yield*n.call(this,P,R[C]);else throw W}}function B0(){v=T,B.encode(null,W8)}function z0(P,R,C){if(R&&R.chunkThreshold)v=T=R.chunkThreshold;else v=100;if(P&&typeof P==="object")return B.encode(null,W8),C(P,B.iterateProperties||(B.iterateProperties={}),!0);return[B.encode(P)]}async function*g8(P,R){for(let C of n(P,R,!0)){let A=C.constructor;if(A===G4||A===Uint8Array)yield C;else if(A8(C)){let W=C.stream().getReader(),V;while(!(V=await W.read()).done)yield V.value}else if(C[Symbol.asyncIterator])for await(let W of C)if(B0(),W)yield*g8(W,R.async||(R.async={}));else yield B.encode(W);else yield C}}}useBuffer($){N=$,l=new DataView(N.buffer,N.byteOffset,N.byteLength),K=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let G=this.structures.slice(0),X=new I8(G,this.sharedValues,this.sharedVersion),Q=this.saveShared(X,(U)=>(U&&U.version||0)==$);if(Q===!1)X=this.getShared()||{},this.structures=X.structures||[],this.sharedValues=X.packedValues,this.sharedVersion=X.version,this.structures.nextId=this.structures.length;else G.forEach((U,Z)=>this.structures[Z]=U);return Q}}function U4($,G){if($<24)N[K++]=G|$;else if($<256)N[K++]=G|24,N[K++]=$;else if($<65536)N[K++]=G|25,N[K++]=$>>8,N[K++]=$&255;else N[K++]=G|26,l.setUint32(K,$),K+=4}class I8{constructor($,G,X){this.structures=$,this.packedValues=G,this.version=X}}function q0($){if($<24)N[K++]=128|$;else if($<256)N[K++]=152,N[K++]=$;else if($<65536)N[K++]=153,N[K++]=$>>8,N[K++]=$&255;else N[K++]=154,l.setUint32(K,$),K+=4}var j$=typeof Blob==="undefined"?function(){}:Blob;function A8($){if($ instanceof j$)return!0;let G=$[Symbol.toStringTag];return G==="Blob"||G==="File"}function s0($,G){switch(typeof $){case"string":if($.length>3){if(G.objectMap[$]>-1||G.values.length>=G.maxValues)return;let Q=G.get($);if(Q){if(++Q.count==2)G.values.push($)}else if(G.set($,{count:1}),G.samplingPackedValues){let U=G.samplingPackedValues.get($);if(U)U.count++;else G.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let Q=0,U=$.length;Q<U;Q++)s0($[Q],G);else{let Q=!G.encoder.useRecords;for(var X in $)if($.hasOwnProperty(X)){if(Q)s0(X,G);s0($[X],G)}}break;case"function":console.log($)}}var E$=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;H4=[Date,Set,Error,RegExp,Z0,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,I8];x8=[{tag:1,encode($,G){let X=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&X>=0&&X<4294967296)N[K++]=26,l.setUint32(K,X),K+=4;else N[K++]=251,l.setFloat64(K,X),K+=8}},{tag:258,encode($,G){let X=Array.from($);G(X)}},{tag:27,encode($,G){G([$.name,$.message])}},{tag:27,encode($,G){G(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,G){G($.value)}},{encode($,G,X){F8($,X)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||w0&&this.tagUint8Array!==!1)return 64}},encode($,G,X){F8($,X)}},H0(68,1),H0(69,2),H0(70,4),H0(71,8),H0(72,1),H0(77,2),H0(78,4),H0(79,8),H0(85,4),H0(86,8),{encode($,G){let X=$.packedValues||[],Q=$.structures||[];if(X.values.length>0){N[K++]=216,N[K++]=51,q0(4);let U=X.values;G(U),q0(0),q0(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let Z=0,Y=U.length;Z<Y;Z++)packedObjectMap[U[Z]]=Z}if(Q){l.setUint32(K,3655335424),K+=3;let U=Q.slice(0);U.unshift(57344),U.push(new Z0($.version,1399353956)),G(U)}else G(new Z0($.version,1399353956))}}];function H0($,G){if(!E$&&G>1)$-=4;return{tag:$,encode:function X(Q,U){let Z=Q.byteLength,Y=Q.byteOffset||0,H=Q.buffer||Q;U(w0?i0.from(H,Y,Z):new Uint8Array(H,Y,Z))}}}function F8($,G){let X=$.byteLength;if(X<24)N[K++]=64+X;else if(X<256)N[K++]=88,N[K++]=X;else if(X<65536)N[K++]=89,N[K++]=X>>8,N[K++]=X&255;else N[K++]=90,l.setUint32(K,X),K+=4;if(K+X>=N.length)G(K+X);N.set($.buffer?$:new Uint8Array($),K),K+=X}function w$($,G){let X,Q=G.length*2,U=$.length-Q;G.sort((Z,Y)=>Z.offset>Y.offset?1:-1);for(let Z=0;Z<G.length;Z++){let Y=G[Z];Y.id=Z;for(let H of Y.references)$[H++]=Z>>8,$[H]=Z&255}while(X=G.pop()){let Z=X.offset;$.copyWithin(Z+Q,Z,U),Q-=2;let Y=Z+Q;$[Y++]=216,$[Y++]=28,U=Z}return $}function Y4($,G){l.setUint32(t.position+$,K-t.position-$+1);let X=t;t=null,G(X[0]),G(X[1])}var V8=new a0({useRecords:!1}),T$=V8.encode,_$=V8.encodeAsIterable,f$=V8.encodeAsAsyncIterable;var R8=512,v$=1024,W8=2048;var r0=($)=>{let G=new Uint8Array($);return btoa(String.fromCharCode(...G)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},q4=($)=>{let G=$.replace(/-/g,"+").replace(/_/g,"/");while(G.length%4)G+="=";let X=atob(G),Q=new Uint8Array(X.length);for(let U=0;U<X.length;U++)Q[U]=X.charCodeAt(U);return Q.buffer};async function B4($){let G=crypto.getRandomValues(new Uint8Array(32)),Q=new TextEncoder().encode($),U=await crypto.subtle.digest("SHA-256",Q),Z=new Uint8Array(U).slice(0,16),Y=await navigator.credentials.create({publicKey:{challenge:G,rp:{name:"Sorane Web/A Form"},user:{id:Z,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"required"},timeout:60000,attestation:"none",extensions:{prf:{}}}});if(!Y)throw new Error("Credential creation failed");return{id:Y.id,rawId:r0(Y.rawId),response:Y.response}}async function J4($,G){let X=await navigator.credentials.get({publicKey:{challenge:G,allowCredentials:[{id:q4($),type:"public-key"}],userVerification:"required"}});if(!X)throw new Error("Assertion failed");let Q=X.response;return{id:X.id,signature:r0(Q.signature),authenticatorData:r0(Q.authenticatorData),clientDataJSON:r0(Q.clientDataJSON)}}async function K4($,G){let X=crypto.getRandomValues(new Uint8Array(32)),Q=await navigator.credentials.get({publicKey:{challenge:X,allowCredentials:[{id:q4($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:G}}}}});if(!Q)throw new Error("Assertion failed");let Z=Q.getClientExtensionResults()?.prf?.results?.first;if(!Z)throw new Error("PRF extension not available");return new Uint8Array(Z)}var L4=typeof Buffer!=="undefined";function t0($){if(L4)return Buffer.from($).toString("hex");return Array.from($).map((G)=>G.toString(16).padStart(2,"0")).join("")}function e0($){if(L4)return Uint8Array.from(Buffer.from($,"hex"));let G=new Uint8Array($.length/2);for(let X=0;X<G.length;X++)G[X]=parseInt($.substring(X*2,X*2+2),16);return G}function j8($){if($.length===0)return"";let G=[0];for(let U of $){let Z=U;for(let Y=0;Y<G.length;Y++){let H=G[Y]*256+Z;G[Y]=H%58,Z=Math.floor(H/58)}while(Z>0)G.push(Z%58),Z=Math.floor(Z/58)}let X=0;for(let U of $){if(U!==0)break;X+=1}let Q="1".repeat(X);for(let U=G.length-1;U>=0;U--)Q+="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"[G[U]];return Q}function N4($){return`z${j8($)}`}var S$=237,h$=4608;function y$($){let G=[],X=$;while(X>=128)G.push(X&127|128),X>>=7;return G.push(X),new Uint8Array(G)}function k$($,G){let X=y$($),Q=new Uint8Array(X.length+G.length);return Q.set(X,0),Q.set(G,X.length),Q}function P4($,G){let Q=k$(G==="p256"?h$:S$,$);return`did:key:z${j8(Q)}`}var mG="eddsa-jcs-2022";class a4{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),G=localStorage.getItem("weba_passkey_pub");if($&&G){this.credentialId=$,this.publicKey=e0(G),this.publicKeyType="p256",this.usePasskey=!0;return}let X=localStorage.getItem("weba_private_key");if(X)this.edPrivateKey=e0(X),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{console.log("Registering Passkey for Form Signer...");let G=await B4("Form Signer"),X=new Uint8Array(G.response.attestationObject),U=n0(X).authData,Z=new DataView(U.buffer,U.byteOffset,U.byteLength),Y=53,H=Z.getUint16(Y);Y+=2,Y+=H;let B=U.slice(Y),J=n0(B),q=J.get(-2),L=J.get(-3);if(!q||!L)throw new Error("Invalid COSE Key: x or y missing");let O=new Uint8Array(65);if(O[0]=4,O.set(q,1),O.set(L,33),this.credentialId=G.rawId,this.publicKey=O,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",t0(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}async generateEdKey(){let{initWasmFromB64:$,ed25519GenerateKeyPair:G}=await Promise.resolve().then(() => (v8(),f8));await $();let{privateKey:X,publicKey:Q}=G();if(this.edPrivateKey=X,this.publicKey=Q,this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",t0(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return P4(this.publicKey,this.publicKeyType)}getPublicKey(){return this.publicKey?t0(this.publicKey):""}async sign($,G="authentication"){if(!this.publicKey)await this.register();let X=i4.default($),Q=new TextEncoder().encode(X);if(this.usePasskey&&this.credentialId){let U=await crypto.subtle.digest("SHA-256",Q),Z=await J4(this.credentialId,U);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:G,proofValue:Z.signature,"srn:authenticatorData":Z.authenticatorData,"srn:clientDataJSON":Z.clientDataJSON,"srn:credentialId":Z.id}}}else{if(!this.edPrivateKey)await this.generateEdKey();let{initWasmFromB64:U,ed25519Sign:Z}=await Promise.resolve().then(() => (v8(),f8));await U();let Y=Z(this.edPrivateKey,Q);return{...$,proof:{type:"DataIntegrityProof",cryptosuite:mG,created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:G,proofValue:N4(Y)}}}}async derivePrf($){if(!this.credentialId)return null;try{return await K4(this.credentialId,$)}catch(G){return console.error("PRF derivation failed",G),null}}}var F0=new a4;function gG($){let G=$.getElementById("json-debug"),X=G?.textContent||"";if($.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox"||Q.type==="radio")Q.checked=!1,Q.removeAttribute("checked");else Q.value="",Q.removeAttribute("value")}),$.querySelectorAll("textarea").forEach((Q)=>{Q.value="",Q.textContent=""}),$.querySelectorAll("select").forEach((Q)=>{Q.selectedIndex=-1,Q.querySelectorAll("option").forEach((U)=>U.removeAttribute("selected"))}),$.getElementById("json-ld")?.remove(),$.getElementById("data-layer")?.remove(),G&&X)G.textContent=X}function pG($,G){let X=JSON.stringify(G,null,2),Q=$.createElement("script");Q.type="application/ld+json",Q.id="weba-user-vc",Q.textContent=X,$.body.appendChild(Q);let U=$.createElement("div");U.className="weba-user-verification no-print",U.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",U.innerHTML=`
    <details>
      <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
        <span></span> 
      </summary>
      <div style="padding: 1rem 0;">
        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
      </div>
    </details>
  `;let Z=U.querySelector("pre");if(Z)Z.textContent=X;$.body.appendChild(U)}function cG($,G){let X=$.createElement("script");X.id="weba-l2-envelope",X.type="application/json",X.textContent=JSON.stringify(G,null,2),$.body.appendChild(X)}function uG($,G){let X=$.getElementById("weba-draft-state");if(X)X.remove();let Q=$.createElement("script");Q.id="weba-draft-state",Q.type="application/json",Q.textContent=JSON.stringify(G,null,2),$.body.appendChild(Q)}function lG($,G){let X=new Date,Q=X.getFullYear()+("0"+(X.getMonth()+1)).slice(-2)+("0"+X.getDate()).slice(-2)+"-"+("0"+X.getHours()).slice(-2)+("0"+X.getMinutes()).slice(-2),U=Math.random().toString(36).substring(2,8);return`${$}_${Q}_${G}_${U}.html`}function dG($){let G=$.createElement("script");G.id="weba-submitted",G.type="application/json",G.textContent=JSON.stringify({submitted:!0,submittedAt:new Date().toISOString()}),$.body.appendChild(G)}function nG($,G,X){let U=new DOMParser().parseFromString($,"text/html");if(X?.stripPlaintext)gG(U);if(X?.embeddedVc)pG(U,X.embeddedVc);if(X?.l2Envelope)cG(U,X.l2Envelope);if(X?.draftState)uG(U,X.draftState);if(G)dG(U);return U.documentElement.outerHTML}function r4($){let G=nG($.documentHtml,$.isFinal,$.options),X=new Blob([G],{type:"text/html"}),Q=URL.createObjectURL(X),U=document.createElement("a");if(U.href=Q,U.download=lG($.title,$.filenameSuffix),U.click(),$.isFinal)setTimeout(()=>window.location.reload(),1000)}class S8{overlay=null;show($){this.close();let{missingFields:G,onCancel:X,onSubmit:Q}=$,U=(navigator.language||"").toLowerCase().startsWith("ja"),Z=G.map((q)=>`<li>${this.escapeHtml(q.label||q.key)}</li>`).join(""),Y=U?{title:"",message:"",missingLabel:"",cancelBtn:"",submitBtn:""}:{title:"Incomplete Required Fields",message:"The following required fields are not filled. Do you want to submit anyway?",missingLabel:"Missing fields:",cancelBtn:"Go Back",submitBtn:"Submit Anyway"};this.overlay=document.createElement("div"),this.overlay.className="validation-dialog-overlay",this.overlay.innerHTML=`
            <div class="validation-dialog">
                <div class="validation-dialog-title">${this.escapeHtml(Y.title)}</div>
                <div class="validation-dialog-message">${this.escapeHtml(Y.message)}</div>
                <div class="validation-missing-fields">
                    <strong>${this.escapeHtml(Y.missingLabel)}</strong>
                    <ul>${Z}</ul>
                </div>
                <div class="validation-dialog-actions">
                    <button class="validation-dialog-btn validation-dialog-btn-cancel" data-action="dialog-cancel">
                        ${this.escapeHtml(Y.cancelBtn)}
                    </button>
                    <button class="validation-dialog-btn validation-dialog-btn-submit" data-action="dialog-submit">
                        ${this.escapeHtml(Y.submitBtn)}
                    </button>
                </div>
            </div>
        `;let H=this.overlay.querySelector('[data-action="dialog-cancel"]'),B=this.overlay.querySelector('[data-action="dialog-submit"]');H?.addEventListener("click",()=>{this.close(),X()}),B?.addEventListener("click",()=>{this.close(),Q()}),this.overlay.addEventListener("click",(q)=>{if(q.target===this.overlay)this.close(),X()});let J=(q)=>{if(q.key==="Escape")this.close(),X(),document.removeEventListener("keydown",J)};document.addEventListener("keydown",J),document.body.appendChild(this.overlay)}close(){if(this.overlay)this.overlay.remove(),this.overlay=null}escapeHtml($){let G=document.createElement("div");return G.textContent=$,G.innerHTML}}function h8(){let G=window.generatedJsonStructure;if(!G||!G.fields)return{isValid:!0,missingFields:[]};let X=[],Q=Array.from(document.querySelectorAll("input, select, textarea"));for(let U of Q){if(U.offsetParent===null)continue;if(U.disabled)continue;let Z=U.dataset.jsonPath||U.name;if(!Z)continue;let Y=G.fields.find((H)=>H.key===Z);if(Y&&Y.required){let H=!1;if(U.type==="checkbox")H=!U.checked;else if(U.type==="radio"){let B=document.getElementsByName(U.name),J=!1;for(let q=0;q<B.length;q++)if(B[q].checked){J=!0;break}H=!J}else H=!U.value.trim();if(H&&!X.find((B)=>B.key===Z))X.push({key:Z,label:Y.label||Z,type:Y.type||"text"})}}return{isValid:X.length===0,missingFields:X}}class k0{formId;static DRAFT_STATE_VERSION=1;static L2_REPLAY_STORE_KEY="weba_l2_nonces";currentSecurityTier="standard";validationDialog;constructor(){this.formId="WebA_"+window.location.pathname,this.validationDialog=new S8}updateSecurityUI($){this.currentSecurityTier=$;let G=new CustomEvent("weba-security-tier-change",{detail:{tier:$}});window.dispatchEvent(G)}updateJsonLd(){let $={};document.querySelectorAll("[data-json-path]").forEach((Q)=>{let U=Q.dataset.jsonPath;if(U)if(Q.type==="tel")$[U]=Q.value.replace(/[^0-9]/g,"");else $[U]=Q.value}),document.querySelectorAll('[type="radio"]:checked').forEach((Q)=>{$[Q.name]=Q.value}),document.querySelectorAll("table.data-table.dynamic").forEach((Q)=>{let U=Q.dataset.tableKey;if(U){let Z=[];Q.querySelectorAll("tbody tr").forEach((Y)=>{let H={},B=!1;if(Y.querySelectorAll("[data-base-key]").forEach((J)=>{if(J.type==="checkbox"){if(H[J.dataset.baseKey]=J.checked,J.checked)B=!0}else if(H[J.dataset.baseKey]=J.value,J.value)B=!0}),B)Z.push(H)}),$[U]=Z}});let G=document.getElementById("json-ld");if(G)G.textContent=JSON.stringify($,null,2);let X=document.getElementById("json-debug");if(X)X.textContent=JSON.stringify($,null,2);return $}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=h8();if(!$.isValid){this.validationDialog.show({missingFields:$.missingFields,onCancel:()=>{console.log("[DataManager] User cancelled submission")},onSubmit:()=>{console.log("[DataManager] User confirmed submission despite missing fields"),this.performSignAndDownload()}});return}this.performSignAndDownload()}async performSignAndDownload(){let $=this.updateJsonLd(),G=window,X=G.generatedJsonStructure&&G.generatedJsonStructure.name||"Response",Q=window.location.href.split("#")[0],U=this.getL2Config(),Z=document.getElementById("weba-l2-encrypt");if(!!(U?.enabled&&(Z?Z.checked:U.default_enabled))){if(!U?.recipient_kid||!U?.recipient_x25519||!U?.layer1_ref){alert("L2 encryption config is missing required fields.");return}let B={...U},J="offline";if(U.prekey_url)try{let{fetchPreKey:O}=await Promise.resolve().then(() => X8),D=await O(U.prekey_url);if(D){if(console.log("Tier 3 Active: Using dynamic pre-key",D.kid),B.recipient_kid=D.kid,B.recipient_x25519=D.recipient_x25519,D.recipient_pqc)B.recipient_pqc=D.recipient_pqc;J="high"}}catch(O){console.warn("Tier 3 Failed. Falling back to Tier 2.")}if(J==="offline"&&U.epoch_registry_url)try{let{fetchEpochRegistry:O,selectEpochKey:D}=await Promise.resolve().then(() => X8),j=await O(U.epoch_registry_url);if(j){let I=D(j);if(I)console.log("Tier 2 Active: Using epoch key",I.kid),B.recipient_kid=I.kid,B.recipient_x25519=I.publicKey,J="standard"}}catch(O){console.warn("Tier 2 Failed. Falling back to Tier 1.")}if(J==="offline")console.log("Tier 1 Active: Using static master key (Offline Mode)");this.updateSecurityUI(J);let q=U.user_kid,L=document.getElementById("weba-guest-did-opt");if(L&&L.checked)try{let{getOrCreateGuestDid:O}=await Promise.resolve().then(() => $$),{did:D,isReused:j}=await O();q=D,console.log(`Using Guest DID: ${D} (Reused: ${j})`)}catch(O){if(console.error("Guest DID creation failed:",O),!confirm("Failed to create/retrieve Guest DID for replies. Continue with anonymous submission?"))return}try{let{buildLayer2Envelope:O}=await Promise.resolve().then(() => X8),D=await O({layer2_plain:$,config:B,user_kid:q||"anonymous"});this.downloadHtml("submit",!0,{l2Envelope:D,stripPlaintext:!0})}catch(O){console.error(O),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!F0.getPublicKey()){if(!await F0.register()){alert("Key registration failed.");return}}let H={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:F0.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:Q,answers:$}};try{let B=new Set;document.querySelectorAll("[data-json-path]").forEach((O)=>B.add(O.dataset.jsonPath)),document.querySelectorAll('[type="radio"]').forEach((O)=>B.add(O.name)),document.querySelectorAll("table.data-table.dynamic").forEach((O)=>B.add(O.dataset.tableKey));let J=[],q=H.credentialSubject.answers;for(let O in q)if(!B.has(O)&&!O.startsWith("@")&&O!=="type"&&O!=="templateId"&&O!=="id")J.push(O);if(J.length>0){if(!confirm(`WARNING: HMP Variance Detected.

The following hidden fields will be signed but are not visible in the form UI:
- ${J.join(`
- `)}

Continue signing?`))return}let L=await F0.sign(H);this.downloadHtml("submitted",!0,{embeddedVc:L})}catch(B){console.error(B),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let G=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((X)=>{let Q=X.dataset.jsonPath;if(G[Q]!==void 0)X.value=G[Q]}),document.querySelectorAll("table.data-table.dynamic").forEach((X)=>{let Q=X.dataset.tableKey,U=G[Q];if(Array.isArray(U)){let Z=X.querySelector("tbody");if(!Z)return;let Y=Z.querySelectorAll(".template-row");U.forEach((H,B)=>{let J;if(B===0)J=Z.querySelector(".template-row");else{let q=Z.querySelector(".template-row");if(q){J=q.cloneNode(!0),J.classList.remove("template-row");let L=J.querySelector(".remove-row-btn");if(L)L.style.visibility="visible";Z.appendChild(J)}}if(J)J.querySelectorAll("input, select").forEach((q)=>{let L=q.dataset.baseKey;if(L&&H[L]!==void 0)if(q.type==="checkbox")q.checked=!!H[L];else q.value=H[L]})})}})}catch(G){console.error(G)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,G,X){let Q=window,U=Q.generatedJsonStructure&&Q.generatedJsonStructure.name||"web-a-form";r4({documentHtml:document.documentElement.outerHTML,title:U,filenameSuffix:$,isFinal:G,...X?{options:X}:{}})}buildDraftState(){let $=this.updateJsonLd(),G=new Date().toISOString(),X=localStorage.getItem(k0.L2_REPLAY_STORE_KEY),Q;if(X)try{let U=JSON.parse(X);if(Array.isArray(U))Q=U.filter((Z)=>typeof Z==="string")}catch(U){console.warn("Failed to parse L2 replay store for draft",U)}return{version:k0.DRAFT_STATE_VERSION,savedAt:G,formId:this.formId,formData:$,...Q?{l2State:{replayNonces:Q}}:{}}}saveDraft(){let $=this.buildDraftState();this.bakeValues(),this.downloadHtml("draft",!1,{draftState:$})}submitDocument(){let $=h8();if(!$.isValid){this.validationDialog.show({missingFields:$.missingFields,onCancel:()=>{console.log("[DataManager] User cancelled submission")},onSubmit:()=>{console.log("[DataManager] User confirmed submission despite missing fields"),this.performSubmitDocument()}});return}this.performSubmitDocument()}performSubmitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class y8{calc;data;constructor($,G){this.calc=$,this.data=G,this.initSecuritySignal()}initSecuritySignal(){window.addEventListener("weba-security-tier-change",($)=>{this.updateSecurityBadge($.detail.tier)})}updateSecurityBadge($){let G=document.getElementById("weba-security-signal");if(!G)return;let X=(navigator.language||"").toLowerCase().startsWith("ja"),Q={high:X?":  (True PFS)":"Security: HIGH (True PFS)",standard:X?":  (Epoch-Based)":"Security: STANDARD (Epoch)",offline:X?":  (Offline/Static)":"Security: BASIC (Offline)"};G.textContent=Q[$],G.className=`security-badge tier-${$}`;let U=document.createElement("span");U.className="status-dot",G.prepend(U)}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save",clear_btn:"Clear",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},G=(navigator.language||"en").startsWith("ja")?"ja":"en",X=$[G]||$.en;document.querySelectorAll("[data-i18n]").forEach((Q)=>{let U=Q.dataset.i18n;if(X[U])Q.textContent=X[U]})}initTelFormatter(){document.querySelectorAll('input[type="tel"]').forEach(($)=>{if($.value)$.value=this.formatTelDisplay($.value);$.addEventListener("input",(G)=>{let X=G.target.selectionStart,Q=G.target.value,U=Q.replace(/[^0-9]/g,""),Z=this.formatTelDisplay(U);if(Z!==Q){G.target.value=Z;let Y=Z.length-Q.length;G.target.setSelectionRange(X+Y,X+Y)}}),$.addEventListener("blur",(G)=>{let X=G.target.value.replace(/[^0-9]/g,"");$.dataset.cleanValue=X})})}formatTelDisplay($){let G=$.replace(/[^0-9]/g,"");if(G.length===0)return"";if(G.length===11&&G.startsWith("0"))return G.replace(/^(\d{3})(\d{4})(\d{4})$/,"$1-$2-$3");else if(G.length===10&&G.startsWith("0"))if(G.startsWith("0120")||G.startsWith("0800"))return G.replace(/^(\d{4})(\d{3})(\d{3})$/,"$1-$2-$3");else if(["03","04","06"].includes(G.substring(0,2)))return G.replace(/^(\d{2})(\d{4})(\d{4})$/,"$1-$2-$3");else return G.replace(/^(\d{3})(\d{3})(\d{4})$/,"$1-$2-$3");return G}initTables(){document.querySelectorAll(".data-table.dynamic tbody, .dynamic-container").forEach(($)=>{this.renumberRows($)})}renumberRows($){let G=Array.from($.querySelectorAll("tr"));if(G.length===0)G=Array.from($.querySelectorAll(".dynamic-row"));G.filter((Q)=>{return Q.tagName!=="TR"||Q.querySelectorAll("td").length>0}).forEach((Q,U)=>{let Z=U+1;Q.querySelectorAll(".auto-num").forEach((Y)=>{if(Y.value!=Z)Y.value=Z.toString(),Y.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let G=$.closest("tr")||$.closest(".dynamic-row");if(!G)return;let X=G.parentElement;if(G.classList.contains("template-row"))G.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox")Q.checked=!1;else Q.value=""});else{if(G.remove(),X)this.renumberRows(X);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,G){let X=document.getElementById("tbl_"+G);if(!X)return;let Q=X.querySelector("tbody")||X;if(!Q)return;let U=Q.querySelector(".template-row");if(!U)return;let Z=U.cloneNode(!0);Z.classList.remove("template-row"),Z.querySelectorAll("input").forEach((H)=>{if(H.type==="checkbox")H.checked=H.hasAttribute("checked");else H.value=H.getAttribute("value")||""});let Y=Z.querySelector(".remove-row-btn");if(Y)Y.style.visibility="visible";Z.querySelectorAll("[data-copy-from]").forEach((H)=>{let B=H.dataset.copyFrom;if(B){let J=Z.querySelector(`[data-base-key="${B}"]`);if(J&&J.value)H.value=J.value}}),Q.appendChild(Z),this.renumberRows(Q),this.calc.recalculate()}switchTab($,G){document.querySelectorAll(".tab-btn").forEach((Q)=>Q.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((Q)=>Q.classList.remove("active")),$.classList.add("active");let X=document.getElementById(G);if(X)X.classList.add("active")}updateVisibility(){document.querySelectorAll("[data-show-if]").forEach(($)=>{let G=$.dataset.showIf;if(!G)return;let X=G.match(/^([a-zA-Z0-9_]+)\s*(==|!=)\s*(['"]?)(.*?)\3$/),Q=!0;if(X){let[Z,Y,H,B,J]=X,q=document.querySelector(`[data-json-path="${Y}"]`);if(!q){let L=$.closest("tr");if(L)q=L.querySelector(`[data-json-path="${Y}"]`)}if(q){let L=(q.type==="checkbox"||q.type==="radio")&&q.checked?"true":(q.type==="checkbox"||q.type==="radio")&&!q.checked?"false":q.value;if(q.type==="radio"){let D=q.name,j=document.querySelector(`input[name="${D}"]:checked`)}let O=q.value;if(q.type==="checkbox")O=q.checked?"true":"false";if(q.type==="radio"){let D=q.name,j=document.querySelector(`input[name="${D}"]:checked`);O=j?j.value:""}if(H==="==")Q=O==J;if(H==="!=")Q=O!=J}else Q=!1}else{let Z=G.trim(),Y=document.querySelector(`[data-json-path="${Z}"]`);if(Y)if(Y.type==="checkbox")Q=Y.checked;else Q=!!Y.value;else Q=!1}let U=$.closest(".form-row");if(U)U.style.display=Q?"":"none",U.querySelectorAll("input, select, textarea").forEach((Y)=>{Y.disabled=!Q});else if($.style.display=Q?"":"none",$ instanceof HTMLInputElement||$ instanceof HTMLSelectElement||$ instanceof HTMLTextAreaElement)$.disabled=!Q})}}function R0($){let G=($.dataset.jsonPath||$.dataset.baseKey||$.name||$.id||"").toLowerCase(),X=[".","_","-"];for(let Q of X){if(!G.includes(Q))continue;let U=G.split(Q);if(U.length<2)continue;let Z=U[U.length-1];return{group:U.slice(0,-1).join(Q),separator:Q,fieldType:Z,raw:G}}return{group:null,separator:null,fieldType:G,raw:G}}function Q8($,G){if(!$.group||!G.group)return!1;return $.group===G.group&&$.separator===G.separator}function D0($){if(!$)return null;if($.match(/zip|postal|postcode|/))return"zip";if($.match(/pref|/))return"pref";if($.match(/city||/))return"city";if($.match(/town|||/))return"town";if($.match(/address|/)&&!$.match(/detail|sub||building|room|mansion|house/))return"address";return null}function X$(){console.log("Web/A Runtime Booting...");let $=new H8,G=new k0,X=new y8($,G),Q=window,U=()=>{if(Q.postalLookup&&!Q.__postalInitialized)Q.__postalInitialized=!0,Q.postalLookup.autoInit().then(()=>console.log("\uD83D\uDCEE Postal lookup ready."))},Z=()=>{if(Q.lgLookup&&!Q.__lgInitialized)Q.__lgInitialized=!0,Q.lgLookup.autoInit().then(()=>console.log("\uD83C\uDFDB LG lookup ready."))};(async()=>{let J=Q.__WEBA_MANIFEST;if(J&&J.blobs){let L=J.blobs.find((O)=>O.id==="weba-structure");if(L&&L.urls){console.log("[Runtime] Found weba-structure in manifest");for(let O of L.urls)try{let D;if(O.startsWith("#")){let I=document.querySelector(O);if(!I||!I.textContent)continue;let E=atob(I.textContent.trim()),u=new Uint8Array(E.length);for(let p=0;p<E.length;p++)u[p]=E.charCodeAt(p);if(L.mediaType==="application/x-gzip"){let p=new Blob([u]).stream().pipeThrough(new DecompressionStream("gzip"));D=await new Response(p).text()}else D=new TextDecoder().decode(u)}else{let I=await fetch(O);if(!I.ok)continue;D=await I.text()}let j=JSON.parse(D);return console.log("[Runtime] Structure data loaded from blob. Keys:",Object.keys(j)),j}catch(D){console.warn("[Runtime] Failed to load structure from:",O,D)}}}let q=document.getElementById("weba-structure");if(q)return console.log("[Runtime] Loading structure from direct element"),await G$(q);return console.warn("[Runtime] weba-structure not found in manifest or DOM"),null})().then((J)=>{if(J){if(Q.generatedJsonStructure=J,console.log("[Runtime] generatedJsonStructure set"),X.applyI18n(),X.initTelFormatter(),$.recalculate(),X.updateVisibility(),k8(),Q.SearchEngine&&typeof Q.SearchEngine.init==="function")console.log("[Runtime] Calling SearchEngine.init()..."),Q.SearchEngine.init().catch((q)=>console.error("SearchEngine init failed:",q))}else console.warn("[Runtime] Failed to load structure data")}).catch((J)=>{console.error("[Runtime] Error loading structure:",J)});let H=document.getElementById("weba-l2-config");if(H)G$(H).then((J)=>{if(J)Q.webaL2Config=J,jX(J),EX(J)});if(Q.saveDraft=()=>G.saveDraft(),Q.submitDocument=()=>G.submitDocument(),Q.signAndDownload=()=>G.signAndDownload(),Q.clearData=()=>G.clearData(),Q.removeTableRow=(J)=>X.removeTableRow(J),Q.addTableRow=(J,q)=>X.addTableRow(J,q),Q.switchTab=(J,q)=>X.switchTab(J,q),Q.recalculate=()=>$.recalculate(),G.restoreFromLS(),X.applyI18n(),X.initTables(),$.recalculate(),Q.initL2Viewer)Q.initL2Viewer();if(Q.initKeywrapTool)Q.initKeywrapTool();if(Q.initAggregatorBrowser)Q.initAggregatorBrowser();U(),Z();let B;document.addEventListener("input",(J)=>{let q=J.target;if(!q||q.tagName!=="INPUT")return;if(J.isTrusted)q.dataset.dirty="true";let L=(q.dataset.jsonPath||q.name||"").toLowerCase(),O=q.value.trim(),D=Q.postalLookup,j=q.classList.contains("search-input");if(D&&D.isReady()&&!j){L=(q.dataset.jsonPath||q.dataset.baseKey||q.name||q.id||"").toLowerCase();let E=(q.placeholder||"").toLowerCase(),u=q.dataset.autofill||"",p="";if(u.startsWith("postal:"))p=u.replace("postal:","");else if(L.match(/zip|postal|postcode|/)&&!L.match(/pref|city|town|address|||/)||E.match(/|zip|postal/))p="zip";else if(L.match(/pref|/))p="pref";else if(L.match(/city|/))p="city";else if(L.match(/town||/))p="town";else if(L.match(/address|/))p="address";if(p){let x=q.getAttribute("list");if(!x){x=`dl-${Math.random().toString(36).substring(2,7)}`,q.setAttribute("list",x);let f=document.createElement("datalist");f.id=x,document.body.appendChild(f)}let w=document.getElementById(x);if(p==="zip"){let f=O.replace(/[^0-9]/g,"");if(w&&f.length>=3){let v=D.suggest(f,50);w.innerHTML=v.map((T)=>`<option value="${T.zip.substring(0,3)}-${T.zip.substring(3)}">${T.pref}${T.city}${T.town}</option><option value="${T.zip}">${T.pref}${T.city}${T.town}</option>`).join("")}if(f.length===7){let v=D.lookup(f);if(v)VX(q,v,q.closest("tr")||q.closest(".dynamic-row")||q.closest(".address-group")||q.closest("table")||q.closest("form")||document.body)}}else if(p==="pref"){if(w&&O.length>=1){let f=D.suggestByAddress(O,50),v=[...new Set(f.map((T)=>T.pref))].slice(0,10);w.innerHTML=v.map((T)=>`<option value="${T}">${T}</option>`).join("")}}else if(p==="city"){if(w&&O.length>=1){let f=D.suggestByAddress(O,50),v=[...new Set(f.map((T)=>T.city))].slice(0,20);w.innerHTML=v.map((T)=>`<option value="${T}">${T}</option>`).join("")}}else if(p==="town"||p==="address"){if(w&&O.length>=2){let f=D.suggestByAddress(O,30);w.innerHTML=f.map((v)=>`<option value="${v.town}">${v.pref}${v.city}${v.town}</option>`).join("")}}}}let I=Q.lgLookup;if(I&&I.isReady()&&!j){let E=q.dataset.autofill||"",u=(x)=>{let w=x.closest("tr")||x.closest(".dynamic-row")||x.closest(".group")||x.closest("form")||document.body,f=Array.from(w.querySelectorAll("input, select, textarea")),v=null,T=null,n=null;return f.forEach((d)=>{let B0=d.dataset.autofill||"",z0=(d.dataset.jsonPath||d.name||d.id||"").toLowerCase();if(B0==="lg"||z0.match(/lg_code|lgcode|/))v=d;else if(B0==="lg:pref"||z0.match(/pref|/))T=d;else if(B0==="lg:city"||z0.match(/city|/))n=d}),{codeField:v,prefField:T,cityField:n}},p=(x,w)=>{let{codeField:f,prefField:v,cityField:T}=u(w);[{field:f,value:x.code},{field:v,value:x.pref},{field:T,value:x.city}].forEach(({field:n,value:d})=>{if(n&&n!==w&&d&&n.value!==d)n.value=d,n.dataset.dirty="true",n.style.backgroundColor="#e0f2fe",setTimeout(()=>{n.style.backgroundColor=""},500),n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))})};if(E==="lg"){let x=q.getAttribute("list");if(!x){x=`dl-lg-${Math.random().toString(36).substring(2,7)}`,q.setAttribute("list",x);let v=document.createElement("datalist");v.id=x,document.body.appendChild(v)}let w=document.getElementById(x),f=O.replace(/[^0-9]/g,"");if(w&&f.length>=2&&f.length<6){let v=I.suggest(f,30);w.innerHTML=v.map((T)=>`<option value="${T.code}">${T.pref} ${T.city}</option>`).join("")}if(f.length===6){let v=I.lookup(f);if(v)p(v,q)}}else if(E==="lg:pref"){let x=q.getAttribute("list");if(!x){x=`dl-lg-pref-${Math.random().toString(36).substring(2,7)}`,q.setAttribute("list",x);let f=document.createElement("datalist");f.id=x,document.body.appendChild(f)}let w=document.getElementById(x);if(w&&O.length>=1){let v=I.getUniquePrefectures().filter((T)=>T.includes(O)).slice(0,20);w.innerHTML=v.map((T)=>`<option value="${T}">${T}</option>`).join("")}}else if(E==="lg:city"){let x=q.getAttribute("list");if(!x){x=`dl-lg-city-${Math.random().toString(36).substring(2,7)}`,q.setAttribute("list",x);let f=document.createElement("datalist");f.id=x,document.body.appendChild(f)}let w=document.getElementById(x);if(w&&O.length>=1){let{prefField:f}=u(q),v=f?f.value.trim():"",T;if(v)T=I.suggestCitiesByPref(v,O,30),w.innerHTML=T.map((d)=>`<option value="${d.city}">${d.city}</option>`).join("");else T=I.suggestByCity(O,void 0,30),w.innerHTML=T.map((d)=>`<option value="${d.city}">${d.pref} ${d.city}</option>`).join("");let n=T.find((d)=>d.city===O);if(n)p(n,q)}}}if(q.classList.contains("search-input")&&Q.SearchEngine);if(L)(q.closest("tr")||q.closest(".dynamic-row")||q.closest(".group")||document).querySelectorAll(`[data-copy-from="${L}"]`).forEach((u)=>{if(!u.dataset.dirty&&u.value!==q.value)u.value=q.value,u.dispatchEvent(new Event("input",{bubbles:!0}))});$.recalculate(),X.updateVisibility(),G.updateJsonLd(),k8(),clearTimeout(B),B=setTimeout(()=>G.saveToLS(),1000)}),setTimeout(k8,500),document.addEventListener("change",(J)=>{let q=J.target;if(!q||q.tagName!=="INPUT")return;let L=q.dataset.autofill||"",O=Q.lgLookup;if(O&&O.isReady()&&L==="lg:city"){let D=q.value.trim();if(!D)return;let j=q.closest("tr")||q.closest(".dynamic-row")||q.closest(".group")||q.closest("form")||document.body,I=Array.from(j.querySelectorAll("input, select, textarea")),E=null;I.forEach((w)=>{let f=w.dataset.autofill||"",v=(w.dataset.jsonPath||w.name||w.id||"").toLowerCase();if(f==="lg:pref"||v.match(/pref|/))E=w});let u=E?E.value.trim():"",x=(u?O.suggestCitiesByPref(u,D,50):O.suggestByCity(D,void 0,50)).find((w)=>w.city===D);if(x)I.forEach((w)=>{if(w===q)return;let f=w.dataset.autofill||"",v=(w.dataset.jsonPath||w.name||w.id||"").toLowerCase(),T="";if(f==="lg"||v.match(/lg_code|lgcode|/))T=x.code;else if(f==="lg:pref"||v.match(/pref|/))T=x.pref;if(T&&w.value!==T)w.value=T,w.dataset.dirty="true",w.style.backgroundColor="#e0f2fe",setTimeout(()=>{w.style.backgroundColor=""},500),w.dispatchEvent(new Event("input",{bubbles:!0})),w.dispatchEvent(new Event("change",{bubbles:!0}))}),$.recalculate(),X.updateVisibility(),G.updateJsonLd()}}),console.log("Web/A Runtime Ready.")}function IX(){let $=window;if(!$.generatedJsonStructure||!$.generatedJsonStructure.fields)return!1;let G=Array.from(document.querySelectorAll("input, select, textarea"));for(let X of G){if(X.offsetParent===null)continue;let Q=X.dataset.jsonPath||X.name;if(!Q)continue;let U=$.generatedJsonStructure.fields.find((Z)=>Z.key===Q);if(U&&U.required){if(X.type==="checkbox"){if(!X.checked)return console.log(`[Validation] Required Checkbox missing: ${Q}`),!1}else if(X.type==="radio"){let Z=document.getElementsByName(X.name),Y=!1;for(let H=0;H<Z.length;H++)if(Z[H].checked){Y=!0;break}if(!Y)return console.log(`[Validation] Required Radio missing: ${Q}`),!1}else if(!X.value.trim())return console.log(`[Validation] Required Field empty: ${Q}`),!1}}return!0}function k8(){let $=document.getElementById("btn-submit");if(!$)return;if(IX())$.classList.remove("btn-submit-incomplete"),$.classList.add("btn-submit-ready"),$.title="";else{$.classList.remove("btn-submit-ready"),$.classList.add("btn-submit-incomplete");let X=(navigator.language||"").toLowerCase().startsWith("ja");$.title=X?"":"Required fields missing (click to review)"}}function VX($,G,X,Q=!1){let U=R0($);if(!U.group){console.warn("[fillAddress] :",U.raw);return}let Y=Array.from(X.querySelectorAll("input, select, textarea")).map((q)=>({element:q,parsed:R0(q)})).filter(({parsed:q})=>Q8(U,q)),H=Y.some(({element:q,parsed:L})=>{if(q===$)return!1;return D0(L.fieldType||"")==="pref"}),B=Y.some(({element:q,parsed:L})=>{if(q===$)return!1;return D0(L.fieldType||"")==="city"}),J=Y.some(({element:q,parsed:L})=>{if(q===$)return!1;return D0(L.fieldType||"")==="town"});Y.forEach(({element:q,parsed:L})=>{if(q===$)return;let O=D0(L.fieldType||""),D="";if(Q&&O==="zip")D=G.zip.substring(0,3)+"-"+G.zip.substring(3);else if(O==="pref")D=G.pref;else if(O==="city")D=G.city;else if(O==="town")D=G.town;else if(O==="address"){if(!H&&!B&&!J)D=`${G.pref}${G.city}${G.town}`;else if(H&&!B&&!J)D=`${G.city}${G.town}`;else if(!J)D=G.town}if(D&&q.value!==D)q.value=D,q.dataset.dirty="true",q.style.backgroundColor="#e0f2fe",setTimeout(()=>{q.style.backgroundColor=""},500),q.dispatchEvent(new Event("input",{bubbles:!0})),q.dispatchEvent(new Event("change",{bubbles:!0}))})}async function G$($){if(!$.textContent)return null;let G=$.textContent.trim();if($.type==="application/x-gzip")try{let X=atob(G),Q=new Uint8Array(X.length);for(let Z=0;Z<X.length;Z++)Q[Z]=X.charCodeAt(Z);let U=new Blob([Q]).stream().pipeThrough(new DecompressionStream("gzip"));G=await new Response(U).text()}catch(X){return null}try{return JSON.parse(G)}catch(X){return null}}function jX($){let G=document.querySelector(".form-toolbar");if(!G)return;let X=document.createElement("div");X.id="weba-security-signal",X.className="security-badge",G.appendChild(X),(async()=>{let Q="offline";if($.prekey_url)try{if((await fetch($.prekey_url,{method:"HEAD"})).ok)Q="high"}catch(U){}window.dispatchEvent(new CustomEvent("weba-security-tier-change",{detail:{tier:Q}}))})()}function EX($){if(!$?.enabled||!window.PublicKeyCredential)return;let G=document.querySelector('button[onclick*="signAndDownload"]');if(G&&G.parentElement){let X=document.createElement("div");X.className="weba-guest-opt no-print",X.style.cssText="display:flex;align-items:center;gap:6px;margin-right:12px;",X.innerHTML='<input type="checkbox" id="weba-guest-did-opt"><label for="weba-guest-did-opt" style="font-size:13px;color:#555;cursor:pointer;"> (Passkey)</label>',G.parentElement.insertBefore(X,G)}}var U8=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];class Q${data={};initialized=!1;instanceId=Math.random().toString(36).substring(7);constructor(){console.log("[PostalLookup] New instance created:",this.instanceId)}async loadFromBase64($){try{let G=atob($),X=new Uint8Array(G.length);for(let U=0;U<G.length;U++)X[U]=G.charCodeAt(U);let Q;if(X[0]===31&&X[1]===139)if(typeof DecompressionStream!=="undefined"){let U=new DecompressionStream("gzip"),Z=new Blob([X]).stream().pipeThrough(U);Q=await new Response(Z).text()}else throw new Error("DecompressionStream not supported");else Q=new TextDecoder().decode(X);this.data=JSON.parse(Q),this.initialized=!0,console.log("\uD83D\uDCEE Postal lookup initialized:",Object.keys(this.data).length,"prefixes","[Instance:",this.instanceId+"]")}catch(G){console.error("Failed to load postal data:",G)}}async loadFromManifest(){let $=window.__WEBA_MANIFEST;if(!$||!$.blobs)return!1;let G=$.blobs.find((X)=>X.id==="jp-postal");if(!G||!G.urls||G.urls.length===0)return!1;for(let X of G.urls)try{if(X.startsWith("#")){let Q=document.querySelector(X);if(Q&&Q.textContent){if(console.log("\uD83D\uDCEE Loading postal data from embedded source:",X),await this.loadFromBase64(Q.textContent.trim()),this.initialized)return this._activeDigest=G.digest,!0}}else{console.log("\uD83D\uDCEE Loading postal data from network:",X);let Q=await fetch(X);if(!Q.ok)continue;let U=await Q.blob(),Z,Y=new Uint8Array(await U.slice(0,2).arrayBuffer());if(Y[0]===31&&Y[1]===139)if(typeof DecompressionStream!=="undefined"){let H=new DecompressionStream("gzip"),B=U.stream().pipeThrough(H);Z=await new Response(B).text()}else throw new Error("DecompressionStream not supported");else Z=await U.text();return this.data=JSON.parse(Z),this.initialized=!0,this._activeDigest=G.digest,console.log("\uD83D\uDCEE Postal lookup initialized via Network:",Object.keys(this.data).length,"prefixes"),!0}}catch(Q){console.warn(`Failed to load postal from ${X}:`,Q)}return!1}async autoInit(){if(this.initialized){console.log("\uD83D\uDCEE Postal lookup already initialized, skipping");return}if(await this.loadFromManifest())return;let $=document.getElementById("weba-postal-data");if($&&$.textContent)await this.loadFromBase64($.textContent.trim());else console.warn("No postal data found in document")}getActiveDigest(){return this._activeDigest||null}lookup($){if(!this.initialized)return null;let G=$.replace(/[^0-9]/g,"");if(G.length!==7)return null;let X=G.substring(0,3),Q=G.substring(3),U=this.data[X];if(!U)return null;let Z=U.t.find(([Y])=>Y===Q);if(!Z)return null;return{zip:G,pref:U8[U.p-1],city:Z[1],town:Z[2]}}suggest($,G=50){if(!this.initialized)return[];let X=$.replace(/[^0-9]/g,"");if(X.length<3)return[];let Q=X.substring(0,3),U=X.substring(3),Z=[],Y=this.data[Q];if(Y){for(let[H,B,J]of Y.t)if(!U||H.startsWith(U)){if(Z.push({zip:Q+H,pref:U8[Y.p-1],city:B,town:J}),Z.length>=G)return Z}}return Z}getPrefixCandidates($){if(!this.initialized)return[];let G=$.replace(/[^0-9]/g,"");if(G.length!==3)return[];let X=this.data[G];if(!X)return[];return X.t.map(([Q,U,Z])=>({zip:G+Q,pref:U8[X.p-1],city:U,town:Z}))}suggestByAddress($,G=30){if(!this.initialized||$.length<2)return[];let X=[],Q=$.trim();for(let U in this.data){if(!Object.prototype.hasOwnProperty.call(this.data,U))continue;let Z=this.data[U];if(!Z)continue;let Y=U8[Z.p-1]||"";for(let[H,B,J]of Z.t)if((Y+B+J).includes(Q)){if(X.push({zip:U+H,pref:Y,city:B,town:J}),X.length>=G)return X}}return X}isReady(){return this.initialized}}var b8=new Q$;if(typeof window!=="undefined")if(!window.postalLookup)console.log("[PostalLookup] Registering instance to window:",b8.instanceId),window.postalLookup=b8;else console.log("[PostalLookup] window.postalLookup already exists, skipping registration. Existing instance:",window.postalLookup.instanceId,"New instance:",b8.instanceId);function b0($){if(!$)return"";return $.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}class m8{suggestionsVisible=!1;activeSearchInput=null;globalBox=null;postalReady=!1;constructor(){}async initPostalLookup(){try{let $=window.postalLookup;if($){if(await $.autoInit(),this.postalReady=$.isReady(),this.postalReady)console.log("\uD83D\uDCEE Postal lookup enabled")}}catch($){console.warn("Postal lookup not available:",$)}}async init(){console.log("Initializing Search Engine (Bundle)..."),await this.initPostalLookup();let G=window.generatedJsonStructure;if(G){if(G.masterDataRefs)await this.loadMasterDataFromBlobs(G);if(G.masterData){let X=Object.keys(G.masterData);console.log("Master Data Keys available:",X.join(", "))}}this.setupEventDelegation(),console.log("Search Engine ready. Postal enabled:",this.postalReady)}async loadMasterDataFromBlobs($){let G=window.__WEBA_MANIFEST;if(!G||!G.blobs)return;let X=$.masterDataRefs;$.masterData=$.masterData||{};for(let[Q,U]of Object.entries(X)){let Z=G.blobs.find((Y)=>Y.digest===U);if(!Z||!Z.urls)continue;for(let Y of Z.urls)try{let H;if(Y.startsWith("#")){let B=document.querySelector(Y);if(!B||!B.textContent)continue;let J=atob(B.textContent.trim()),q=new Uint8Array(J.length);for(let O=0;O<J.length;O++)q[O]=J.charCodeAt(O);let L=new Blob([q]).stream().pipeThrough(new DecompressionStream("gzip"));H=await new Response(L).text()}else{let B=await fetch(Y);if(!B.ok)continue;H=await B.text()}$.masterData[Q]=JSON.parse(H),console.log(`\uD83D\uDCEE Master data '${Q}' loaded from blob:`,U);break}catch(H){console.warn(`Failed to load master data blob ${Q} from ${Y}:`,H)}}}normalize($){if(!$)return"";let G=$.toString().toLowerCase();return G=G.replace(/[---]/g,(X)=>{return String.fromCharCode(X.charCodeAt(0)-65248)}),G=G.replace(/[-]/g,(X)=>String.fromCharCode(X.charCodeAt(0)-65248)),G.trim()}clean($){if(!$)return"";let G=this.normalize($);return G=G.replace(/(|||||npo||)/g,""),G=G.replace(/(\(\)|\(\)|\(\))/g,""),G.trim()}toIndex($){let G=parseInt($||"",10);return Number.isFinite(G)?G-1:-1}isPostalField($){if(($.dataset.autofill||"").startsWith("postal:"))return!0;let X=($.dataset.jsonPath||$.dataset.baseKey||$.name||$.id||"").toLowerCase(),Q=($.placeholder||"").toLowerCase(),U=X.match(/zip|postal|postcode|/)&&!X.match(/pref|city|town|address|||/),Z=Q.match(/|zip|postal/);return Boolean(U||Z)}handlePostalInput($){if(console.log("[SearchEngine] handlePostalInput - postalReady:",this.postalReady),!this.postalReady){console.log("[SearchEngine] Postal not ready, hiding suggestions"),this.hideSuggestions();return}let G=$.value.replace(/[^0-9]/g,"");if(console.log("[SearchEngine] Cleaned postal value:",G),G.length<3){console.log("[SearchEngine] Value too short (<3), hiding suggestions"),this.hideSuggestions();return}let X=window.postalLookup;if(!X){console.log("[SearchEngine] ERROR: postalLookup not found on window");return}if(G.length===7){console.log("[SearchEngine] 7-digit zip, doing lookup");let U=X.lookup(G);if(console.log("[SearchEngine] Lookup result:",U),U)this.fillPostalData($,U,!0),this.hideSuggestions();return}console.log("[SearchEngine] Partial zip, getting suggestions");let Q=X.suggest(G,50);if(console.log("[SearchEngine] Got",Q.length,"suggestions"),Q.length>0)this.renderPostalSuggestions($,Q);else this.hideSuggestions()}renderPostalSuggestions($,G){let X="";G.forEach((H)=>{let B=H.zip.substring(0,3)+"-"+H.zip.substring(3),J=`${H.pref} ${H.city} ${H.town}`,q=b0(JSON.stringify(H));X+=`<div class="suggestion-item postal-item" data-postal="${q}" style="padding:6px 8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333; display:flex; gap:12px; align-items:center;">
                <span style="color:#3b82f6; flex-shrink:0; min-width:85px;">${B}</span>
                <span style="color:#666; flex-grow:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${b0(J)}</span>
            </div>`});let Q=this.getGlobalBox();Q.innerHTML=X;let U=$.getBoundingClientRect(),Z=window.scrollY||document.documentElement.scrollTop,Y=window.scrollX||document.documentElement.scrollLeft;Q.style.width=Math.max(U.width,400)+"px",Q.style.left=U.left+Y+"px",Q.style.top=U.bottom+Z+"px",Q.style.maxHeight="360px",Q.style.overflowY="auto",Q.querySelectorAll(".suggestion-item").forEach((H)=>{H.onmouseenter=()=>H.style.background="#f0f8ff",H.onmouseleave=()=>H.style.background="white"}),Q.style.display="block",this.suggestionsVisible=!0}fillPostalData($,G,X=!1){if(X)$.value=G.zip.substring(0,3)+"-"+G.zip.substring(3);let Q=R0($);if(!Q.group){console.warn("[fillPostalData] :",Q.raw,": sender.zip, sender_zip, sender-zip");return}console.log("[fillPostalData] Source field group:",Q.group,"separator:",Q.separator);let U=$.closest(".dynamic-row")||$.closest(".address-group")||$.closest("table")||$.closest("form")||$.closest(".form-row")?.parentElement||document,Z=U===document?"document":$.closest("tr")?"tr":$.closest(".dynamic-row")?"dynamic-row":$.closest(".address-group")?"address-group":$.closest("table")?"table":$.closest("form")?"form":"form-row";console.log("[fillPostalData] Container type:",Z,"Source group:",Q.group);let H=Array.from(U.querySelectorAll("input, select, textarea")).map((D)=>({element:D,parsed:R0(D)})).filter(({parsed:D})=>Q8(Q,D));console.log("[fillPostalData] Found",H.length,"fields in same group:",Q.group);let B=new Map;for(let{element:D,parsed:j}of H){if(D===$)continue;let I=D0(j.fieldType||"");if(I&&!B.has(I))B.set(I,D)}let J=B.get("pref");if(J)J.value=G.pref,J.dispatchEvent(new Event("input",{bubbles:!0})),console.log("[fillPostalData] Filled pref:",J.dataset.jsonPath||J.name);let q=B.get("city");if(q)q.value=G.city,q.dispatchEvent(new Event("input",{bubbles:!0})),console.log("[fillPostalData] Filled city:",q.dataset.jsonPath||q.name);let L=B.get("town");if(L)L.value=G.town,L.dispatchEvent(new Event("input",{bubbles:!0})),console.log("[fillPostalData] Filled town:",L.dataset.jsonPath||L.name);let O=B.get("address");if(O){let D="";if(!J&&!q&&!L)D=`${G.pref}${G.city}${G.town}`;else if(J&&!q&&!L)D=`${G.city}${G.town}`;else if(!L)D=G.town;if(D)O.value=D,O.dispatchEvent(new Event("input",{bubbles:!0})),console.log("[fillPostalData] Filled address:",O.dataset.jsonPath||O.name,"=",D)}if(B.size===0)console.warn("[fillPostalData] :",Q.group)}getGlobalBox(){if(this.globalBox&&!document.body.contains(this.globalBox))this.globalBox=null;if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){console.log("[SearchEngine] Setting up event delegation"),document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if(console.log("[SearchEngine] Input event on:",$.target.tagName,"classList:",$.target.classList.value),$.target.classList.contains("search-input"))console.log("[SearchEngine] Target has search-input class, handling"),this.handleSearchInput($.target);else console.log("[SearchEngine] Target does not have search-input class, ignoring")}),document.body.addEventListener("click",($)=>{let X=$.target?.closest?.(".suggestion-item");if(X)this.handleSelection(X)})}handleSearchInput($){this.activeSearchInput=$;let G=window;if(console.log("[SearchEngine] handleSearchInput called for:",$.dataset.jsonPath||$.name,"value:",$.value),this.isPostalField($)){console.log("[SearchEngine] Detected as postal field, calling handlePostalInput"),this.handlePostalInput($);return}let X=$.dataset.masterSrc,Q=$.dataset.suggestSource;if(!X&&!Q)return;let U=this.toIndex($.dataset.masterLabelIndex),Z=this.toIndex($.dataset.masterValueIndex),Y=$.value;if(!Y){this.hideSuggestions();return}let H=[],B=this.normalize(Y);if(Q==="column"){let J=$.dataset.baseKey,q=$.closest("table");if(q&&J){let L=new Set;q.querySelectorAll(`[data-base-key="${J}"]`).forEach((O)=>{if(O===$)return;let D=O.value;if(D&&this.normalize(D).includes(B)){if(!L.has(D))L.add(D),H.push({val:D,row:[D],label:D,score:10})}})}}else if(X){if(console.log("[SearchEngine] Master search requested. srcKey:",X),console.log("[SearchEngine] generatedJsonStructure exists?",!!G.generatedJsonStructure),G.generatedJsonStructure){if(console.log("[SearchEngine] masterData exists?",!!G.generatedJsonStructure.masterData),G.generatedJsonStructure.masterData)console.log("[SearchEngine] Available master keys:",Object.keys(G.generatedJsonStructure.masterData))}if(!G.generatedJsonStructure||!G.generatedJsonStructure.masterData)return;let J=G.generatedJsonStructure.masterData;if(!J[X]){console.log("[SearchEngine] Master key not found:",X);return}J[X].forEach((L,O)=>{if(O===0)return;if(L.some((j)=>this.normalize(j||"").includes(B))){let j=U>=0?L[U]||"":"",I=Z>=0?L[Z]||"":"",E=Z>=0?I:U>=0?j:L[1]||L[0]||"";H.push({val:E,row:L,label:j,score:10,idx:O})}})}this.renderSuggestions($,H,U)}renderSuggestions($,G,X){if(G.length===0){this.hideSuggestions();return}let Q=G.slice(0,10),U="";Q.forEach((J)=>{let q=b0(JSON.stringify(J.row)),L=X>=0?J.label||J.row.join(" : "):J.row.join(" : ");U+=`<div class="suggestion-item" data-val="${b0(J.val)}" data-row="${q}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${b0(L)}</div>`});let Z=this.getGlobalBox();Z.innerHTML=U;let Y=$.getBoundingClientRect(),H=window.scrollY||document.documentElement.scrollTop,B=window.scrollX||document.documentElement.scrollLeft;Z.style.width=Math.max(Y.width,200)+"px",Z.style.left=Y.left+B+"px",Z.style.top=Y.bottom+H+"px",Z.style.maxHeight="300px",Z.style.overflowY="auto",Z.querySelectorAll(".suggestion-item").forEach((J)=>{J.onmouseenter=()=>J.style.background="#f0f8ff",J.onmouseleave=()=>J.style.background="white"}),Z.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;if($.classList.contains("postal-item")){let Z=$.dataset.postal;if(Z)try{let Y=JSON.parse(Z);this.fillPostalData(this.activeSearchInput,Y,!0)}catch(Y){console.error("Failed to parse postal data:",Y)}this.hideSuggestions();return}let G=window,X=this.activeSearchInput,Q=$.dataset.val||"",U=$.dataset.row||"[]";try{let Z=JSON.parse(U),Y=X.dataset.masterSrc,H=Y?G.generatedJsonStructure.masterData[Y][0]:[],B=!1;if(H.length>0&&Z.length>0){let J=X.closest("tr");if(J){let q=Array.from(J.querySelectorAll("input, select, textarea"));H.forEach((L,O)=>{if(!L)return;let D=Z[O];this.fillField(q,L,D,X,()=>{B=!0})})}}if(!B)X.value=Q,X.dispatchEvent(new Event("input",{bubbles:!0}))}catch(Z){console.error(Z)}this.hideSuggestions()}fillField($,G,X,Q,U){let Z=this.normalize(G),Y=$.find((H)=>{let B=H.dataset.baseKey||H.dataset.jsonPath,J=this.normalize(H.getAttribute("placeholder")||"");return B&&this.normalize(B)===Z||J===Z});if(Y){if(Y.value=X||"",Y.dispatchEvent(new Event("input",{bubbles:!0})),Y===Q)U()}}}var U$=new m8;window.GlobalSearch=U$;window.SearchEngine=U$;X$();
