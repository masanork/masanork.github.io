var Z$=Object.create;var{getPrototypeOf:U$,defineProperty:Z8,getOwnPropertyNames:G$}=Object;var q$=Object.prototype.hasOwnProperty;var g8=($,H,X)=>{X=$!=null?Z$(U$($)):{};let Q=H||!$||!$.__esModule?Z8(X,"default",{value:$,enumerable:!0}):X;for(let Z of G$($))if(!q$.call(Q,Z))Z8(Q,Z,{get:()=>$[Z],enumerable:!0});return Q};var B$=($,H)=>()=>(H||$((H={exports:{}}).exports,H),H.exports);var m0=($,H)=>{for(var X in H)Z8($,X,{get:H[X],enumerable:!0,configurable:!0,set:(Q)=>H[X]=()=>Q})};var U8=($,H)=>()=>($&&(H=$($=0)),H);var J$=(($)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy($,{get:(H,X)=>(typeof require!=="undefined"?require:H)[X]}):$)(function($){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+$+'" is not supported')});var p8=B$((FX,c8)=>{c8.exports=function $(H){if(typeof H==="number"&&isNaN(H))throw new Error("NaN is not allowed");if(typeof H==="number"&&!isFinite(H))throw new Error("Infinity is not allowed");if(H===null||typeof H!=="object")return JSON.stringify(H);if(H.toJSON instanceof Function)return $(H.toJSON());if(Array.isArray(H))return`[${H.reduce((Z,U,Y)=>{return`${Z}${Y===0?"":","}${$(U===void 0||typeof U==="symbol"?null:U)}`},"")}]`;return`{${Object.keys(H).sort().reduce((Q,Z)=>{if(H[Z]===void 0||typeof H[Z]==="symbol")return Q;let U=Q.length===0?"":",";return`${Q}${U}${$(Z)}:${$(H[Z])}`},"")}}`}});function _0($){let H=C.__externref_table_alloc();return C.__wbindgen_externrefs.set(H,$),H}function e($,H){return $=$>>>0,F0().subarray($/1,$/1+H)}function W0($,H){return $=$>>>0,m$($,H)}function F0(){if(f0===null||f0.byteLength===0)f0=new Uint8Array(C.memory.buffer);return f0}function T0($,H){try{return $.apply(this,H)}catch(X){let Q=_0(X);C.__wbindgen_exn_store(Q)}}function v0($){return $===void 0||$===null}function k($,H){let X=H($.length*1,1)>>>0;return F0().set($,X/1),_=$.length,X}function S0($,H,X){if(X===void 0){let G=h0.encode($),q=H(G.length,1)>>>0;return F0().subarray(q,q+G.length).set(G),_=G.length,q}let Q=$.length,Z=H(Q,1)>>>0,U=F0(),Y=0;for(;Y<Q;Y++){let G=$.charCodeAt(Y);if(G>127)break;U[Z+Y]=G}if(Y!==Q){if(Y!==0)$=$.slice(Y);Z=X(Z,Q,Q=Y+$.length*3,1)>>>0;let G=F0().subarray(Z+Y,Z+Q),q=h0.encodeInto($,G);Y+=q.written,Z=X(Z,Q,Y,1)>>>0}return _=Y,Z}function s($){let H=C.__wbindgen_externrefs.get($);return C.__externref_table_dealloc($),H}function m$($,H){if(E8+=H,E8>=y$)$8=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),$8.decode(),E8=H;return $8.decode(F0().subarray($,$+H))}function N4($,H,X,Q){let Z=k($,C.__wbindgen_malloc),U=_,Y=k(H,C.__wbindgen_malloc),G=_,q=k(X,C.__wbindgen_malloc),J=_,B=k(Q,C.__wbindgen_malloc),L=_,D=C.aes_gcm_decrypt(Z,U,Y,G,q,J,B,L);if(D[3])throw s(D[2]);var M=e(D[0],D[1]).slice();return C.__wbindgen_free(D[0],D[1]*1,1),M}function O4($,H,X,Q){let Z=k($,C.__wbindgen_malloc),U=_,Y=k(H,C.__wbindgen_malloc),G=_,q=k(X,C.__wbindgen_malloc),J=_,B=k(Q,C.__wbindgen_malloc),L=_,D=C.aes_gcm_encrypt(Z,U,Y,G,q,J,B,L);if(D[3])throw s(D[2]);var M=e(D[0],D[1]).slice();return C.__wbindgen_free(D[0],D[1]*1,1),M}function D4($,H,X,Q,Z){let U,Y;try{let J=S0($,C.__wbindgen_malloc,C.__wbindgen_realloc),B=_,L=k(H,C.__wbindgen_malloc),D=_,M=S0(X,C.__wbindgen_malloc,C.__wbindgen_realloc),j=_,V=S0(Q,C.__wbindgen_malloc,C.__wbindgen_realloc),E=_,u=S0(Z,C.__wbindgen_malloc,C.__wbindgen_realloc),c=_,F=C.build_l2_envelope_wasm(J,B,L,D,M,j,V,E,u,c);var G=F[0],q=F[1];if(F[3])throw G=0,q=0,s(F[2]);return U=G,Y=q,W0(G,q)}finally{C.__wbindgen_free(U,Y,1)}}function M4($,H){let X=k($,C.__wbindgen_malloc),Q=_,Z=k(H,C.__wbindgen_malloc),U=_;return C.constant_time_equal(X,Q,Z,U)!==0}function z4($,H,X){let Q,Z;try{let J=S0($,C.__wbindgen_malloc,C.__wbindgen_realloc),B=_,L=k(H,C.__wbindgen_malloc),D=_;var U=v0(X)?0:k(X,C.__wbindgen_malloc),Y=_;let M=C.decrypt_l2_envelope_wasm(J,B,L,D,U,Y);var G=M[0],q=M[1];if(M[3])throw G=0,q=0,s(M[2]);return Q=G,Z=q,W0(G,q)}finally{C.__wbindgen_free(Q,Z,1)}}function C4(){let $=C.ed25519_generate_keypair();if($[3])throw s($[2]);var H=e($[0],$[1]).slice();return C.__wbindgen_free($[0],$[1]*1,1),H}function P4($){let H=k($,C.__wbindgen_malloc),X=_,Q=C.ed25519_public_key_to_x25519_public_key(H,X);if(Q[3])throw s(Q[2]);var Z=e(Q[0],Q[1]).slice();return C.__wbindgen_free(Q[0],Q[1]*1,1),Z}function A4($,H){let X=k($,C.__wbindgen_malloc),Q=_,Z=k(H,C.__wbindgen_malloc),U=_,Y=C.ed25519_sign(X,Q,Z,U);if(Y[3])throw s(Y[2]);var G=e(Y[0],Y[1]).slice();return C.__wbindgen_free(Y[0],Y[1]*1,1),G}function W4($,H,X){let Q=k($,C.__wbindgen_malloc),Z=_,U=k(H,C.__wbindgen_malloc),Y=_,G=k(X,C.__wbindgen_malloc),q=_,J=C.ed25519_verify(Q,Z,U,Y,G,q);if(J[2])throw s(J[1]);return J[0]!==0}function F4($){return C.get_padding_target_size($)>>>0}function w8(){let $,H;try{let X=C.get_version();return $=X[0],H=X[1],W0(X[0],X[1])}finally{C.__wbindgen_free($,H,1)}}function R4($,H,X,Q){let Z=k($,C.__wbindgen_malloc),U=_,Y=k(H,C.__wbindgen_malloc),G=_,q=k(X,C.__wbindgen_malloc),J=_,B=C.hkdf_sha256_wasm(Z,U,Y,G,q,J,Q);if(B[3])throw s(B[2]);var L=e(B[0],B[1]).slice();return C.__wbindgen_free(B[0],B[1]*1,1),L}function x4(){let $=C.ml_dsa_44_generate_keypair();if($[3])throw s($[2]);var H=e($[0],$[1]).slice();return C.__wbindgen_free($[0],$[1]*1,1),H}function V4($,H){let X=k($,C.__wbindgen_malloc),Q=_,Z=k(H,C.__wbindgen_malloc),U=_,Y=C.ml_dsa_44_sign(X,Q,Z,U);if(Y[3])throw s(Y[2]);var G=e(Y[0],Y[1]).slice();return C.__wbindgen_free(Y[0],Y[1]*1,1),G}function I4($,H,X){let Q=k($,C.__wbindgen_malloc),Z=_,U=k(H,C.__wbindgen_malloc),Y=_,G=k(X,C.__wbindgen_malloc),q=_,J=C.ml_dsa_44_verify(Q,Z,U,Y,G,q);if(J[2])throw s(J[1]);return J[0]!==0}function j4($,H){let X=k($,C.__wbindgen_malloc),Q=_,Z=k(H,C.__wbindgen_malloc),U=_,Y=C.ml_kem_768_decapsulate(X,Q,Z,U);if(Y[3])throw s(Y[2]);var G=e(Y[0],Y[1]).slice();return C.__wbindgen_free(Y[0],Y[1]*1,1),G}function E4($){let H=k($,C.__wbindgen_malloc),X=_,Q=C.ml_kem_768_encapsulate(H,X);if(Q[3])throw s(Q[2]);var Z=e(Q[0],Q[1]).slice();return C.__wbindgen_free(Q[0],Q[1]*1,1),Z}function w4(){let $=C.ml_kem_768_generate_keypair();if($[3])throw s($[2]);var H=e($[0],$[1]).slice();return C.__wbindgen_free($[0],$[1]*1,1),H}function T4(){let $=C.p256_generate_keypair();if($[3])throw s($[2]);var H=e($[0],$[1]).slice();return C.__wbindgen_free($[0],$[1]*1,1),H}function _4($,H){let X=k($,C.__wbindgen_malloc),Q=_,Z=k(H,C.__wbindgen_malloc),U=_,Y=C.p256_sign(X,Q,Z,U);if(Y[3])throw s(Y[2]);var G=e(Y[0],Y[1]).slice();return C.__wbindgen_free(Y[0],Y[1]*1,1),G}function f4($,H,X){let Q=k($,C.__wbindgen_malloc),Z=_,U=k(H,C.__wbindgen_malloc),Y=_,G=k(X,C.__wbindgen_malloc),q=_,J=C.p256_verify(Q,Z,U,Y,G,q);if(J[2])throw s(J[1]);return J[0]!==0}function v4($){let H=k($,C.__wbindgen_malloc),X=_,Q=C.sha256_wasm(H,X);var Z=e(Q[0],Q[1]).slice();return C.__wbindgen_free(Q[0],Q[1]*1,1),Z}function S4(){let $=C.x25519_generate_keypair();if($[3])throw s($[2]);var H=e($[0],$[1]).slice();return C.__wbindgen_free($[0],$[1]*1,1),H}function h4($){let H=k($,C.__wbindgen_malloc),X=_,Q=C.x25519_get_public_key(H,X);if(Q[3])throw s(Q[2]);var Z=e(Q[0],Q[1]).slice();return C.__wbindgen_free(Q[0],Q[1]*1,1),Z}function k4($,H){let X=k($,C.__wbindgen_malloc),Q=_,Z=k(H,C.__wbindgen_malloc),U=_,Y=C.x25519_get_shared_secret(X,Q,Z,U);if(Y[3])throw s(Y[2]);var G=e(Y[0],Y[1]).slice();return C.__wbindgen_free(Y[0],Y[1]*1,1),G}async function c$($,H){if(typeof Response==="function"&&$ instanceof Response){if(typeof WebAssembly.instantiateStreaming==="function")try{return await WebAssembly.instantiateStreaming($,H)}catch(Q){if($.ok&&g$.has($.type)&&$.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",Q);else throw Q}let X=await $.arrayBuffer();return await WebAssembly.instantiate(X,H)}else{let X=await WebAssembly.instantiate($,H);if(X instanceof WebAssembly.Instance)return{instance:X,module:$};else return X}}function p$(){let $={};return $.wbg={},$.wbg.__wbg___wbindgen_is_function_8d400b8b1af978cd=function(H){return typeof H==="function"},$.wbg.__wbg___wbindgen_is_object_ce774f3490692386=function(H){let X=H;return typeof X==="object"&&X!==null},$.wbg.__wbg___wbindgen_is_string_704ef9c8fc131030=function(H){return typeof H==="string"},$.wbg.__wbg___wbindgen_is_undefined_f6b95eab589e0269=function(H){return H===void 0},$.wbg.__wbg___wbindgen_throw_dd24417ed36fc46e=function(H,X){throw new Error(W0(H,X))},$.wbg.__wbg_call_3020136f7a2d6e44=function(){return T0(function(H,X,Q){return H.call(X,Q)},arguments)},$.wbg.__wbg_call_abb4ff46ce38be40=function(){return T0(function(H,X){return H.call(X)},arguments)},$.wbg.__wbg_crypto_574e78ad8b13b65f=function(H){return H.crypto},$.wbg.__wbg_getRandomValues_b8f5dbd5f3995a9e=function(){return T0(function(H,X){H.getRandomValues(X)},arguments)},$.wbg.__wbg_length_22ac23eaec9d8053=function(H){return H.length},$.wbg.__wbg_msCrypto_a61aeb35a24c1329=function(H){return H.msCrypto},$.wbg.__wbg_new_no_args_cb138f77cf6151ee=function(H,X){return new Function(W0(H,X))},$.wbg.__wbg_new_with_length_aa5eaf41d35235e5=function(H){return new Uint8Array(H>>>0)},$.wbg.__wbg_node_905d3e251edff8a2=function(H){return H.node},$.wbg.__wbg_process_dc0fbacc7c1c06f7=function(H){return H.process},$.wbg.__wbg_prototypesetcall_dfe9b766cdc1f1fd=function(H,X,Q){Uint8Array.prototype.set.call(e(H,X),Q)},$.wbg.__wbg_randomFillSync_ac0988aba3254290=function(){return T0(function(H,X){H.randomFillSync(X)},arguments)},$.wbg.__wbg_require_60cc747a6bc5215a=function(){return T0(function(){return l$.require},arguments)},$.wbg.__wbg_static_accessor_GLOBAL_769e6b65d6557335=function(){let H=typeof window==="undefined"?null:window;return v0(H)?0:_0(H)},$.wbg.__wbg_static_accessor_GLOBAL_THIS_60cf02db4de8e1c1=function(){let H=typeof globalThis==="undefined"?null:globalThis;return v0(H)?0:_0(H)},$.wbg.__wbg_static_accessor_SELF_08f5a74c69739274=function(){let H=typeof self==="undefined"?null:self;return v0(H)?0:_0(H)},$.wbg.__wbg_static_accessor_WINDOW_a8924b26aa92d024=function(){let H=typeof window==="undefined"?null:window;return v0(H)?0:_0(H)},$.wbg.__wbg_subarray_845f2f5bce7d061a=function(H,X,Q){return H.subarray(X>>>0,Q>>>0)},$.wbg.__wbg_versions_c01dfd4722a88165=function(H){return H.versions},$.wbg.__wbindgen_cast_2241b6af4c4b2941=function(H,X){return W0(H,X)},$.wbg.__wbindgen_cast_cb9088102bce6b30=function(H,X){return e(H,X)},$.wbg.__wbindgen_init_externref_table=function(){let H=C.__wbindgen_externrefs,X=H.grow(4);H.set(0,void 0),H.set(X+0,void 0),H.set(X+1,null),H.set(X+2,!0),H.set(X+3,!1)},$}function u$($,H){return C=$.exports,b4.__wbindgen_wasm_module=H,f0=null,C.__wbindgen_start(),C}async function b4($){if(C!==void 0)return C;if(typeof $!=="undefined")if(Object.getPrototypeOf($)===Object.prototype)({module_or_path:$}=$);else console.warn("using deprecated parameters for the initialization function; pass a single object instead");if(typeof $==="undefined")$=new URL("weba_crypto_wasm_bg.wasm",import.meta.url);let H=p$();if(typeof $==="string"||typeof Request==="function"&&$ instanceof Request||typeof URL==="function"&&$ instanceof URL)$=fetch($);let{instance:X,module:Q}=await c$(await $,H);return u$(X,Q)}var C,f0=null,$8,y$=2146435072,E8=0,h0,_=0,g$,H8;var y4=U8(()=>{$8=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});$8.decode();h0=new TextEncoder;if(!("encodeInto"in h0))h0.encodeInto=function($,H){let X=h0.encode($);return H.set(X),{read:$.length,written:X.length}};g$=new Set(["basic","cors","default"]);H8=b4});var m4="";var l4={};m0(l4,{win32:()=>T8,toNamespacedPath:()=>GH,sep:()=>NH,resolve:()=>XH,relative:()=>UH,posix:()=>N0,parse:()=>LH,normalize:()=>QH,join:()=>ZH,isAbsolute:()=>YH,format:()=>KH,extname:()=>JH,dirname:()=>qH,delimiter:()=>OH,default:()=>HH,basename:()=>BH});var d$,c4,o$,n$,s$,i$,a$=($,H)=>()=>(H||$((H={exports:{}}).exports,H),H.exports),r$=($,H,X,Q)=>{if(H&&typeof H=="object"||typeof H=="function")for(let Z of n$(H))!i$.call($,Z)&&Z!==X&&c4($,Z,{get:()=>H[Z],enumerable:!(Q=o$(H,Z))||Q.enumerable});return $},t$=($,H,X)=>(X=$!=null?d$(s$($)):{},r$(H||!$||!$.__esModule?c4(X,"default",{value:$,enumerable:!0}):X,$)),e$,p4,i,$H,g4=function($){return $},u4=function(){throw new Error("Not implemented")},N0,T8,HH,XH,QH,YH,ZH,UH,GH,qH,BH,JH,KH,LH,NH,OH;var d4=U8(()=>{d$=Object.create,c4=Object.defineProperty,o$=Object.getOwnPropertyDescriptor,n$=Object.getOwnPropertyNames,s$=Object.getPrototypeOf,i$=Object.prototype.hasOwnProperty,e$=a$(($,H)=>{function X(Y){if(typeof Y!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(Y))}function Q(Y,G){for(var q="",J=0,B=-1,L=0,D,M=0;M<=Y.length;++M){if(M<Y.length)D=Y.charCodeAt(M);else{if(D===47)break;D=47}if(D===47){if(!(B===M-1||L===1))if(B!==M-1&&L===2){if(q.length<2||J!==2||q.charCodeAt(q.length-1)!==46||q.charCodeAt(q.length-2)!==46){if(q.length>2){var j=q.lastIndexOf("/");if(j!==q.length-1){j===-1?(q="",J=0):(q=q.slice(0,j),J=q.length-1-q.lastIndexOf("/")),B=M,L=0;continue}}else if(q.length===2||q.length===1){q="",J=0,B=M,L=0;continue}}G&&(q.length>0?q+="/..":q="..",J=2)}else q.length>0?q+="/"+Y.slice(B+1,M):q=Y.slice(B+1,M),J=M-B-1;B=M,L=0}else D===46&&L!==-1?++L:L=-1}return q}function Z(Y,G){var q=G.dir||G.root,J=G.base||(G.name||"")+(G.ext||"");return q?q===G.root?q+J:q+Y+J:J}var U={resolve:function(){for(var Y="",G=!1,q,J=arguments.length-1;J>=-1&&!G;J--){var B;J>=0?B=arguments[J]:(q===void 0&&(q=window.process.cwd()),B=q),X(B),B.length!==0&&(Y=B+"/"+Y,G=B.charCodeAt(0)===47)}return Y=Q(Y,!G),G?Y.length>0?"/"+Y:"/":Y.length>0?Y:"."},normalize:function(Y){if(X(Y),Y.length===0)return".";var G=Y.charCodeAt(0)===47,q=Y.charCodeAt(Y.length-1)===47;return Y=Q(Y,!G),Y.length===0&&!G&&(Y="."),Y.length>0&&q&&(Y+="/"),G?"/"+Y:Y},isAbsolute:function(Y){return X(Y),Y.length>0&&Y.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var Y,G=0;G<arguments.length;++G){var q=arguments[G];X(q),q.length>0&&(Y===void 0?Y=q:Y+="/"+q)}return Y===void 0?".":U.normalize(Y)},relative:function(Y,G){if(X(Y),X(G),Y===G||(Y=U.resolve(Y),G=U.resolve(G),Y===G))return"";for(var q=1;q<Y.length&&Y.charCodeAt(q)===47;++q);for(var J=Y.length,B=J-q,L=1;L<G.length&&G.charCodeAt(L)===47;++L);for(var D=G.length,M=D-L,j=B<M?B:M,V=-1,E=0;E<=j;++E){if(E===j){if(M>j){if(G.charCodeAt(L+E)===47)return G.slice(L+E+1);if(E===0)return G.slice(L+E)}else B>j&&(Y.charCodeAt(q+E)===47?V=E:E===0&&(V=0));break}var u=Y.charCodeAt(q+E),c=G.charCodeAt(L+E);if(u!==c)break;u===47&&(V=E)}var F="";for(E=q+V+1;E<=J;++E)(E===J||Y.charCodeAt(E)===47)&&(F.length===0?F+="..":F+="/..");return F.length>0?F+G.slice(L+V):(L+=V,G.charCodeAt(L)===47&&++L,G.slice(L))},_makeLong:function(Y){return Y},dirname:function(Y){if(X(Y),Y.length===0)return".";for(var G=Y.charCodeAt(0),q=G===47,J=-1,B=!0,L=Y.length-1;L>=1;--L)if(G=Y.charCodeAt(L),G===47){if(!B){J=L;break}}else B=!1;return J===-1?q?"/":".":q&&J===1?"//":Y.slice(0,J)},basename:function(Y,G){if(G!==void 0&&typeof G!="string")throw new TypeError('"ext" argument must be a string');X(Y);var q=0,J=-1,B=!0,L;if(G!==void 0&&G.length>0&&G.length<=Y.length){if(G.length===Y.length&&G===Y)return"";var D=G.length-1,M=-1;for(L=Y.length-1;L>=0;--L){var j=Y.charCodeAt(L);if(j===47){if(!B){q=L+1;break}}else M===-1&&(B=!1,M=L+1),D>=0&&(j===G.charCodeAt(D)?--D===-1&&(J=L):(D=-1,J=M))}return q===J?J=M:J===-1&&(J=Y.length),Y.slice(q,J)}else{for(L=Y.length-1;L>=0;--L)if(Y.charCodeAt(L)===47){if(!B){q=L+1;break}}else J===-1&&(B=!1,J=L+1);return J===-1?"":Y.slice(q,J)}},extname:function(Y){X(Y);for(var G=-1,q=0,J=-1,B=!0,L=0,D=Y.length-1;D>=0;--D){var M=Y.charCodeAt(D);if(M===47){if(!B){q=D+1;break}continue}J===-1&&(B=!1,J=D+1),M===46?G===-1?G=D:L!==1&&(L=1):G!==-1&&(L=-1)}return G===-1||J===-1||L===0||L===1&&G===J-1&&G===q+1?"":Y.slice(G,J)},format:function(Y){if(Y===null||typeof Y!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof Y);return Z("/",Y)},parse:function(Y){X(Y);var G={root:"",dir:"",base:"",ext:"",name:""};if(Y.length===0)return G;var q=Y.charCodeAt(0),J=q===47,B;J?(G.root="/",B=1):B=0;for(var L=-1,D=0,M=-1,j=!0,V=Y.length-1,E=0;V>=B;--V){if(q=Y.charCodeAt(V),q===47){if(!j){D=V+1;break}continue}M===-1&&(j=!1,M=V+1),q===46?L===-1?L=V:E!==1&&(E=1):L!==-1&&(E=-1)}return L===-1||M===-1||E===0||E===1&&L===M-1&&L===D+1?M!==-1&&(D===0&&J?G.base=G.name=Y.slice(1,M):G.base=G.name=Y.slice(D,M)):(D===0&&J?(G.name=Y.slice(1,L),G.base=Y.slice(1,M)):(G.name=Y.slice(D,L),G.base=Y.slice(D,M)),G.ext=Y.slice(L,M)),D>0?G.dir=Y.slice(0,D-1):J&&(G.dir="/"),G},sep:"/",delimiter:":",win32:null,posix:null};U.posix=U,H.exports=U}),p4=t$(e$()),i=p4,$H=p4;i.parse??=u4;$H.parse??=u4;N0={resolve:i.resolve.bind(i),normalize:i.normalize.bind(i),isAbsolute:i.isAbsolute.bind(i),join:i.join.bind(i),relative:i.relative.bind(i),toNamespacedPath:g4,dirname:i.dirname.bind(i),basename:i.basename.bind(i),extname:i.extname.bind(i),format:i.format.bind(i),parse:i.parse.bind(i),sep:"/",delimiter:":",win32:void 0,posix:void 0,_makeLong:g4},T8={sep:"\\",delimiter:";",win32:void 0,...N0,posix:N0};N0.win32=T8.win32=T8;N0.posix=N0;HH=N0,{resolve:XH,normalize:QH,isAbsolute:YH,join:ZH,relative:UH,toNamespacedPath:GH,dirname:qH,basename:BH,extname:JH,format:KH,parse:LH,sep:NH,delimiter:OH}=N0});var f8={};m0(f8,{x25519GetSharedSecret:()=>AH,x25519GetPublicKey:()=>PH,x25519GenerateKeyPair:()=>CH,sha256Hash:()=>vH,p256Verify:()=>IH,p256Sign:()=>VH,p256GenerateKeyPair:()=>xH,mlKem768GenerateKeyPair:()=>jH,mlKem768Encapsulate:()=>EH,mlKem768Decapsulate:()=>wH,mlDsa44Verify:()=>fH,mlDsa44Sign:()=>_H,mlDsa44GenerateKeyPair:()=>TH,initWasmFromB64:()=>_8,initWasm:()=>o4,hkdfSha256:()=>SH,getPaddingTargetSize:()=>hH,ed25519Verify:()=>RH,ed25519Sign:()=>FH,ed25519PublicKeyToX25519PublicKey:()=>yH,ed25519GenerateKeyPair:()=>WH,decryptL2Envelope:()=>bH,constantTimeEqual:()=>DH,buildL2Envelope:()=>kH,aesGcmEncrypt:()=>MH,aesGcmDecrypt:()=>zH});async function o4($){if(p)return;if($)await H8($);else if(typeof window!=="undefined"&&window.__WEBA_MANIFEST){let X=window.__WEBA_MANIFEST.blobs?.find((Q)=>Q.id==="weba-crypto-wasm");if(X){let Q=document.getElementById("weba-blob-"+X.digest.split(":")[1]);if(Q){let Z=atob(Q.textContent.trim()),U=new Uint8Array(Z.length);for(let Y=0;Y<Z.length;Y++)U[Y]=Z.charCodeAt(Y);await H8(U),p=!0,console.log(`WASM Crypto Initialized from Manifest: ${w8()}`);return}}await _8()}else if(typeof window.process!=="undefined"&&window.process.versions&&window.process.versions.node){let H=await import("node:fs"),Q=(await Promise.resolve().then(() => (d4(),l4))).join(import.meta.dirname,"wasm_bindings/weba_crypto_wasm_bg.wasm"),Z=H.readFileSync(Q);await H8(Z)}else try{await _8()}catch(H){throw new Error("WASM source must be provided in browser environment")}if(p=!0,!p)console.log(`WASM Crypto Initialized: ${w8()}`)}async function _8(){if(p)return;let $=atob(m4),H=new Uint8Array($.length);for(let X=0;X<$.length;X++)H[X]=$.charCodeAt(X);await o4(H)}function DH($,H){if(!p)throw new Error("WASM not initialized");return M4($,H)}function MH($,H,X,Q){if(!p)throw new Error("WASM not initialized");return O4($,H,X,Q)}function zH($,H,X,Q){if(!p)throw new Error("WASM not initialized");return N4($,H,X,Q)}function CH(){if(!p)throw new Error("WASM not initialized");let $=S4();return{privateKey:$.slice(0,32),publicKey:$.slice(32,64)}}function PH($){if(!p)throw new Error("WASM not initialized");return h4($)}function AH($,H){if(!p)throw new Error("WASM not initialized");return k4($,H)}function WH(){if(!p)throw new Error("WASM not initialized");let $=C4();return{privateKey:$.slice(0,32),publicKey:$.slice(32,64)}}function FH($,H){if(!p)throw new Error("WASM not initialized");return A4($,H)}function RH($,H,X){if(!p)throw new Error("WASM not initialized");return W4($,H,X)}function xH(){if(!p)throw new Error("WASM not initialized");let $=T4();return{privateKey:$.slice(0,32),publicKey:$.slice(32,97)}}function VH($,H){if(!p)throw new Error("WASM not initialized");return _4($,H)}function IH($,H,X){if(!p)throw new Error("WASM not initialized");return f4($,H,X)}function jH(){if(!p)throw new Error("WASM not initialized");let $=w4();return{privateKey:$.slice(0,2400),publicKey:$.slice(2400,3584)}}function EH($){if(!p)throw new Error("WASM not initialized");let H=E4($);return{sharedSecret:H.slice(0,32),ciphertext:H.slice(32,1120)}}function wH($,H){if(!p)throw new Error("WASM not initialized");return j4($,H)}function TH(){if(!p)throw new Error("WASM not initialized");let $=x4();return{privateKey:$.slice(0,2560),publicKey:$.slice(2560,3872)}}function _H($,H){if(!p)throw new Error("WASM not initialized");return V4($,H)}function fH($,H,X){if(!p)throw new Error("WASM not initialized");return I4($,H,X)}function vH($){if(!p)throw new Error("WASM not initialized");return v4($)}function SH($,H,X,Q){if(!p)throw new Error("WASM not initialized");return R4($,H||new Uint8Array(0),X,Q)}function hH($){if(!p)throw new Error("WASM not initialized");return F4($)}function kH($,H,X,Q,Z){if(!p)throw new Error("WASM not initialized");return D4($,H,X,Q,Z)}function bH($,H,X){if(!p)throw new Error("WASM not initialized");return z4($,H,X)}function yH($){if(!p)throw new Error("WASM not initialized");return P4($)}var p=!1;var v8=U8(()=>{y4()});var X8={};m0(X8,{wrapRecipientPrivateKey:()=>HX,unwrapRecipientPrivateKey:()=>eH,selectEpochKey:()=>sH,getOrCreateGuestDid:()=>aH,fetchPreKey:()=>oH,fetchEpochRegistry:()=>nH,deriveKeyPairFromPrf:()=>QX,decryptLayer2Envelope:()=>tH,canonicalJson:()=>XX,buildLayer2Envelope:()=>iH,b64urlEncode:()=>$X,b64urlDecode:()=>rH,ReplayGuard:()=>a4,LocalStorageReplayStore:()=>r4});function oH(){throw new Error("L2 Encryption unavailable in standard runtime")}function nH(){throw new Error("L2 Encryption unavailable in standard runtime")}function sH(){throw new Error("L2 Encryption unavailable in standard runtime")}function iH(){throw new Error("L2 Encryption unavailable in standard runtime")}function aH(){throw new Error("Guest DID unavailable in standard runtime")}function rH(){throw new Error("L2 Crypto unavailable")}function tH(){throw new Error("L2 Crypto unavailable")}function eH(){throw new Error("L2 Crypto unavailable")}function $X(){throw new Error("L2 Crypto unavailable")}function HX(){throw new Error("L2 Crypto unavailable")}function XX($){return JSON.stringify($)}function QX(){throw new Error("L2 Crypto unavailable")}class a4{async checkAndMark($){return!0}async reset(){}}class r4{async has($){return!1}async add($){}async reset(){}}var $$={};m0($$,{wrapRecipientPrivateKey:()=>NX,unwrapRecipientPrivateKey:()=>KX,selectEpochKey:()=>UX,getOrCreateGuestDid:()=>qX,fetchPreKey:()=>YX,fetchEpochRegistry:()=>ZX,deriveKeyPairFromPrf:()=>DX,decryptLayer2Envelope:()=>JX,canonicalJson:()=>OX,buildLayer2Envelope:()=>GX,b64urlEncode:()=>LX,b64urlDecode:()=>BX,ReplayGuard:()=>t4,LocalStorageReplayStore:()=>e4});function YX(){throw new Error("L2 Encryption unavailable in standard runtime")}function ZX(){throw new Error("L2 Encryption unavailable in standard runtime")}function UX(){throw new Error("L2 Encryption unavailable in standard runtime")}function GX(){throw new Error("L2 Encryption unavailable in standard runtime")}function qX(){throw new Error("Guest DID unavailable in standard runtime")}function BX(){throw new Error("L2 Crypto unavailable")}function JX(){throw new Error("L2 Crypto unavailable")}function KX(){throw new Error("L2 Crypto unavailable")}function LX(){throw new Error("L2 Crypto unavailable")}function NX(){throw new Error("L2 Crypto unavailable")}function OX($){return JSON.stringify($)}function DX(){throw new Error("L2 Crypto unavailable")}class t4{async checkAndMark($){return!0}async reset(){}}class e4{async has($){return!1}async add($){}async reset(){}}class G8{runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let H=$.dataset.copyFrom;if(H){let Z=($.closest("tr")||document).querySelector(`[data-base-key="${H}"], [data-json-path="${H}"]`);if(Z&&Z.value!==$.value)$.value=Z.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let H=$.dataset.formula;if(!H)return;let X=$.closest("tr"),Q=$.closest("table"),Z=(Y)=>{let G=0,q="none";if(X){let J=`[data-base-key="${Y}"], [data-json-path="${Y}"]`,B=X.querySelector(J);if(B){if(q="row-input",B.value!=="")G=parseFloat(B.value)}}if(q==="none"){let J=document.querySelector(`[data-json-path="${Y}"]`);if(J){if(q="static-input",J.value!=="")G=parseFloat(J.value)}}return G},U=H.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(Y,G)=>{let q=0,J=Q||document,B=J.querySelectorAll(`[data-base-key="${G}"], [data-json-path="${G}"]`);if(B.length===0&&J!==document)B=document.querySelectorAll(`[data-base-key="${G}"], [data-json-path="${G}"]`);return B.forEach((L)=>{let D=parseFloat(L.value);if(!isNaN(D))q+=D}),q});U=U.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(Y)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(Y))return Y;return String(Z(Y))});try{let Y=new Function("return "+U)();if(typeof Y==="number"&&!isNaN(Y))$.value=Number.isInteger(Y)?Y:Y.toFixed(0);else $.value=""}catch(Y){console.error("Calc Error:",Y),$.value="Err"}}),this.runAutoCopy()}}var n4=g8(p8(),1);var q8;try{q8=new TextDecoder}catch($){}var R,D0,z=0;var n8=[],K$=105,L$=57342,N$=57343,u8=57337;var l8=6,C0={},V0=112810000,J0=16810000;var B8=n8,J8=0,y={},n,p0,u0=0,j0=0,r,Y0,a=[],K8=[],X0,H0,I0,d8={useRecords:!1,mapsAsObjects:!0},E0=!1,s8=2;try{new Function("")}catch($){s8=1/0}class K0{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[H,X]of Object.entries($.keyMap))this.mapKey.set(X,H)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let H=new Map;for(let[X,Q]of Object.entries($))H.set(this._keyMap.hasOwnProperty(X)?this._keyMap[X]:X,Q);return H}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[X,Q]of Object.entries(this._keyMap))this._mapKey.set(Q,X)}let H={};return $.forEach((X,Q)=>H[Z0(this._mapKey.has(Q)?this._mapKey.get(Q):Q)]=X),H}mapDecode($,H){let X=this.decode($);if(this._keyMap)switch(X.constructor.name){case"Array":return X.map((Q)=>this.decodeKeys(Q))}return X}decode($,H){if(R)return t8(()=>{return l0(),this?this.decode($,H):K0.prototype.decode.call(d8,$,H)});D0=H>-1?H:$.length,z=0,J8=0,j0=0,p0=null,B8=n8,r=null,R=$;try{H0=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(X){if(R=null,$ instanceof Uint8Array)throw X;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof K0){if(y=this,X0=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return n=this.structures,g0();else if(!n||n.length>0)n=[]}else{if(y=d8,!n||n.length>0)n=[];X0=null}return g0()}decodeMultiple($,H){let X,Q=0;try{let Z=$.length;E0=!0;let U=this?this.decode($,Z):z8.decode($,Z);if(H){if(H(U)===!1)return;while(z<Z)if(Q=z,H(g0())===!1)return}else{X=[U];while(z<Z)Q=z,X.push(g0());return X}}catch(Z){throw Z.lastPosition=Q,Z.values=X,Z}finally{E0=!1,l0()}}}function g0(){try{let $=m();if(r){if(z>=r.postBundlePosition){let H=new Error("Unexpected bundle position");throw H.incomplete=!0,H}z=r.postBundlePosition,r=null}if(z==D0){if(n=null,R=null,Y0)Y0=null}else if(z>D0){let H=new Error("Unexpected end of CBOR data");throw H.incomplete=!0,H}else if(!E0)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(l0(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function m(){let $=R[z++],H=$>>5;if($=$&31,$>23)switch($){case 24:$=R[z++];break;case 25:if(H==7)return z$();$=H0.getUint16(z),z+=2;break;case 26:if(H==7){let X=H0.getFloat32(z);if(y.useFloat32>2){let Q=d0[(R[z]&127)<<1|R[z+1]>>7];return z+=4,(Q*X+(X>0?0.5:-0.5)>>0)/Q}return z+=4,X}$=H0.getUint32(z),z+=4;break;case 27:if(H==7){let X=H0.getFloat64(z);return z+=8,X}if(H>1){if(H0.getUint32(z)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=H0.getUint32(z+4)}else if(y.int64AsNumber)$=H0.getUint32(z)*4294967296,$+=H0.getUint32(z+4);else $=H0.getBigUint64(z);z+=8;break;case 31:switch(H){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let X=[],Q,Z=0;while((Q=m())!=C0){if(Z>=V0)throw new Error(`Array length exceeds ${V0}`);X[Z++]=Q}return H==4?X:H==3?X.join(""):Buffer.concat(X);case 5:let U;if(y.mapsAsObjects){let Y={},G=0;if(y.keyMap)while((U=m())!=C0){if(G++>=J0)throw new Error(`Property count exceeds ${J0}`);Y[Z0(y.decodeKey(U))]=m()}else while((U=m())!=C0){if(G++>=J0)throw new Error(`Property count exceeds ${J0}`);Y[Z0(U)]=m()}return Y}else{if(I0)y.mapsAsObjects=!0,I0=!1;let Y=new Map;if(y.keyMap){let G=0;while((U=m())!=C0){if(G++>=J0)throw new Error(`Map size exceeds ${J0}`);Y.set(y.decodeKey(U),m())}}else{let G=0;while((U=m())!=C0){if(G++>=J0)throw new Error(`Map size exceeds ${J0}`);Y.set(U,m())}}return Y}case 7:return C0;default:throw new Error("Invalid major type for indefinite length "+H)}default:throw new Error("Unknown token "+$)}switch(H){case 0:return $;case 1:return~$;case 2:return M$($);case 3:if(j0>=z)return p0.slice(z-u0,(z+=$)-u0);if(j0==0&&D0<140&&$<32){let Z=$<16?i8($):D$($);if(Z!=null)return Z}return O$($);case 4:if($>=V0)throw new Error(`Array length exceeds ${V0}`);let X=new Array($);for(let Z=0;Z<$;Z++)X[Z]=m();return X;case 5:if($>=J0)throw new Error(`Map size exceeds ${V0}`);if(y.mapsAsObjects){let Z={};if(y.keyMap)for(let U=0;U<$;U++)Z[Z0(y.decodeKey(m()))]=m();else for(let U=0;U<$;U++)Z[Z0(m())]=m();return Z}else{if(I0)y.mapsAsObjects=!0,I0=!1;let Z=new Map;if(y.keyMap)for(let U=0;U<$;U++)Z.set(y.decodeKey(m()),m());else for(let U=0;U<$;U++)Z.set(m(),m());return Z}case 6:if($>=u8){let Z=n[$&8191];if(Z){if(!Z.read)Z.read=L8(Z);return Z.read()}if($<65536){if($==N$){let U=A0(),Y=m(),G=m();O8(Y,G);let q={};if(y.keyMap)for(let J=2;J<U;J++){let B=y.decodeKey(G[J-2]);q[Z0(B)]=m()}else for(let J=2;J<U;J++){let B=G[J-2];q[Z0(B)]=m()}return q}else if($==L$){let U=A0(),Y=m();for(let G=2;G<U;G++)O8(Y++,m());return m()}else if($==u8)return R$();if(y.getShared){if(M8(),Z=n[$&8191],Z){if(!Z.read)Z.read=L8(Z);return Z.read()}}}}let Q=a[$];if(Q)if(Q.handlesRead)return Q(m);else return Q(m());else{let Z=m();for(let U=0;U<K8.length;U++){let Y=K8[U]($,Z);if(Y!==void 0)return Y}return new U0(Z,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let Z=(X0||O0())[$];if(Z!==void 0)return Z;throw new Error("Unknown token "+$)}default:if(isNaN($)){let Z=new Error("Unexpected end of CBOR data");throw Z.incomplete=!0,Z}throw new Error("Unknown CBOR token "+$)}}var o8=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function L8($){if(!$)throw new Error("Structure is required in record definition");function H(){let X=R[z++];if(X=X&31,X>23)switch(X){case 24:X=R[z++];break;case 25:X=H0.getUint16(z),z+=2;break;case 26:X=H0.getUint32(z),z+=4;break;default:throw new Error("Expected array header, but got "+R[z-1])}let Q=this.compiledReader;while(Q){if(Q.propertyCount===X)return Q(m);Q=Q.next}if(this.slowReads++>=s8){let U=this.length==X?this:this.slice(0,X);if(Q=y.keyMap?new Function("r","return {"+U.map((Y)=>y.decodeKey(Y)).map((Y)=>o8.test(Y)?Z0(Y)+":r()":"["+JSON.stringify(Y)+"]:r()").join(",")+"}"):new Function("r","return {"+U.map((Y)=>o8.test(Y)?Z0(Y)+":r()":"["+JSON.stringify(Y)+"]:r()").join(",")+"}"),this.compiledReader)Q.next=this.compiledReader;return Q.propertyCount=X,this.compiledReader=Q,Q(m)}let Z={};if(y.keyMap)for(let U=0;U<X;U++)Z[Z0(y.decodeKey(this[U]))]=m();else for(let U=0;U<X;U++)Z[Z0(this[U])]=m();return Z}return $.slowReads=0,H}function Z0($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var O$=N8;function N8($){let H;if($<16){if(H=i8($))return H}if($>64&&q8)return q8.decode(R.subarray(z,z+=$));let X=z+$,Q=[];H="";while(z<X){let Z=R[z++];if((Z&128)===0)Q.push(Z);else if((Z&224)===192){let U=R[z++]&63;Q.push((Z&31)<<6|U)}else if((Z&240)===224){let U=R[z++]&63,Y=R[z++]&63;Q.push((Z&31)<<12|U<<6|Y)}else if((Z&248)===240){let U=R[z++]&63,Y=R[z++]&63,G=R[z++]&63,q=(Z&7)<<18|U<<12|Y<<6|G;if(q>65535)q-=65536,Q.push(q>>>10&1023|55296),q=56320|q&1023;Q.push(q)}else Q.push(Z);if(Q.length>=4096)H+=$0.apply(String,Q),Q.length=0}if(Q.length>0)H+=$0.apply(String,Q);return H}var $0=String.fromCharCode;function D$($){let H=z,X=new Array($);for(let Q=0;Q<$;Q++){let Z=R[z++];if((Z&128)>0){z=H;return}X[Q]=Z}return $0.apply(String,X)}function i8($){if($<4)if($<2)if($===0)return"";else{let H=R[z++];if((H&128)>1){z-=1;return}return $0(H)}else{let H=R[z++],X=R[z++];if((H&128)>0||(X&128)>0){z-=2;return}if($<3)return $0(H,X);let Q=R[z++];if((Q&128)>0){z-=3;return}return $0(H,X,Q)}else{let H=R[z++],X=R[z++],Q=R[z++],Z=R[z++];if((H&128)>0||(X&128)>0||(Q&128)>0||(Z&128)>0){z-=4;return}if($<6)if($===4)return $0(H,X,Q,Z);else{let U=R[z++];if((U&128)>0){z-=5;return}return $0(H,X,Q,Z,U)}else if($<8){let U=R[z++],Y=R[z++];if((U&128)>0||(Y&128)>0){z-=6;return}if($<7)return $0(H,X,Q,Z,U,Y);let G=R[z++];if((G&128)>0){z-=7;return}return $0(H,X,Q,Z,U,Y,G)}else{let U=R[z++],Y=R[z++],G=R[z++],q=R[z++];if((U&128)>0||(Y&128)>0||(G&128)>0||(q&128)>0){z-=8;return}if($<10)if($===8)return $0(H,X,Q,Z,U,Y,G,q);else{let J=R[z++];if((J&128)>0){z-=9;return}return $0(H,X,Q,Z,U,Y,G,q,J)}else if($<12){let J=R[z++],B=R[z++];if((J&128)>0||(B&128)>0){z-=10;return}if($<11)return $0(H,X,Q,Z,U,Y,G,q,J,B);let L=R[z++];if((L&128)>0){z-=11;return}return $0(H,X,Q,Z,U,Y,G,q,J,B,L)}else{let J=R[z++],B=R[z++],L=R[z++],D=R[z++];if((J&128)>0||(B&128)>0||(L&128)>0||(D&128)>0){z-=12;return}if($<14)if($===12)return $0(H,X,Q,Z,U,Y,G,q,J,B,L,D);else{let M=R[z++];if((M&128)>0){z-=13;return}return $0(H,X,Q,Z,U,Y,G,q,J,B,L,D,M)}else{let M=R[z++],j=R[z++];if((M&128)>0||(j&128)>0){z-=14;return}if($<15)return $0(H,X,Q,Z,U,Y,G,q,J,B,L,D,M,j);let V=R[z++];if((V&128)>0){z-=15;return}return $0(H,X,Q,Z,U,Y,G,q,J,B,L,D,M,j,V)}}}}}function M$($){return y.copyBuffers?Uint8Array.prototype.slice.call(R,z,z+=$):R.subarray(z,z+=$)}var a8=new Float32Array(1),c0=new Uint8Array(a8.buffer,0,4);function z$(){let $=R[z++],H=R[z++],X=($&127)>>2;if(X===31){if(H||$&3)return NaN;return $&128?-1/0:1/0}if(X===0){let Q=(($&3)<<8|H)/16777216;return $&128?-Q:Q}return c0[3]=$&128|(X>>1)+56,c0[2]=($&7)<<5|H>>3,c0[1]=H<<5,c0[0]=0,a8[0]}var RX=new Array(4096);class U0{constructor($,H){this.value=$,this.tag=H}}a[0]=($)=>{return new Date($)};a[1]=($)=>{return new Date(Math.round($*1000))};a[2]=($)=>{let H=BigInt(0);for(let X=0,Q=$.byteLength;X<Q;X++)H=BigInt($[X])+(H<<BigInt(8));return H};a[3]=($)=>{return BigInt(-1)-a[2]($)};a[4]=($)=>{return+($[1]+"e"+$[0])};a[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var O8=($,H)=>{$=$-57344;let X=n[$];if(X&&X.isShared)(n.restoreStructures||(n.restoreStructures=[]))[$]=X;n[$]=H,H.read=L8(H)};a[K$]=($)=>{let H=$.length,X=$[1];O8($[0],X);let Q={};for(let Z=2;Z<H;Z++){let U=X[Z-2];Q[Z0(U)]=$[Z]}return Q};a[14]=($)=>{if(r)return r[0].slice(r.position0,r.position0+=$);return new U0($,14)};a[15]=($)=>{if(r)return r[1].slice(r.position1,r.position1+=$);return new U0($,15)};var C$={Error,RegExp};a[27]=($)=>{return(C$[$[0]]||Error)($[1],$[2])};var r8=($)=>{if(R[z++]!=132){let X=new Error("Packed values structure must be followed by a 4 element array");if(R.length<z)X.incomplete=!0;throw X}let H=$();if(!H||!H.length){let X=new Error("Packed values structure must be followed by a 4 element array");throw X.incomplete=!0,X}return X0=X0?H.concat(X0.slice(H.length)):H,X0.prefixes=$(),X0.suffixes=$(),$()};r8.handlesRead=!0;a[51]=r8;a[l8]=($)=>{if(!X0)if(y.getShared)M8();else return new U0($,l8);if(typeof $=="number")return X0[16+($>=0?2*$:-2*$-1)];let H=new Error("No support for non-integer packed references yet");if($===void 0)H.incomplete=!0;throw H};a[28]=($)=>{if(!Y0)Y0=new Map,Y0.id=0;let H=Y0.id++,X=z,Q=R[z],Z;if(Q>>5==4)Z=[];else Z={};let U={target:Z};Y0.set(H,U);let Y=$();if(U.used){if(Object.getPrototypeOf(Z)!==Object.getPrototypeOf(Y))z=X,Z=Y,Y0.set(H,{target:Z}),Y=$();return Object.assign(Z,Y)}return U.target=Y,Y};a[28].handlesRead=!0;a[29]=($)=>{let H=Y0.get($);return H.used=!0,H.target};a[258]=($)=>new Set($);(a[259]=($)=>{if(y.mapsAsObjects)y.mapsAsObjects=!1,I0=!0;return $()}).handlesRead=!0;function P0($,H){if(typeof $==="string")return $+H;if($ instanceof Array)return $.concat(H);return Object.assign({},$,H)}function O0(){if(!X0)if(y.getShared)M8();else throw new Error("No packed values available");return X0}var P$=1399353956;K8.push(($,H)=>{if($>=225&&$<=255)return P0(O0().prefixes[$-224],H);if($>=28704&&$<=32767)return P0(O0().prefixes[$-28672],H);if($>=1879052288&&$<=2147483647)return P0(O0().prefixes[$-1879048192],H);if($>=216&&$<=223)return P0(H,O0().suffixes[$-216]);if($>=27647&&$<=28671)return P0(H,O0().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return P0(H,O0().suffixes[$-1811939328]);if($==P$)return{packedValues:X0,structures:n.slice(0),version:H};if($==55799)return H});var A$=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,D8=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],W$=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<D8.length;$++)F$(D8[$],W$[$]);function F$($,H){let X="get"+$.name.slice(0,-5),Q;if(typeof $==="function")Q=$.BYTES_PER_ELEMENT;else $=null;for(let Z=0;Z<2;Z++){if(!Z&&Q==1)continue;let U=Q==2?1:Q==4?2:Q==8?3:0;a[Z?H:H-4]=Q==1||Z==A$?(Y)=>{if(!$)throw new Error("Could not find typed array for code "+H);if(!y.copyBuffers){if(Q===1||Q===2&&!(Y.byteOffset&1)||Q===4&&!(Y.byteOffset&3)||Q===8&&!(Y.byteOffset&7))return new $(Y.buffer,Y.byteOffset,Y.byteLength>>U)}return new $(Uint8Array.prototype.slice.call(Y,0).buffer)}:(Y)=>{if(!$)throw new Error("Could not find typed array for code "+H);let G=new DataView(Y.buffer,Y.byteOffset,Y.byteLength),q=Y.length>>U,J=new $(q),B=G[X];for(let L=0;L<q;L++)J[L]=B.call(G,L<<U,Z);return J}}}function R$(){let $=A0(),H=z+m();for(let Q=2;Q<$;Q++){let Z=A0();z+=Z}let X=z;return z=H,r=[N8(A0()),N8(A0())],r.position0=0,r.position1=0,r.postBundlePosition=z,z=X,m()}function A0(){let $=R[z++]&31;if($>23)switch($){case 24:$=R[z++];break;case 25:$=H0.getUint16(z),z+=2;break;case 26:$=H0.getUint32(z),z+=4;break}return $}function M8(){if(y.getShared){let $=t8(()=>{return R=null,y.getShared()})||{},H=$.structures||[];if(y.sharedVersion=$.version,X0=y.sharedValues=$.packedValues,n===!0)y.structures=n=H;else n.splice.apply(n,[0,H.length].concat(H))}}function t8($){let H=D0,X=z,Q=J8,Z=u0,U=j0,Y=p0,G=B8,q=Y0,J=r,B=new Uint8Array(R.slice(0,D0)),L=n,D=y,M=E0,j=$();return D0=H,z=X,J8=Q,u0=Z,j0=U,p0=Y,B8=G,Y0=q,r=J,R=B,E0=M,n=L,y=D,H0=new DataView(R.buffer,R.byteOffset,R.byteLength),j}function l0(){R=null,Y0=null,n=null}var d0=new Array(147);for(let $=0;$<256;$++)d0[$]=+("1e"+Math.floor(45.15-$*0.30103));var z8=new K0({useRecords:!1}),o0=z8.decode,x$=z8.decodeMultiple;var n0;try{n0=new TextEncoder}catch($){}var F8,Z4,i0=typeof globalThis==="object"&&globalThis.Buffer,w0=typeof i0!=="undefined",C8=w0?i0.allocUnsafeSlow:Uint8Array,e8=w0?i0:Uint8Array,$4=256,H4=w0?4294967296:2144337920;var P8,N,l,K=0,L0,t=null,V$=61440,I$=/[\u0080-\uFFFF]/,Q0=Symbol("record-id");class a0 extends K0{constructor($){super($);this.offset=0;let H,X,Q,Z,U,Y;$=$||{};let G=e8.prototype.utf8Write?function(O,x,P){return N.utf8Write(O,x,P)}:n0&&n0.encodeInto?function(O,x){return n0.encodeInto(O,N.subarray(x)).written}:!1,q=this,J=$.structures||$.saveStructures,B=$.maxSharedStructures;if(B==null)B=J?128:0;if(B>8190)throw new Error("Maximum maxSharedStructure is 8190");let L=$.sequential;if(L)B=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let D,M,j=$.sharedValues,V;if(j){V=Object.create(null);for(let O=0,x=j.length;O<x;O++)V[j[O]]=O}let E=[],u=0,c=0;this.mapEncode=function(O,x){if(this._keyMap&&!this._mapped)switch(O.constructor.name){case"Array":O=O.map((P)=>this.encodeKeys(P));break}return this.encode(O,x)},this.encode=function(O,x){if(!N)N=new C8(8192),l=new DataView(N.buffer,0,8192),K=0;if(L0=N.length-10,L0-K<2048)N=new C8(N.length),l=new DataView(N.buffer,0,N.length),L0=N.length-10,K=0;else if(x===x8)K=K+7&2147483640;if(X=K,q.useSelfDescribedHeader)l.setUint32(K,3654940416),K+=3;if(Y=q.structuredClone?new Map:null,q.bundleStrings&&typeof O!=="string")t=[],t.size=1/0;else t=null;if(Q=q.structures,Q){if(Q.uninitialized){let A=q.getShared()||{};q.structures=Q=A.structures||[],q.sharedVersion=A.version;let W=q.sharedValues=A.packedValues;if(W){V={};for(let I=0,S=W.length;I<S;I++)V[W[I]]=I}}let P=Q.length;if(P>B&&!L)P=B;if(!Q.transitions){Q.transitions=Object.create(null);for(let A=0;A<P;A++){let W=Q[A];if(!W)continue;let I,S=Q.transitions;for(let h=0,b=W.length;h<b;h++){if(S[Q0]===void 0)S[Q0]=A;let g=W[h];if(I=S[g],!I)I=S[g]=Object.create(null);S=I}S[Q0]=A|1048576}}if(!L)Q.nextId=P}if(Z)Z=!1;if(U=Q||[],M=V,$.pack){let P=new Map;if(P.values=[],P.encoder=q,P.maxValues=$.maxPrivatePackedValues||(V?16:1/0),P.objectMap=V||!1,P.samplingPackedValues=D,s0(O,P),P.values.length>0){N[K++]=216,N[K++]=51,q0(4);let A=P.values;F(A),q0(0),q0(0),M=Object.create(V||null);for(let W=0,I=A.length;W<I;W++)M[A[W]]=W}}P8=x&W8;try{if(P8)return;if(F(O),t)Q4(X,F);if(q.offset=K,Y&&Y.idsToInsert){if(K+=Y.idsToInsert.length*2,K>L0)f(K);q.offset=K;let P=w$(N.subarray(X,K),Y.idsToInsert);return Y=null,P}if(x&x8)return N.start=X,N.end=K,N;return N.subarray(X,K)}finally{if(Q){if(c<10)c++;if(Q.length>B)Q.length=B;if(u>1e4){if(Q.transitions=null,c=0,u=0,E.length>0)E=[]}else if(E.length>0&&!L){for(let P=0,A=E.length;P<A;P++)E[P][Q0]=void 0;E=[]}}if(Z&&q.saveShared){if(q.structures.length>B)q.structures=q.structures.slice(0,B);let P=N.subarray(X,K);if(q.updateSharedData()===!1)return q.encode(O);return P}if(x&v$)K=X}},this.findCommonStringsToPack=()=>{if(D=new Map,!V)V=Object.create(null);return(O)=>{let x=O&&O.threshold||4,P=this.pack?O.maxPrivatePackedValues||16:0;if(!j)j=this.sharedValues=[];for(let[A,W]of D)if(W.count>x)V[A]=P++,j.push(A),Z=!0;while(this.saveShared&&this.updateSharedData()===!1);D=null}};let F=(O)=>{if(K>L0)N=f(K);var x=typeof O,P;if(x==="string"){if(M){let S=M[O];if(S>=0){if(S<16)N[K++]=S+224;else if(N[K++]=198,S&1)F(15-S>>1);else F(S-16>>1);return}else if(D&&!$.pack){let h=D.get(O);if(h)h.count++;else D.set(O,{count:1})}}let A=O.length;if(t&&A>=4&&A<1024){if((t.size+=A)>V$){let h,b=(t[0]?t[0].length*3+t[1].length:0)+10;if(K+b>L0)N=f(K+b);if(N[K++]=217,N[K++]=223,N[K++]=249,N[K++]=t.position?132:130,N[K++]=26,h=K-X,K+=4,t.position)Q4(X,F);t=["",""],t.size=0,t.position=h}let S=I$.test(O);t[S?0:1]+=O,N[K++]=S?206:207,F(A);return}let W;if(A<32)W=1;else if(A<256)W=2;else if(A<65536)W=3;else W=5;let I=A*3;if(K+I>L0)N=f(K+I);if(A<64||!G){let S,h,b,g=K+W;for(S=0;S<A;S++)if(h=O.charCodeAt(S),h<128)N[g++]=h;else if(h<2048)N[g++]=h>>6|192,N[g++]=h&63|128;else if((h&64512)===55296&&((b=O.charCodeAt(S+1))&64512)===56320)h=65536+((h&1023)<<10)+(b&1023),S++,N[g++]=h>>18|240,N[g++]=h>>12&63|128,N[g++]=h>>6&63|128,N[g++]=h&63|128;else N[g++]=h>>12|224,N[g++]=h>>6&63|128,N[g++]=h&63|128;P=g-K-W}else P=G(O,K+W,I);if(P<24)N[K++]=96|P;else if(P<256){if(W<2)N.copyWithin(K+2,K+1,K+1+P);N[K++]=120,N[K++]=P}else if(P<65536){if(W<3)N.copyWithin(K+3,K+2,K+2+P);N[K++]=121,N[K++]=P>>8,N[K++]=P&255}else{if(W<5)N.copyWithin(K+5,K+3,K+3+P);N[K++]=122,l.setUint32(K,P),K+=4}K+=P}else if(x==="number")if(!this.alwaysUseFloat&&O>>>0===O)if(O<24)N[K++]=O;else if(O<256)N[K++]=24,N[K++]=O;else if(O<65536)N[K++]=25,N[K++]=O>>8,N[K++]=O&255;else N[K++]=26,l.setUint32(K,O),K+=4;else if(!this.alwaysUseFloat&&O>>0===O)if(O>=-24)N[K++]=31-O;else if(O>=-256)N[K++]=56,N[K++]=~O;else if(O>=-65536)N[K++]=57,l.setUint16(K,~O),K+=2;else N[K++]=58,l.setUint32(K,~O),K+=4;else{let A;if((A=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){N[K++]=250,l.setFloat32(K,O);let W;if(A<4||(W=O*d0[(N[K]&127)<<1|N[K+1]>>7])>>0===W){K+=4;return}else K--}N[K++]=251,l.setFloat64(K,O),K+=8}else if(x==="object")if(!O)N[K++]=246;else{if(Y){let W=Y.get(O);if(W){if(N[K++]=216,N[K++]=29,N[K++]=25,!W.references){let I=Y.idsToInsert||(Y.idsToInsert=[]);W.references=[],I.push(W)}W.references.push(K-X),K+=2;return}else Y.set(O,{offset:K-X})}let A=O.constructor;if(A===Object)w(O);else if(A===Array){if(P=O.length,P<24)N[K++]=128|P;else q0(P);for(let W=0;W<P;W++)F(O[W])}else if(A===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)N[K++]=217,N[K++]=1,N[K++]=3;if(P=O.size,P<24)N[K++]=160|P;else if(P<256)N[K++]=184,N[K++]=P;else if(P<65536)N[K++]=185,N[K++]=P>>8,N[K++]=P&255;else N[K++]=186,l.setUint32(K,P),K+=4;if(q.keyMap)for(let[W,I]of O)F(q.encodeKey(W)),F(I);else for(let[W,I]of O)F(W),F(I)}else{for(let W=0,I=F8.length;W<I;W++){let S=Z4[W];if(O instanceof S){let h=F8[W],b=h.tag;if(b==null)b=h.getTag&&h.getTag.call(this,O);if(b<24)N[K++]=192|b;else if(b<256)N[K++]=216,N[K++]=b;else if(b<65536)N[K++]=217,N[K++]=b>>8,N[K++]=b&255;else if(b>-1)N[K++]=218,l.setUint32(K,b),K+=4;h.encode.call(this,O,F,f);return}}if(O[Symbol.iterator]){if(P8){let W=new Error("Iterable should be serialized as iterator");throw W.iteratorNotHandled=!0,W}N[K++]=159;for(let W of O)F(W);N[K++]=255;return}if(O[Symbol.asyncIterator]||A8(O)){let W=new Error("Iterable/blob should be serialized as iterator");throw W.iteratorNotHandled=!0,W}if(this.useToJSON&&O.toJSON){let W=O.toJSON();if(W!==O)return F(W)}w(O)}}else if(x==="boolean")N[K++]=O?245:244;else if(x==="bigint"){if(O<BigInt(1)<<BigInt(64)&&O>=0)N[K++]=27,l.setBigUint64(K,O);else if(O>-(BigInt(1)<<BigInt(64))&&O<0)N[K++]=59,l.setBigUint64(K,-O-BigInt(1));else if(this.largeBigIntToFloat)N[K++]=251,l.setFloat64(K,Number(O));else{if(O>=BigInt(0))N[K++]=194;else N[K++]=195,O=BigInt(-1)-O;let A=[];while(O)A.push(Number(O&BigInt(255))),O>>=BigInt(8);R8(new Uint8Array(A.reverse()),f);return}K+=8}else if(x==="undefined")N[K++]=247;else throw new Error("Unknown type: "+x)},w=this.useRecords===!1?this.variableMapSize?(O)=>{let x=Object.keys(O),P=Object.values(O),A=x.length;if(A<24)N[K++]=160|A;else if(A<256)N[K++]=184,N[K++]=A;else if(A<65536)N[K++]=185,N[K++]=A>>8,N[K++]=A&255;else N[K++]=186,l.setUint32(K,A),K+=4;let W;if(q.keyMap)for(let I=0;I<A;I++)F(q.encodeKey(x[I])),F(P[I]);else for(let I=0;I<A;I++)F(x[I]),F(P[I])}:(O)=>{N[K++]=185;let x=K-X;K+=2;let P=0;if(q.keyMap){for(let A in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(A))F(q.encodeKey(A)),F(O[A]),P++}else for(let A in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(A))F(A),F(O[A]),P++;N[x+++X]=P>>8,N[x+X]=P&255}:(O,x)=>{let P,A=U.transitions||(U.transitions=Object.create(null)),W=0,I=0,S,h;if(this.keyMap){h=Object.keys(O).map((g)=>this.encodeKey(g)),I=h.length;for(let g=0;g<I;g++){let m8=h[g];if(P=A[m8],!P)P=A[m8]=Object.create(null),W++;A=P}}else for(let g in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(g)){if(P=A[g],!P){if(A[Q0]&1048576)S=A[Q0]&65535;P=A[g]=Object.create(null),W++}A=P,I++}let b=A[Q0];if(b!==void 0)b&=65535,N[K++]=217,N[K++]=b>>8|224,N[K++]=b&255;else{if(!h)h=A.__keys__||(A.__keys__=Object.keys(O));if(S===void 0){if(b=U.nextId++,!b)b=0,U.nextId=1;if(b>=$4)U.nextId=(b=B)+1}else b=S;if(U[b]=h,b<B){N[K++]=217,N[K++]=b>>8|224,N[K++]=b&255,A=U.transitions;for(let g=0;g<I;g++){if(A[Q0]===void 0||A[Q0]&1048576)A[Q0]=b;A=A[h[g]]}A[Q0]=b|1048576,Z=!0}else{if(A[Q0]=b,l.setUint32(K,3655335680),K+=3,W)u+=c*W;if(E.length>=$4-B)E.shift()[Q0]=void 0;if(E.push(A),q0(I+2),F(57344+b),F(h),x)return;for(let g in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(g))F(O[g]);return}}if(I<24)N[K++]=128|I;else q0(I);if(x)return;for(let g in O)if(typeof O.hasOwnProperty!=="function"||O.hasOwnProperty(g))F(O[g])},f=(O)=>{let x;if(O>16777216){if(O-X>H4)throw new Error("Encoded buffer would be larger than maximum buffer size");x=Math.min(H4,Math.round(Math.max((O-X)*(O>67108864?1.25:2),4194304)/4096)*4096)}else x=(Math.max(O-X<<2,N.length-1)>>12)+1<<12;let P=new C8(x);if(l=new DataView(P.buffer,0,x),N.copy)N.copy(P,0,X,O);else P.set(N.slice(X,O));return K-=X,X=0,L0=P.length-10,N=P},v=100,T=1000;this.encodeAsIterable=function(O,x){return z0(O,x,o)},this.encodeAsAsyncIterable=function(O,x){return z0(O,x,y8)};function*o(O,x,P){let A=O.constructor;if(A===Object){let W=q.useRecords!==!1;if(W)w(O,!0);else X4(Object.keys(O).length,160);for(let I in O){let S=O[I];if(!W)F(I);if(S&&typeof S==="object")if(x[I])yield*o(S,x[I]);else yield*d(S,x,I);else F(S)}}else if(A===Array){let W=O.length;q0(W);for(let I=0;I<W;I++){let S=O[I];if(S&&(typeof S==="object"||K-X>v))if(x.element)yield*o(S,x.element);else yield*d(S,x,"element");else F(S)}}else if(O[Symbol.iterator]&&!O.buffer){N[K++]=159;for(let W of O)if(W&&(typeof W==="object"||K-X>v))if(x.element)yield*o(W,x.element);else yield*d(W,x,"element");else F(W);N[K++]=255}else if(A8(O))X4(O.size,64),yield N.subarray(X,K),yield O,B0();else if(O[Symbol.asyncIterator])N[K++]=159,yield N.subarray(X,K),yield O,B0(),N[K++]=255;else F(O);if(P&&K>X)yield N.subarray(X,K);else if(K-X>v)yield N.subarray(X,K),B0()}function*d(O,x,P){let A=K-X;try{if(F(O),K-X>v)yield N.subarray(X,K),B0()}catch(W){if(W.iteratorNotHandled)x[P]={},K=X+A,yield*o.call(this,O,x[P]);else throw W}}function B0(){v=T,q.encode(null,W8)}function z0(O,x,P){if(x&&x.chunkThreshold)v=T=x.chunkThreshold;else v=100;if(O&&typeof O==="object")return q.encode(null,W8),P(O,q.iterateProperties||(q.iterateProperties={}),!0);return[q.encode(O)]}async function*y8(O,x){for(let P of o(O,x,!0)){let A=P.constructor;if(A===e8||A===Uint8Array)yield P;else if(A8(P)){let W=P.stream().getReader(),I;while(!(I=await W.read()).done)yield I.value}else if(P[Symbol.asyncIterator])for await(let W of P)if(B0(),W)yield*y8(W,x.async||(x.async={}));else yield q.encode(W);else yield P}}}useBuffer($){N=$,l=new DataView(N.buffer,N.byteOffset,N.byteLength),K=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let H=this.structures.slice(0),X=new V8(H,this.sharedValues,this.sharedVersion),Q=this.saveShared(X,(Z)=>(Z&&Z.version||0)==$);if(Q===!1)X=this.getShared()||{},this.structures=X.structures||[],this.sharedValues=X.packedValues,this.sharedVersion=X.version,this.structures.nextId=this.structures.length;else H.forEach((Z,U)=>this.structures[U]=Z);return Q}}function X4($,H){if($<24)N[K++]=H|$;else if($<256)N[K++]=H|24,N[K++]=$;else if($<65536)N[K++]=H|25,N[K++]=$>>8,N[K++]=$&255;else N[K++]=H|26,l.setUint32(K,$),K+=4}class V8{constructor($,H,X){this.structures=$,this.packedValues=H,this.version=X}}function q0($){if($<24)N[K++]=128|$;else if($<256)N[K++]=152,N[K++]=$;else if($<65536)N[K++]=153,N[K++]=$>>8,N[K++]=$&255;else N[K++]=154,l.setUint32(K,$),K+=4}var j$=typeof Blob==="undefined"?function(){}:Blob;function A8($){if($ instanceof j$)return!0;let H=$[Symbol.toStringTag];return H==="Blob"||H==="File"}function s0($,H){switch(typeof $){case"string":if($.length>3){if(H.objectMap[$]>-1||H.values.length>=H.maxValues)return;let Q=H.get($);if(Q){if(++Q.count==2)H.values.push($)}else if(H.set($,{count:1}),H.samplingPackedValues){let Z=H.samplingPackedValues.get($);if(Z)Z.count++;else H.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let Q=0,Z=$.length;Q<Z;Q++)s0($[Q],H);else{let Q=!H.encoder.useRecords;for(var X in $)if($.hasOwnProperty(X)){if(Q)s0(X,H);s0($[X],H)}}break;case"function":console.log($)}}var E$=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;Z4=[Date,Set,Error,RegExp,U0,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,V8];F8=[{tag:1,encode($,H){let X=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&X>=0&&X<4294967296)N[K++]=26,l.setUint32(K,X),K+=4;else N[K++]=251,l.setFloat64(K,X),K+=8}},{tag:258,encode($,H){let X=Array.from($);H(X)}},{tag:27,encode($,H){H([$.name,$.message])}},{tag:27,encode($,H){H(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,H){H($.value)}},{encode($,H,X){R8($,X)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||w0&&this.tagUint8Array!==!1)return 64}},encode($,H,X){R8($,X)}},G0(68,1),G0(69,2),G0(70,4),G0(71,8),G0(72,1),G0(77,2),G0(78,4),G0(79,8),G0(85,4),G0(86,8),{encode($,H){let X=$.packedValues||[],Q=$.structures||[];if(X.values.length>0){N[K++]=216,N[K++]=51,q0(4);let Z=X.values;H(Z),q0(0),q0(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let U=0,Y=Z.length;U<Y;U++)packedObjectMap[Z[U]]=U}if(Q){l.setUint32(K,3655335424),K+=3;let Z=Q.slice(0);Z.unshift(57344),Z.push(new U0($.version,1399353956)),H(Z)}else H(new U0($.version,1399353956))}}];function G0($,H){if(!E$&&H>1)$-=4;return{tag:$,encode:function X(Q,Z){let U=Q.byteLength,Y=Q.byteOffset||0,G=Q.buffer||Q;Z(w0?i0.from(G,Y,U):new Uint8Array(G,Y,U))}}}function R8($,H){let X=$.byteLength;if(X<24)N[K++]=64+X;else if(X<256)N[K++]=88,N[K++]=X;else if(X<65536)N[K++]=89,N[K++]=X>>8,N[K++]=X&255;else N[K++]=90,l.setUint32(K,X),K+=4;if(K+X>=N.length)H(K+X);N.set($.buffer?$:new Uint8Array($),K),K+=X}function w$($,H){let X,Q=H.length*2,Z=$.length-Q;H.sort((U,Y)=>U.offset>Y.offset?1:-1);for(let U=0;U<H.length;U++){let Y=H[U];Y.id=U;for(let G of Y.references)$[G++]=U>>8,$[G]=U&255}while(X=H.pop()){let U=X.offset;$.copyWithin(U+Q,U,Z),Q-=2;let Y=U+Q;$[Y++]=216,$[Y++]=28,Z=U}return $}function Q4($,H){l.setUint32(t.position+$,K-t.position-$+1);let X=t;t=null,H(X[0]),H(X[1])}var I8=new a0({useRecords:!1}),T$=I8.encode,_$=I8.encodeAsIterable,f$=I8.encodeAsAsyncIterable;var x8=512,v$=1024,W8=2048;var r0=($)=>{let H=new Uint8Array($);return btoa(String.fromCharCode(...H)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},U4=($)=>{let H=$.replace(/-/g,"+").replace(/_/g,"/");while(H.length%4)H+="=";let X=atob(H),Q=new Uint8Array(X.length);for(let Z=0;Z<X.length;Z++)Q[Z]=X.charCodeAt(Z);return Q.buffer};async function G4($){let H=crypto.getRandomValues(new Uint8Array(32)),Q=new TextEncoder().encode($),Z=await crypto.subtle.digest("SHA-256",Q),U=new Uint8Array(Z).slice(0,16),Y=await navigator.credentials.create({publicKey:{challenge:H,rp:{name:"Sorane Web/A Form"},user:{id:U,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"required"},timeout:60000,attestation:"none",extensions:{prf:{}}}});if(!Y)throw new Error("Credential creation failed");return{id:Y.id,rawId:r0(Y.rawId),response:Y.response}}async function q4($,H){let X=await navigator.credentials.get({publicKey:{challenge:H,allowCredentials:[{id:U4($),type:"public-key"}],userVerification:"required"}});if(!X)throw new Error("Assertion failed");let Q=X.response;return{id:X.id,signature:r0(Q.signature),authenticatorData:r0(Q.authenticatorData),clientDataJSON:r0(Q.clientDataJSON)}}async function B4($,H){let X=crypto.getRandomValues(new Uint8Array(32)),Q=await navigator.credentials.get({publicKey:{challenge:X,allowCredentials:[{id:U4($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:H}}}}});if(!Q)throw new Error("Assertion failed");let U=Q.getClientExtensionResults()?.prf?.results?.first;if(!U)throw new Error("PRF extension not available");return new Uint8Array(U)}var J4=typeof Buffer!=="undefined";function t0($){if(J4)return Buffer.from($).toString("hex");return Array.from($).map((H)=>H.toString(16).padStart(2,"0")).join("")}function e0($){if(J4)return Uint8Array.from(Buffer.from($,"hex"));let H=new Uint8Array($.length/2);for(let X=0;X<H.length;X++)H[X]=parseInt($.substring(X*2,X*2+2),16);return H}function j8($){if($.length===0)return"";let H=[0];for(let Z of $){let U=Z;for(let Y=0;Y<H.length;Y++){let G=H[Y]*256+U;H[Y]=G%58,U=Math.floor(G/58)}while(U>0)H.push(U%58),U=Math.floor(U/58)}let X=0;for(let Z of $){if(Z!==0)break;X+=1}let Q="1".repeat(X);for(let Z=H.length-1;Z>=0;Z--)Q+="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"[H[Z]];return Q}function K4($){return`z${j8($)}`}var S$=237,h$=4608;function k$($){let H=[],X=$;while(X>=128)H.push(X&127|128),X>>=7;return H.push(X),new Uint8Array(H)}function b$($,H){let X=k$($),Q=new Uint8Array(X.length+H.length);return Q.set(X,0),Q.set(H,X.length),Q}function L4($,H){let Q=b$(H==="p256"?h$:S$,$);return`did:key:z${j8(Q)}`}var mH="eddsa-jcs-2022";class s4{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),H=localStorage.getItem("weba_passkey_pub");if($&&H){this.credentialId=$,this.publicKey=e0(H),this.publicKeyType="p256",this.usePasskey=!0;return}let X=localStorage.getItem("weba_private_key");if(X)this.edPrivateKey=e0(X),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{let $=prompt("Enter a name for this Passkey:","demo-user")||"User";console.log(`Registering Passkey for ${$}...`);let H=await G4($),X=new Uint8Array(H.response.attestationObject),Z=o0(X).authData,U=new DataView(Z.buffer,Z.byteOffset,Z.byteLength),Y=53,G=U.getUint16(Y);Y+=2,Y+=G;let q=Z.slice(Y),J=o0(q),B=J.get(-2),L=J.get(-3);if(!B||!L)throw new Error("Invalid COSE Key: x or y missing");let D=new Uint8Array(65);if(D[0]=4,D.set(B,1),D.set(L,33),this.credentialId=H.rawId,this.publicKey=D,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",t0(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}async generateEdKey(){let{initWasm:$,ed25519GenerateKeyPair:H}=await Promise.resolve().then(() => (v8(),f8));await $(fetch("/assets/weba_crypto_wasm_bg.wasm"));let{privateKey:X,publicKey:Q}=H();if(this.edPrivateKey=X,this.publicKey=Q,this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",t0(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return L4(this.publicKey,this.publicKeyType)}getPublicKey(){return this.publicKey?t0(this.publicKey):""}async sign($,H="authentication"){if(!this.publicKey)await this.register();let X=n4.default($),Q=new TextEncoder().encode(X);if(this.usePasskey&&this.credentialId){let Z=await crypto.subtle.digest("SHA-256",Q),U=await q4(this.credentialId,Z);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:H,proofValue:U.signature,"srn:authenticatorData":U.authenticatorData,"srn:clientDataJSON":U.clientDataJSON,"srn:credentialId":U.id}}}else{if(!this.edPrivateKey)await this.generateEdKey();let{initWasm:Z,ed25519Sign:U}=await Promise.resolve().then(() => (v8(),f8));await Z(fetch("/assets/weba_crypto_wasm_bg.wasm"));let Y=U(this.edPrivateKey,Q);return{...$,proof:{type:"DataIntegrityProof",cryptosuite:mH,created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:H,proofValue:K4(Y)}}}}async derivePrf($){if(!this.credentialId)return null;try{return await B4(this.credentialId,$)}catch(H){return console.error("PRF derivation failed",H),null}}}var R0=new s4;function gH($){$.querySelectorAll("input").forEach((X)=>{if(X.type==="checkbox"||X.type==="radio")X.checked=!1,X.removeAttribute("checked");else X.value="",X.removeAttribute("value")}),$.querySelectorAll("textarea").forEach((X)=>{X.value="",X.textContent=""}),$.querySelectorAll("select").forEach((X)=>{X.selectedIndex=-1,X.querySelectorAll("option").forEach((Q)=>Q.removeAttribute("selected"))}),$.getElementById("json-ld")?.remove(),$.getElementById("data-layer")?.remove();let H=$.getElementById("json-debug");if(H)H.textContent=""}function cH($,H){let X=JSON.stringify(H,null,2),Q=$.createElement("script");Q.type="application/ld+json",Q.id="weba-user-vc",Q.textContent=X,$.body.appendChild(Q);let Z=$.createElement("div");Z.className="weba-user-verification no-print",Z.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",Z.innerHTML=`
    <details>
      <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
        <span></span> 
      </summary>
      <div style="padding: 1rem 0;">
        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
      </div>
    </details>
  `;let U=Z.querySelector("pre");if(U)U.textContent=X;$.body.appendChild(Z)}function pH($,H){let X=$.createElement("script");X.id="weba-l2-envelope",X.type="application/json",X.textContent=JSON.stringify(H,null,2),$.body.appendChild(X)}function uH($,H){let X=$.getElementById("weba-draft-state");if(X)X.remove();let Q=$.createElement("script");Q.id="weba-draft-state",Q.type="application/json",Q.textContent=JSON.stringify(H,null,2),$.body.appendChild(Q)}function lH($,H){let X=new Date,Q=X.getFullYear()+("0"+(X.getMonth()+1)).slice(-2)+("0"+X.getDate()).slice(-2)+"-"+("0"+X.getHours()).slice(-2)+("0"+X.getMinutes()).slice(-2),Z=Math.random().toString(36).substring(2,8);return`${$}_${Q}_${H}_${Z}.html`}function dH($,H){let Q=new DOMParser().parseFromString($,"text/html");if(H?.stripPlaintext)gH(Q);if(H?.embeddedVc)cH(Q,H.embeddedVc);if(H?.l2Envelope)pH(Q,H.l2Envelope);if(H?.draftState)uH(Q,H.draftState);return Q.documentElement.outerHTML}function i4($){let H=dH($.documentHtml,$.options),X=new Blob([H],{type:"text/html"}),Q=URL.createObjectURL(X),Z=document.createElement("a");if(Z.href=Q,Z.download=lH($.title,$.filenameSuffix),Z.click(),$.isFinal)setTimeout(()=>window.location.reload(),1000)}class b0{formId;static DRAFT_STATE_VERSION=1;static L2_REPLAY_STORE_KEY="weba_l2_nonces";currentSecurityTier="standard";constructor(){this.formId="WebA_"+window.location.pathname}updateSecurityUI($){this.currentSecurityTier=$;let H=new CustomEvent("weba-security-tier-change",{detail:{tier:$}});window.dispatchEvent(H)}updateJsonLd(){let $={};document.querySelectorAll("[data-json-path]").forEach((Q)=>{let Z=Q.dataset.jsonPath;if(Z)if(Q.type==="tel")$[Z]=Q.value.replace(/[^0-9]/g,"");else $[Z]=Q.value}),document.querySelectorAll('[type="radio"]:checked').forEach((Q)=>{$[Q.name]=Q.value}),document.querySelectorAll("table.data-table.dynamic").forEach((Q)=>{let Z=Q.dataset.tableKey;if(Z){let U=[];Q.querySelectorAll("tbody tr").forEach((Y)=>{let G={},q=!1;if(Y.querySelectorAll("[data-base-key]").forEach((J)=>{if(J.type==="checkbox"){if(G[J.dataset.baseKey]=J.checked,J.checked)q=!0}else if(G[J.dataset.baseKey]=J.value,J.value)q=!0}),q)U.push(G)}),$[Z]=U}});let H=document.getElementById("json-ld");if(H)H.textContent=JSON.stringify($,null,2);let X=document.getElementById("json-debug");if(X)X.textContent=JSON.stringify($,null,2);return $}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=this.updateJsonLd(),H=window,X=H.generatedJsonStructure&&H.generatedJsonStructure.name||"Response",Q=window.location.href.split("#")[0],Z=this.getL2Config(),U=document.getElementById("weba-l2-encrypt");if(!!(Z?.enabled&&(U?U.checked:Z.default_enabled))){if(!Z?.recipient_kid||!Z?.recipient_x25519||!Z?.layer1_ref){alert("L2 encryption config is missing required fields.");return}let q={...Z},J="offline";if(Z.prekey_url)try{let{fetchPreKey:D}=await Promise.resolve().then(() => X8),M=await D(Z.prekey_url);if(M){if(console.log("Tier 3 Active: Using dynamic pre-key",M.kid),q.recipient_kid=M.kid,q.recipient_x25519=M.recipient_x25519,M.recipient_pqc)q.recipient_pqc=M.recipient_pqc;J="high"}}catch(D){console.warn("Tier 3 Failed. Falling back to Tier 2.")}if(J==="offline"&&Z.epoch_registry_url)try{let{fetchEpochRegistry:D,selectEpochKey:M}=await Promise.resolve().then(() => X8),j=await D(Z.epoch_registry_url);if(j){let V=M(j);if(V)console.log("Tier 2 Active: Using epoch key",V.kid),q.recipient_kid=V.kid,q.recipient_x25519=V.publicKey,J="standard"}}catch(D){console.warn("Tier 2 Failed. Falling back to Tier 1.")}if(J==="offline")console.log("Tier 1 Active: Using static master key (Offline Mode)");this.updateSecurityUI(J);let B=Z.user_kid,L=document.getElementById("weba-guest-did-opt");if(L&&L.checked)try{let{getOrCreateGuestDid:D}=await Promise.resolve().then(() => $$),{did:M,isReused:j}=await D();B=M,console.log(`Using Guest DID: ${M} (Reused: ${j})`)}catch(D){if(console.error("Guest DID creation failed:",D),!confirm("Failed to create/retrieve Guest DID for replies. Continue with anonymous submission?"))return}try{let{buildLayer2Envelope:D}=await Promise.resolve().then(() => X8),M=await D({layer2_plain:$,config:q,user_kid:B||"anonymous"});this.downloadHtml("submit",!0,{l2Envelope:M,stripPlaintext:!0})}catch(D){console.error(D),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!R0.getPublicKey()){if(!await R0.register()){alert("Key registration failed.");return}}let G={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:R0.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:Q,answers:$}};try{let q=new Set;document.querySelectorAll("[data-json-path]").forEach((D)=>q.add(D.dataset.jsonPath)),document.querySelectorAll('[type="radio"]').forEach((D)=>q.add(D.name)),document.querySelectorAll("table.data-table.dynamic").forEach((D)=>q.add(D.dataset.tableKey));let J=[],B=G.credentialSubject.answers;for(let D in B)if(!q.has(D)&&!D.startsWith("@")&&D!=="type"&&D!=="templateId"&&D!=="id")J.push(D);if(J.length>0){if(!confirm(`WARNING: HMP Variance Detected.

The following hidden fields will be signed but are not visible in the form UI:
- ${J.join(`
- `)}

Continue signing?`))return}let L=await R0.sign(G);this.downloadHtml("submitted",!0,{embeddedVc:L})}catch(q){console.error(q),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let H=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((X)=>{let Q=X.dataset.jsonPath;if(H[Q]!==void 0)X.value=H[Q]}),document.querySelectorAll("table.data-table.dynamic").forEach((X)=>{let Q=X.dataset.tableKey,Z=H[Q];if(Array.isArray(Z)){let U=X.querySelector("tbody");if(!U)return;let Y=U.querySelectorAll(".template-row");Z.forEach((G,q)=>{let J;if(q===0)J=U.querySelector(".template-row");else{let B=U.querySelector(".template-row");if(B){J=B.cloneNode(!0),J.classList.remove("template-row");let L=J.querySelector(".remove-row-btn");if(L)L.style.visibility="visible";U.appendChild(J)}}if(J)J.querySelectorAll("input, select").forEach((B)=>{let L=B.dataset.baseKey;if(L&&G[L]!==void 0)if(B.type==="checkbox")B.checked=!!G[L];else B.value=G[L]})})}})}catch(H){console.error(H)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,H,X){let Q=window,Z=Q.generatedJsonStructure&&Q.generatedJsonStructure.name||"web-a-form";i4({documentHtml:document.documentElement.outerHTML,title:Z,filenameSuffix:$,isFinal:H,...X?{options:X}:{}})}buildDraftState(){let $=this.updateJsonLd(),H=new Date().toISOString(),X=localStorage.getItem(b0.L2_REPLAY_STORE_KEY),Q;if(X)try{let Z=JSON.parse(X);if(Array.isArray(Z))Q=Z.filter((U)=>typeof U==="string")}catch(Z){console.warn("Failed to parse L2 replay store for draft",Z)}return{version:b0.DRAFT_STATE_VERSION,savedAt:H,formId:this.formId,formData:$,...Q?{l2State:{replayNonces:Q}}:{}}}saveDraft(){let $=this.buildDraftState();this.bakeValues(),this.downloadHtml("draft",!1,{draftState:$})}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class S8{calc;data;constructor($,H){this.calc=$,this.data=H,this.initSecuritySignal()}initSecuritySignal(){window.addEventListener("weba-security-tier-change",($)=>{this.updateSecurityBadge($.detail.tier)})}updateSecurityBadge($){let H=document.getElementById("weba-security-signal");if(!H)return;let X=(navigator.language||"").toLowerCase().startsWith("ja"),Q={high:X?":  (True PFS)":"Security: HIGH (True PFS)",standard:X?":  (Epoch-Based)":"Security: STANDARD (Epoch)",offline:X?":  (Offline/Static)":"Security: BASIC (Offline)"};H.textContent=Q[$],H.className=`security-badge tier-${$}`;let Z=document.createElement("span");Z.className="status-dot",H.prepend(Z)}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save",clear_btn:"Clear",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},H=(navigator.language||"en").startsWith("ja")?"ja":"en",X=$[H]||$.en;document.querySelectorAll("[data-i18n]").forEach((Q)=>{let Z=Q.dataset.i18n;if(X[Z])Q.textContent=X[Z]})}initTelFormatter(){document.querySelectorAll('input[type="tel"]').forEach(($)=>{if($.value)$.value=this.formatTelDisplay($.value);$.addEventListener("input",(H)=>{let X=H.target.selectionStart,Q=H.target.value,Z=Q.replace(/[^0-9]/g,""),U=this.formatTelDisplay(Z);if(U!==Q){H.target.value=U;let Y=U.length-Q.length;H.target.setSelectionRange(X+Y,X+Y)}}),$.addEventListener("blur",(H)=>{let X=H.target.value.replace(/[^0-9]/g,"");$.dataset.cleanValue=X})})}formatTelDisplay($){let H=$.replace(/[^0-9]/g,"");if(H.length===0)return"";if(H.length===11&&H.startsWith("0"))return H.replace(/^(\d{3})(\d{4})(\d{4})$/,"$1-$2-$3");else if(H.length===10&&H.startsWith("0"))if(H.startsWith("0120")||H.startsWith("0800"))return H.replace(/^(\d{4})(\d{3})(\d{3})$/,"$1-$2-$3");else if(["03","04","06"].includes(H.substring(0,2)))return H.replace(/^(\d{2})(\d{4})(\d{4})$/,"$1-$2-$3");else return H.replace(/^(\d{3})(\d{3})(\d{4})$/,"$1-$2-$3");return H}initTables(){document.querySelectorAll(".data-table.dynamic tbody, .dynamic-container").forEach(($)=>{this.renumberRows($)})}renumberRows($){let H=Array.from($.querySelectorAll("tr"));if(H.length===0)H=Array.from($.querySelectorAll(".dynamic-row"));H.filter((Q)=>{return Q.tagName!=="TR"||Q.querySelectorAll("td").length>0}).forEach((Q,Z)=>{let U=Z+1;Q.querySelectorAll(".auto-num").forEach((Y)=>{if(Y.value!=U)Y.value=U.toString(),Y.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let H=$.closest("tr")||$.closest(".dynamic-row");if(!H)return;let X=H.parentElement;if(H.classList.contains("template-row"))H.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox")Q.checked=!1;else Q.value=""});else{if(H.remove(),X)this.renumberRows(X);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,H){let X=document.getElementById("tbl_"+H);if(!X)return;let Q=X.querySelector("tbody")||X;if(!Q)return;let Z=Q.querySelector(".template-row");if(!Z)return;let U=Z.cloneNode(!0);U.classList.remove("template-row"),U.querySelectorAll("input").forEach((G)=>{if(G.type==="checkbox")G.checked=G.hasAttribute("checked");else G.value=G.getAttribute("value")||""});let Y=U.querySelector(".remove-row-btn");if(Y)Y.style.visibility="visible";U.querySelectorAll("[data-copy-from]").forEach((G)=>{let q=G.dataset.copyFrom;if(q){let J=U.querySelector(`[data-base-key="${q}"]`);if(J&&J.value)G.value=J.value}}),Q.appendChild(U),this.renumberRows(Q),this.calc.recalculate()}switchTab($,H){document.querySelectorAll(".tab-btn").forEach((Q)=>Q.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((Q)=>Q.classList.remove("active")),$.classList.add("active");let X=document.getElementById(H);if(X)X.classList.add("active")}updateVisibility(){document.querySelectorAll("[data-show-if]").forEach(($)=>{let H=$.dataset.showIf;if(!H)return;let X=H.match(/^([a-zA-Z0-9_]+)\s*(==|!=)\s*(['"]?)(.*?)\3$/),Q=!0;if(X){let[U,Y,G,q,J]=X,B=document.querySelector(`[data-json-path="${Y}"]`);if(!B){let L=$.closest("tr");if(L)B=L.querySelector(`[data-json-path="${Y}"]`)}if(B){let L=(B.type==="checkbox"||B.type==="radio")&&B.checked?"true":(B.type==="checkbox"||B.type==="radio")&&!B.checked?"false":B.value;if(B.type==="radio"){let M=B.name,j=document.querySelector(`input[name="${M}"]:checked`)}let D=B.value;if(B.type==="checkbox")D=B.checked?"true":"false";if(B.type==="radio"){let M=B.name,j=document.querySelector(`input[name="${M}"]:checked`);D=j?j.value:""}if(G==="==")Q=D==J;if(G==="!=")Q=D!=J}else Q=!1}else{let U=H.trim(),Y=document.querySelector(`[data-json-path="${U}"]`);if(Y)if(Y.type==="checkbox")Q=Y.checked;else Q=!!Y.value;else Q=!1}let Z=$.closest(".form-row");if(Z)Z.style.display=Q?"":"none",Z.querySelectorAll("input, select, textarea").forEach((Y)=>{Y.disabled=!Q});else if($.style.display=Q?"":"none",$ instanceof HTMLInputElement||$ instanceof HTMLSelectElement||$ instanceof HTMLTextAreaElement)$.disabled=!Q})}}function x0($){let H=($.dataset.jsonPath||$.dataset.baseKey||$.name||$.id||"").toLowerCase(),X=[".","_","-"];for(let Q of X){if(!H.includes(Q))continue;let Z=H.split(Q);if(Z.length<2)continue;let U=Z[Z.length-1];return{group:Z.slice(0,-1).join(Q),separator:Q,fieldType:U,raw:H}}return{group:null,separator:null,fieldType:H,raw:H}}function Q8($,H){if(!$.group||!H.group)return!1;return $.group===H.group&&$.separator===H.separator}function M0($){if(!$)return null;if($.match(/zip|postal|postcode|/))return"zip";if($.match(/pref|/))return"pref";if($.match(/city||/))return"city";if($.match(/town|||/))return"town";if($.match(/address|/)&&!$.match(/detail|sub||building|room|mansion|house/))return"address";return null}function X$(){console.log("Web/A Runtime Booting...");let $=new G8,H=new b0,X=new S8($,H),Q=window,Z=()=>{if(Q.postalLookup&&!Q.__postalInitialized)Q.__postalInitialized=!0,Q.postalLookup.autoInit().then(()=>console.log("\uD83D\uDCEE Postal lookup ready."))},U=()=>{if(Q.lgLookup&&!Q.__lgInitialized)Q.__lgInitialized=!0,Q.lgLookup.autoInit().then(()=>console.log("\uD83C\uDFDB LG lookup ready."))};(async()=>{let J=Q.__WEBA_MANIFEST;if(J&&J.blobs){let L=J.blobs.find((D)=>D.id==="weba-structure");if(L&&L.urls){console.log("[Runtime] Found weba-structure in manifest");for(let D of L.urls)try{let M;if(D.startsWith("#")){let V=document.querySelector(D);if(!V||!V.textContent)continue;let E=atob(V.textContent.trim()),u=new Uint8Array(E.length);for(let c=0;c<E.length;c++)u[c]=E.charCodeAt(c);if(L.mediaType==="application/x-gzip"){let c=new Blob([u]).stream().pipeThrough(new DecompressionStream("gzip"));M=await new Response(c).text()}else M=new TextDecoder().decode(u)}else{let V=await fetch(D);if(!V.ok)continue;M=await V.text()}let j=JSON.parse(M);return console.log("[Runtime] Structure data loaded from blob. Keys:",Object.keys(j)),j}catch(M){console.warn("[Runtime] Failed to load structure from:",D,M)}}}let B=document.getElementById("weba-structure");if(B)return console.log("[Runtime] Loading structure from direct element"),await H$(B);return console.warn("[Runtime] weba-structure not found in manifest or DOM"),null})().then((J)=>{if(J){if(Q.generatedJsonStructure=J,console.log("[Runtime] generatedJsonStructure set"),X.applyI18n(),X.initTelFormatter(),$.recalculate(),X.updateVisibility(),h8(),Q.SearchEngine&&typeof Q.SearchEngine.init==="function")console.log("[Runtime] Calling SearchEngine.init()..."),Q.SearchEngine.init().catch((B)=>console.error("SearchEngine init failed:",B))}else console.warn("[Runtime] Failed to load structure data")}).catch((J)=>{console.error("[Runtime] Error loading structure:",J)});let G=document.getElementById("weba-l2-config");if(G)H$(G).then((J)=>{if(J)Q.webaL2Config=J,CX(J),PX(J)});if(Q.saveDraft=()=>H.saveDraft(),Q.submitDocument=()=>H.submitDocument(),Q.signAndDownload=()=>H.signAndDownload(),Q.clearData=()=>H.clearData(),Q.removeTableRow=(J)=>X.removeTableRow(J),Q.addTableRow=(J,B)=>X.addTableRow(J,B),Q.switchTab=(J,B)=>X.switchTab(J,B),Q.recalculate=()=>$.recalculate(),H.restoreFromLS(),X.applyI18n(),X.initTables(),$.recalculate(),Q.initL2Viewer)Q.initL2Viewer();if(Q.initKeywrapTool)Q.initKeywrapTool();if(Q.initAggregatorBrowser)Q.initAggregatorBrowser();Z(),U();let q;document.addEventListener("input",(J)=>{let B=J.target;if(!B||B.tagName!=="INPUT")return;if(J.isTrusted)B.dataset.dirty="true";let L=(B.dataset.jsonPath||B.name||"").toLowerCase(),D=B.value.trim(),M=Q.postalLookup,j=B.classList.contains("search-input");if(M&&M.isReady()&&!j){L=(B.dataset.jsonPath||B.dataset.baseKey||B.name||B.id||"").toLowerCase();let E=(B.placeholder||"").toLowerCase(),u=B.dataset.autofill||"",c="";if(u.startsWith("postal:"))c=u.replace("postal:","");else if(L.match(/zip|postal|postcode|/)&&!L.match(/pref|city|town|address|||/)||E.match(/|zip|postal/))c="zip";else if(L.match(/pref|/))c="pref";else if(L.match(/city|/))c="city";else if(L.match(/town||/))c="town";else if(L.match(/address|/))c="address";if(c){let F=B.getAttribute("list");if(!F){F=`dl-${Math.random().toString(36).substring(2,7)}`,B.setAttribute("list",F);let f=document.createElement("datalist");f.id=F,document.body.appendChild(f)}let w=document.getElementById(F);if(c==="zip"){let f=D.replace(/[^0-9]/g,"");if(w&&f.length>=3){let v=M.suggest(f,50);w.innerHTML=v.map((T)=>`<option value="${T.zip.substring(0,3)}-${T.zip.substring(3)}">${T.pref}${T.city}${T.town}</option><option value="${T.zip}">${T.pref}${T.city}${T.town}</option>`).join("")}if(f.length===7){let v=M.lookup(f);if(v)zX(B,v,B.closest("tr")||B.closest(".dynamic-row")||B.closest(".address-group")||B.closest("table")||B.closest("form")||document.body)}}else if(c==="pref"){if(w&&D.length>=1){let f=M.suggestByAddress(D,50),v=[...new Set(f.map((T)=>T.pref))].slice(0,10);w.innerHTML=v.map((T)=>`<option value="${T}">${T}</option>`).join("")}}else if(c==="city"){if(w&&D.length>=1){let f=M.suggestByAddress(D,50),v=[...new Set(f.map((T)=>T.city))].slice(0,20);w.innerHTML=v.map((T)=>`<option value="${T}">${T}</option>`).join("")}}else if(c==="town"||c==="address"){if(w&&D.length>=2){let f=M.suggestByAddress(D,30);w.innerHTML=f.map((v)=>`<option value="${v.town}">${v.pref}${v.city}${v.town}</option>`).join("")}}}}let V=Q.lgLookup;if(V&&V.isReady()&&!j){let E=B.dataset.autofill||"",u=(F)=>{let w=F.closest("tr")||F.closest(".dynamic-row")||F.closest(".group")||F.closest("form")||document.body,f=Array.from(w.querySelectorAll("input, select, textarea")),v=null,T=null,o=null;return f.forEach((d)=>{let B0=d.dataset.autofill||"",z0=(d.dataset.jsonPath||d.name||d.id||"").toLowerCase();if(B0==="lg"||z0.match(/lg_code|lgcode|/))v=d;else if(B0==="lg:pref"||z0.match(/pref|/))T=d;else if(B0==="lg:city"||z0.match(/city|/))o=d}),{codeField:v,prefField:T,cityField:o}},c=(F,w)=>{let{codeField:f,prefField:v,cityField:T}=u(w);[{field:f,value:F.code},{field:v,value:F.pref},{field:T,value:F.city}].forEach(({field:o,value:d})=>{if(o&&o!==w&&d&&o.value!==d)o.value=d,o.dataset.dirty="true",o.style.backgroundColor="#e0f2fe",setTimeout(()=>{o.style.backgroundColor=""},500),o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))})};if(E==="lg"){let F=B.getAttribute("list");if(!F){F=`dl-lg-${Math.random().toString(36).substring(2,7)}`,B.setAttribute("list",F);let v=document.createElement("datalist");v.id=F,document.body.appendChild(v)}let w=document.getElementById(F),f=D.replace(/[^0-9]/g,"");if(w&&f.length>=2&&f.length<6){let v=V.suggest(f,30);w.innerHTML=v.map((T)=>`<option value="${T.code}">${T.pref} ${T.city}</option>`).join("")}if(f.length===6){let v=V.lookup(f);if(v)c(v,B)}}else if(E==="lg:pref"){let F=B.getAttribute("list");if(!F){F=`dl-lg-pref-${Math.random().toString(36).substring(2,7)}`,B.setAttribute("list",F);let f=document.createElement("datalist");f.id=F,document.body.appendChild(f)}let w=document.getElementById(F);if(w&&D.length>=1){let v=V.getUniquePrefectures().filter((T)=>T.includes(D)).slice(0,20);w.innerHTML=v.map((T)=>`<option value="${T}">${T}</option>`).join("")}}else if(E==="lg:city"){let F=B.getAttribute("list");if(!F){F=`dl-lg-city-${Math.random().toString(36).substring(2,7)}`,B.setAttribute("list",F);let f=document.createElement("datalist");f.id=F,document.body.appendChild(f)}let w=document.getElementById(F);if(w&&D.length>=1){let{prefField:f}=u(B),v=f?f.value.trim():"",T;if(v)T=V.suggestCitiesByPref(v,D,30),w.innerHTML=T.map((d)=>`<option value="${d.city}">${d.city}</option>`).join("");else T=V.suggestByCity(D,void 0,30),w.innerHTML=T.map((d)=>`<option value="${d.city}">${d.pref} ${d.city}</option>`).join("");let o=T.find((d)=>d.city===D);if(o)c(o,B)}}}if(B.classList.contains("search-input")&&Q.SearchEngine);if(L)(B.closest("tr")||B.closest(".dynamic-row")||B.closest(".group")||document).querySelectorAll(`[data-copy-from="${L}"]`).forEach((u)=>{if(!u.dataset.dirty&&u.value!==B.value)u.value=B.value,u.dispatchEvent(new Event("input",{bubbles:!0}))});$.recalculate(),X.updateVisibility(),H.updateJsonLd(),h8(),clearTimeout(q),q=setTimeout(()=>H.saveToLS(),1000)}),setTimeout(h8,500),document.addEventListener("change",(J)=>{let B=J.target;if(!B||B.tagName!=="INPUT")return;let L=B.dataset.autofill||"",D=Q.lgLookup;if(D&&D.isReady()&&L==="lg:city"){let M=B.value.trim();if(!M)return;let j=B.closest("tr")||B.closest(".dynamic-row")||B.closest(".group")||B.closest("form")||document.body,V=Array.from(j.querySelectorAll("input, select, textarea")),E=null;V.forEach((w)=>{let f=w.dataset.autofill||"",v=(w.dataset.jsonPath||w.name||w.id||"").toLowerCase();if(f==="lg:pref"||v.match(/pref|/))E=w});let u=E?E.value.trim():"",F=(u?D.suggestCitiesByPref(u,M,50):D.suggestByCity(M,void 0,50)).find((w)=>w.city===M);if(F)V.forEach((w)=>{if(w===B)return;let f=w.dataset.autofill||"",v=(w.dataset.jsonPath||w.name||w.id||"").toLowerCase(),T="";if(f==="lg"||v.match(/lg_code|lgcode|/))T=F.code;else if(f==="lg:pref"||v.match(/pref|/))T=F.pref;if(T&&w.value!==T)w.value=T,w.dataset.dirty="true",w.style.backgroundColor="#e0f2fe",setTimeout(()=>{w.style.backgroundColor=""},500),w.dispatchEvent(new Event("input",{bubbles:!0})),w.dispatchEvent(new Event("change",{bubbles:!0}))}),$.recalculate(),X.updateVisibility(),H.updateJsonLd()}}),console.log("Web/A Runtime Ready.")}function MX(){let $=window;if(!$.generatedJsonStructure||!$.generatedJsonStructure.fields)return!1;let H=Array.from(document.querySelectorAll("input, select, textarea"));for(let X of H){if(X.offsetParent===null)continue;let Q=X.dataset.jsonPath||X.name;if(!Q)continue;let Z=$.generatedJsonStructure.fields.find((U)=>U.key===Q);if(Z&&Z.required){if(X.type==="checkbox"){if(!X.checked)return console.log(`[Validation] Required Checkbox missing: ${Q}`),!1}else if(X.type==="radio"){let U=document.getElementsByName(X.name),Y=!1;for(let G=0;G<U.length;G++)if(U[G].checked){Y=!0;break}if(!Y)return console.log(`[Validation] Required Radio missing: ${Q}`),!1}else if(!X.value.trim())return console.log(`[Validation] Required Field empty: ${Q}`),!1}}return!0}function h8(){let $=document.getElementById("btn-submit");if(!$)return;let H=MX();$.disabled=!H,$.style.opacity=H?"1":"0.5",$.style.cursor=H?"pointer":"not-allowed",$.title=H?"":"Please fill in all required fields"}function zX($,H,X,Q=!1){let Z=x0($);if(!Z.group){console.warn("[fillAddress] :",Z.raw);return}let Y=Array.from(X.querySelectorAll("input, select, textarea")).map((B)=>({element:B,parsed:x0(B)})).filter(({parsed:B})=>Q8(Z,B)),G=Y.some(({element:B,parsed:L})=>{if(B===$)return!1;return M0(L.fieldType||"")==="pref"}),q=Y.some(({element:B,parsed:L})=>{if(B===$)return!1;return M0(L.fieldType||"")==="city"}),J=Y.some(({element:B,parsed:L})=>{if(B===$)return!1;return M0(L.fieldType||"")==="town"});Y.forEach(({element:B,parsed:L})=>{if(B===$)return;let D=M0(L.fieldType||""),M="";if(Q&&D==="zip")M=H.zip.substring(0,3)+"-"+H.zip.substring(3);else if(D==="pref")M=H.pref;else if(D==="city")M=H.city;else if(D==="town")M=H.town;else if(D==="address"){if(!G&&!q&&!J)M=`${H.pref}${H.city}${H.town}`;else if(G&&!q&&!J)M=`${H.city}${H.town}`;else if(!J)M=H.town}if(M&&B.value!==M)B.value=M,B.dataset.dirty="true",B.style.backgroundColor="#e0f2fe",setTimeout(()=>{B.style.backgroundColor=""},500),B.dispatchEvent(new Event("input",{bubbles:!0})),B.dispatchEvent(new Event("change",{bubbles:!0}))})}async function H$($){if(!$.textContent)return null;let H=$.textContent.trim();if($.type==="application/x-gzip")try{let X=atob(H),Q=new Uint8Array(X.length);for(let U=0;U<X.length;U++)Q[U]=X.charCodeAt(U);let Z=new Blob([Q]).stream().pipeThrough(new DecompressionStream("gzip"));H=await new Response(Z).text()}catch(X){return null}try{return JSON.parse(H)}catch(X){return null}}function CX($){let H=document.querySelector(".form-toolbar");if(!H)return;let X=document.createElement("div");X.id="weba-security-signal",X.className="security-badge",H.appendChild(X),(async()=>{let Q="offline";if($.prekey_url)try{if((await fetch($.prekey_url,{method:"HEAD"})).ok)Q="high"}catch(Z){}window.dispatchEvent(new CustomEvent("weba-security-tier-change",{detail:{tier:Q}}))})()}function PX($){if(!$?.enabled||!window.PublicKeyCredential)return;let H=document.querySelector('button[onclick*="signAndDownload"]');if(H&&H.parentElement){let X=document.createElement("div");X.className="weba-guest-opt no-print",X.style.cssText="display:flex;align-items:center;gap:6px;margin-right:12px;",X.innerHTML='<input type="checkbox" id="weba-guest-did-opt"><label for="weba-guest-did-opt" style="font-size:13px;color:#555;cursor:pointer;"> (Passkey)</label>',H.parentElement.insertBefore(X,H)}}var Y8=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];class Q${data={};initialized=!1;instanceId=Math.random().toString(36).substring(7);constructor(){console.log("[PostalLookup] New instance created:",this.instanceId)}async loadFromBase64($){try{let H=atob($),X=new Uint8Array(H.length);for(let Z=0;Z<H.length;Z++)X[Z]=H.charCodeAt(Z);let Q;if(X[0]===31&&X[1]===139)if(typeof DecompressionStream!=="undefined"){let Z=new DecompressionStream("gzip"),U=new Blob([X]).stream().pipeThrough(Z);Q=await new Response(U).text()}else throw new Error("DecompressionStream not supported");else Q=new TextDecoder().decode(X);this.data=JSON.parse(Q),this.initialized=!0,console.log("\uD83D\uDCEE Postal lookup initialized:",Object.keys(this.data).length,"prefixes","[Instance:",this.instanceId+"]")}catch(H){console.error("Failed to load postal data:",H)}}async loadFromManifest(){let $=window.__WEBA_MANIFEST;if(!$||!$.blobs)return!1;let H=$.blobs.find((X)=>X.id==="jp-postal");if(!H||!H.urls||H.urls.length===0)return!1;for(let X of H.urls)try{if(X.startsWith("#")){let Q=document.querySelector(X);if(Q&&Q.textContent){if(console.log("\uD83D\uDCEE Loading postal data from embedded source:",X),await this.loadFromBase64(Q.textContent.trim()),this.initialized)return this._activeDigest=H.digest,!0}}else{console.log("\uD83D\uDCEE Loading postal data from network:",X);let Q=await fetch(X);if(!Q.ok)continue;let Z=await Q.blob(),U,Y=new Uint8Array(await Z.slice(0,2).arrayBuffer());if(Y[0]===31&&Y[1]===139)if(typeof DecompressionStream!=="undefined"){let G=new DecompressionStream("gzip"),q=Z.stream().pipeThrough(G);U=await new Response(q).text()}else throw new Error("DecompressionStream not supported");else U=await Z.text();return this.data=JSON.parse(U),this.initialized=!0,this._activeDigest=H.digest,console.log("\uD83D\uDCEE Postal lookup initialized via Network:",Object.keys(this.data).length,"prefixes"),!0}}catch(Q){console.warn(`Failed to load postal from ${X}:`,Q)}return!1}async autoInit(){if(this.initialized){console.log("\uD83D\uDCEE Postal lookup already initialized, skipping");return}if(await this.loadFromManifest())return;let $=document.getElementById("weba-postal-data");if($&&$.textContent)await this.loadFromBase64($.textContent.trim());else console.warn("No postal data found in document")}getActiveDigest(){return this._activeDigest||null}lookup($){if(!this.initialized)return null;let H=$.replace(/[^0-9]/g,"");if(H.length!==7)return null;let X=H.substring(0,3),Q=H.substring(3),Z=this.data[X];if(!Z)return null;let U=Z.t.find(([Y])=>Y===Q);if(!U)return null;return{zip:H,pref:Y8[Z.p-1],city:U[1],town:U[2]}}suggest($,H=50){if(!this.initialized)return[];let X=$.replace(/[^0-9]/g,"");if(X.length<3)return[];let Q=X.substring(0,3),Z=X.substring(3),U=[],Y=this.data[Q];if(Y){for(let[G,q,J]of Y.t)if(!Z||G.startsWith(Z)){if(U.push({zip:Q+G,pref:Y8[Y.p-1],city:q,town:J}),U.length>=H)return U}}return U}getPrefixCandidates($){if(!this.initialized)return[];let H=$.replace(/[^0-9]/g,"");if(H.length!==3)return[];let X=this.data[H];if(!X)return[];return X.t.map(([Q,Z,U])=>({zip:H+Q,pref:Y8[X.p-1],city:Z,town:U}))}suggestByAddress($,H=30){if(!this.initialized||$.length<2)return[];let X=[],Q=$.trim();for(let Z in this.data){if(!Object.prototype.hasOwnProperty.call(this.data,Z))continue;let U=this.data[Z];if(!U)continue;let Y=Y8[U.p-1]||"";for(let[G,q,J]of U.t)if((Y+q+J).includes(Q)){if(X.push({zip:Z+G,pref:Y,city:q,town:J}),X.length>=H)return X}}return X}isReady(){return this.initialized}}var k8=new Q$;if(typeof window!=="undefined")if(!window.postalLookup)console.log("[PostalLookup] Registering instance to window:",k8.instanceId),window.postalLookup=k8;else console.log("[PostalLookup] window.postalLookup already exists, skipping registration. Existing instance:",window.postalLookup.instanceId,"New instance:",k8.instanceId);function y0($){if(!$)return"";return $.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}class b8{suggestionsVisible=!1;activeSearchInput=null;globalBox=null;postalReady=!1;constructor(){}async initPostalLookup(){try{let $=window.postalLookup;if($){if(await $.autoInit(),this.postalReady=$.isReady(),this.postalReady)console.log("\uD83D\uDCEE Postal lookup enabled")}}catch($){console.warn("Postal lookup not available:",$)}}async init(){console.log("Initializing Search Engine (Bundle)..."),await this.initPostalLookup();let H=window.generatedJsonStructure;if(H){if(H.masterDataRefs)await this.loadMasterDataFromBlobs(H);if(H.masterData){let X=Object.keys(H.masterData);console.log("Master Data Keys available:",X.join(", "))}}this.setupEventDelegation(),console.log("Search Engine ready. Postal enabled:",this.postalReady)}async loadMasterDataFromBlobs($){let H=window.__WEBA_MANIFEST;if(!H||!H.blobs)return;let X=$.masterDataRefs;$.masterData=$.masterData||{};for(let[Q,Z]of Object.entries(X)){let U=H.blobs.find((Y)=>Y.digest===Z);if(!U||!U.urls)continue;for(let Y of U.urls)try{let G;if(Y.startsWith("#")){let q=document.querySelector(Y);if(!q||!q.textContent)continue;let J=atob(q.textContent.trim()),B=new Uint8Array(J.length);for(let D=0;D<J.length;D++)B[D]=J.charCodeAt(D);let L=new Blob([B]).stream().pipeThrough(new DecompressionStream("gzip"));G=await new Response(L).text()}else{let q=await fetch(Y);if(!q.ok)continue;G=await q.text()}$.masterData[Q]=JSON.parse(G),console.log(`\uD83D\uDCEE Master data '${Q}' loaded from blob:`,Z);break}catch(G){console.warn(`Failed to load master data blob ${Q} from ${Y}:`,G)}}}normalize($){if(!$)return"";let H=$.toString().toLowerCase();return H=H.replace(/[---]/g,(X)=>{return String.fromCharCode(X.charCodeAt(0)-65248)}),H=H.replace(/[-]/g,(X)=>String.fromCharCode(X.charCodeAt(0)-65248)),H.trim()}clean($){if(!$)return"";let H=this.normalize($);return H=H.replace(/(|||||npo||)/g,""),H=H.replace(/(\(\)|\(\)|\(\))/g,""),H.trim()}toIndex($){let H=parseInt($||"",10);return Number.isFinite(H)?H-1:-1}isPostalField($){if(($.dataset.autofill||"").startsWith("postal:"))return!0;let X=($.dataset.jsonPath||$.dataset.baseKey||$.name||$.id||"").toLowerCase(),Q=($.placeholder||"").toLowerCase(),Z=X.match(/zip|postal|postcode|/)&&!X.match(/pref|city|town|address|||/),U=Q.match(/|zip|postal/);return Boolean(Z||U)}handlePostalInput($){if(console.log("[SearchEngine] handlePostalInput - postalReady:",this.postalReady),!this.postalReady){console.log("[SearchEngine] Postal not ready, hiding suggestions"),this.hideSuggestions();return}let H=$.value.replace(/[^0-9]/g,"");if(console.log("[SearchEngine] Cleaned postal value:",H),H.length<3){console.log("[SearchEngine] Value too short (<3), hiding suggestions"),this.hideSuggestions();return}let X=window.postalLookup;if(!X){console.log("[SearchEngine] ERROR: postalLookup not found on window");return}if(H.length===7){console.log("[SearchEngine] 7-digit zip, doing lookup");let Z=X.lookup(H);if(console.log("[SearchEngine] Lookup result:",Z),Z)this.fillPostalData($,Z,!0),this.hideSuggestions();return}console.log("[SearchEngine] Partial zip, getting suggestions");let Q=X.suggest(H,50);if(console.log("[SearchEngine] Got",Q.length,"suggestions"),Q.length>0)this.renderPostalSuggestions($,Q);else this.hideSuggestions()}renderPostalSuggestions($,H){let X="";H.forEach((G)=>{let q=G.zip.substring(0,3)+"-"+G.zip.substring(3),J=`${G.pref} ${G.city} ${G.town}`,B=y0(JSON.stringify(G));X+=`<div class="suggestion-item postal-item" data-postal="${B}" style="padding:6px 8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333; display:flex; gap:12px; align-items:center;">
                <span style="color:#3b82f6; flex-shrink:0; min-width:85px;">${q}</span>
                <span style="color:#666; flex-grow:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${y0(J)}</span>
            </div>`});let Q=this.getGlobalBox();Q.innerHTML=X;let Z=$.getBoundingClientRect(),U=window.scrollY||document.documentElement.scrollTop,Y=window.scrollX||document.documentElement.scrollLeft;Q.style.width=Math.max(Z.width,400)+"px",Q.style.left=Z.left+Y+"px",Q.style.top=Z.bottom+U+"px",Q.style.maxHeight="360px",Q.style.overflowY="auto",Q.querySelectorAll(".suggestion-item").forEach((G)=>{G.onmouseenter=()=>G.style.background="#f0f8ff",G.onmouseleave=()=>G.style.background="white"}),Q.style.display="block",this.suggestionsVisible=!0}fillPostalData($,H,X=!1){if(X)$.value=H.zip.substring(0,3)+"-"+H.zip.substring(3);let Q=x0($);if(!Q.group){console.warn("[fillPostalData] :",Q.raw,": sender.zip, sender_zip, sender-zip");return}console.log("[fillPostalData] Source field group:",Q.group,"separator:",Q.separator);let Z=$.closest(".dynamic-row")||$.closest(".address-group")||$.closest("table")||$.closest("form")||$.closest(".form-row")?.parentElement||document,U=Z===document?"document":$.closest("tr")?"tr":$.closest(".dynamic-row")?"dynamic-row":$.closest(".address-group")?"address-group":$.closest("table")?"table":$.closest("form")?"form":"form-row";console.log("[fillPostalData] Container type:",U,"Source group:",Q.group);let G=Array.from(Z.querySelectorAll("input, select, textarea")).map((M)=>({element:M,parsed:x0(M)})).filter(({parsed:M})=>Q8(Q,M));console.log("[fillPostalData] Found",G.length,"fields in same group:",Q.group);let q=new Map;for(let{element:M,parsed:j}of G){if(M===$)continue;let V=M0(j.fieldType||"");if(V&&!q.has(V))q.set(V,M)}let J=q.get("pref");if(J)J.value=H.pref,J.dispatchEvent(new Event("input",{bubbles:!0})),console.log("[fillPostalData] Filled pref:",J.dataset.jsonPath||J.name);let B=q.get("city");if(B)B.value=H.city,B.dispatchEvent(new Event("input",{bubbles:!0})),console.log("[fillPostalData] Filled city:",B.dataset.jsonPath||B.name);let L=q.get("town");if(L)L.value=H.town,L.dispatchEvent(new Event("input",{bubbles:!0})),console.log("[fillPostalData] Filled town:",L.dataset.jsonPath||L.name);let D=q.get("address");if(D){let M="";if(!J&&!B&&!L)M=`${H.pref}${H.city}${H.town}`;else if(J&&!B&&!L)M=`${H.city}${H.town}`;else if(!L)M=H.town;if(M)D.value=M,D.dispatchEvent(new Event("input",{bubbles:!0})),console.log("[fillPostalData] Filled address:",D.dataset.jsonPath||D.name,"=",M)}if(q.size===0)console.warn("[fillPostalData] :",Q.group)}getGlobalBox(){if(this.globalBox&&!document.body.contains(this.globalBox))this.globalBox=null;if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){console.log("[SearchEngine] Setting up event delegation"),document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if(console.log("[SearchEngine] Input event on:",$.target.tagName,"classList:",$.target.classList.value),$.target.classList.contains("search-input"))console.log("[SearchEngine] Target has search-input class, handling"),this.handleSearchInput($.target);else console.log("[SearchEngine] Target does not have search-input class, ignoring")}),document.body.addEventListener("click",($)=>{let X=$.target?.closest?.(".suggestion-item");if(X)this.handleSelection(X)})}handleSearchInput($){this.activeSearchInput=$;let H=window;if(console.log("[SearchEngine] handleSearchInput called for:",$.dataset.jsonPath||$.name,"value:",$.value),this.isPostalField($)){console.log("[SearchEngine] Detected as postal field, calling handlePostalInput"),this.handlePostalInput($);return}let X=$.dataset.masterSrc,Q=$.dataset.suggestSource;if(!X&&!Q)return;let Z=this.toIndex($.dataset.masterLabelIndex),U=this.toIndex($.dataset.masterValueIndex),Y=$.value;if(!Y){this.hideSuggestions();return}let G=[],q=this.normalize(Y);if(Q==="column"){let J=$.dataset.baseKey,B=$.closest("table");if(B&&J){let L=new Set;B.querySelectorAll(`[data-base-key="${J}"]`).forEach((D)=>{if(D===$)return;let M=D.value;if(M&&this.normalize(M).includes(q)){if(!L.has(M))L.add(M),G.push({val:M,row:[M],label:M,score:10})}})}}else if(X){if(console.log("[SearchEngine] Master search requested. srcKey:",X),console.log("[SearchEngine] generatedJsonStructure exists?",!!H.generatedJsonStructure),H.generatedJsonStructure){if(console.log("[SearchEngine] masterData exists?",!!H.generatedJsonStructure.masterData),H.generatedJsonStructure.masterData)console.log("[SearchEngine] Available master keys:",Object.keys(H.generatedJsonStructure.masterData))}if(!H.generatedJsonStructure||!H.generatedJsonStructure.masterData)return;let J=H.generatedJsonStructure.masterData;if(!J[X]){console.log("[SearchEngine] Master key not found:",X);return}J[X].forEach((L,D)=>{if(D===0)return;if(L.some((j)=>this.normalize(j||"").includes(q))){let j=Z>=0?L[Z]||"":"",V=U>=0?L[U]||"":"",E=U>=0?V:Z>=0?j:L[1]||L[0]||"";G.push({val:E,row:L,label:j,score:10,idx:D})}})}this.renderSuggestions($,G,Z)}renderSuggestions($,H,X){if(H.length===0){this.hideSuggestions();return}let Q=H.slice(0,10),Z="";Q.forEach((J)=>{let B=y0(JSON.stringify(J.row)),L=X>=0?J.label||J.row.join(" : "):J.row.join(" : ");Z+=`<div class="suggestion-item" data-val="${y0(J.val)}" data-row="${B}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${y0(L)}</div>`});let U=this.getGlobalBox();U.innerHTML=Z;let Y=$.getBoundingClientRect(),G=window.scrollY||document.documentElement.scrollTop,q=window.scrollX||document.documentElement.scrollLeft;U.style.width=Math.max(Y.width,200)+"px",U.style.left=Y.left+q+"px",U.style.top=Y.bottom+G+"px",U.style.maxHeight="300px",U.style.overflowY="auto",U.querySelectorAll(".suggestion-item").forEach((J)=>{J.onmouseenter=()=>J.style.background="#f0f8ff",J.onmouseleave=()=>J.style.background="white"}),U.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;if($.classList.contains("postal-item")){let U=$.dataset.postal;if(U)try{let Y=JSON.parse(U);this.fillPostalData(this.activeSearchInput,Y,!0)}catch(Y){console.error("Failed to parse postal data:",Y)}this.hideSuggestions();return}let H=window,X=this.activeSearchInput,Q=$.dataset.val||"",Z=$.dataset.row||"[]";try{let U=JSON.parse(Z),Y=X.dataset.masterSrc,G=Y?H.generatedJsonStructure.masterData[Y][0]:[],q=!1;if(G.length>0&&U.length>0){let J=X.closest("tr");if(J){let B=Array.from(J.querySelectorAll("input, select, textarea"));G.forEach((L,D)=>{if(!L)return;let M=U[D];this.fillField(B,L,M,X,()=>{q=!0})})}}if(!q)X.value=Q,X.dispatchEvent(new Event("input",{bubbles:!0}))}catch(U){console.error(U)}this.hideSuggestions()}fillField($,H,X,Q,Z){let U=this.normalize(H),Y=$.find((G)=>{let q=G.dataset.baseKey||G.dataset.jsonPath,J=this.normalize(G.getAttribute("placeholder")||"");return q&&this.normalize(q)===U||J===U});if(Y){if(Y.value=X||"",Y.dispatchEvent(new Event("input",{bubbles:!0})),Y===Q)Z()}}}var Y$=new b8;window.GlobalSearch=Y$;window.SearchEngine=Y$;X$();
