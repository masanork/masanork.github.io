var N=["北海道","青森県","岩手県","宮城県","秋田県","山形県","福島県","茨城県","栃木県","群馬県","埼玉県","千葉県","東京都","神奈川県","新潟県","富山県","石川県","福井県","山梨県","長野県","岐阜県","静岡県","愛知県","三重県","滋賀県","京都府","大阪府","兵庫県","奈良県","和歌山県","鳥取県","島根県","岡山県","広島県","山口県","徳島県","香川県","愛媛県","高知県","福岡県","佐賀県","長崎県","熊本県","大分県","宮崎県","鹿児島県","沖縄県"];class O{data={};initialized=!1;async loadFromBase64(G){try{let A=atob(G),h=new Uint8Array(A.length);for(let v=0;v<A.length;v++)h[v]=A.charCodeAt(v);let H;if(h[0]===31&&h[1]===139)if(typeof DecompressionStream!=="undefined"){let v=new DecompressionStream("gzip"),B=new Blob([h]).stream().pipeThrough(v);H=await new Response(B).text()}else throw new Error("DecompressionStream not supported");else H=new TextDecoder().decode(h);this.data=JSON.parse(H),this.initialized=!0,console.log("\uD83D\uDCEE Postal lookup initialized:",Object.keys(this.data).length,"prefixes")}catch(A){console.error("Failed to load postal data:",A)}}async autoInit(){if(this.initialized){console.log("\uD83D\uDCEE Postal lookup already initialized, skipping");return}let G=document.getElementById("weba-postal-data");if(G&&G.textContent)await this.loadFromBase64(G.textContent.trim());else console.warn("No postal data found in document")}lookup(G){if(!this.initialized)return null;let A=G.replace(/[^0-9]/g,"");if(A.length!==7)return null;let h=A.substring(0,3),H=A.substring(3),v=this.data[h];if(!v)return null;let B=v.t.find(([I])=>I===H);if(!B)return null;return{zip:A,pref:N[v.p-1],city:B[1],town:B[2]}}suggest(G,A=50){if(!this.initialized)return[];let h=G.replace(/[^0-9]/g,"");if(h.length<3)return[];let H=h.substring(0,3),v=h.substring(3),B=[],I=this.data[H];if(I){for(let[J,K,M]of I.t)if(!v||J.startsWith(v)){if(B.push({zip:H+J,pref:N[I.p-1],city:K,town:M}),B.length>=A)return B}}return B}getPrefixCandidates(G){if(!this.initialized)return[];let A=G.replace(/[^0-9]/g,"");if(A.length!==3)return[];let h=this.data[A];if(!h)return[];return h.t.map(([H,v,B])=>({zip:A+H,pref:N[h.p-1],city:v,town:B}))}suggestByAddress(G,A=30){if(!this.initialized||G.length<2)return[];let h=[],H=G.trim();for(let v in this.data){if(!Object.prototype.hasOwnProperty.call(this.data,v))continue;let B=this.data[v];if(!B)continue;let I=N[B.p-1]||"";for(let[J,K,M]of B.t)if((I+K+M).includes(H)){if(h.push({zip:v+J,pref:I,city:K,town:M}),h.length>=A)return h}}return h}isReady(){return this.initialized}}var V=new O;if(typeof window!=="undefined")window.postalLookup=V;export{V as postalLookup,O as PostalLookup};
