var V=["北海道","青森県","岩手県","宮城県","秋田県","山形県","福島県","茨城県","栃木県","群馬県","埼玉県","千葉県","東京都","神奈川県","新潟県","富山県","石川県","福井県","山梨県","長野県","岐阜県","静岡県","愛知県","三重県","滋賀県","京都府","大阪府","兵庫県","奈良県","和歌山県","鳥取県","島根県","岡山県","広島県","山口県","徳島県","香川県","愛媛県","高知県","福岡県","佐賀県","長崎県","熊本県","大分県","宮崎県","鹿児島県","沖縄県"];class X{data={};initialized=!1;instanceId=Math.random().toString(36).substring(7);constructor(){console.log("[PostalLookup] New instance created:",this.instanceId)}async loadFromBase64(J){try{let B=atob(J),A=new Uint8Array(B.length);for(let G=0;G<B.length;G++)A[G]=B.charCodeAt(G);let H;if(A[0]===31&&A[1]===139)if(typeof DecompressionStream!=="undefined"){let G=new DecompressionStream("gzip"),I=new Blob([A]).stream().pipeThrough(G);H=await new Response(I).text()}else throw new Error("DecompressionStream not supported");else H=new TextDecoder().decode(A);this.data=JSON.parse(H),this.initialized=!0,console.log("\uD83D\uDCEE Postal lookup initialized:",Object.keys(this.data).length,"prefixes","[Instance:",this.instanceId+"]")}catch(B){console.error("Failed to load postal data:",B)}}async loadFromManifest(){let J=window.__WEBA_MANIFEST;if(!J||!J.blobs)return!1;let B=J.blobs.find((A)=>A.id==="jp-postal");if(!B||!B.urls||B.urls.length===0)return!1;for(let A of B.urls)try{if(A.startsWith("#")){let H=document.querySelector(A);if(H&&H.textContent){if(console.log("\uD83D\uDCEE Loading postal data from embedded source:",A),await this.loadFromBase64(H.textContent.trim()),this.initialized)return this._activeDigest=B.digest,!0}}else{console.log("\uD83D\uDCEE Loading postal data from network:",A);let H=await fetch(A);if(!H.ok)continue;let G=await H.blob(),I,K=new Uint8Array(await G.slice(0,2).arrayBuffer());if(K[0]===31&&K[1]===139)if(typeof DecompressionStream!=="undefined"){let M=new DecompressionStream("gzip"),N=G.stream().pipeThrough(M);I=await new Response(N).text()}else throw new Error("DecompressionStream not supported");else I=await G.text();return this.data=JSON.parse(I),this.initialized=!0,this._activeDigest=B.digest,console.log("\uD83D\uDCEE Postal lookup initialized via Network:",Object.keys(this.data).length,"prefixes"),!0}}catch(H){console.warn(`Failed to load postal from ${A}:`,H)}return!1}async autoInit(){if(this.initialized){console.log("\uD83D\uDCEE Postal lookup already initialized, skipping");return}if(await this.loadFromManifest())return;let J=document.getElementById("weba-postal-data");if(J&&J.textContent)await this.loadFromBase64(J.textContent.trim());else console.warn("No postal data found in document")}getActiveDigest(){return this._activeDigest||null}lookup(J){if(!this.initialized)return null;let B=J.replace(/[^0-9]/g,"");if(B.length!==7)return null;let A=B.substring(0,3),H=B.substring(3),G=this.data[A];if(!G)return null;let I=G.t.find(([K])=>K===H);if(!I)return null;return{zip:B,pref:V[G.p-1],city:I[1],town:I[2]}}suggest(J,B=50){if(!this.initialized)return[];let A=J.replace(/[^0-9]/g,"");if(A.length<3)return[];let H=A.substring(0,3),G=A.substring(3),I=[],K=this.data[H];if(K){for(let[M,N,O]of K.t)if(!G||M.startsWith(G)){if(I.push({zip:H+M,pref:V[K.p-1],city:N,town:O}),I.length>=B)return I}}return I}getPrefixCandidates(J){if(!this.initialized)return[];let B=J.replace(/[^0-9]/g,"");if(B.length!==3)return[];let A=this.data[B];if(!A)return[];return A.t.map(([H,G,I])=>({zip:B+H,pref:V[A.p-1],city:G,town:I}))}suggestByAddress(J,B=30){if(!this.initialized||J.length<2)return[];let A=[],H=J.trim();for(let G in this.data){if(!Object.prototype.hasOwnProperty.call(this.data,G))continue;let I=this.data[G];if(!I)continue;let K=V[I.p-1]||"";for(let[M,N,O]of I.t)if((K+N+O).includes(H)){if(A.push({zip:G+M,pref:K,city:N,town:O}),A.length>=B)return A}}return A}isReady(){return this.initialized}}var W=new X;if(typeof window!=="undefined")if(!window.postalLookup)console.log("[PostalLookup] Registering instance to window:",W.instanceId),window.postalLookup=W;else console.log("[PostalLookup] window.postalLookup already exists, skipping registration. Existing instance:",window.postalLookup.instanceId,"New instance:",W.instanceId);export{W as postalLookup,X as PostalLookup};
